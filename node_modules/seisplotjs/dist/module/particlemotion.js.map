{"version":3,"file":"particlemotion.js","sources":["../../src/particlemotion.js"],"sourcesContent":["// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as d3 from 'd3';\n\nimport {\n    createPlotsBySelectorPromise\n  } from './plotutil.js';\n\nimport {insertCSS} from './cssutil.js';\nimport { SeismographConfig } from './seismographconfig';\nimport {SeismogramSegment, Seismogram, SeismogramDisplayData } from './seismogram.js';\nimport { isDef, isNumArg, StartEndDuration } from './util.js';\n\n/**\n * Creates particle motion plots, for each selected element. This assumes each\n * element has some combination of start, end, duration, net, sta, loc, and chan\n * attributes sufficient to form the data query to return all components of\n * motion. Or an href to a miniseed file.\n *\n * @param selector css selector\n */\nexport function createParticleMotionBySelector(selector: string): void {\n    createPlotsBySelectorPromise(selector)\n    .then(function(resultArray) {\n      resultArray.forEach(function(result) {\n        result.svgParent.append(\"p\").text(\"Build plot\");\n        const sddList = result.sddList;\n          if (sddList.length >1) {\n            addDivForParticleMotion(result.svgParent, sddList[0], sddList[1]);\n            if (sddList.length > 2) {\n              addDivForParticleMotion(result.svgParent, sddList[0], sddList[2]);\n              addDivForParticleMotion(result.svgParent, sddList[1], sddList[2]);\n            }\n          } else {\n            result.svgParent.append(\"p\").text(`Not Enough Data: ${sddList.length}`);\n          }\n      });\n    });\n  }\n\nexport function addDivForParticleMotion(svgParent: any, xSeisData: SeismogramDisplayData, ySeisData: SeismogramDisplayData, timeWindow?: StartEndDuration): ParticleMotion {\n  let svgDiv = svgParent.append(\"div\");\n  if ( ! isDef(xSeisData)) {throw new Error(\"xSeisData cannot be null\");}\n  if ( ! isDef(ySeisData)) {throw new Error(\"ySeisData cannot be null\");}\n  const xSeis = xSeisData.seismogram;\n  const ySeis = ySeisData.seismogram;\n  const xLabel = xSeis ? xSeis.channelCode : \"unknown\";\n  const yLabel = ySeis ? ySeis.channelCode : \"unknown\";\n  svgDiv.classed(xLabel+\" \"+yLabel, true);\n  svgDiv.classed(\"particleMotionContainer\", true);\n  return addParticleMotion(svgDiv, xSeisData, ySeisData, timeWindow);\n}\n\nexport function addParticleMotion(svgParent: any, xSeisData: SeismogramDisplayData, ySeisData: SeismogramDisplayData, timeWindow?: StartEndDuration): ParticleMotion {\n  if ( ! isDef(xSeisData.seismogram) || ! isDef(ySeisData.seismogram)) {\n    // $FlowFixMe\n    throw new Error(`Seismogram has no data: ${xSeisData.seismogram} ${ySeisData.seismogram}`);\n  }\n  const xSeis = xSeisData.seismogram;\n  const ySeis = ySeisData.seismogram;\n\n  let seisConfig = new SeismographConfig();\n  if (isDef(timeWindow)) {\n    seisConfig.fixedTimeScale = timeWindow;\n  }\n  seisConfig.title = xSeis.channelCode+\" \"+ySeis.channelCode;\n  seisConfig.xLabel = xSeis.channelCode;\n  seisConfig.yLabel = ySeis.channelCode;\n  seisConfig.margin.top = seisConfig.margin.bottom;\n  seisConfig.margin.right = seisConfig.margin.left;\n  let pmp = new ParticleMotion(svgParent, seisConfig, xSeisData, ySeisData);\n  pmp.draw();\n  return pmp;\n}\n\n/**\n * Particle motion plot.\n *\n * @param inSvgParent parent element, often a div\n * @param seismographConfig config, not all parameters are used in\n * particle motion plots. Can be null for defaults.\n * @param xSeisData x axis seismogram\n * @param ySeisData y axis seismogram\n */\nexport class ParticleMotion {\n  plotId: number;\n  xSeisData: SeismogramDisplayData;\n  ySeisData: SeismogramDisplayData;\n  seismographConfig: SeismographConfig;\n  timeWindow: StartEndDuration;\n  width: number;\n  height: number;\n  outerWidth: number;\n  outerHeight: number;\n  xScale: any;\n  xScaleRmean: any;\n  xAxis: any;\n  yScale: any;\n  yScaleRmean: any;\n  yAxis: any;\n  svg: any;\n  svgParent: any;\n  g: any;\n  static _lastID: number;\n  constructor(inSvgParent: any,\n              seismographConfig: SeismographConfig,\n              xSeisData: SeismogramDisplayData | Seismogram,\n              ySeisData: SeismogramDisplayData | Seismogram): void {\n    if ( ! isDef(inSvgParent)) {throw new Error(\"inSvgParent cannot be null\");}\n    if ( ! isDef(xSeisData)) {throw new Error(\"xSeisData cannot be null\");}\n    if ( ! isDef(ySeisData)) {throw new Error(\"ySeisData cannot be null\");}\n    this.plotId = ++ParticleMotion._lastID;\n    if ( xSeisData instanceof Seismogram) {\n      this.xSeisData = SeismogramDisplayData.fromSeismogram(xSeisData);\n    } else if ( xSeisData instanceof SeismogramDisplayData) {\n      this.xSeisData = xSeisData;\n    }\n    if ( ySeisData instanceof Seismogram) {\n      this.ySeisData = SeismogramDisplayData.fromSeismogram(ySeisData);\n    } else if ( ySeisData instanceof SeismogramDisplayData) {\n      this.ySeisData = ySeisData;\n    }\n    if (isDef(seismographConfig)) {\n      this.seismographConfig = seismographConfig;\n    } else {\n      this.seismographConfig = new SeismographConfig();\n      this.seismographConfig.xLabel = this.xSeisData.channelCode;\n      this.seismographConfig.yLabel = this.ySeisData.channelCode;\n      this.seismographConfig.margin.left = 40;\n      this.seismographConfig.margin.top = this.seismographConfig.margin.bottom;\n      this.seismographConfig.margin.right = this.seismographConfig.margin.left;\n    }\n    this.calcTimeWindow();\n    this.svg = inSvgParent.append(\"svg\");\n    this.svg.attr(\"version\", \"1.1\");\n    this.svg.classed(\"particleMotion\", true);\n    this.svg.attr(\"plotId\", this.plotId);\n    this.xScale = d3.scaleLinear();\n    // yScale for axis (not drawing) that puts mean at 0 in center\n    this.xScaleRmean = d3.scaleLinear();\n    this.yScale = d3.scaleLinear();\n    // yScale for axis (not drawing) that puts mean at 0 in center\n    this.yScaleRmean = d3.scaleLinear();\n    this.svgParent = inSvgParent;\n\n    this.xAxis = d3.axisBottom(this.xScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    this.yAxis = d3.axisLeft(this.yScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    this.width = 100;\n    this.height = 100;\n    let mythis = this;\n\n    this.g = this.svg.append(\"g\")\n        .attr(\"transform\", \"translate(\" + this.seismographConfig.margin.left + \",\" + this.seismographConfig.margin.top + \")\");\n    this.calcScaleDomain();\n    d3.select(window).on('resize.particleMotion'+this.plotId, function() {if (mythis.checkResize()) {mythis.draw();}});\n  }\n  draw() {\n    this.checkResize();\n    this.drawAxis();\n    this.drawAxisLabels();\n    this.drawParticleMotion();\n    return this;\n  }\n  checkResize(): boolean {\n    let rect = this.svgParent.node().getBoundingClientRect();\n    if (rect.width !== this.outerWidth || rect.height !== this.outerHeight) {\n      this.calcWidthHeight(rect.width, rect.height);\n      return true;\n    }\n    return false;\n  }\n  drawParticleMotion() {\n    this.g.selectAll(\"g.particleMotion\").remove();\n    let lineG = this.g.append(\"g\");\n    lineG.classed(\"particleMotion\", true)\n      .classed(\"seispath\", true)\n      .classed(this.xSeisData.codes(), true)\n      .classed(\"orient\"+this.xSeisData.channelCode.charAt(2)+\"_\"+this.ySeisData.channelCode.charAt(2), true);\n\n    // for flow\n    let xSegments = this.xSeisData.seismogram ? this.xSeisData.seismogram.segments : [];\n    let ySegments = this.ySeisData.seismogram ? this.ySeisData.seismogram.segments : [];\n    xSegments.forEach(segX => {\n        ySegments.forEach(segY => {\n          this.drawParticleMotionForSegment(lineG, segX, segY);\n        });\n      });\n  }\n  drawParticleMotionForSegment(lineG: d3.selection, segA: SeismogramSegment, segB: SeismogramSegment) {\n    const mythis = this;\n    const timeWindow = segA.timeWindow.intersect(segB.timeWindow);\n    if ( ! isDef(timeWindow)) {\n      // no overlap\n      return;\n    }\n    const idxA = segA.indexOfTime(timeWindow.startTime);\n    const lastIdxA = segA.indexOfTime(timeWindow.endTime);\n    const idxB = segB.indexOfTime(timeWindow.startTime);\n    const lastIdxB = segB.indexOfTime(timeWindow.endTime);\n    if (idxA === -1 || lastIdxA === -1 || idxB === -1 || lastIdxB === -1) {\n      return;\n    }\n    const numPts = Math.min(lastIdxA-idxA, lastIdxB-idxB)+1;\n    let segmentG = lineG.append(\"g\").classed(\"segment\", true);\n    let path = segmentG.selectAll(\"path\").data( [ segA.y.slice(idxA, numPts) ] );\n    path.exit().remove();\n    path.enter()\n      .append(\"path\")\n      .classed(\"seispath\", true)\n    .attr(\"d\", d3.line().curve(d3.curveLinear)\n      .x(d => mythis.xScale(d))\n      .y((d,i) => mythis.yScale(segB.yAtIndex(idxB+i))));\n  }\n\n  drawAxis() {\n    let svgG = this.g;\n    svgG.selectAll(\"g.axis\").remove();\n    svgG.append(\"g\")\n        .attr(\"class\", \"axis axis--x\")\n        .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxis);\n    svgG.append(\"g\")\n        .attr(\"class\", \"axis axis--y\")\n        .call(this.yAxis);\n  }\n  drawAxisLabels() {\n    this.drawTitle();\n    this.drawXLabel();\n    this.drawXSublabel();\n    this.drawYLabel();\n    this.drawYSublabel();\n    return this;\n  }\n\n  rescaleAxis() {\n    let delay = 500;\n    this.g.select(\".axis--y\").transition().duration(delay/2).call(this.yAxis);\n    this.g.select(\".axis--x\").transition().duration(delay/2).call(this.xAxis);\n    return this;\n  }\n\n  calcScaleDomain() {\n    let halfDomainDelta = 1;\n    if (this.seismographConfig.fixedYScale) {\n      halfDomainDelta = (this.seismographConfig.fixedYScale[1] - this.seismographConfig.fixedYScale[0])/2;\n      this.xScale.domain(this.seismographConfig.fixedYScale).nice();\n      this.yScale.domain(this.seismographConfig.fixedYScale).nice();\n    } else {\n      let xMinMax = [this.xSeisData.min, this.xSeisData.max];\n      let yMinMax = [this.ySeisData.min, this.ySeisData.max];\n      halfDomainDelta = (xMinMax[1] - xMinMax[0])/2;\n      if (yMinMax[1]-yMinMax[0] > xMinMax[1] - xMinMax[0]) {\n        halfDomainDelta = (yMinMax[1]-yMinMax[0])/2;\n      }\n      let xMid = (xMinMax[1] + xMinMax[0])/2;\n      let yMid = (yMinMax[1] + yMinMax[0])/2;\n      xMinMax = [xMid - halfDomainDelta, xMid + halfDomainDelta ];\n      yMinMax = [yMid - halfDomainDelta, yMid + halfDomainDelta ];\n      this.xScale.domain(xMinMax).nice();\n      this.yScale.domain(yMinMax).nice();\n    }\n    let xNiceMinMax = this.xScale.domain();\n    let xHalfNice = (xNiceMinMax[1] - xNiceMinMax[0])/2;\n    this.xScaleRmean.domain([ -1 * xHalfNice,  xHalfNice ]);\n\n    let yNiceMinMax = this.yScale.domain();\n    let yHalfNice = (yNiceMinMax[1] - yNiceMinMax[0])/2;\n    this.yScaleRmean.domain([ -1 * yHalfNice,  yHalfNice ]);\n    this.rescaleAxis();\n    return this;\n  }\n\n  calcTimeWindow(): void {\n    let tw = null;\n    if ( this.seismographConfig.fixedTimeScale) {\n      tw = this.seismographConfig.fixedTimeScale;\n    } else {\n      tw = this.xSeisData.timeWindow.intersect(this.ySeisData.timeWindow);\n    }\n    if ( ! tw) {\n      // intersection might be null\n      throw new Error(`Seismograms do not overlap: ${this.xSeisData.timeWindow.toString()} ${this.ySeisData.timeWindow.toString()}`);\n    }\n    this.timeWindow = tw;\n  }\n\n  calcWidthHeight(nOuterWidth: number, nOuterHeight: number) {\n    this.outerWidth = nOuterWidth ? Math.max(100, nOuterWidth) : 100;\n    this.outerHeight = nOuterHeight ? Math.max(100, nOuterHeight) : 100;\n    this.height = this.outerHeight - this.seismographConfig.margin.top - this.seismographConfig.margin.bottom;\n    this.width = this.outerWidth - this.seismographConfig.margin.left - this.seismographConfig.margin.right;\n    this.xScale.range([0, this.width]);\n    this.yScale.range([this.height, 0]);\n    this.xScaleRmean.range([0, this.width]);\n    this.yScaleRmean.range([this.height, 0]);\n    return this;\n  }\n  /**\n   * Draws the title as simple string or array of strings. If an array\n   * then each item will be in a separate tspan for easier formatting.\n   *\n   * @returns this\n   */\n  drawTitle(): ParticleMotion {\n    this.svg.selectAll(\"g.title\").remove();\n    let titleSVGText = this.svg.append(\"g\")\n       .classed(\"title\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+( this.seismographConfig.margin.bottom/3  )+\")\")\n       .append(\"text\").classed(\"title label\", true)\n       .attr(\"text-anchor\", \"middle\");\n    if (Array.isArray(this.seismographConfig.title)) {\n      this.seismographConfig.title.forEach(function(s) {\n        titleSVGText.append(\"tspan\").text(s+\" \");\n      });\n    } else {\n      titleSVGText\n        .text(this.seismographConfig.title);\n    }\n    return this;\n  }\n  drawXLabel() {\n    this.svg.selectAll(\"g.xLabel\").remove();\n    if (isNumArg(this.width) && isNumArg(this.outerWidth)) {\n    this.svg.append(\"g\")\n       .classed(\"xLabel\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight - this.seismographConfig.margin.bottom/3  )+\")\")\n       .append(\"text\").classed(\"x label\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .text(this.seismographConfig.xLabel);\n    }\n    return this;\n  }\n  drawYLabel() {\n    this.svg.selectAll('g.yLabel').remove();\n    if (this.height) {\n      this.svg.append(\"g\")\n       .classed(\"yLabel\", true)\n       .attr(\"x\", 0)\n       .attr(\"transform\", \"translate(0, \"+(this.seismographConfig.margin.top+(this.height)/2)+\")\")\n       .append(\"text\")\n       .classed(\"y label\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .attr(\"dy\", \".75em\")\n       .attr(\"transform-origin\", \"center center\")\n       .attr(\"transform\", \"rotate(-90)\")\n       .text(this.seismographConfig.yLabel);\n     }\n    return this;\n  }\n  drawXSublabel() {\n    this.svg.selectAll('g.xSublabel').remove();\n    this.svg.append(\"g\")\n       .classed(\"xSublabel\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight  )+\")\")\n       .append(\"text\").classed(\"x label sublabel\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .text(this.seismographConfig.xSublabel);\n    return this;\n  }\n  drawYSublabel()  {\n    this.svg.selectAll('g.ySublabel').remove();\n\n    this.svg.append(\"g\")\n       .classed(\"ySublabel\", true)\n       .attr(\"x\", 0)\n       .attr(\"transform\", \"translate( \"+this.seismographConfig.ySublabelTrans+\" , \"+(this.seismographConfig.margin.top+(this.height)/2)+\")\")\n       .append(\"text\")\n       .classed(\"y label sublabel\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .attr(\"dy\", \".75em\")\n       .attr(\"transform-origin\", \"center center\")\n       .attr(\"transform\", \"rotate(-90)\")\n       .text(this.seismographConfig.ySublabel);\n    return this;\n  }\n}\n\nexport const particleMotion_css = `\n.particleMotionContainer {\n  height: 100%;\n  width: 100%;\n  min-height: 25px;\n  min-width: 25px;\n}\n\nsvg.particleMotion {\n  height: 100%;\n  width: 100%;\n  min-height: 25px;\n  min-width: 25px;\n}\n\nsvg.particleMotion text.title {\n  font-size: larger;\n  font-weight: bold;\n  fill: black;\n  color: black;\n  dominant-baseline: hanging;\n}\n\nsvg.particleMotion path.seispath {\n    stroke: skyblue;\n    fill: none;\n    stroke-width: 1px;\n}\n`;\n\nif (document){\n  insertCSS(particleMotion_css);\n}\n\n// static ID for particle motion\nParticleMotion._lastID = 0;\n"],"names":["createParticleMotionBySelector","selector","createPlotsBySelectorPromise","then","resultArray","forEach","result","svgParent","append","text","sddList","length","addDivForParticleMotion","xSeisData","ySeisData","timeWindow","svgDiv","isDef","Error","xSeis","seismogram","ySeis","xLabel","channelCode","yLabel","classed","addParticleMotion","seisConfig","SeismographConfig","fixedTimeScale","title","margin","top","bottom","right","left","pmp","ParticleMotion","draw","constructor","inSvgParent","seismographConfig","plotId","_lastID","Seismogram","SeismogramDisplayData","fromSeismogram","calcTimeWindow","svg","attr","xScale","d3","xScaleRmean","yScale","yScaleRmean","xAxis","tickFormat","yScaleFormat","yAxis","width","height","mythis","g","calcScaleDomain","window","on","checkResize","drawAxis","drawAxisLabels","drawParticleMotion","rect","node","getBoundingClientRect","outerWidth","outerHeight","calcWidthHeight","selectAll","remove","lineG","codes","charAt","xSegments","segments","ySegments","segX","segY","drawParticleMotionForSegment","segA","segB","intersect","idxA","indexOfTime","startTime","lastIdxA","endTime","idxB","lastIdxB","numPts","Math","min","segmentG","path","data","y","slice","exit","enter","curve","x","d","i","yAtIndex","svgG","call","drawTitle","drawXLabel","drawXSublabel","drawYLabel","drawYSublabel","rescaleAxis","delay","select","transition","duration","halfDomainDelta","fixedYScale","domain","nice","xMinMax","max","yMinMax","xMid","yMid","xNiceMinMax","xHalfNice","yNiceMinMax","yHalfNice","tw","toString","nOuterWidth","nOuterHeight","range","titleSVGText","Array","isArray","s","isNumArg","xSublabel","ySublabelTrans","ySublabel","particleMotion_css","document","insertCSS"],"mappings":"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"}