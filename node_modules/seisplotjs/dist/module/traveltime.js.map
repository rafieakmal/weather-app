{"version":3,"file":"traveltime.js","sources":["../../src/traveltime.js"],"sourcesContent":["// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {checkProtocol, hasArgs, stringify, isDef, isNonEmptyStringArg } from './util';\nimport {Station} from './stationxml.js';\nimport {Quake} from './quakeml.js';\n\nexport let IRIS_HOST = \"service.iris.edu\";\n\nexport const TEXT_FORMAT = \"text\";\nexport const JSON_FORMAT = \"json\";\nexport const SVG_FORMAT = \"svg\";\n\n/**\n * Query to the IRIS traveltime webservice, based on the TauP Toolkit. See\n * http://service.iris.edu/irisws/traveltime/1/ and\n * https://www.seis.sc.edu/TauP/\n *\n * @param host optional host to connect to, defaults to IRIS\n */\nexport class TraveltimeQuery {\n  /** @private */\n  _specVersion: string;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _evdepth: number;\n  /** @private */\n  _distdeg: number;\n  /** @private */\n  _model: string;\n  /** @private */\n  _phases: string;\n  /** @private */\n  _stalat: number;\n  /** @private */\n  _stalon: number;\n  /** @private */\n  _evlat: number;\n  /** @private */\n  _evlon: number;\n  /** @private */\n  _format: string;\n  /** @private */\n  _noheader: boolean;\n  constructor(host: ?string) {\n    this._specVersion = \"1\";\n    this._protocol = checkProtocol();\n    if (! isNonEmptyStringArg(host)) {\n      this._host = IRIS_HOST;\n    } else {\n      this._host = host;\n    }\n    this._format = JSON_FORMAT;\n    this._noheader = false; // only for text format\n  }\n  protocol(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._protocol = value, this) : this._protocol;\n  }\n  host(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._host = value, this) : this._host;\n  }\n  specVersion(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._specVersion = value, this) : this._specVersion;\n  }\n  evdepth(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evdepth = value, this) : this._evdepth;\n  }\n  distdeg(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._distdeg = value, this) : this._distdeg;\n  }\n  model(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._model = value, this) : this._model;\n  }\n  phases(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._phases = value, this) : this._phases;\n  }\n  stalat(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._stalat = value, this) : this._stalat;\n  }\n  stalon(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._stalon = value, this) : this._stalon;\n  }\n  latLonFromStation(station: Station): TraveltimeQuery {\n    this.stalat(station.latitude);\n    this.stalon(station.longitude);\n    return this;\n  }\n  evlat(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evlat = value, this) : this._evlat;\n  }\n  evlon(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evlon = value, this) : this._evlon;\n  }\n  latLonFromQuake(quake: Quake): TraveltimeQuery {\n    this.evlat(quake.latitude);\n    this.evlon(quake.longitude);\n    this.evdepth(quake.depth/1000);\n    return this;\n  }\n  format(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._format = value, this) : this._format;\n  }\n  noheader(value?: boolean): boolean | TraveltimeQuery {\n    return hasArgs(value) ? (this._noheader = value, this) : this._noheader;\n  }\n  convertToArrival(ttimeline: string) {\n    let items = ttimeline.trim().split(/\\s+/);\n    return {\n      distdeg: parseFloat(items[0]),\n      phase: items[2],\n      time: parseFloat(items[3]),\n      rayparam: parseFloat(items[4]),\n      takeoff: parseFloat(items[5]),\n      incident: parseFloat(items[6]),\n      puristdist: parseFloat(items[7]),\n      puristname: items[9]\n    };\n  }\n\n  queryText(): Promise<string> {\n    this.format(TEXT_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  queryJson(): Promise<any> {\n    this.format(JSON_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.json();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  querySvg(): Promise<Element> {\n    this.format(SVG_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text()\n            .then(textResponse => (new window.DOMParser()).parseFromString(textResponse, \"text/xml\"))\n            .then(xml => {\n              let elArray = xml.getElementsByTagName(\"svg\");\n              if (elArray.length > 0) {\n                return elArray[0];\n              } else {\n                throw new Error(\"Can't find svg element in response\");\n              }\n            });\n\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  queryWadl(): Promise<Element> {\n    return fetch(this.formWadlURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text()\n            .then(textResponse => (new window.DOMParser()).parseFromString(textResponse, \"text/xml\"));\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  query(): Promise<any> {\n    if (this._format === JSON_FORMAT) {\n      return this.queryJson();\n    } else if (this._format === SVG_FORMAT) {\n      return this.querySvg();\n    } else if (this._format === TEXT_FORMAT) {\n      return this.queryText();\n    } else {\n      throw new Error(\"Unknown format: \"+this._format);\n    }\n  }\n\n  makeParam(name: string, val: mixed): string {\n    return name+\"=\"+encodeURIComponent(stringify(val))+\"&\";\n  }\n\n  formBaseURL(): string {\n    let colon = \":\";\n    if (this._protocol.endsWith(colon)) {\n      colon = \"\";\n    }\n    let url = this._protocol+colon+\"//\"+this._host+\"/irisws/traveltime/\"+this._specVersion+\"/\";\n    return url;\n  }\n\n  formURL(): string {\n    let url = this.formBaseURL()+'query?';\n    if (isDef(this._noheader) && this._noheader) {\n      url = url +\"noheader=true&\";\n    }\n    if (isDef(this._evdepth)) { url = url+this.makeParam(\"evdepth\", this.evdepth()); }\n    if (isDef(this._stalat) && isDef(this._stalon)) {\n      url = url+this.makeParam(\"staloc\", \"[\"+stringify(this.stalat())+\",\"+stringify(this.stalon())+\"]\");\n    }\n    if (isDef(this._evlat) && isDef(this._evlon)) {\n      url = url+this.makeParam(\"evloc\", \"[\"+stringify(this.evlat())+\",\"+stringify(this.evlon())+\"]\");\n    }\n    if (isDef(this._distdeg)) { url = url+this.makeParam(\"distdeg\", this.distdeg());}\n    if (isDef(this._model)) { url = url+this.makeParam(\"model\", this.model());}\n    if (isDef(this._phases)) { url = url+this.makeParam(\"phases\", this.phases());}\n    if (isDef(this._format)) { url = url+this.makeParam(\"format\", this.format());}\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n\n\n  queryTauPVersion(): Promise<string> {\n    return fetch(this.formTauPVersionURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n\n  formTauPVersionURL(): string {\n    return this.formBaseURL()+'taupversion';\n  }\n\n\n  formWadlURL(): string {\n    return this.formBaseURL()+'application.wadl';\n  }\n}\n"],"names":["IRIS_HOST","TEXT_FORMAT","JSON_FORMAT","SVG_FORMAT","TraveltimeQuery","constructor","host","_specVersion","_protocol","checkProtocol","isNonEmptyStringArg","_host","_format","_noheader","protocol","value","hasArgs","specVersion","evdepth","_evdepth","distdeg","_distdeg","model","_model","phases","_phases","stalat","_stalat","stalon","_stalon","latLonFromStation","station","latitude","longitude","evlat","_evlat","evlon","_evlon","latLonFromQuake","quake","depth","format","noheader","convertToArrival","ttimeline","items","trim","split","parseFloat","phase","time","rayparam","takeoff","incident","puristdist","puristname","queryText","fetch","formURL","then","response","ok","text","Error","status","statusText","queryJson","json","querySvg","textResponse","window","DOMParser","parseFromString","xml","elArray","getElementsByTagName","length","queryWadl","formWadlURL","query","makeParam","name","val","encodeURIComponent","stringify","formBaseURL","colon","endsWith","url","isDef","substr","queryTauPVersion","formTauPVersionURL"],"mappings":"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"}