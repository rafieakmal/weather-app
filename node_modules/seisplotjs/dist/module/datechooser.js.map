{"version":3,"file":"datechooser.js","sources":["../../src/datechooser.js"],"sourcesContent":["// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport Pikaday from 'pikaday';\n\nimport moment from 'moment';\nimport * as d3 from 'd3';\n\nimport {insertCSS} from './cssutil.js';\n\nimport {StartEndDuration} from './util.js';\n\n/**\n * Hour and Minute chooser using sliders.\n *\n * @param div selected div to append chooser to\n * @param initialTime initial chooser time value\n * @param updateCallback optional callback function when time is selected\n */\nexport class HourMinChooser {\n\n  div: any; // d3 not yet in flow-typed :(\n  time: moment;\n  updateCallback: ( time: moment) => void;\n  hourMinRegEx: RegExp;\n  myOnClick: (event: Event) => void;\n  hourMinField: any; // d3 not yet in flow-typed :(\n  popupDiv: any; // d3 not yet in flow-typed :(\n  hourDiv: any; // d3 not yet in flow-typed :(\n  hourSlider: any; // d3 not yet in flow-typed :(\n  minuteDiv: any; // d3 not yet in flow-typed :(\n  minuteSlider: any; // d3 not yet in flow-typed :(\n  constructor(div: any, initialTime: moment, updateCallback?: ( time: moment) => void) {\n    let mythis = this;\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.time = moment.utc(initialTime);\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    this.hourMinRegEx = /^([0-1]?[0-9]):([0-5]?[0-9])$/;\n    this.myOnClick = function(e) {\n      // click document outside popup closes popup\n      // not sure this if matters???\n          if (e.target !== mythis.hourMinField && e.target !== mythis.popupDiv) {\n            mythis.hide();\n          }\n    };\n    this.hourMinField = this.div.append(\"input\")\n      .classed(\"pikatime\", true)\n      .attr(\"value\", this.time.format('HH:mm'))\n      .attr(\"type\", \"text\")\n      .on(\"click\", function() {\n        mythis.showHide();\n        // don't propagate click up to document\n        d3.event.stopPropagation();\n      })\n      .on(\"change\", function() {\n        let match = mythis.hourMinRegEx.exec(mythis.hourMinField.property(\"value\"));\n        if (match) {\n          mythis.hourMinField.style(\"background-color\", null);\n          let h = match[1];\n          let m = match[2];\n          mythis.time.hours(h);\n          mythis.time.minutes(m);\n          mythis.popupDiv.style(\"visibility\", \"hidden\");\n          mythis.timeModified();\n        } else {\n          mythis.hourMinField.property(\"value\", mythis.time.format('HH:mm'));\n        }\n\n      });\n    this.div.append(\"span\").classed(\"utclabel\", true).text(\"UTC\");\n    this.popupDiv = this.div.append(\"div\")\n      .classed(\"hourminpopup\", true)\n      .style(\"position\", \"absolute\")\n      .style(\"visibility\", \"hidden\")\n      .on(\"click\", function() {\n        // don't propagate click up to document\n        d3.event.stopPropagation();\n      });\n    this.hourDiv = this.popupDiv.append(\"div\").classed(\"hour\", true);\n    this.hourSlider = this.hourDiv.append(\"label\").text(\"Hour:\").append(\"input\");\n    this.hourSlider.attr(\"type\", \"range\")\n      .attr(\"min\",\"0\")\n      .attr(\"max\", \"23\")\n      .classed(\"hourSlider\", true)\n      .on(\"input\", function() {\n        let nHour = +this.value;\n        if (mythis.time.hours() !== nHour) {\n          mythis.time.hours(nHour);\n          mythis.hourSlider.property(\"value\", nHour);\n          mythis.timeModified();\n        }\n      });\n    this.hourSlider.attr(\"value\", this.time.hour());\n    this.minuteDiv = this.popupDiv.append(\"div\").classed(\"minute\", true);\n    this.minuteSlider = this.minuteDiv.append(\"label\").text(\"Minute:\").append(\"input\");\n    this.minuteSlider.attr(\"type\", \"range\")\n      .attr(\"min\",\"0\")\n      .attr(\"max\", \"59\")\n      .classed(\"minuteSlider\", true)\n      .on(\"input\", function() {\n        let nMinute = +this.value;\n        if (mythis.time.minutes() !== nMinute) {\n          mythis.time.minutes(nMinute);\n          mythis.minuteSlider.property(\"value\", nMinute);\n          mythis.timeModified();\n        }\n      });\n    this.minuteSlider.attr(\"value\", this.time.minute());\n  }\n  /**\n   * Updates the time without triggering the callback function.\n   *\n   * @param  newTime new time to update sliders\n   */\n  updateTime(newTime: moment): void {\n    this.time = newTime;\n    this.hourMinField.property(\"value\", this.time.format('HH:mm'));\n    this.hourSlider.property(\"value\", this.time.hour());\n    this.minuteSlider.property(\"value\", this.time.minute());\n  }\n  /**\n   * Updates the sliders based on this.time and triggers the callback function.\n   */\n  timeModified(): void {\n    this.hourSlider.property(\"value\", this.time.hour());\n    this.minuteSlider.property(\"value\", this.time.minute());\n    this.hourMinField.property(\"value\", this.time.format('HH:mm'));\n    this.updateCallback(this.time);\n  }\n  /**\n   * Shows or hides the popup based on current visibility style\n   */\n  showHide(): void {\n    if (this.popupDiv.style(\"visibility\") === \"hidden\") {\n      this.popupDiv.style(\"visibility\", \"visible\")\n        .classed(\"is-bound\", true);\n      this._adjustPopupPosition();\n      window.document.addEventListener(\"click\", this.myOnClick, false);\n    } else {\n      this.popupDiv.style(\"visibility\", \"hidden\");\n      window.document.removeEventListener(\"click\", this.myOnClick);\n    }\n  }\n  /**\n   * Hides the popup with sliders.\n   */\n  hide(): void {\n    this.popupDiv.style(\"visibility\", \"hidden\")\n      .classed(\"is-bound\", false);\n    window.document.removeEventListener(\"click\", this.myOnClick);\n  }\n  /** @private */\n  _adjustPopupPosition(): void {\n\n      let field = this.hourMinField.node();\n      let width = this.hourMinField.offsetWidth;\n      let height = this.hourMinField.offsetHeight;\n      let viewportWidth: number = window.innerWidth;\n      let viewportHeight: number = window.innerHeight;\n      let scrollTop: number = window.pageYOffset;\n      let left = field.offsetLeft;\n      let top  = field.offsetTop + field.offsetHeight;\n      while((field = field.offsetParent)) {\n          left += field.offsetLeft;\n          top  += field.offsetTop;\n      }\n\n\n      // default position is bottom & left\n      if ((left + width > viewportWidth)) {\n          left = left - width + field.offsetWidth;\n      }\n      if ((top + height > viewportHeight + scrollTop)) {\n          top = top - height - field.offsetHeight;\n      }\n      this.popupDiv.style(\"left\", left + 'px');\n      this.popupDiv.style(\"top\", top + 'px');\n  }\n}\n\n/**\n * Date and Time chooser using pikaday for the date and the above\n * HourMinChooser for the hour and minute of time.\n *\n * @param div selected div to append chooser to\n * @param label label for chooser\n * @param initialTime initial chooser time value\n * @param updateCallback optional callback function when time is selected\n */\nexport class DateTimeChooser {\n  div: any; // d3 not yet in flow-typed :(\n  time: moment;\n  updateCallback: ( time: moment) => void;\n  label: string;\n  dateField: any;\n  picker: Pikaday;\n  hourMin: HourMinChooser;\n  constructor(div: any, label: string, initialTime: moment, updateCallback?: ( time: moment) => void) {\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.label = label;\n    this.time = moment.utc(initialTime);\n    this.time.second(0).millisecond(0); // only hour and min?\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    this.dateField = div.append(\"label\").text(this.label).append(\"input\")\n      .classed(\"pikaday\", true)\n      .attr(\"value\", this.time.toISOString())\n      .attr(\"type\", \"text\")\n      .on(\"click\", function() {\n        if (mythis.picker.isVisible()) {\n          mythis.picker.hide();\n        }\n      });\n    let mythis = this;\n    this.picker = new Pikaday({ field: this.dateField.node(),\n                              //  trigger: inputField.node(),\n                                format: \"YYYY-MM-DD\",\n                                onSelect: function() {\n                                  let pikaValue = this.getMoment();\n                                  let origTime = moment.utc(mythis.time);\n                                  if (origTime.year() !== pikaValue.year() || origTime.dayOfYear() !== pikaValue.dayOfYear()) {\n                                    mythis.time.year(pikaValue.year());\n                                    mythis.time.dayOfYear(pikaValue.dayOfYear());\n                                    mythis.timeModified();\n                                  }\n                                }\n                            });\n    this._internalSetTime(this.time);\n    this.hourMin = new HourMinChooser(div, this.time, function(time) {\n      mythis._internalSetTime(time);\n      mythis.timeModified();\n    });\n  }\n  /**\n   * Updates the time without triggering the callback function.\n   *\n   * @param  newTime new time to update sliders\n   */\n  updateTime(newTime: moment): void {\n    this._internalSetTime(newTime);\n    this.hourMin.updateTime(newTime);\n  }\n  /**\n   * triggers the callback function.\n   */\n  timeModified(): void {\n    this.updateCallback(this.time);\n  }\n  getTime(): moment {\n    return this.time;\n  }\n\n  /**\n   * internal time set\n   *\n   * @private\n   * @param  newTime new time to update\n   */\n  _internalSetTime(newTime: moment): void {\n    this.time = moment.utc(newTime);\n    this.dateField.attr(\"value\", this.time.toISOString());\n    // re-moment to avoid utc issue, using utc messes up picker, so pretend\n    this.picker.setMoment(moment([this.time.year(), this.time.month(), this.time.date()]));\n  }\n}\n\n/**\n * Combination of two DateTimeChoosers to specify a start and end time.\n *\n * @param div selected div to append chooser to\n * @param updateCallback optional callback function when time is selected/changed\n */\nexport class TimeRangeChooser {\n  div: any;\n  updateCallback: (timerange: StartEndDuration) => void;\n  duration: number;\n  startChooser: DateTimeChooser;\n  endChooser: DateTimeChooser;\n  _mostRecentChanged: string;\n  constructor(div: any, updateCallback?: (timerange: StartEndDuration) => void) {\n    this._mostRecentChanged = 'start';\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    let endTime = moment.utc();\n    this.duration = 300;\n    let startTime = moment.utc(endTime).subtract(this.duration, 'second');\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.div.classed(\"timeRangeChooser\", true);\n    let mythis = this;\n    let startDiv = this.div.append(\"span\").classed(\"start\", true);\n    this.startChooser = new DateTimeChooser(startDiv, \"Start:\", startTime, function(startTime) {\n      mythis.endChooser.updateTime(moment.utc(startTime).add(mythis.duration, 'seconds'));\n      mythis.updateCallback(mythis.getTimeRange());\n      mythis._mostRecentChanged = 'start';\n    });\n\n    let durationDiv = this.div.append(\"span\").classed(\"duration\", true);\n    durationDiv.append(\"label\").text(\"Duration:\").append(\"input\")\n      .classed(\"pikatime\", true)\n      .attr(\"value\", this.duration)\n      .attr(\"type\", \"text\")\n      .on(\"input\", function() {\n        let nDur = +Number.parseInt(this.value);\n        mythis.duration = nDur;\n        if (mythis._mostRecentChanged === 'end') {\n          mythis.startChooser.updateTime(moment.utc(mythis.endChooser.getTime()).subtract(mythis.duration, 'seconds'));\n          mythis.updateCallback(mythis.getTimeRange());\n        } else {\n          // change end\n          mythis.endChooser.updateTime(moment.utc(mythis.startChooser.getTime()).add(mythis.duration, 'seconds'));\n          mythis.updateCallback(mythis.getTimeRange());\n        }\n      });\n\n    let endDiv = this.div.append(\"span\").classed(\"end\", true);\n    this.endChooser = new DateTimeChooser(endDiv, \"End:\", endTime, function(endTime) {\n      mythis.startChooser.updateTime(moment.utc(endTime).subtract(mythis.duration, 'seconds'));\n      mythis.updateCallback(mythis.getTimeRange());\n      mythis._mostRecentChanged = 'end';\n    });\n  }\n  getTimeRange(): StartEndDuration {\n    return new StartEndDuration(this.startChooser.getTime(),\n                                this.endChooser.getTime());\n  }\n}\n\n/**\n * Dummy callback function for cases where user doesn't need this. Mainly here\n * to keep eslint happy.\n *\n * @param   t new time/time range, not used\n */\n// eslint-disable-next-line no-unused-vars\nfunction dummyCallback(t) { }\n\n/**\n * CSS for the parts of HourMin, DateTime and TimeRange choosers\n * that are not using pikaday.\n */\nexport const chooser_css = `\n\ndiv.timeRangeChooser .utclabel {\n  font-size: smaller;\n}\n\ndiv.timeRangeChooser span div.hourminpopup {\n    z-index: 9999;\n    display: block;\n    position: relative;\n    color: #333;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-bottom-color: #bbb;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n}\n\n\n\n.hourminpopup.is-hidden {\n    display: none;\n}\n.hourminpopup.is-bound {\n    position: absolute;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n    background-color: white;\n}\n\ndiv.hourminpopup div label {\n  display: block;\n  float: right;\n}\ndiv.hourminpopup div {\n    display: block;\n    float: right;\n    clear: both;\n}\n\ndiv.hourminpopup input {\n    width: 150px;\n}\n\ndiv.timeRangeChooser span {\n  margin: 2px;\n  margin-right: 5px;\n}\n\ninput.pikaday {\n  width: 70px;\n}\ninput.pikatime {\n  width: 50px;\n}\n\n`;\n\n\n/**\n * CSS for the pikaday chooser.\n */\nexport const pikaday_css = `\n@charset \"UTF-8\";\n\n/*!\n * Pikaday\n * Copyright Â© 2014 David Bushell | BSD & MIT license | http://dbushell.com/\n */\n\n.pika-single {\n    z-index: 9999;\n    display: block;\n    position: relative;\n    color: #333;\n    background: #fff;\n    border: 1px solid #ccc;\n    border-bottom-color: #bbb;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n}\n\n/*\nclear child float (pika-lendar), using the famous micro clearfix hack\nhttp://nicolasgallagher.com/micro-clearfix-hack/\n*/\n.pika-single:before,\n.pika-single:after {\n    content: \" \";\n    display: table;\n}\n.pika-single:after { clear: both }\n\n.pika-single.is-hidden {\n    display: none;\n}\n\n.pika-single.is-bound {\n    position: absolute;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n}\n\n.pika-lendar {\n    float: left;\n    width: 240px;\n    margin: 8px;\n}\n\n.pika-title {\n    position: relative;\n    text-align: center;\n}\n\n.pika-label {\n    display: inline-block;\n    position: relative;\n    z-index: 9999;\n    overflow: hidden;\n    margin: 0;\n    padding: 5px 3px;\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: bold;\n    background-color: #fff;\n}\n.pika-title select {\n    cursor: pointer;\n    position: absolute;\n    z-index: 9998;\n    margin: 0;\n    left: 0;\n    top: 5px;\n    opacity: 0;\n}\n\n.pika-prev,\n.pika-next {\n    display: block;\n    cursor: pointer;\n    position: relative;\n    outline: none;\n    border: 0;\n    padding: 0;\n    width: 20px;\n    height: 30px;\n    /* hide text using text-indent trick, using width value (it's enough) */\n    text-indent: 20px;\n    white-space: nowrap;\n    overflow: hidden;\n    background-color: transparent;\n    background-position: center center;\n    background-repeat: no-repeat;\n    background-size: 75% 75%;\n    opacity: .5;\n}\n\n.pika-prev:hover,\n.pika-next:hover {\n    opacity: 1;\n}\n\n.pika-prev,\n.is-rtl .pika-next {\n    float: left;\n    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj+OD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8+AqBIl6kKgHiXqQqAeJepBo/z38J/U0uAHlaBkBl9I4GwAAAABJRU5ErkJggg==');\n}\n\n.pika-next,\n.is-rtl .pika-prev {\n    float: right;\n    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO+BJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII=');\n}\n\n.pika-prev.is-disabled,\n.pika-next.is-disabled {\n    cursor: default;\n    opacity: .2;\n}\n\n.pika-select {\n    display: inline-block;\n}\n\n.pika-table {\n    width: 100%;\n    border-collapse: collapse;\n    border-spacing: 0;\n    border: 0;\n}\n\n.pika-table th,\n.pika-table td {\n    width: 14.285714285714286%;\n    padding: 0;\n}\n\n.pika-table th {\n    color: #999;\n    font-size: 12px;\n    line-height: 25px;\n    font-weight: bold;\n    text-align: center;\n}\n\n.pika-button {\n    cursor: pointer;\n    display: block;\n    box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    outline: none;\n    border: 0;\n    margin: 0;\n    width: 100%;\n    padding: 5px;\n    color: #666;\n    font-size: 12px;\n    line-height: 15px;\n    text-align: right;\n    background: #f5f5f5;\n}\n\n.pika-week {\n    font-size: 11px;\n    color: #999;\n}\n\n.is-today .pika-button {\n    color: #33aaff;\n    font-weight: bold;\n}\n\n.is-selected .pika-button,\n.has-event .pika-button {\n    color: #fff;\n    font-weight: bold;\n    background: #33aaff;\n    box-shadow: inset 0 1px 3px #178fe5;\n    border-radius: 3px;\n}\n\n.has-event .pika-button {\n    background: #005da9;\n    box-shadow: inset 0 1px 3px #0076c9;\n}\n\n.is-disabled .pika-button,\n.is-inrange .pika-button {\n    background: #D5E9F7;\n}\n\n.is-startrange .pika-button {\n    color: #fff;\n    background: #6CB31D;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n.is-endrange .pika-button {\n    color: #fff;\n    background: #33aaff;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n.is-disabled .pika-button {\n    pointer-events: none;\n    cursor: default;\n    color: #999;\n    opacity: .3;\n}\n\n.is-outside-current-month .pika-button {\n    color: #999;\n    opacity: .3;\n}\n\n.is-selection-disabled {\n    pointer-events: none;\n    cursor: default;\n}\n\n.pika-button:hover,\n.pika-row.pick-whole-week:hover .pika-button {\n    color: #fff;\n    background: #ff8000;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n/* styling for abbr */\n.pika-table abbr {\n    border-bottom: none;\n    cursor: help;\n}\n\n`;\n\n\nif (document){\n  insertCSS(chooser_css);\n  insertCSS(pikaday_css);\n}\n"],"names":["HourMinChooser","constructor","div","initialTime","updateCallback","mythis","d3","time","moment","utc","dummyCallback","hourMinRegEx","myOnClick","e","target","hourMinField","popupDiv","hide","append","classed","attr","format","on","showHide","stopPropagation","match","exec","property","style","h","m","hours","minutes","timeModified","text","hourDiv","hourSlider","nHour","value","hour","minuteDiv","minuteSlider","nMinute","minute","updateTime","newTime","_adjustPopupPosition","window","document","addEventListener","removeEventListener","field","node","width","offsetWidth","height","offsetHeight","viewportWidth","innerWidth","viewportHeight","innerHeight","scrollTop","pageYOffset","left","offsetLeft","top","offsetTop","offsetParent","DateTimeChooser","label","second","millisecond","dateField","toISOString","picker","isVisible","Pikaday","onSelect","pikaValue","getMoment","origTime","year","dayOfYear","_internalSetTime","hourMin","getTime","setMoment","month","date","TimeRangeChooser","_mostRecentChanged","endTime","duration","startTime","subtract","startDiv","startChooser","endChooser","add","getTimeRange","durationDiv","nDur","Number","parseInt","endDiv","StartEndDuration","t","chooser_css","pikaday_css","insertCSS"],"mappings":";;;;;;AAEA;;;;;AAeA;;;;;;;;AAOO,MAAMA,cAAN,CAAqB;AAEhB;AAKS;AACJ;AACD;AACG;AACD;AACG;AACnBC,EAAAA,WAAW,CAACC,GAAD,EAAWC,WAAX,EAAgCC,cAAhC,EAA0E;AACnF,QAAIC,MAAM,GAAG,IAAb;;AACA,QAAI,OAAOH,GAAP,KAAe,QAAnB,EAA6B;AAC3B,WAAKA,GAAL,GAAWI,MAAA,CAAUJ,GAAV,CAAX;AACD,KAFD,MAEO;AACL,WAAKA,GAAL,GAAWA,GAAX;AACD;;AACD,SAAKK,IAAL,GAAYC,QAAM,CAACC,GAAP,CAAWN,WAAX,CAAZ;AACA,SAAKC,cAAL,GAAsBA,cAAc,GAAGA,cAAH,GAAoBM,aAAxD;AACA,SAAKC,YAAL,GAAoB,+BAApB;;AACA,SAAKC,SAAL,GAAiB,UAASC,CAAT,EAAY;AAC3B;AACA;AACI,UAAIA,CAAC,CAACC,MAAF,KAAaT,MAAM,CAACU,YAApB,IAAoCF,CAAC,CAACC,MAAF,KAAaT,MAAM,CAACW,QAA5D,EAAsE;AACpEX,QAAAA,MAAM,CAACY,IAAP;AACD;AACN,KAND;;AAOA,SAAKF,YAAL,GAAoB,KAAKb,GAAL,CAASgB,MAAT,CAAgB,OAAhB,EACjBC,OADiB,CACT,UADS,EACG,IADH,EAEjBC,IAFiB,CAEZ,OAFY,EAEH,KAAKb,IAAL,CAAUc,MAAV,CAAiB,OAAjB,CAFG,EAGjBD,IAHiB,CAGZ,MAHY,EAGJ,MAHI,EAIjBE,EAJiB,CAId,OAJc,EAIL,YAAW;AACtBjB,MAAAA,MAAM,CAACkB,QAAP,GADsB;;AAGtBjB,MAAAA,KAAA,CAASkB,eAAT;AACD,KARiB,EASjBF,EATiB,CASd,QATc,EASJ,YAAW;AACvB,UAAIG,KAAK,GAAGpB,MAAM,CAACM,YAAP,CAAoBe,IAApB,CAAyBrB,MAAM,CAACU,YAAP,CAAoBY,QAApB,CAA6B,OAA7B,CAAzB,CAAZ;;AACA,UAAIF,KAAJ,EAAW;AACTpB,QAAAA,MAAM,CAACU,YAAP,CAAoBa,KAApB,CAA0B,kBAA1B,EAA8C,IAA9C;AACA,YAAIC,CAAC,GAAGJ,KAAK,CAAC,CAAD,CAAb;AACA,YAAIK,CAAC,GAAGL,KAAK,CAAC,CAAD,CAAb;AACApB,QAAAA,MAAM,CAACE,IAAP,CAAYwB,KAAZ,CAAkBF,CAAlB;AACAxB,QAAAA,MAAM,CAACE,IAAP,CAAYyB,OAAZ,CAAoBF,CAApB;AACAzB,QAAAA,MAAM,CAACW,QAAP,CAAgBY,KAAhB,CAAsB,YAAtB,EAAoC,QAApC;AACAvB,QAAAA,MAAM,CAAC4B,YAAP;AACD,OARD,MAQO;AACL5B,QAAAA,MAAM,CAACU,YAAP,CAAoBY,QAApB,CAA6B,OAA7B,EAAsCtB,MAAM,CAACE,IAAP,CAAYc,MAAZ,CAAmB,OAAnB,CAAtC;AACD;AAEF,KAvBiB,CAApB;AAwBA,SAAKnB,GAAL,CAASgB,MAAT,CAAgB,MAAhB,EAAwBC,OAAxB,CAAgC,UAAhC,EAA4C,IAA5C,EAAkDe,IAAlD,CAAuD,KAAvD;AACA,SAAKlB,QAAL,GAAgB,KAAKd,GAAL,CAASgB,MAAT,CAAgB,KAAhB,EACbC,OADa,CACL,cADK,EACW,IADX,EAEbS,KAFa,CAEP,UAFO,EAEK,UAFL,EAGbA,KAHa,CAGP,YAHO,EAGO,QAHP,EAIbN,EAJa,CAIV,OAJU,EAID,YAAW;AACtB;AACAhB,MAAAA,KAAA,CAASkB,eAAT;AACD,KAPa,CAAhB;AAQA,SAAKW,OAAL,GAAe,KAAKnB,QAAL,CAAcE,MAAd,CAAqB,KAArB,EAA4BC,OAA5B,CAAoC,MAApC,EAA4C,IAA5C,CAAf;AACA,SAAKiB,UAAL,GAAkB,KAAKD,OAAL,CAAajB,MAAb,CAAoB,OAApB,EAA6BgB,IAA7B,CAAkC,OAAlC,EAA2ChB,MAA3C,CAAkD,OAAlD,CAAlB;AACA,SAAKkB,UAAL,CAAgBhB,IAAhB,CAAqB,MAArB,EAA6B,OAA7B,EACGA,IADH,CACQ,KADR,EACc,GADd,EAEGA,IAFH,CAEQ,KAFR,EAEe,IAFf,EAGGD,OAHH,CAGW,YAHX,EAGyB,IAHzB,EAIGG,EAJH,CAIM,OAJN,EAIe,YAAW;AACtB,UAAIe,KAAK,GAAG,CAAC,KAAKC,KAAlB;;AACA,UAAIjC,MAAM,CAACE,IAAP,CAAYwB,KAAZ,OAAwBM,KAA5B,EAAmC;AACjChC,QAAAA,MAAM,CAACE,IAAP,CAAYwB,KAAZ,CAAkBM,KAAlB;AACAhC,QAAAA,MAAM,CAAC+B,UAAP,CAAkBT,QAAlB,CAA2B,OAA3B,EAAoCU,KAApC;AACAhC,QAAAA,MAAM,CAAC4B,YAAP;AACD;AACF,KAXH;AAYA,SAAKG,UAAL,CAAgBhB,IAAhB,CAAqB,OAArB,EAA8B,KAAKb,IAAL,CAAUgC,IAAV,EAA9B;AACA,SAAKC,SAAL,GAAiB,KAAKxB,QAAL,CAAcE,MAAd,CAAqB,KAArB,EAA4BC,OAA5B,CAAoC,QAApC,EAA8C,IAA9C,CAAjB;AACA,SAAKsB,YAAL,GAAoB,KAAKD,SAAL,CAAetB,MAAf,CAAsB,OAAtB,EAA+BgB,IAA/B,CAAoC,SAApC,EAA+ChB,MAA/C,CAAsD,OAAtD,CAApB;AACA,SAAKuB,YAAL,CAAkBrB,IAAlB,CAAuB,MAAvB,EAA+B,OAA/B,EACGA,IADH,CACQ,KADR,EACc,GADd,EAEGA,IAFH,CAEQ,KAFR,EAEe,IAFf,EAGGD,OAHH,CAGW,cAHX,EAG2B,IAH3B,EAIGG,EAJH,CAIM,OAJN,EAIe,YAAW;AACtB,UAAIoB,OAAO,GAAG,CAAC,KAAKJ,KAApB;;AACA,UAAIjC,MAAM,CAACE,IAAP,CAAYyB,OAAZ,OAA0BU,OAA9B,EAAuC;AACrCrC,QAAAA,MAAM,CAACE,IAAP,CAAYyB,OAAZ,CAAoBU,OAApB;AACArC,QAAAA,MAAM,CAACoC,YAAP,CAAoBd,QAApB,CAA6B,OAA7B,EAAsCe,OAAtC;AACArC,QAAAA,MAAM,CAAC4B,YAAP;AACD;AACF,KAXH;AAYA,SAAKQ,YAAL,CAAkBrB,IAAlB,CAAuB,OAAvB,EAAgC,KAAKb,IAAL,CAAUoC,MAAV,EAAhC;AACD;AACD;;;;;;;AAKAC,EAAAA,UAAU,CAACC,OAAD,EAAwB;AAChC,SAAKtC,IAAL,GAAYsC,OAAZ;AACA,SAAK9B,YAAL,CAAkBY,QAAlB,CAA2B,OAA3B,EAAoC,KAAKpB,IAAL,CAAUc,MAAV,CAAiB,OAAjB,CAApC;AACA,SAAKe,UAAL,CAAgBT,QAAhB,CAAyB,OAAzB,EAAkC,KAAKpB,IAAL,CAAUgC,IAAV,EAAlC;AACA,SAAKE,YAAL,CAAkBd,QAAlB,CAA2B,OAA3B,EAAoC,KAAKpB,IAAL,CAAUoC,MAAV,EAApC;AACD;AACD;;;;;AAGAV,EAAAA,YAAY,GAAS;AACnB,SAAKG,UAAL,CAAgBT,QAAhB,CAAyB,OAAzB,EAAkC,KAAKpB,IAAL,CAAUgC,IAAV,EAAlC;AACA,SAAKE,YAAL,CAAkBd,QAAlB,CAA2B,OAA3B,EAAoC,KAAKpB,IAAL,CAAUoC,MAAV,EAApC;AACA,SAAK5B,YAAL,CAAkBY,QAAlB,CAA2B,OAA3B,EAAoC,KAAKpB,IAAL,CAAUc,MAAV,CAAiB,OAAjB,CAApC;AACA,SAAKjB,cAAL,CAAoB,KAAKG,IAAzB;AACD;AACD;;;;;AAGAgB,EAAAA,QAAQ,GAAS;AACf,QAAI,KAAKP,QAAL,CAAcY,KAAd,CAAoB,YAApB,MAAsC,QAA1C,EAAoD;AAClD,WAAKZ,QAAL,CAAcY,KAAd,CAAoB,YAApB,EAAkC,SAAlC,EACGT,OADH,CACW,UADX,EACuB,IADvB;;AAEA,WAAK2B,oBAAL;;AACAC,MAAAA,MAAM,CAACC,QAAP,CAAgBC,gBAAhB,CAAiC,OAAjC,EAA0C,KAAKrC,SAA/C,EAA0D,KAA1D;AACD,KALD,MAKO;AACL,WAAKI,QAAL,CAAcY,KAAd,CAAoB,YAApB,EAAkC,QAAlC;AACAmB,MAAAA,MAAM,CAACC,QAAP,CAAgBE,mBAAhB,CAAoC,OAApC,EAA6C,KAAKtC,SAAlD;AACD;AACF;AACD;;;;;AAGAK,EAAAA,IAAI,GAAS;AACX,SAAKD,QAAL,CAAcY,KAAd,CAAoB,YAApB,EAAkC,QAAlC,EACGT,OADH,CACW,UADX,EACuB,KADvB;AAEA4B,IAAAA,MAAM,CAACC,QAAP,CAAgBE,mBAAhB,CAAoC,OAApC,EAA6C,KAAKtC,SAAlD;AACD;AACD;;;AACAkC,EAAAA,oBAAoB,GAAS;AAEzB,QAAIK,KAAK,GAAG,KAAKpC,YAAL,CAAkBqC,IAAlB,EAAZ;AACA,QAAIC,KAAK,GAAG,KAAKtC,YAAL,CAAkBuC,WAA9B;AACA,QAAIC,MAAM,GAAG,KAAKxC,YAAL,CAAkByC,YAA/B;AACA,QAAIC,aAAqB,GAAGV,MAAM,CAACW,UAAnC;AACA,QAAIC,cAAsB,GAAGZ,MAAM,CAACa,WAApC;AACA,QAAIC,SAAiB,GAAGd,MAAM,CAACe,WAA/B;AACA,QAAIC,IAAI,GAAGZ,KAAK,CAACa,UAAjB;AACA,QAAIC,GAAG,GAAId,KAAK,CAACe,SAAN,GAAkBf,KAAK,CAACK,YAAnC;;AACA,WAAOL,KAAK,GAAGA,KAAK,CAACgB,YAArB,EAAoC;AAChCJ,MAAAA,IAAI,IAAIZ,KAAK,CAACa,UAAd;AACAC,MAAAA,GAAG,IAAKd,KAAK,CAACe,SAAd;AACH,KAbwB;;;AAiBzB,QAAKH,IAAI,GAAGV,KAAP,GAAeI,aAApB,EAAoC;AAChCM,MAAAA,IAAI,GAAGA,IAAI,GAAGV,KAAP,GAAeF,KAAK,CAACG,WAA5B;AACH;;AACD,QAAKW,GAAG,GAAGV,MAAN,GAAeI,cAAc,GAAGE,SAArC,EAAiD;AAC7CI,MAAAA,GAAG,GAAGA,GAAG,GAAGV,MAAN,GAAeJ,KAAK,CAACK,YAA3B;AACH;;AACD,SAAKxC,QAAL,CAAcY,KAAd,CAAoB,MAApB,EAA4BmC,IAAI,GAAG,IAAnC;AACA,SAAK/C,QAAL,CAAcY,KAAd,CAAoB,KAApB,EAA2BqC,GAAG,GAAG,IAAjC;AACH;;AAlKyB;AAqK5B;;;;;;;;;;AASO,MAAMG,eAAN,CAAsB;AACjB;AAOVnE,EAAAA,WAAW,CAACC,GAAD,EAAWmE,KAAX,EAA0BlE,WAA1B,EAA+CC,cAA/C,EAAyF;AAClG,QAAI,OAAOF,GAAP,KAAe,QAAnB,EAA6B;AAC3B,WAAKA,GAAL,GAAWI,MAAA,CAAUJ,GAAV,CAAX;AACD,KAFD,MAEO;AACL,WAAKA,GAAL,GAAWA,GAAX;AACD;;AACD,SAAKmE,KAAL,GAAaA,KAAb;AACA,SAAK9D,IAAL,GAAYC,QAAM,CAACC,GAAP,CAAWN,WAAX,CAAZ;AACA,SAAKI,IAAL,CAAU+D,MAAV,CAAiB,CAAjB,EAAoBC,WAApB,CAAgC,CAAhC,EARkG;;AASlG,SAAKnE,cAAL,GAAsBA,cAAc,GAAGA,cAAH,GAAoBM,aAAxD;AACA,SAAK8D,SAAL,GAAiBtE,GAAG,CAACgB,MAAJ,CAAW,OAAX,EAAoBgB,IAApB,CAAyB,KAAKmC,KAA9B,EAAqCnD,MAArC,CAA4C,OAA5C,EACdC,OADc,CACN,SADM,EACK,IADL,EAEdC,IAFc,CAET,OAFS,EAEA,KAAKb,IAAL,CAAUkE,WAAV,EAFA,EAGdrD,IAHc,CAGT,MAHS,EAGD,MAHC,EAIdE,EAJc,CAIX,OAJW,EAIF,YAAW;AACtB,UAAIjB,MAAM,CAACqE,MAAP,CAAcC,SAAd,EAAJ,EAA+B;AAC7BtE,QAAAA,MAAM,CAACqE,MAAP,CAAczD,IAAd;AACD;AACF,KARc,CAAjB;AASA,QAAIZ,MAAM,GAAG,IAAb;AACA,SAAKqE,MAAL,GAAc,IAAIE,SAAJ,CAAY;AAAEzB,MAAAA,KAAK,EAAE,KAAKqB,SAAL,CAAepB,IAAf,EAAT;AACA;AACE/B,MAAAA,MAAM,EAAE,YAFV;AAGEwD,MAAAA,QAAQ,EAAE,oBAAW;AACnB,YAAIC,SAAS,GAAG,KAAKC,SAAL,EAAhB;AACA,YAAIC,QAAQ,GAAGxE,QAAM,CAACC,GAAP,CAAWJ,MAAM,CAACE,IAAlB,CAAf;;AACA,YAAIyE,QAAQ,CAACC,IAAT,OAAoBH,SAAS,CAACG,IAAV,EAApB,IAAwCD,QAAQ,CAACE,SAAT,OAAyBJ,SAAS,CAACI,SAAV,EAArE,EAA4F;AAC1F7E,UAAAA,MAAM,CAACE,IAAP,CAAY0E,IAAZ,CAAiBH,SAAS,CAACG,IAAV,EAAjB;AACA5E,UAAAA,MAAM,CAACE,IAAP,CAAY2E,SAAZ,CAAsBJ,SAAS,CAACI,SAAV,EAAtB;AACA7E,UAAAA,MAAM,CAAC4B,YAAP;AACD;AACF;AAXH,KAAZ,CAAd;;AAaA,SAAKkD,gBAAL,CAAsB,KAAK5E,IAA3B;;AACA,SAAK6E,OAAL,GAAe,IAAIpF,cAAJ,CAAmBE,GAAnB,EAAwB,KAAKK,IAA7B,EAAmC,UAASA,IAAT,EAAe;AAC/DF,MAAAA,MAAM,CAAC8E,gBAAP,CAAwB5E,IAAxB;;AACAF,MAAAA,MAAM,CAAC4B,YAAP;AACD,KAHc,CAAf;AAID;AACD;;;;;;;AAKAW,EAAAA,UAAU,CAACC,OAAD,EAAwB;AAChC,SAAKsC,gBAAL,CAAsBtC,OAAtB;;AACA,SAAKuC,OAAL,CAAaxC,UAAb,CAAwBC,OAAxB;AACD;AACD;;;;;AAGAZ,EAAAA,YAAY,GAAS;AACnB,SAAK7B,cAAL,CAAoB,KAAKG,IAAzB;AACD;;AACD8E,EAAAA,OAAO,GAAW;AAChB,WAAO,KAAK9E,IAAZ;AACD;AAED;;;;;;;;AAMA4E,EAAAA,gBAAgB,CAACtC,OAAD,EAAwB;AACtC,SAAKtC,IAAL,GAAYC,QAAM,CAACC,GAAP,CAAWoC,OAAX,CAAZ;AACA,SAAK2B,SAAL,CAAepD,IAAf,CAAoB,OAApB,EAA6B,KAAKb,IAAL,CAAUkE,WAAV,EAA7B,EAFsC;;AAItC,SAAKC,MAAL,CAAYY,SAAZ,CAAsB9E,QAAM,CAAC,CAAC,KAAKD,IAAL,CAAU0E,IAAV,EAAD,EAAmB,KAAK1E,IAAL,CAAUgF,KAAV,EAAnB,EAAsC,KAAKhF,IAAL,CAAUiF,IAAV,EAAtC,CAAD,CAA5B;AACD;;AA7E0B;AAgF7B;;;;;;;AAMO,MAAMC,gBAAN,CAAuB;AAO5BxF,EAAAA,WAAW,CAACC,GAAD,EAAWE,cAAX,EAAmE;AAC5E,SAAKsF,kBAAL,GAA0B,OAA1B;AACA,SAAKtF,cAAL,GAAsBA,cAAc,GAAGA,cAAH,GAAoBM,aAAxD;AACA,QAAIiF,OAAO,GAAGnF,QAAM,CAACC,GAAP,EAAd;AACA,SAAKmF,QAAL,GAAgB,GAAhB;AACA,QAAIC,SAAS,GAAGrF,QAAM,CAACC,GAAP,CAAWkF,OAAX,EAAoBG,QAApB,CAA6B,KAAKF,QAAlC,EAA4C,QAA5C,CAAhB;;AACA,QAAI,OAAO1F,GAAP,KAAe,QAAnB,EAA6B;AAC3B,WAAKA,GAAL,GAAWI,MAAA,CAAUJ,GAAV,CAAX;AACD,KAFD,MAEO;AACL,WAAKA,GAAL,GAAWA,GAAX;AACD;;AACD,SAAKA,GAAL,CAASiB,OAAT,CAAiB,kBAAjB,EAAqC,IAArC;AACA,QAAId,MAAM,GAAG,IAAb;AACA,QAAI0F,QAAQ,GAAG,KAAK7F,GAAL,CAASgB,MAAT,CAAgB,MAAhB,EAAwBC,OAAxB,CAAgC,OAAhC,EAAyC,IAAzC,CAAf;AACA,SAAK6E,YAAL,GAAoB,IAAI5B,eAAJ,CAAoB2B,QAApB,EAA8B,QAA9B,EAAwCF,SAAxC,EAAmD,UAASA,SAAT,EAAoB;AACzFxF,MAAAA,MAAM,CAAC4F,UAAP,CAAkBrD,UAAlB,CAA6BpC,QAAM,CAACC,GAAP,CAAWoF,SAAX,EAAsBK,GAAtB,CAA0B7F,MAAM,CAACuF,QAAjC,EAA2C,SAA3C,CAA7B;AACAvF,MAAAA,MAAM,CAACD,cAAP,CAAsBC,MAAM,CAAC8F,YAAP,EAAtB;AACA9F,MAAAA,MAAM,CAACqF,kBAAP,GAA4B,OAA5B;AACD,KAJmB,CAApB;AAMA,QAAIU,WAAW,GAAG,KAAKlG,GAAL,CAASgB,MAAT,CAAgB,MAAhB,EAAwBC,OAAxB,CAAgC,UAAhC,EAA4C,IAA5C,CAAlB;AACAiF,IAAAA,WAAW,CAAClF,MAAZ,CAAmB,OAAnB,EAA4BgB,IAA5B,CAAiC,WAAjC,EAA8ChB,MAA9C,CAAqD,OAArD,EACGC,OADH,CACW,UADX,EACuB,IADvB,EAEGC,IAFH,CAEQ,OAFR,EAEiB,KAAKwE,QAFtB,EAGGxE,IAHH,CAGQ,MAHR,EAGgB,MAHhB,EAIGE,EAJH,CAIM,OAJN,EAIe,YAAW;AACtB,UAAI+E,IAAI,GAAG,CAACC,MAAM,CAACC,QAAP,CAAgB,KAAKjE,KAArB,CAAZ;AACAjC,MAAAA,MAAM,CAACuF,QAAP,GAAkBS,IAAlB;;AACA,UAAIhG,MAAM,CAACqF,kBAAP,KAA8B,KAAlC,EAAyC;AACvCrF,QAAAA,MAAM,CAAC2F,YAAP,CAAoBpD,UAApB,CAA+BpC,QAAM,CAACC,GAAP,CAAWJ,MAAM,CAAC4F,UAAP,CAAkBZ,OAAlB,EAAX,EAAwCS,QAAxC,CAAiDzF,MAAM,CAACuF,QAAxD,EAAkE,SAAlE,CAA/B;AACAvF,QAAAA,MAAM,CAACD,cAAP,CAAsBC,MAAM,CAAC8F,YAAP,EAAtB;AACD,OAHD,MAGO;AACL;AACA9F,QAAAA,MAAM,CAAC4F,UAAP,CAAkBrD,UAAlB,CAA6BpC,QAAM,CAACC,GAAP,CAAWJ,MAAM,CAAC2F,YAAP,CAAoBX,OAApB,EAAX,EAA0Ca,GAA1C,CAA8C7F,MAAM,CAACuF,QAArD,EAA+D,SAA/D,CAA7B;AACAvF,QAAAA,MAAM,CAACD,cAAP,CAAsBC,MAAM,CAAC8F,YAAP,EAAtB;AACD;AACF,KAfH;AAiBA,QAAIK,MAAM,GAAG,KAAKtG,GAAL,CAASgB,MAAT,CAAgB,MAAhB,EAAwBC,OAAxB,CAAgC,KAAhC,EAAuC,IAAvC,CAAb;AACA,SAAK8E,UAAL,GAAkB,IAAI7B,eAAJ,CAAoBoC,MAApB,EAA4B,MAA5B,EAAoCb,OAApC,EAA6C,UAASA,OAAT,EAAkB;AAC/EtF,MAAAA,MAAM,CAAC2F,YAAP,CAAoBpD,UAApB,CAA+BpC,QAAM,CAACC,GAAP,CAAWkF,OAAX,EAAoBG,QAApB,CAA6BzF,MAAM,CAACuF,QAApC,EAA8C,SAA9C,CAA/B;AACAvF,MAAAA,MAAM,CAACD,cAAP,CAAsBC,MAAM,CAAC8F,YAAP,EAAtB;AACA9F,MAAAA,MAAM,CAACqF,kBAAP,GAA4B,KAA5B;AACD,KAJiB,CAAlB;AAKD;;AACDS,EAAAA,YAAY,GAAqB;AAC/B,WAAO,IAAIM,gBAAJ,CAAqB,KAAKT,YAAL,CAAkBX,OAAlB,EAArB,EACqB,KAAKY,UAAL,CAAgBZ,OAAhB,EADrB,CAAP;AAED;;AAvD2B;AA0D9B;;;;;;AAMA;;AACA,SAAS3E,aAAT,CAAuBgG,CAAvB,EAA0B;AAE1B;;;;;;MAIaC,WAAW;AA0DxB;;;;MAGaC,WAAW;;AA2OxB,IAAI5D,QAAJ,EAAa;AACX6D,EAAAA,SAAS,CAACF,WAAD,CAAT;AACAE,EAAAA,SAAS,CAACD,WAAD,CAAT;AACD;;;;"}