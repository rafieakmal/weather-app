{"version":3,"file":"seisplotjs-umd.js","sources":["../src/cssutil.js","../src/util.js","../src/seedcodec.js","../src/oregondsputil.js","../src/stationxml.js","../src/quakeml.js","../src/seismogram.js","../src/miniseed.js","../src/datalink.js","../src/datechooser.js","../src/distaz.js","../src/fdsnavailability.js","../src/fdsndataselect.js","../src/fdsnevent.js","../src/fdsnstation.js","../src/fdsndatacenters.js","../src/filter.js","../src/fft.js","../src/seismographconfig.js","../src/fftplot.js","../src/seismograph.js","../src/helicorder.js","../src/knowndatacenters.js","../src/mseedarchive.js","../src/plotutil.js","../src/particlemotion.js","../src/ringserverweb.js","../src/sacpolezero.js","../src/seedlink.js","../src/taper.js","../src/transfer.js","../src/traveltime.js","../src/vector.js","../src/xseed.js","../src/index.js"],"sourcesContent":["// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n/**\n * Inserts text as css into the head of an html document. No checking\n * as to validity of the css is done, just inserts a style\n * element at the beginning of the head.\n * \n * @param  cssText textual css for insertion\n * @returns the style html element inserted\n */\nexport function insertCSS(cssText: string): HTMLElement {\n  let head = document.head;\n  if (head === null) {throw new Error(\"document.head is null\");}\n  let styleElement = document.createElement('style');\n  styleElement.type = 'text/css';\n  styleElement.appendChild(document.createTextNode(cssText));\n  head.insertBefore(styleElement, head.firstChild);\n  return styleElement;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n\nimport moment from 'moment';\nimport * as d3 from 'd3';\n\n//reexport\nexport { moment, };\n\n\nimport RSVP from 'rsvp';\n\nRSVP.on('error', function(reason: string) {\n  // eslint-disable-next-line no-console\n  console.assert(false, reason);\n});\n\n//reexport\nexport {RSVP, };\n\nexport const XML_MIME = \"application/xml\";\nexport const JSON_MIME = \"application/json\";\nexport const JSONAPI_MIME = \"application/vnd.api+json\";\nexport const TEXT_MIME = \"text/plain\";\n\n// flow predicate %check functions\nexport function hasArgs(value: any): boolean %checks {\n  return arguments.length !== 0 && typeof value !== 'undefined';\n}\nexport function hasNoArgs(value: any): boolean %checks {\n  return arguments.length === 0 || typeof value === 'undefined';\n}\nexport function isStringArg(value: any): boolean %checks {\n  return arguments.length !== 0 && typeof value === 'string';\n}\nexport function isNumArg(value: any): boolean %checks {\n  return typeof value === 'number';\n}\nexport function isNonEmptyStringArg(value: any): boolean %checks {\n  return arguments.length !== 0 && isStringArg(value) && value.length !== 0;\n}\nexport function isObject (obj: mixed): boolean %checks {\n  return obj !== null && typeof obj === 'object';\n}\nexport function isDef(v: mixed): boolean %checks {\n  return typeof v !== 'undefined' && v !== null;\n}\n\n/**\n * Converts entire DataView to a string as utf-8.\n *\n * @param   dataView bytes to convert\n * @returns           the string\n */\nexport function dataViewToString(dataView: DataView) {\n  let out = \"\";\n  for (let i=0; i< dataView.byteLength; i++) {\n    out += String.fromCharCode(dataView.getUint8(i));\n  }\n  return out;\n}\n\n/**\n * Log a message to the console. Put here to limit lint console errors\n * for the times we really do want to use console.log. Will also append a\n * p tag to a div#debug if it exists.\n *\n * @param   msg the message to log\n */\nexport function log(msg: string): void {\n  // eslint-disable-next-line no-console\n  if (console) {console.log(`${stringify(msg)}`);}\n  d3.select(\"div#debug\").append(\"p\").text(`${stringify(msg)}`);\n}\n\n/**\n * String representation of input. This is kind of dumb but makes\n *  flow happier.\n *\n * @param value any kind of thing that can be turned into a string\n * @returns a string\n */\nexport function stringify(value: mixed): string {\n  if (typeof value === 'string') {\n    return value;\n  } else if (typeof value === 'number') {\n    return value.toString();\n  } else if (typeof value === 'boolean') {\n    return value ? \"true\" : \"false\";\n  } else if (typeof value === 'undefined') {\n    return \"undefined\";\n  } else if (typeof value === 'function') {\n    return \"function \"+value.name;\n  } else if (typeof value === 'object') {\n    if (value) {\n      if (value instanceof moment) {\n        return value.toISOString();\n      } else {\n        return value.constructor.name+ \" \"+value.toString();\n      }\n    } else {\n      return \"null\";\n    }\n// symbol not yet supported by flow\n//  } else if (typeof value === 'symbol') {\n//    return value.toString();\n  } else {\n    return \"<unknown\"+(typeof value)+\"???>\";\n  }\n}\n\n/**\n * Calculates offset of remote server versus local time. It is assumed that the\n * argument was acquired as close in time to calling this as possible.\n *\n * @param  serverTimeUTC now as reported by remote server\n * @returns offset in seconds to now on local machine\n */\nexport function calcClockOffset(serverTimeUTC: moment): number {\n  return moment.utc().diff(serverTimeUTC, 'seconds', true);\n}\n\n/**\n * Any two of startTime, endTime and duration can be specified, or just duration which\n * then assumes endTime is now.\n * startTime and endTime are moment objects, duration is in seconds.\n * clockOffset is the seconds that should be subtracted from the computer time\n * to get real world time, ie computerUTC - UTC\n * or moment.utc().diff(serverTimeUTC, 'seconds', true).\n * default is zero.\n */\nexport class StartEndDuration {\n  _startTime: moment;\n  _endTime: moment;\n  _duration: moment.duration;\n  _clockOffset: moment.duration;\n  constructor(startTime: moment | null, endTime: moment | null, duration: moment.duration | number | null =null, clockOffset?: number | null =0) {\n    if (isDef(duration)) {\n      if ((typeof duration === \"string\" || duration instanceof String)) {\n        if (duration.charAt(0) === 'P') {\n          this._duration = moment.duration(duration);\n        } else {\n          this._duration = moment.duration(Number.parseFloat(duration), 'seconds');\n        }\n      } else if ((typeof duration === \"number\" || duration instanceof Number)) {\n        this._duration = moment.duration(duration, 'seconds');\n      } else if ((moment.isDuration(duration))) {\n        this._duration = moment.duration(duration);\n      } else {\n        throw new Error(`Unknown type for duration: ${typeof duration}  ${JSON.stringify(duration)}`);\n      }\n    }\n    if (startTime && endTime) {\n      this._startTime = checkStringOrDate(startTime);\n      this._endTime = checkStringOrDate(endTime);\n      this._duration = moment.duration(this.endTime.diff(this.startTime));\n    } else if (startTime && this._duration) {\n      this._startTime = checkStringOrDate(startTime);\n      this._endTime = moment.utc(this.startTime).add(this.duration);\n    } else if (endTime && this._duration) {\n      this._endTime = checkStringOrDate(endTime);\n      this._startTime = moment.utc(this.endTime).subtract(this.duration);\n    } else if (this._duration) {\n      if (clockOffset === undefined) {\n        this._clockOffset = moment.duration(0, 'seconds');\n      } else if (clockOffset instanceof Number) {\n        this._clockOffset = moment.duration(clockOffset, 'seconds');\n      } else {\n        this._clockOffset = clockOffset;\n      }\n      this._endTime = moment.utc().subtract(clockOffset);\n      this._startTime = moment.utc(this.endTime).subtract(this.duration);\n    } else {\n      throw new Error(\"need some combination of startTime, endTime and duration\");\n    }\n  }\n  get start() {\n    return this._startTime;\n  }\n  get startTime() {\n    return this._startTime;\n  }\n  get end() {\n    return this._endTime;\n  }\n  get endTime() {\n    return this._endTime;\n  }\n  get duration() {\n    return this._duration;\n  }\n  get clockOffset() {\n    return this._clockOffset;\n  }\n  /**\n   * Check if this time window contains the given moment. Equality to start\n   * or end is considered being contained in.\n   *\n   * @param   other moment to check\n   * @returns        true if moment is inside this time range\n   */\n  contains(other: moment | StartEndDuration): boolean {\n    if (other instanceof moment){\n      if (this.startTime.isAfter(other)\n          || this.endTime.isBefore(other)) {\n        return false;\n      }\n      return true;\n    } else if (other instanceof StartEndDuration) {\n      return this.contains(other.startTime) && this.contains(other.endTime);\n    } else {\n      throw new Error(\"expect moment or StartEndDuration\");\n    }\n  }\n  overlaps(other: StartEndDuration): boolean {\n    if (this.startTime.isAfter(other.endTime)\n        || this.endTime.isBefore(other.startTime)) {\n      return false;\n    }\n    return true;\n  }\n  intersect(other: StartEndDuration): StartEndDuration | null {\n    let out = null;\n    if (this.overlaps(other)) {\n      let tb = this.startTime;\n      if (tb.isBefore(other.startTime)) {\n        tb = other.startTime;\n      }\n      let te = this.endTime;\n      if (te.isAfter(other.endTime)) {\n        te = other.endTime;\n      }\n      out = new StartEndDuration(tb, te);\n    }\n    return out;\n  }\n  union(other: StartEndDuration): StartEndDuration {\n    let tb = this.startTime;\n    if (tb.isAfter(other.startTime)) {\n      tb = other.startTime;\n    }\n    let te = this.endTime;\n    if (te.isBefore(other.endTime)) {\n      te = other.endTime;\n    }\n    return new StartEndDuration(tb, te);\n  }\n  toString() {\n    return `StartEndDuration: ${toIsoWoZ(this.startTime)} to ${toIsoWoZ(this.endTime)} ${this.duration}`;\n  }\n}\n\n/**\n * converts the input value is a moment, throws Error if not\n * a string, Date or moment. Zero length string or \"now\" return\n * current time.\n *\n * @param d 'now', string time, Date, number of milliseconds since epoch, or moment\n * @returns moment created from argument\n */\nexport function checkStringOrDate(d: any): moment {\n  if (moment.isMoment(d)) {\n    return d;\n  } else if (d instanceof Date) {\n      return moment.utc(d);\n  } else if (d instanceof Number || typeof d === \"number\") {\n    return moment.utc(d);\n  } else if (d instanceof String || typeof d === \"string\") {\n    let lc = d.toLowerCase();\n    if (d.length === 0 || lc === \"now\") {\n      return moment.utc();\n    } else {\n      return moment.utc(d);\n    }\n  }\n  throw new Error(\"unknown date type: \"+d+\" \"+(typeof d));\n}\n\n\n/**\n * Converts name and value into a html query parameter, with appending ampersand.\n *\n * @param   name parameter name\n * @param   val  parameter value\n * @returns      formated query parameter\n */\nexport function makeParam(name: string, val: mixed): string {\n  return name+\"=\"+encodeURIComponent(stringify(val))+\"&\";\n}\n\n/**\n * converts to ISO8601 but removes the trailing Z as FDSN web services\n * do not allow that.\n *\n * @param  date moment to convert to string\n * @returns ISO8601 without timezone Z\n **/\nexport function toIsoWoZ(date: moment): string {\n  let out = date.toISOString();\n  return out.substring(0, out.length-1);\n}\n\n/**\n * @returns the protocol, http or https for the document if possible.\n **/\nexport function checkProtocol(): string {\n  let _protocol = 'http:';\n  if (typeof document !== 'undefined' && document.location && \"https:\" === document.location.protocol) {\n    _protocol = 'https:';\n  }\n  return _protocol;\n}\n\n/**\n * Create default fetch init object with the given mimeType. Sets\n * no-cache, follow redirects, cors mode, referrer as seisplotjs and mimetype as a header.\n *\n * @param   mimeType requested mime type\n * @returns           object with fetch configuration parameters\n */\nexport function defaultFetchInitObj(mimeType?: string): { [key: string]: any } {\n  let headers = {};\n  if (isStringArg(mimeType)) {\n    headers.Accept = mimeType;\n  }\n  return {\n        cache: 'no-cache',\n        redirect: 'follow', // manual, *follow, error\n        mode: \"cors\",\n        referrer: \"seisplotjs\",\n        headers: headers\n  };\n}\n\n/**\n * Does a fetch, but times out if it takes too long.\n *\n * @param   url        url to retrieve\n * @param   fetchInit  fetch configuration, initialization\n * @param   timeoutSec maximum time to wait in seconds\n * @returns             promise to the result\n * @throws Error if time out or other failure\n */\nexport function doFetchWithTimeout(url: string | URL,\n                                   fetchInit?: { [key: string]: any },\n                                   timeoutSec?: number): Promise<Response> {\n  const controller = new AbortController();\n  const signal = controller.signal;\n  if ( ! isDef(fetchInit)) {\n    fetchInit = defaultFetchInitObj();\n  }\n  if ( ! isDef(timeoutSec) ){\n    timeoutSec = 30;\n  }\n  setTimeout(() => controller.abort(), timeoutSec * 1000);\n  fetchInit.signal = signal;\n  let absoluteUrl: URL;\n  if (isStringArg(url)) {\n    absoluteUrl = new URL(url, document.URL);\n  } else if (url instanceof URL) {\n    absoluteUrl = url;\n  } else {\n    throw new Error(`url must be string or URL, ${stringify(url)}`);\n  }\n  log(`attempt to fetch ${stringify(absoluteUrl)}`);\n  return fetch(absoluteUrl, fetchInit)\n  .catch(err => {\n    log(\"fetch failed, possible CORS or PrivacyBadger or NoScript?\");\n    throw err;\n  }).then(function(response) {\n    if(response.ok) {\n      return response;\n    }\n    // $FlowFixMe\n    throw new Error(`fetch response was not ok. ${response.ok} ${response.status}`);\n  });\n}\n\n\n/**\n * Recursively calculates the mean of a slice of an array. This helps with\n * very long seismograms to equally weight each sample point without overflowing.\n *\n * @param   dataSlice slice of a seismogram\n * @param   totalPts  number of points in the original seismogram\n * @returns            sum of slice data points divided by totalPts\n */\nexport function meanOfSlice(dataSlice: Int32Array | Float32Array | Float64Array, totalPts: number ): number {\n  if (dataSlice.length < 8) {\n    return dataSlice.reduce(function(acc, val) {\n       return acc + val;\n    }, 0) / totalPts;\n  } else {\n    let byTwo = Math.floor(dataSlice.length / 2);\n    return meanOfSlice(dataSlice.slice(0, byTwo), totalPts) + meanOfSlice(dataSlice.slice(byTwo, dataSlice.length), totalPts);\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n// converted from Steim2.java in seedCodec\n// http://github.com/crotwell/seedcodec/\n\n\n\n// constants for compression types\n\n/** ascii */\nexport const ASCII = 0;\n\n/** 16 bit integer, or java short */\nexport const SHORT = 1;\n\n/** 24 bit integer */\nexport const INT24 = 2;\n\n/** 32 bit integer, or java int */\nexport const INTEGER = 3;\n\n/** ieee float */\nexport const FLOAT = 4;\n\n/** ieee double*/\nexport const DOUBLE = 5;\n\n/** Steim1 compression */\nexport const STEIM1= 10;\n\n/** Steim2 compression */\nexport const STEIM2 = 11;\n\n/** CDSN 16 bit gain ranged */\nexport const CDSN = 16;\n\n/** (A)SRO */\nexport const SRO = 30;\n\n/** DWWSSN 16 bit */\nexport const DWWSSN = 32;\n\nexport class CodecException extends Error {\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.name = 'CodecException';\n  }\n}\n\nexport class UnsupportedCompressionType extends Error {\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    this.name = 'UnsupportedCompressionType';\n  }\n}\n\nexport function isFloatCompression(compressionType: number): boolean {\n  if (compressionType === FLOAT || compressionType === DOUBLE) {\n    return true;\n  }\n  return false;\n}\n\n/**\n * A holder for compressed data independent of the file format.\n */\nexport class EncodedDataSegment {\n  compressionType: number;\n  dataView: DataView;\n  numSamples: number;\n  littleEndian: boolean;\n  constructor(compressionType: number, dataView: DataView, numSamples: number, littleEndian: boolean) {\n    this.compressionType = compressionType;\n    this.dataView = dataView;\n    this.numSamples = numSamples;\n    this.littleEndian = littleEndian;\n  }\n  isFloatCompression(): boolean {\n    return isFloatCompression(this.compressionType);\n  }\n  decode(): Int32Array | Float32Array | Float64Array {\n    return decompress(this.compressionType,\n      this.dataView,\n      this.numSamples,\n      this.littleEndian);\n  }\n}\n\n/**\n *  Decompress the samples from the provided DataView and\n *  return an array of the decompressed values.\n *  Only 16 bit short, 32 bit int, 32 bit float and 64 bit double\n *  along with Steim1 and Steim2 are supported.\n *\n *  @param compressionType compression format as defined in SEED blockette 1000\n *  @param dataView input DataView to be decoded\n *  @param numSamples the number of samples that can be decoded from array\n *  <b>b</b>\n *  @param littleEndian if true, dataView is little-endian (intel byte order) <b>b</b>.\n *  @returns array of length <b>numSamples</b>.\n *  @throws CodecException fail to decompress.\n *  @throws UnsupportedCompressionType unsupported compression type\n */\nexport function decompress(compressionType: number, dataView: DataView, numSamples: number, littleEndian: boolean): Int32Array | Float32Array | Float64Array {\n  // in case of record with no data points, ex detection blockette, which often have compression type\n  // set to 0, which messes up the decompresser even though it doesn't matter since there is no data.\n  if (numSamples === 0) {\n    return new Int32Array(0);\n  }\n\n  let out;\n  let offset = 0;\n  let i;\n  switch(compressionType){\n    case SHORT:\n    case DWWSSN:\n      // 16 bit values\n      if(dataView.byteLength < 2 * numSamples) {\n        throw new CodecException(\"Not enough bytes for \"\n                        + numSamples + \" 16 bit data points, only \"\n                        + dataView.byteLength + \" bytes.\");\n      }\n      out = new Int32Array(numSamples);\n      for(i = 0; i < numSamples; i++) {\n        out[i] = dataView.getInt16(offset, littleEndian);\n        offset += 2;\n      }\n      break;\n    case INTEGER:\n      // 32 bit integers\n      if(dataView.byteLength < 4 * numSamples) {\n          throw new CodecException(\"Not enough bytes for \"\n                + numSamples + \" 32 bit data points, only \"\n                + dataView.byteLength + \" bytes.\");\n      }\n      out = new Int32Array(numSamples);\n      for(i = 0; i < numSamples; i++) {\n        out[i] = dataView.getInt32(offset, littleEndian);\n        offset += 4;\n      }\n      break;\n    case FLOAT:\n      // 32 bit floats\n      if(dataView.byteLength < 4 * numSamples) {\n        throw new CodecException(\"Not enough bytes for \"\n              + numSamples + \" 32 bit data points, only \"\n              + dataView.byteLength + \" bytes.\");\n      }\n      out = new Float32Array(numSamples);\n      for(i = 0; i < numSamples; i++) {\n        out[i] = dataView.getFloat32(offset, littleEndian);\n        offset += 4;\n      }\n      break;\n    case DOUBLE:\n      // 64 bit doubles\n      if(dataView.byteLength < 8 * numSamples) {\n          throw new CodecException(\"Not enough bytes for \"\n                + numSamples + \" 64 bit data points, only \"\n                + dataView.byteLength + \" bytes.\");\n      }\n      out = new Float64Array(numSamples);\n      for(i = 0; i < numSamples; i++) {\n        out[i] = dataView.getFloat64(offset, littleEndian);\n        offset += 8;\n      }\n      break;\n    case STEIM1:\n      // steim 1\n      out = decodeSteim1(dataView, numSamples, littleEndian, 0);\n      break;\n    case STEIM2:\n      // steim 2\n      out = decodeSteim2(dataView, numSamples, littleEndian, 0);\n      break;\n    default:\n      // unknown format????\n      throw new UnsupportedCompressionType(\"Type \" + compressionType\n                    + \" is not supported at this time.\");\n  } // end of switch ()\n  return out;\n}\n\n/**\n *  Decode the indicated number of samples from the provided byte array and\n *  return an integer array of the decompressed values.  Being differencing\n *  compression, there may be an offset carried over from a previous data\n *  record.  This offset value can be placed in <b>bias</b>, otherwise leave\n *  the value as 0.\n *\n *  @param dataView input DataView to be decoded\n *  @param numSamples the number of samples that can be decoded from array\n *  <b>b</b>\n *  @param littleEndian if true, dataView is little-endian (intel byte order) <b>b</b>.\n *  @param bias the first difference value will be computed from this value.\n *  If set to 0, the method will attempt to use the X(0) constant instead.\n *  @returns int array of length <b>numSamples</b>.\n *  @throws CodecException - encoded data length is not multiple of 64\n *  bytes.\n */\nexport function decodeSteim1(dataView: DataView, numSamples: number, littleEndian: boolean, bias: number): Int32Array {\n  // Decode Steim1 compression format from the provided byte array, which contains numSamples number\n  // of samples.  swapBytes is set to true if the value words are to be byte swapped.  bias represents\n  // a previous value which acts as a starting constant for continuing differences integration.  At the\n  // very start, bias is set to 0.\n  if (dataView.byteLength % 64 !== 0) {\n    throw new CodecException(\"encoded data length is not multiple of 64 bytes (\" + dataView.byteLength + \")\");\n  }\n  let buf = new ArrayBuffer(4 * numSamples);\n  let samples = new Int32Array(buf);\n  let tempSamples;\n  let numFrames = dataView.byteLength / 64;\n  let current = 0;\n  let start=0;\n  let firstData=0;\n  let lastValue = 0;\n  let i, j;\n\n  for (i=0; i< numFrames; i++ ) {\n    tempSamples = extractSteim1Samples(dataView, i*64, littleEndian);   // returns only differences except for frame 0\n    firstData = 0; // d(0) is byte 0 by default\n    if (i===0) {   // special case for first frame\n      lastValue = bias; // assign our X(-1)\n      // x0 and xn are in 1 and 2 spots\n      start = tempSamples[1];  // X(0) is byte 1 for frame 0\n      //  end = tempSamples[2];    // X(n) is byte 2 for frame 0\n      firstData = 3; // d(0) is byte 3 for frame 0\n      // if bias was zero, then we want the first sample to be X(0) constant\n      if (bias === 0) lastValue = start - tempSamples[3];  // X(-1) = X(0) - d(0)\n    }\n    for (j = firstData; j < tempSamples.length && current < numSamples; j++) {\n      samples[current] = lastValue + tempSamples[j];  // X(n) = X(n-1) + d(n)\n      lastValue = samples[current];\n      current++;\n    }\n  }  // end for each frame...\n  if (current !== numSamples) {\n    throw new CodecException(\"Number of samples decompressed doesn't match number in header: \"+current+\" !== \"+numSamples);\n  }\n  // ignore last sample check???\n  //if (end !== samples[numSamples-1]) {\n  //    throw new SteimException(\"Last sample decompressed doesn't match value x(n) value in Steim1 record: \"+samples[numSamples-1]+\" !== \"+end);\n  //}\n  return samples;\n}\n\n/**\n * Extracts differences from the next 64 byte frame of the given compressed\n * byte array (starting at offset) and returns those differences in an int\n * array.\n * An offset of 0 means that we are at the first frame, so include the header\n * bytes in the returned int array...else, do not include the header bytes\n * in the returned array.\n *\n * @param dataView byte array of compressed data differences\n * @param offset index to begin reading compressed bytes for decoding\n * @param littleEndian reverse the endian-ness of the compressed bytes being read\n * @returns integer array of difference (and constant) values\n */\nfunction extractSteim1Samples(dataView: DataView, offset: number,  littleEndian: boolean): Array<number> {\n  /* get nibbles */\n  let nibbles = dataView.getInt32(offset, littleEndian);\n  let currNibble = 0;\n  let temp = [];  // 4 samples * 16 longwords, can't be more than 64\n  let currNum = 0;\n  let i, n;\n  for (i=0; i<16; i++) {   // i is the word number of the frame starting at 0\n    //currNibble = (nibbles >>> (30 - i*2 ) ) & 0x03; // count from top to bottom each nibble in W(0)\n    currNibble = (nibbles >> (30 - i*2) ) & 0x03; // count from top to bottom each nibble in W(0)\n    //System.err.print(\"c(\" + i + \")\" + currNibble + \",\");  // DEBUG\n    // Rule appears to be:\n    // only check for byte-swap on actual value-atoms, so a 32-bit word in of itself\n    // is not swapped, but two 16-bit short *values* are or a single\n    // 32-bit int *value* is, if the flag is set to TRUE.  8-bit values\n    // are naturally not swapped.\n    // It would seem that the W(0) word is swap-checked, though, which is confusing...\n    // maybe it has to do with the reference to high-order bits for c(0)\n    switch (currNibble) {\n      case 0:\n        //System.out.println(\"0 means header info\");\n        // only include header info if offset is 0\n        if (offset === 0) {\n          temp[currNum++] = dataView.getInt32(offset+(i*4), littleEndian);\n        }\n        break;\n      case 1:\n        //System.out.println(\"1 means 4 one byte differences\");\n        for ( n=0; n<4; n++) {\n          temp[currNum] = dataView.getInt8(offset+(i*4)+n);\n          currNum++;\n        }\n        break;\n      case 2:\n        //System.out.println(\"2 means 2 two byte differences\");\n        for ( n=0; n<4; n+=2) {\n          temp[currNum] = dataView.getInt16(offset+(i*4)+n, littleEndian);\n          currNum++;\n        }\n        break;\n      case 3:\n        //System.out.println(\"3 means 1 four byte difference\");\n        temp[currNum++] =dataView.getInt32(offset+(i*4), littleEndian);\n        break;\n      default:\n        throw new CodecException(\"unreachable case: \"+currNibble);\n        //System.out.println(\"default\");\n    }\n  }\n  return temp;\n}\n\n/**\n *  Decode the indicated number of samples from the provided byte array and\n *  return an integer array of the decompressed values.  Being differencing\n *  compression, there may be an offset carried over from a previous data\n *  record.  This offset value can be placed in <b>bias</b>, otherwise leave\n *  the value as 0.\n *\n *  @param dataView input byte array to be decoded\n *  @param numSamples the number of samples that can be decoded from array\n *  @param swapBytes if true, swap reverse the endian-ness of the elements of\n *  dataview\n *  @param bias the first difference value will be computed from this value.\n *  If set to 0, the method will attempt to use the X(0) constant instead.\n *  @returns int array of length <b>numSamples</b>.\n *  @throws SteimException - encoded data length is not multiple of 64\n *  bytes.\n */\nexport function decodeSteim2(dataView: DataView, numSamples: number, swapBytes: boolean, bias: number): Int32Array {\n  if (dataView.byteLength % 64 !== 0) {\n    throw new CodecException(\"encoded data length is not multiple of 64 bytes (\" + dataView.byteLength + \")\");\n  }\n  let buf = new ArrayBuffer(4 * numSamples);\n  let samples = new Int32Array(buf);\n  let tempSamples;\n  let numFrames = dataView.byteLength / 64;\n  let current = 0;\n  let start=0;\n  let firstData=0;\n  let lastValue = 0;\n\n  //System.err.println(\"DEBUG: number of samples: \" + numSamples + \", number of frames: \" + numFrames + \", byte array size: \" + b.length);\n  for (let i=0; i< numFrames ; i++ ) {\n    tempSamples = extractSteim2Samples(dataView, i*64, swapBytes);   // returns only differences except for frame 0\n    firstData = 0; // d(0) is byte 0 by default\n    if (i===0) {   // special case for first frame\n      lastValue = bias; // assign our X(-1)\n      // x0 and xn are in 1 and 2 spots\n      start = tempSamples[1];  // X(0) is byte 1 for frame 0\n      // end = tempSamples[2];    // X(n) is byte 2 for frame 0\n      firstData = 3; // d(0) is byte 3 for frame 0\n      // if bias was zero, then we want the first sample to be X(0) constant\n      if (bias === 0) lastValue = start - tempSamples[3];  // X(-1) = X(0) - d(0)\n    }\n    //System.err.print(\"DEBUG: \");\n    for (let j = firstData; j < tempSamples.length && current < numSamples; j++) {\n      samples[current] = lastValue + tempSamples[j];  // X(n) = X(n-1) + d(n)\n      lastValue = samples[current];\n      current++;\n    }\n    //System.err.println(\"DEBUG: end of frame \" + i);\n  }  // end for each frame...\n  if (current !== numSamples) {\n    throw new CodecException(\"Number of samples decompressed doesn't match number in header: \"+current+\" !== \"+numSamples);\n  }\n  // ignore last sample check???\n  //if (end !== samples[numSamples-1]) {\n  //    throw new SteimException(\"Last sample decompressed doesn't match value x(n) value in Steim2 record: \"+samples[numSamples-1]+\" !== \"+end);\n  //}\n  return samples;\n}\n\n\n/**\n * Extracts differences from the next 64 byte frame of the given compressed\n * byte array (starting at offset) and returns those differences in an int\n * array.\n * An offset of 0 means that we are at the first frame, so include the header\n * bytes in the returned int array...else, do not include the header bytes\n * in the returned array.\n *\n * @param dataView byte array of compressed data differences\n * @param offset index to begin reading compressed bytes for decoding\n * @param swapBytes reverse the endian-ness of the compressed bytes being read\n * @returns integer array of difference (and constant) values\n */\nfunction extractSteim2Samples(dataView: DataView, offset: number, swapBytes: boolean): Int32Array {\n  /* get nibbles */\n  let nibbles = dataView.getUint32(offset, swapBytes);\n  let currNibble = 0;\n  let dnib = 0;\n  let temp = new Int32Array(106); //max 106 = 7 samples * 15 long words + 1 nibble int\n  let tempInt;\n  let currNum = 0;\n  let diffCount = 0;  // number of differences\n  let bitSize = 0;    // bit size\n  let headerSize = 0; // number of header/unused bits at top\n  for (let i=0; i<16; i++) {\n    currNibble = (nibbles >> (30 - i*2 ) ) & 0x03;\n    switch (currNibble) {\n      case 0:\n        // \"0 means header info\"\n        // only include header info if offset is 0\n        if (offset === 0) {\n          temp[currNum++] = dataView.getInt32(offset+(i*4), swapBytes);\n        }\n        break;\n      case 1:\n        //  \"1 means 4 one byte differences \" +currNum+\" \"+dataView.getInt8(offset+(i*4))+\" \"+dataView.getInt8(offset+(i*4)+1)+\" \"+dataView.getInt8(offset+(i*4)+2)+\" \"+dataView.getInt8(offset+(i*4)+3)\n        temp[currNum++] = dataView.getInt8(offset+(i*4));\n        temp[currNum++] = dataView.getInt8(offset+(i*4)+1);\n        temp[currNum++] = dataView.getInt8(offset+(i*4)+2);\n        temp[currNum++] = dataView.getInt8(offset+(i*4)+3);\n        break;\n      case 2:\n        tempInt = dataView.getUint32(offset+(i*4), swapBytes);\n        dnib = (tempInt >> 30) & 0x03;\n        switch (dnib) {\n          case 1:\n            // \"2,1 means 1 thirty bit difference\"\n            temp[currNum++] = (tempInt << 2) >> 2;\n            break;\n          case 2:\n            // \"2,2 means 2 fifteen bit differences\"\n            temp[currNum++] = (tempInt << 2) >> 17;  // d0\n            temp[currNum++] = (tempInt << 17) >> 17; // d1\n            break;\n          case 3:\n            //  \"2,3 means 3 ten bit differences\"\n            temp[currNum++] = (tempInt << 2) >> 22;  // d0\n            temp[currNum++] = (tempInt << 12) >> 22; // d1\n            temp[currNum++] = (tempInt << 22) >> 22; // d2\n            break;\n          default:\n            throw new CodecException(`Unknown case currNibble=${currNibble} dnib=${dnib}`);\n        }\n        break;\n      case 3:\n        tempInt = dataView.getUint32(offset+(i*4), swapBytes);\n        dnib = (tempInt >> 30) & 0x03;\n        // for case 3, we are going to use a for-loop formulation that\n        // accomplishes the same thing as case 2, just less verbose.\n        diffCount = 0;  // number of differences\n        bitSize = 0;    // bit size\n        headerSize = 0; // number of header/unused bits at top\n        switch (dnib) {\n          case 0:\n            //System.out.println(\"3,0 means 5 six bit differences\");\n            headerSize = 2;\n            diffCount = 5;\n            bitSize = 6;\n            break;\n          case 1:\n            //System.out.println(\"3,1 means 6 five bit differences\");\n            headerSize = 2;\n            diffCount = 6;\n            bitSize = 5;\n            break;\n          case 2:\n            //System.out.println(\"3,2 means 7 four bit differences, with 2 unused bits\");\n            headerSize = 4;\n            diffCount = 7;\n            bitSize = 4;\n            break;\n          default:\n            throw new CodecException(`Unknown case currNibble=${currNibble} dnib=${dnib}`);\n        }\n        if (diffCount > 0) {\n          for (let d=0; d<diffCount; d++) {  // for-loop formulation\n            temp[currNum++] = ( tempInt << (headerSize+(d*bitSize)) ) >> (((diffCount-1)*bitSize) + headerSize);\n          }\n        }\n        break;\n      default:\n        throw new CodecException(`Unknown case currNibble=${currNibble}`);\n    }\n  }\n  return temp.slice(0, currNum);\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n import * as OregonDSPTop from 'oregondsp';\n\n export const OregonDSP = OregonDSPTop.com.oregondsp.signalProcessing;\n export const Complex = OregonDSP.filter.iir.Complex;\n\n export function createComplex(real: number, imag: number) {\n   return OregonDSP.filter.iir.Complex_init(real, imag);\n }\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport { StartEndDuration, isObject, isDef, isStringArg, isNonEmptyStringArg,\n         isNumArg, checkStringOrDate, stringify} from './util';\nimport {Complex, createComplex} from './oregondsputil.js';\n\nimport moment from 'moment';\n\n/** xml namespace for stationxml */\nexport const STAML_NS = 'http://www.fdsn.org/xml/station/1';\n\n\n// StationXML classes\n\nexport class Network {\n  networkCode: string;\n  _startDate: moment;\n  _endDate: moment;\n  restrictedStatus: string;\n  description: string;\n  totalNumberStations: number;\n  stations: Array<Station>;\n  constructor(networkCode: string) {\n    this.networkCode = networkCode;\n    this.stations = [];\n  }\n  get startDate() {\n    return this._startDate;\n  }\n  set startDate(value?: moment | string) {\n    this._startDate = checkStringOrDate(value);\n  }\n  get endDate() {\n    return this._endDate;\n  }\n  set endDate(value?: moment | string) {\n    this._endDate = checkStringOrDate(value);\n  }\n  get timeRange(): StartEndDuration {\n    return new StartEndDuration(this.startDate, this.endDate);\n  }\n  codes(): string {\n    return this.networkCode;\n  }\n  isTempNet(): boolean {\n    const first = this.networkCode.charAt(0);\n    return first === 'X' || first === 'Y' || first === 'Z' || (first >= '0' && first <= '9');\n  }\n}\n\nexport class Station {\n  network: Network;\n  stationCode: string;\n    /** @private */\n  _startDate: moment;\n    /** @private */\n  _endDate: moment;\n  restrictedStatus: string;\n  name: string;\n  latitude: number;\n  longitude: number;\n  elevation: number;\n  channels: Array<Channel>;\n  constructor(network: Network, stationCode: string) {\n    this.network = network;\n    this.stationCode = stationCode;\n    this.channels = [];\n  }\n  get startDate(): moment {\n    return this._startDate;\n  }\n  set startDate(value?: moment | string) {\n    this._startDate = checkStringOrDate(value);\n  }\n  get endDate(): moment {\n    return this._endDate;\n  }\n  set endDate(value?: moment | string) {\n    this._endDate = checkStringOrDate(value);\n  }\n  get timeRange(): StartEndDuration {\n    return new StartEndDuration(this.startDate, this.endDate);\n  }\n  get networkCode(): string {\n    return this.network.networkCode;\n  }\n  codes(): string {\n    return this.network.codes()+\".\"+this.stationCode;\n  }\n}\n\nexport class Channel {\n  station: Station;\n    /** @private */\n  _locationCode: string;\n  channelCode: string;\n    /** @private */\n  _startDate: moment;\n    /** @private */\n  _endDate: moment;\n  restrictedStatus: string;\n  latitude: number;\n  longitude: number;\n  elevation: number;\n  depth: number;\n  azimuth: number;\n  dip: number;\n  sampleRate: number;\n  response: Response;\n  constructor(station: Station, channelCode: string, locationCode: string) {\n    this.station = station;\n    if (channelCode.length !== 3) {\n      throw new Error(`Channel code must be 3 chars: ${channelCode}`);\n    }\n    this.channelCode = channelCode;\n    this.locationCode = locationCode;\n    if (! locationCode) {\n      // make sure \"null\" is encoded as empty string\n      this.locationCode = '';\n    }\n    if ( ! (this.locationCode.length === 2 || this.locationCode.length === 0)) {\n      throw new Error(`locationCode must be 2 chars, or empty: \"${locationCode}\"`);\n    }\n  }\n  get startDate() {\n    return this._startDate;\n  }\n  set startDate(value?: moment | string) {\n    this._startDate = checkStringOrDate(value);\n  }\n  get endDate() {\n    return this._endDate;\n  }\n  set endDate(value?: moment | string) {\n    this._endDate = checkStringOrDate(value);\n  }\n  get timeRange(): StartEndDuration {\n    return new StartEndDuration(this.startDate, this.endDate);\n  }\n  get locationCode() {\n    return this._locationCode;\n  }\n  set locationCode(value: string) {\n    this._locationCode = value;\n    if (! value) {\n      // make sure \"null\" is encoded as empty string\n      this._locationCode = '';\n    }\n  }\n  get stationCode(): string {\n    return this.station.stationCode;\n  }\n  get networkCode(): string {\n    return this.station.networkCode;\n  }\n  /**\n   * Checks if this channel has sensitivity defined, within the response.\n   *\n   * @returns          true if instrumentSensitivity exits\n   */\n  hasInstrumentSensitivity(): boolean {\n    return isDef(this.response) && isDef(this.response.instrumentSensitivity);\n  }\n  set instrumentSensitivity(value: InstrumentSensitivity) {\n    if (typeof this.response === 'undefined') {\n      this.response = new Response(value);\n    } else {\n      this.response.instrumentSensitivity = value;\n    }\n  }\n  get instrumentSensitivity(): InstrumentSensitivity {\n    if (this.response) {\n      return this.response.instrumentSensitivity;\n    } else {\n      throw new Error(\"no Response or InstrumentSensitivity defined\");\n    }\n  }\n\n  codes(): string {\n    return this.station.codes()+\".\"+this.locationCode+\".\"+this.channelCode;\n  }\n}\n\nexport class InstrumentSensitivity {\n  sensitivity: number;\n  frequency: number;\n  inputUnits: string;\n  outputUnits: string;\n  constructor(sensitivity: number, frequency: number, inputUnits: string, outputUnits: string) {\n    this.sensitivity = sensitivity;\n    this.frequency = frequency;\n    this.inputUnits = inputUnits;\n    this.outputUnits = outputUnits;\n  }\n}\n\nexport class Response {\n  instrumentSensitivity: InstrumentSensitivity;\n  stages: Array<Stage>;\n  constructor(instrumentSensitivity?: InstrumentSensitivity, stages?: Array<Stage>) {\n    if (instrumentSensitivity) {\n      this.instrumentSensitivity = instrumentSensitivity;\n    }\n    if (stages) {\n      this.stages = stages;\n    }\n  }\n}\n\nexport class Stage {\n  filter: AbstractFilterType | null;\n  decimation: Decimation | null;\n  gain: Gain;\n  constructor(filter: AbstractFilterType | null, decimation: Decimation | null, gain: Gain) {\n    this.filter = filter;\n    this.decimation = decimation;\n    this.gain = gain;\n  }\n}\n\nexport class AbstractFilterType {\n  inputUnits: string;\n  outputUnits: string;\n  name: string;\n  description: string;\n  constructor(inputUnits: string, outputUnits: string) {\n    this.inputUnits = inputUnits;\n    this.outputUnits = outputUnits;\n  }\n}\nexport class PolesZeros extends AbstractFilterType {\n  pzTransferFunctionType: string;\n  normalizationFactor: number;\n  normalizationFrequency: number;\n  zeros: Array<Complex>;\n  poles: Array<Complex>;\n  constructor(inputUnits: string, outputUnits: string) {\n    super(inputUnits, outputUnits);\n  }\n}\n\nexport class FIR extends AbstractFilterType {\n  symmetry: string;\n  numerator: Array<number>;\n  constructor(inputUnits: string, outputUnits: string) {\n    super(inputUnits, outputUnits);\n  }\n}\n\nexport class CoefficientsFilter extends AbstractFilterType {\n  cfTransferFunction: string;\n  numerator: Array<number>;\n  denominator: Array<number>;\n  constructor(inputUnits: string, outputUnits: string) {\n    super(inputUnits, outputUnits);\n  }\n}\n\nexport class Decimation {\n  inputSampleRate: number;\n  factor: number;\n  offset: ?number;\n  delay: ?number;\n  correction: ?number;\n}\n\nexport class Gain {\n  value: number;\n  frequency: number;\n}\n\n/**\n * Parses the FDSN StationXML returned from a query.\n *\n * @param rawXml parsed xml to extract objects from\n * @returns an Array of Network objects.\n */\nexport function parseStationXml(rawXml: Document): Array<Network> {\n    let top = rawXml.documentElement;\n    if (! top) {throw new Error(\"No documentElement in XML\");}\n    let netArray = top.getElementsByTagNameNS(STAML_NS, \"Network\");\n    let out = [];\n    for (let n of netArray) {\n      out.push(convertToNetwork(n));\n    }\n    return out;\n  }\n\n  /** Parses a FDSNStationXML Network xml element into a Network object.\n   *\n   * @param xml the network xml Element\n   * @returns Network instance\n   */\nexport function convertToNetwork(xml: Element): Network {\n    const netCode = _grabAttribute(xml, \"code\");\n    if (! isNonEmptyStringArg(netCode)) {throw new Error(\"network code missing in network!\");}\n    let out = new Network(netCode);\n    out.startDate = _grabAttribute(xml, \"startDate\");\n    const rs = _grabAttribute(xml, \"restrictedStatus\");\n    if (isNonEmptyStringArg(rs)) { out.restrictedStatus = rs; }\n    const desc = _grabFirstElText(xml, 'Description');\n    if (isNonEmptyStringArg(desc)) {out.description = desc;}\n    if (_grabAttribute(xml, \"endDate\")) {\n      out.endDate = _grabAttribute(xml, \"endDate\");\n    }\n    let totSta = xml.getElementsByTagNameNS(STAML_NS, \"TotalNumberStations\");\n    if (totSta && totSta.length >0) {\n      out.totalNumberStations = parseInt(_grabFirstElText(xml, \"TotalNumberStations\"));\n    }\n    let staArray = xml.getElementsByTagNameNS(STAML_NS, \"Station\");\n    let stations = [];\n    for (let s of staArray) {\n      stations.push(convertToStation(out, s));\n    }\n    out.stations = stations;\n    return out;\n  }\n  /**\n   * Parses a FDSNStationXML Station xml element into a Station object.\n   *\n   * @param network the containing network\n   * @param xml the station xml Element\n   * @returns Station instance\n   */\nexport function convertToStation(network: Network, xml: Element): Station {\n    let staCode = _grabAttribute(xml, \"code\");\n    if (! isNonEmptyStringArg(staCode)) {throw new Error(\"station code missing in station!\");}\n    let out = new Station(network, staCode);\n    out.startDate = _grabAttribute(xml, \"startDate\");\n    const rs = _grabAttribute(xml, \"restrictedStatus\");\n    if (isNonEmptyStringArg(rs)) { out.restrictedStatus = rs; }\n    const lat =  _grabFirstElFloat(xml, 'Latitude');\n    if (isNumArg(lat)) {out.latitude = lat;}\n    const lon = _grabFirstElFloat(xml, 'Longitude');\n    if (isNumArg(lon)) {out.longitude = lon;}\n    const elev = _grabFirstElFloat(xml, 'Elevation');\n    if (isNumArg(elev)) {out.elevation = elev;}\n    const name = _grabFirstElText(_grabFirstEl(xml, 'Site'), 'Name');\n    if (isStringArg(name)) {out.name = name;}\n    const endDate = _grabAttribute(xml, \"endDate\");\n    if (isDef(endDate)) {out.endDate = _grabAttribute(xml, \"endDate\"); }\n    let chanArray = xml.getElementsByTagNameNS(STAML_NS, \"Channel\");\n    let channels = [];\n    for (let c of chanArray) {\n      channels.push(convertToChannel(out, c));\n    }\n    out.channels = channels;\n    return out;\n  }\n  /**\n   * Parses a FDSNStationXML Channel xml element into a Channel object.\n   *\n   * @param station the containing staton\n   * @param xml the channel xml Element\n   * @returns Channel instance\n   */\nexport function convertToChannel(station: Station, xml: Element): Channel {\n    let locCode = _grabAttribute(xml, \"locationCode\");\n    if (! isNonEmptyStringArg(locCode)) {locCode = '';}\n    let chanCode = _grabAttribute(xml, \"code\");\n    if (! isNonEmptyStringArg(chanCode)) {throw new Error(\"channel code missing in channel!\");}\n\n    let out = new Channel(station, chanCode, locCode);\n    out.startDate = _grabAttribute(xml, \"startDate\");\n    const rs = _grabAttribute(xml, \"restrictedStatus\");\n    if (isNonEmptyStringArg(rs)) { out.restrictedStatus = rs; }\n\n    const lat =  _grabFirstElFloat(xml, 'Latitude');\n    if (isNumArg(lat)) {out.latitude = lat;}\n    const lon = _grabFirstElFloat(xml, 'Longitude');\n    if (isNumArg(lon)) {out.longitude = lon;}\n    const elev = _grabFirstElFloat(xml, 'Elevation');\n    if (isNumArg(elev)) {out.elevation = elev;}\n    const depth = _grabFirstElFloat(xml, 'Depth');\n    if (isNumArg(depth)) {out.depth = depth;}\n\n    const azimuth = _grabFirstElFloat(xml, 'Azimuth');\n    if (isNumArg(azimuth)) {out.azimuth = azimuth;}\n    const dip = _grabFirstElFloat(xml, 'Dip');\n    if (isNumArg(dip)) {out.dip = dip;}\n    const sampleRate = _grabFirstElFloat(xml, 'SampleRate');\n    if (isNumArg(sampleRate)) {out.sampleRate = sampleRate;}\n    if (_grabAttribute(xml, \"endDate\")) {\n      out.endDate = _grabAttribute(xml, \"endDate\");\n    }\n    let responseXml = xml.getElementsByTagNameNS(STAML_NS, 'Response');\n    if (responseXml && responseXml.length > 0 ) {\n      const r = responseXml.item(0);\n      if (r) {out.response = convertToResponse(r);}\n    }\n    return out;\n  }\n\n  /** Parses a FDSNStationXML Response xml element into a Response object.\n   *\n   * @param responseXml the response xml Element\n   * @returns Response instance\n   */\nexport function convertToResponse(responseXml: Element): Response {\n    let out;\n    let inst = responseXml.getElementsByTagNameNS(STAML_NS, 'InstrumentSensitivity');\n    if (inst && inst.item(0)) {\n      const i = inst.item(0);\n      if (i) {out = new Response(convertToInstrumentSensitivity(i));}\n    }\n    if (! out) {\n      // DMC returns empty response element when they know nothing (instead\n      // of just leaving it out). Return empty object in this case\n      out = new Response();\n    }\n    let xmlStages = responseXml.getElementsByTagNameNS(STAML_NS, 'Stage');\n    if (xmlStages && xmlStages.length > 0) {\n      let jsStages = Array.from(xmlStages).map(function(stageXml) {\n        return convertToStage(stageXml);\n      });\n      out.stages = jsStages;\n    }\n    return out;\n  }\n\n  /**\n   * Parses a FDSNStationXML InstrumentSensitivity xml element into a InstrumentSensitivity object.\n   *\n   * @param xml the InstrumentSensitivity xml Element\n   * @returns InstrumentSensitivity instance\n   */\nexport function convertToInstrumentSensitivity(xml: Element): InstrumentSensitivity {\n    let sensitivity = _grabFirstElFloat(xml, 'Value');\n    let frequency = _grabFirstElFloat(xml, 'Frequency');\n    let inputUnits = _grabFirstElText(_grabFirstEl(xml, 'InputUnits'), 'Name');\n    let outputUnits = _grabFirstElText(_grabFirstEl(xml, 'OutputUnits'), 'Name');\n    if (! (isDef(sensitivity) && isDef(frequency) && isDef(inputUnits) && isDef(outputUnits))) {\n      // $FlowFixMe\n      throw new Error(`Not all elements of Sensitivity exist: ${sensitivity} ${frequency} ${inputUnits} ${outputUnits}`);\n    }\n    return new InstrumentSensitivity(sensitivity, frequency, inputUnits, outputUnits);\n  }\n\n  /**\n   * Parses a FDSNStationXML Stage xml element into a Stage object.\n   *\n   * @param stageXml the Stage xml Element\n   * @returns Stage instance\n   */\nexport function convertToStage(stageXml: Element): Stage {\n    let subEl = stageXml.firstElementChild;\n    let filter: AbstractFilterType | null = null;\n    if (! subEl) {\n      throw new Error(\"Stage element has no child elements\");\n    } else if (stageXml.childElementCount === 1 && subEl.localName === 'StageGain') {\n      // degenerate case of a gain only stage\n      // fix the lack of units after all stages are converted.\n    } else {\n      // shoudl be a filter of some kind, check for units\n      let inputUnits = _grabFirstElText(_grabFirstEl(stageXml, 'InputUnits'), 'Name');\n      let outputUnits = _grabFirstElText(_grabFirstEl(stageXml, 'OutputUnits'), 'Name');\n      if (! isNonEmptyStringArg(inputUnits)) {\n        throw new Error(\"Stage inputUnits required\");\n      }\n      if (! isNonEmptyStringArg(outputUnits)) {\n        throw new Error(\"Stage outputUnits required\");\n      }\n      // here we assume there must be a filter, and so must have units\n\n      if (subEl.localName === 'PolesZeros') {\n        filter = new PolesZeros(inputUnits, outputUnits);\n        const pzt = _grabFirstElText(stageXml, 'PzTransferFunctionType');\n        if (isNonEmptyStringArg(pzt)) { filter.pzTransferFunctionType = pzt; }\n        const nfa = _grabFirstElFloat(stageXml, 'NormalizationFactor');\n        if (isNumArg(nfa)) { filter.normalizationFactor = nfa;}\n        const nfr = _grabFirstElFloat(stageXml, 'NormalizationFrequency');\n        if (isNumArg(nfr)) {filter.normalizationFrequency = nfr;}\n        let zeros = Array.from(stageXml.getElementsByTagNameNS(STAML_NS, 'Zero'))\n            .map(function(zeroEl) {\n              return extractComplex(zeroEl);\n            });\n        let poles = Array.from(stageXml.getElementsByTagNameNS(STAML_NS, 'Pole'))\n            .map(function(poleEl) {\n              return extractComplex(poleEl);\n            });\n        filter.zeros = zeros;\n        filter.poles = poles;\n      } else if (subEl.localName === 'Coefficients') {\n        let coeffXml = subEl;\n        filter = new CoefficientsFilter(inputUnits, outputUnits);\n        const cft = _grabFirstElText(coeffXml, 'CfTransferFunctionType');\n        if (isNonEmptyStringArg(cft)) {filter.cfTransferFunction = cft;}\n        filter.numerator = Array.from(coeffXml.getElementsByTagNameNS(STAML_NS, 'Numerator'))\n            .map(function(numerEl) {\n              return parseFloat(numerEl.textContent);\n            });\n        filter.denominator = Array.from(coeffXml.getElementsByTagNameNS(STAML_NS, 'Denominator'))\n            .map(function(denomEl) {\n              return parseFloat(denomEl.textContent);\n            });\n      } else if (subEl.localName === 'ResponseList') {\n        throw new Error(\"ResponseList not supported: \");\n      } else if (subEl.localName === 'FIR') {\n        let firXml = subEl;\n        filter = new FIR(inputUnits, outputUnits);\n        const s = _grabFirstElText(firXml, 'Symmetry');\n        if (isNonEmptyStringArg(s)) {filter.symmetry = s;}\n        filter.numerator = Array.from(firXml.getElementsByTagNameNS(STAML_NS, 'NumeratorCoefficient'))\n            .map(function(numerEl) {\n              return parseFloat(numerEl.textContent);\n            });\n      } else if (subEl.localName === 'Polynomial') {\n        throw new Error(\"Polynomial not supported: \");\n      } else if (subEl.localName === 'StageGain') {\n        // gain only stage, pick it up below\n      } else {\n        throw new Error(\"Unknown Stage type: \"+ subEl.localName);\n      }\n\n      if (filter) {\n        // add description and name if it was there\n        let description = _grabFirstElText(subEl, 'Description');\n        if (isNonEmptyStringArg(description)) {\n          filter.description = description;\n        }\n        if (subEl.hasAttribute('name')) {\n          const n = _grabAttribute(subEl, 'name');\n          if (isNonEmptyStringArg(n)) {filter.name = n;}\n        }\n      }\n    }\n    let decimationXml = _grabFirstEl(stageXml, 'Decimation');\n    let decimation: Decimation | null = null;\n    if (decimationXml) {\n      decimation = convertToDecimation(decimationXml);\n    }\n    let gainXml = _grabFirstEl(stageXml, 'StageGain');\n    let gain = null;\n    if (gainXml) {\n      gain = convertToGain(gainXml);\n    } else {\n      throw new Error(\"Did not find Gain in stage number \"+stringify(_grabAttribute(stageXml, \"number\")));\n    }\n    let out = new Stage(filter, decimation, gain);\n\n    return out;\n  }\n\n  /**\n   * Parses a FDSNStationXML Decimation xml element into a Decimation object.\n   *\n   * @param decXml the Decimation xml Element\n   * @returns Decimation instance\n   */\nexport function convertToDecimation(decXml: Element): Decimation {\n    let out = new Decimation();\n    const insr = _grabFirstElFloat(decXml, 'InputSampleRate');\n    if (isNumArg(insr)) {out.inputSampleRate = insr;}\n    const fac = _grabFirstElInt(decXml, 'Factor');\n    if (isNumArg(fac)) {out.factor = fac;}\n    out.offset = _grabFirstElInt(decXml, 'Offset');\n    out.delay = _grabFirstElFloat(decXml, 'Delay');\n    out.correction = _grabFirstElFloat(decXml, 'Correction');\n    return out;\n  }\n\n  /**\n   * Parses a FDSNStationXML Gain xml element into a Gain object.\n   *\n   * @param gainXml the Gain xml Element\n   * @returns Gain instance\n   */\nexport function convertToGain(gainXml: Element): Gain {\n    let out = new Gain();\n    const v = _grabFirstElFloat(gainXml, 'Value');\n    if (isNumArg(v)) {out.value = v;}\n    const f = _grabFirstElFloat(gainXml, 'Frequency');\n    if (isNumArg(f)) {out.frequency = f;}\n    return out;\n  }\n\n  /**\n   * Extracts a complex number from an stationxml element.\n   *\n   * @param   el xml element\n   * @returns     Complex instance\n   */\nexport function extractComplex(el: Element) {\n    const re = _grabFirstElFloat(el, 'Real');\n    const im = _grabFirstElFloat(el, 'Imaginary');\n    if (isNumArg(re) && isNumArg(im)) {\n      return createComplex(re, im);\n    } else {\n      // $FlowFixMe\n      throw new Error(`Both Real and Imaginary required: ${re} ${im}`);\n    }\n  }\n\n/**\n * Generator function to access all stations within all networks in the array.\n *\n * @param      networks array of Networks\n * @yields           generator yeiding stations\n */\nexport function* allStations(networks: Array<Network>): Generator<Station, void, any> {\n  for (let n of networks) {\n    for (let s of n.stations) {\n        yield s;\n    }\n  }\n}\n\n/**\n * Generator function to access all channels within all stations\n * within all networks in the array.\n *\n * @param      networks array of Networks\n * @yields           generator yeiding channels\n */\nexport function* allChannels(networks: Array<Network>): Generator<Channel, void, any> {\n  for (let s of allStations(networks)) {\n    for (let c of s.channels) {\n      yield c;\n    }\n  }\n}\n\n/**\n * Extract all channels from all stations from all networks in the input array.\n *\n * @param   networks Array of networks.\n * @param   netCode network code to match\n * @param   staCode station code to match\n * @param   locCode location code to match\n * @param   chanCode channel code to match\n * @yields           Array of channels.\n */\nexport function* findChannels(networks: Array<Network>, netCode: string, staCode: string, locCode: string, chanCode: string): Generator<Channel, void, any> {\n    for (let n of networks.filter(n => n.networkCode ===  netCode)) {\n      for (let s of n.stations.filter(s => s.stationCode ===  staCode)) {\n        for (let c of s.channels.filter(c => c.locationCode ===  locCode && c.channelCode === chanCode)) {\n          yield c;\n        }\n      }\n    }\n}\n\n// these are similar methods as in seisplotjs.quakeml\n// duplicate here to avoid dependency and diff NS, yes that is dumb...\n\nconst _grabFirstEl = function(xml: Element | null | void, tagName: string): Element | void {\n  let out = undefined;\n  if (isObject(xml)) {\n    let el = xml.getElementsByTagName(tagName);\n    if (isObject(el) && el.length > 0) {\n      const e = el.item(0);\n      if (e) {\n        out = e;\n      }\n    }\n  }\n  return out;\n};\n\nconst _grabFirstElText = function _grabFirstElText(xml: Element | null | void, tagName: string): string | void {\n  let out = undefined;\n  let el = _grabFirstEl(xml, tagName);\n  if (isObject(el)) {\n    out = el.textContent;\n  }\n  return out;\n};\n\nconst _grabFirstElFloat = function _grabFirstElFloat(xml: Element | null | void, tagName: string): number | void {\n  let out = undefined;\n  let elText = _grabFirstElText(xml, tagName);\n  if (isStringArg(elText)) {\n    out = parseFloat(elText);\n  }\n  return out;\n};\n\nconst _grabFirstElInt = function _grabFirstElInt(xml: Element | null | void, tagName: string): number | void {\n  let out = undefined;\n  let elText = _grabFirstElText(xml, tagName);\n  if (isStringArg(elText)) {\n    out = parseInt(elText);\n  }\n  return out;\n};\n\nconst _grabAttribute = function _grabAttribute(xml: Element | null | void, tagName: string): string | void {\n  let out = undefined;\n  if (isObject(xml)) {\n    let a = xml.getAttribute(tagName);\n    if (isStringArg(a)) {\n      out = a;\n    }\n  }\n  return out;\n};\n\nconst _grabAttributeNS = function(xml: Element | null | void, namespace: string, tagName: string): string | void {\n  let out = undefined;\n  if (isObject(xml)) {\n    let a = xml.getAttributeNS(namespace, tagName);\n    if (isStringArg(a)) {\n      out = a;\n    }\n  }\n  return out;\n};\n\n\nexport const parseUtil = {\n  \"_grabFirstEl\": _grabFirstEl,\n  \"_grabFirstElText\": _grabFirstElText,\n  \"_grabFirstElFloat\": _grabFirstElFloat,\n  \"_grabFirstElInt\": _grabFirstElInt,\n  \"_grabAttribute\": _grabAttribute,\n  \"_grabAttributeNS\": _grabAttributeNS\n};\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport { isObject, isStringArg, isNonEmptyStringArg,\n         isNumArg, checkStringOrDate, stringify} from './util';\nimport * as util from './util.js'; // for util.log\nimport moment from 'moment';\n\nexport const QML_NS = 'http://quakeml.org/xmlns/quakeml/1.2';\nexport const BED_NS = 'http://quakeml.org/xmlns/bed/1.2';\nexport const IRIS_NS = 'http://service.iris.edu/fdsnws/event/1/';\nexport const ANSS_NS = 'http://anss.org/xmlns/event/0.1';\nexport const ANSS_CATALOG_NS = \"http://anss.org/xmlns/catalog/0.1\";\n\nexport const USGS_HOST = \"earthquake.usgs.gov\";\n\nexport const UNKNOWN_MAG_TYPE = 'unknown';\n\n// QuakeML classes\n\n/**\n * Represent a QuakeML Event. Renamed to Quake as Event conflicts with\n * other uses in javascript.\n */\nexport class Quake {\n  eventId: string;\n  publicId: string;\n  _time: moment;\n  latitude: number;\n  longitude: number;\n  depth: number;\n  description: string;\n  magnitude: Magnitude;\n  magnitudeList: Array<Magnitude>;\n  originList: Array<Origin>;\n  pickList: Array<Pick>;\n  preferredOriginId: ?string;\n  preferredOrigin: Origin;\n  preferredMagnitudeId: ?string;\n  preferredMagnitude: Magnitude;\n  constructor() {\n// what is essential???\n  }\n  /**\n   * Parses a QuakeML event xml element into a Quake object. Pass in\n   * host=seisplotjs.fdsnevent.USGS_HOST for xml from the USGS service\n   * in order to parse the eventid, otherwise this can be left out\n   *\n   * @param qml the event xml Element\n   * @param host optional source of the xml, helpful for parsing the eventid\n   * @returns QuakeML Quake(Event) object\n   */\n  static createFromXml(qml: Element, host?: string): Quake {\n    if (qml.localName !== \"event\") {\n      throw new Error(`Cannot extract, not a QuakeML Event: ${qml.localName}`);\n    }\n    let out = new Quake();\n    let s = _grabAttribute(qml, 'publicID');\n    if (! isNonEmptyStringArg(s)) {throw new Error(\"Quake/Event does not have publicID\");}\n    out.publicId = s;\n    const desc = _grabFirstElText(_grabFirstEl(qml, 'description'), 'text');\n    if (isStringArg(desc)) {out.description = desc;}\n    let otimeStr = _grabFirstElText(_grabFirstEl(_grabFirstEl(qml, 'origin'), 'time'),'value');\n    if (isNonEmptyStringArg(otimeStr) ) {\n      out.time = otimeStr;\n    }\n\n    //need picks before can do origins\n    let allPickEls = qml.getElementsByTagNameNS(BED_NS, 'pick');\n    let allPicks = [];\n    for (let pickEl of allPickEls) {\n      allPicks.push(Pick.createFromXml(pickEl));\n    }\n\n    let allOriginEls = qml.getElementsByTagNameNS(BED_NS, \"origin\");\n    let allOrigins = [];\n    for (let originEl of allOriginEls) {\n      allOrigins.push(Origin.createFromXml(originEl, allPicks));\n    }\n    let allMagEls = qml.getElementsByTagNameNS(BED_NS, \"magnitude\");\n    let allMags = [];\n    for (let magEl of allMagEls) {\n      allMags.push(Magnitude.createFromXml(magEl));\n    }\n    out.originList = allOrigins;\n    out.magnitudeList = allMags;\n    out.pickList = allPicks;\n    out.eventId = Quake.extractEventId(qml, host);\n    out.preferredOriginId = _grabFirstElText(qml, 'preferredOriginID');\n    out.preferredMagnitudeId = _grabFirstElText(qml, 'preferredMagnitudeID');\n    if (isNonEmptyStringArg(out.preferredOriginId)) {\n      for (let o of allOrigins) {\n        if (o.publicId === out.preferredOriginId) {\n          out.preferredOrigin = o;\n          out.latitude = o.latitude;\n          out.longitude = o.longitude;\n          out.depth = o.depth;\n          out.time = o.time;\n        } else {\n          util.log(`no preferredOriginId match: ${o.publicId} ${out.preferredOriginId}`);\n        }\n      }\n    } else if (out.originList.length > 1) {\n      const o = out.originList[0];\n      out.latitude = o.latitude;\n      out.longitude = o.longitude;\n      out.depth = o.depth;\n    }\n    if (allMags.length > 0) {out.magnitude = allMags[0];}\n    if (isNonEmptyStringArg(out.preferredMagnitudeId)) {\n      for (let m of allMags) {\n        if (m.publicId === out.preferredMagnitudeId) {\n          out.preferredMagnitude = m;\n          out.magnitude = m;\n        } else {\n          util.log(`no match: ${m.publicId} ${out.preferredMagnitudeId}`);\n        }\n      }\n    }\n    return out;\n  }\n  /**\n   * Extracts the EventId from a QuakeML element, guessing from one of several\n   * incompatible (grumble grumble) formats.\n   *\n   * @param   qml Quake(Event) to extract from\n   * @param   host optional source of the xml to help determine the event id style\n   * @returns     Extracted Id, or \"unknownEventId\" if we can't figure it out\n   */\n  static extractEventId(qml: Element, host?: string): string {\n    let eventId = _grabAttributeNS(qml, ANSS_CATALOG_NS, 'eventid');\n    let catalogEventSource = _grabAttributeNS(qml, ANSS_CATALOG_NS, 'eventsource');\n    if (isNonEmptyStringArg(eventId)) {\n      if (host === USGS_HOST && isNonEmptyStringArg(catalogEventSource)) {\n        // USGS, NCEDC and SCEDC use concat of eventsource and eventId as eventit, sigh...\n        return catalogEventSource+eventId;\n      } else {\n        return eventId;\n      }\n    }\n    let publicid = _grabAttribute(qml, 'publicID');\n    if (isNonEmptyStringArg(publicid)) {\n      let re = /eventid=([\\w\\d]+)/;\n      let parsed = re.exec(publicid);\n      if (parsed) { return parsed[1];}\n      re = /evid=([\\w\\d]+)/;\n      parsed = re.exec(publicid);\n      if (parsed) { return parsed[1];}\n    }\n    return \"unknownEventId\";\n  }\n  get time(): moment {\n    return this._time;\n  }\n  set time(value: moment | string) {\n    this._time = moment.utc(value);\n  }\n  get arrivals(): Array<Arrival> {\n    return this.preferredOrigin.arrivalList;\n  }\n  get picks(): Array<Pick> {\n    return this.pickList;\n  }\n  toString() {\n    return stringify(this.time)\n    +' '+stringify(this.latitude)\n    +\" \"+stringify(this.longitude)\n    +' '+stringify(this.depth)\n    +' '+this.magnitude.toString();\n  }\n}\n/** Represents a QuakeML Origin. */\nexport class Origin {\n  time: moment;\n  latitude: number;\n  longitude: number;\n  depth: number;\n  arrivalList: Array<Arrival>;\n  publicId: string;\n\n  constructor() {\n// what is essential???\n  }\n\n  /**\n   * Parses a QuakeML origin xml element into a Origin object.\n   *\n   * @param qml the origin xml Element\n   * @param allPicks picks already extracted from the xml for linking arrivals with picks\n   * @returns Origin instance\n   */\n  static createFromXml(qml: Element, allPicks: Array<Pick>): Origin {\n    if (qml.localName !== \"origin\") {\n      throw new Error(`Cannot extract, not a QuakeML Origin: ${qml.localName}`);\n    }\n    let out = new Origin();\n    let otimeStr = _grabFirstElText(_grabFirstEl(qml, 'time'),'value');\n    if (isNonEmptyStringArg(otimeStr) ) {\n      out.time = otimeStr;\n    } else {\n      util.log(\"origintime is missing...\");\n    }\n    const lat = _grabFirstElFloat(_grabFirstEl(qml, 'latitude'), 'value');\n    if (isNumArg(lat)) {out.latitude = lat;}\n    const lon = _grabFirstElFloat(_grabFirstEl(qml, 'longitude'), 'value');\n    if (isNumArg(lon)) {out.longitude = lon;}\n    const depth = _grabFirstElFloat(_grabFirstEl(qml, 'depth'), 'value');\n    if (isNumArg(depth)) {out.depth = depth;}\n    const pid = _grabAttribute(qml, 'publicID');\n    if (isNonEmptyStringArg(pid)){out.publicId = pid;}\n\n    let allArrivalEls = qml.getElementsByTagNameNS(BED_NS, 'arrival');\n    let allArrivals = [];\n    for ( let arrivalEl of allArrivalEls) {\n      allArrivals.push(Arrival.createFromXml(arrivalEl, allPicks));\n    }\n    out.arrivalList = allArrivals;\n    return out;\n  }\n  toString() {\n    return stringify(this.time)\n      +' '+stringify(this.latitude)\n      +\" \"+stringify(this.longitude)\n      +' '+stringify(this.depth);\n  }\n  get arrivals(): Array<Arrival> {\n    return this.arrivalList;\n  }\n}\n/** Represents a QuakeML Magnitude.\n */\nexport class Magnitude {\n  mag: number;\n  type: string;\n  publicId: string;\n\n  constructor(mag: number, type: string) {\n    this.mag = mag;\n    this.type = type;\n  }\n  /**\n   * Parses a QuakeML magnitude xml element into a Magnitude object.\n   *\n   * @param qml the magnitude xml Element\n   * @returns Magnitude instance\n   */\n  static createFromXml(qml: Element): Magnitude {\n    if (qml.localName !== \"magnitude\") {\n      throw new Error(`Cannot extract, not a QuakeML Magnitude: ${qml.localName}`);\n    }\n    let mag = _grabFirstElFloat(_grabFirstElNS(qml, BED_NS, 'mag'), 'value');\n    let type = _grabFirstElText(qml, 'type');\n    if (isNumArg(mag)) {\n      // allow type to be undef, but mag needs to be a number\n      if ( ! isNonEmptyStringArg(type) ) {\n        type = UNKNOWN_MAG_TYPE;\n      }\n      let out = new Magnitude(mag, type);\n      const pid = _grabAttribute(qml, 'publicID');\n      if (isNonEmptyStringArg(pid)){out.publicId = pid;}\n      return out;\n    } else {\n      throw new Error(`Did not find mag and type in Element: ${stringify(mag)} ${stringify(type)}`);\n    }\n  }\n  toString() {\n    return stringify(this.mag)+\" \"+stringify(this.type);\n  }\n}\n\n/** Represents a QuakeML Arrival, a combination of a Pick with a phase name.\n */\nexport class Arrival {\n  phase: string;\n  pick: Pick;\n  publicId: string;\n\n  constructor(phase: string, pick: Pick) {\n    this.phase = phase;\n    this.pick = pick;\n  }\n  /**\n   * Parses a QuakeML arrival xml element into a Arrival object.\n   *\n   * @param arrivalQML the arrival xml Element\n   * @param allPicks picks already extracted from the xml for linking arrivals with picks\n   * @returns Arrival instance\n   */\n  static createFromXml(arrivalQML: Element, allPicks: Array<Pick>): Arrival {\n    if (arrivalQML.localName !== \"arrival\") {\n      throw new Error(`Cannot extract, not a QuakeML Arrival: ${arrivalQML.localName}`);\n    }\n    let pickId = _grabFirstElText(arrivalQML, 'pickID');\n    let phase = _grabFirstElText(arrivalQML, 'phase');\n    if (isNonEmptyStringArg(phase) && isNonEmptyStringArg(pickId)) {\n      let myPick = allPicks.find(function(p: Pick) { return p.publicId === pickId;});\n      if ( ! myPick) {\n        throw new Error(\"Can't find pick with Id=\"+pickId+\" for Arrival\");\n      }\n      let out = new Arrival(phase, myPick);\n      const pid = _grabAttribute(arrivalQML, 'publicID');\n      if (isNonEmptyStringArg(pid)){out.publicId = pid;}\n      return out;\n    } else {\n      throw new Error(\"Arrival does not have phase or pickId: \"+stringify(phase)+\" \"+stringify(pickId));\n    }\n  }\n}\n\n/** Represents a QuakeML Pick.\n */\nexport class Pick {\n  time: moment;\n  networkCode: string;\n  stationCode: string;\n  locationCode: string;\n  channelCode: string;\n  publicId: string;\n  constructor(time: moment,\n      networkCode: string,\n      stationCode: string,\n      locationCode: string,\n      channelCode: string) {\n    this.time = checkStringOrDate(time);\n    this.networkCode = networkCode;\n    this.stationCode = stationCode;\n    this.locationCode = locationCode;\n    this.channelCode = channelCode;\n  }\n  /**\n   * Parses a QuakeML pick xml element into a Pick object.\n   *\n   * @param pickQML the pick xml Element\n   * @returns Pick instance\n   */\n  static createFromXml(pickQML: Element): Pick {\n    if (pickQML.localName !== \"pick\") {\n      throw new Error(`Cannot extract, not a QuakeML Pick: ${pickQML.localName}`);\n    }\n    let otimeStr = _grabFirstElText(_grabFirstEl(pickQML, 'time'),'value');\n    let time = checkStringOrDate(otimeStr);\n    let waveformIdEl = _grabFirstEl(pickQML, 'waveformID');\n    let netCode = _grabAttribute(waveformIdEl, \"networkCode\");\n    let stationCode = _grabAttribute(waveformIdEl, \"stationCode\");\n    let locationCode = _grabAttribute(waveformIdEl, \"locationCode\");\n    let channelCode = _grabAttribute(waveformIdEl, \"channelCode\");\n    // handle empty loc code, it can be missing\n    if ( ! isNonEmptyStringArg(locationCode)) { locationCode = '';}\n    if (! isNonEmptyStringArg(netCode) || ! isNonEmptyStringArg(stationCode)\n        || ! isNonEmptyStringArg(channelCode)) {\n      throw new Error(\"missing codes: \"+stringify(netCode)\n                      +\".\"+ stringify(stationCode)\n                      +\".\"+ stringify(locationCode)\n                      +\".\"+ stringify(channelCode));\n    }\n    let out = new Pick(time, netCode, stationCode, locationCode, channelCode);\n    const pid = _grabAttribute(pickQML, 'publicID');\n    if (isNonEmptyStringArg(pid)){out.publicId = pid;}\n    return out;\n  }\n}\n\n\n/**\n * Parses a QuakeML xml document into seisplotjs objects\n *\n *  @param rawXml the xml Document to parse\n *  @param host optional source of the xml, helpful for parsing the eventid\n *  @returns array of Quake objects\n */\nexport function parseQuakeML(rawXml: Document, host?: string): Array<Quake> {\n  let top = rawXml.documentElement;\n  if (! top) {\n    throw new Error(\"Can't get documentElement\");\n  }\n  let eventArray = top.getElementsByTagName(\"event\");\n  let out = [];\n  for (let eventEl of eventArray) {\n    out.push(Quake.createFromXml(eventEl, host));\n  }\n  return out;\n}\n\n// these are similar methods as in seisplotjs.stationxml\n// duplicate here to avoid dependency and diff NS, yes that is dumb...\n\nconst _grabFirstElNS = function(xml: Element | null | void, namespace: string, tagName: string): Element | void {\n  let out = undefined;\n  if ( isObject(xml)) {\n    let elList = xml.getElementsByTagNameNS(namespace, tagName);\n    if (isObject(elList) && elList.length > 0) {\n      const e = elList.item(0);\n      if (e) {\n        out = e;\n      }\n    }\n  }\n  return out;\n};\n\nconst _grabFirstEl = function(xml: Element | null | void, tagName: string): Element | void {\n  let out = undefined;\n  if ( isObject(xml)) {\n    let elList = xml.getElementsByTagName(tagName);\n    if (isObject(elList) && elList.length > 0) {\n      const e = elList.item(0);\n      if (e) {\n        out = e;\n      }\n    }\n  }\n  return out;\n};\n\nconst _grabFirstElText = function(xml: Element | null | void, tagName: string): string | void {\n  let out = undefined;\n  let el = _grabFirstEl(xml, tagName);\n  if (isObject(el)) {\n    out = el.textContent;\n  }\n  return out;\n};\n\nconst _grabFirstElInt = function(xml: Element | null | void, tagName: string): number | void {\n  let out = undefined;\n  let el = _grabFirstElText(xml, tagName);\n  if (isStringArg(el)) {\n    out = parseInt(el);\n  }\n  return out;\n};\n\nconst _grabFirstElFloat = function(xml: Element | null | void, tagName: string): number | void {\n  let out = undefined;\n  let el = _grabFirstElText(xml, tagName);\n  if (isStringArg(el)) {\n    out = parseFloat(el);\n  }\n  return out;\n};\n\nconst _grabAttribute = function(xml: Element | null | void, tagName: string): string | void {\n  let out = undefined;\n  if ( isObject(xml)) {\n    let a = xml.getAttribute(tagName);\n    if (isStringArg(a)) {\n      out = a;\n    }\n  }\n  return out;\n};\n\nconst _grabAttributeNS = function(xml: Element | null | void, namespace: string, tagName: string): string | void {\n  let out = undefined;\n  if ( isObject(xml)) {\n    let a = xml.getAttributeNS(namespace, tagName);\n    if (isStringArg(a)) {\n      out = a;\n    }\n  }\n  return out;\n};\n\nexport const parseUtil = {\n  \"_grabFirstEl\": _grabFirstEl,\n  \"_grabFirstElNS\": _grabFirstElNS,\n  \"_grabFirstElText\": _grabFirstElText,\n  \"_grabFirstElFloat\": _grabFirstElFloat,\n  \"_grabFirstElInt\": _grabFirstElInt,\n  \"_grabAttribute\": _grabAttribute,\n  \"_grabAttributeNS\": _grabAttributeNS\n};\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport { checkStringOrDate, meanOfSlice, isDef, stringify } from './util';\nimport * as seedcodec from './seedcodec';\n\nimport {Channel, InstrumentSensitivity} from './stationxml.js';\nimport {Quake} from './quakeml.js';\nimport {StartEndDuration } from './util';\n\nexport const COUNT_UNIT = 'count';\n\nexport type HighLowType = {\n      xScaleDomain: Array<number>;\n      xScaleRange: Array<number>;\n      secondsPerPixel: number;\n      samplesPerPixel: number;\n      highlowArray: Array<number>;\n};\n\nexport type MarkerType = {\n  name: string,\n  time: moment,\n  type: string,\n  description: string\n};\n\n/**\n * A contiguous segment of a Seismogram.\n *\n * @param  yArray array of Y sample values, ie the timeseries\n * @param  sampleRate sample rate of the seismogram, hertz\n * @param  startTime start time of seismogrm as a momentjs moment in utc or a string that can be parsed\n */\nexport class SeismogramSegment {\n  /** Array of y values */\n  _y: null | Int32Array | Float32Array | Float64Array;\n  _compressed: null | Array<seedcodec.EncodedDataSegment>;\n  /**\n   * the sample rate in hertz\n   *\n   * @private\n   */\n  _sampleRate: number;\n  /** @private */\n  _startTime: moment;\n  _endTime_cache: null | moment;\n  _endTime_cache_numPoints: number;\n  networkCode: string;\n  stationCode: string;\n  locationCode: string;\n  channelCode: string;\n  yUnit: string;\n  _highlow: HighLowType;\n  constructor(yArray: Array<seedcodec.EncodedDataSegment> | Int32Array | Float32Array | Float64Array,\n              sampleRate: number,\n              startTime: moment) {\n    if (yArray instanceof Int32Array || yArray instanceof Float32Array || yArray instanceof Float64Array) {\n      this._y = yArray;\n      this._compressed = null;\n    } else if (Array.isArray(yArray) && yArray.every( ee => ee instanceof seedcodec.EncodedDataSegment)) {\n        this._compressed = yArray;\n        this._y = null;\n    } else if (Array.isArray(yArray) && yArray.every( ee => typeof ee === 'number')) {\n      // numbers in js are 64bit, so...\n      this._y = Float64Array.from(((yArray: any): Array<number>));\n      this._compressed = null;\n    }\n    this._sampleRate = sampleRate;\n    this._startTime = checkStringOrDate(startTime);\n    this.yUnit = COUNT_UNIT;\n    // to avoid recalc of end time as it is kind of expensive\n    this._endTime_cache = null;\n    this._endTime_cache_numPoints = 0;\n  }\n  /**\n   * Y data of the seismogram. Decompresses data if needed.\n   *\n   * @returns y data as typed array\n   */\n  get y(): Int32Array | Float32Array | Float64Array {\n    let out;\n    if (this._y) {\n      out = this._y;\n    } else {\n      if ( ! this.isEncoded()) {\n        throw new Error(\"Seismogram not y as TypedArray or encoded.\");\n      }\n      // data is still compressed\n      let outLen = this.numPoints;\n\n      if ( this._compressed === null) {\n        // for flow\n        throw new Error(\"Seismogram not y as TypedArray or encoded.\");\n      }\n      if (this._compressed[0].compressionType === seedcodec.DOUBLE) {\n        out = new Float64Array(outLen);\n      } else if (this._compressed[0].compressionType === seedcodec.FLOAT) {\n        out = new Float32Array(outLen);\n      } else {\n        out = new Int32Array(outLen);\n      }\n      let currIdx = 0;\n      for (let c of this._compressed) {\n        const cData = c.decode();\n        for (let i=0; i<c.numSamples; i++) {\n          out[currIdx+i] = cData[i];\n        }\n        currIdx += c.numSamples;\n      }\n      this._y = out;\n      this._compressed = null;\n    }\n    return out;\n  }\n  set y(value: Int32Array | Float32Array | Float64Array) {\n    this._y = value;\n    this._invalidate_endTime_cache();\n  }\n  get startTime(): moment {\n    return this._startTime;\n  }\n  set startTime(value: moment | string) {\n    this._startTime = checkStringOrDate(value);\n    this._invalidate_endTime_cache();\n  }\n  get endTime(): moment {\n    if ( ! this._endTime_cache || this._endTime_cache_numPoints !== this.numPoints) {\n      // array length modified, recalc cached end time\n      this._endTime_cache_numPoints = this.numPoints;\n      this._endTime_cache = this.timeOfSample(this._endTime_cache_numPoints-1);\n    }\n    return this._endTime_cache;\n  }\n  get timeWindow(): StartEndDuration {\n    return new StartEndDuration(this.startTime, this.endTime);\n  }\n  get sampleRate() {\n    return this._sampleRate;\n  }\n  set sampleRate(value: number) {\n    this._sampleRate = value;\n    this._invalidate_endTime_cache();\n  }\n  get numPoints(): number {\n    let out = 0;\n    if (this._y) {\n      out = this._y.length;\n    } else if (this._compressed) {\n      for (let c of this._compressed) {\n        out += c.numSamples;\n      }\n    }\n    return out;\n  }\n  get netCode(): string {\n    return this.networkCode;\n  }\n  get staCode(): string {\n    return this.stationCode;\n  }\n  get locId(): string {\n    return this.locationCode;\n  }\n  get locCode(): string {\n    return this.locationCode;\n  }\n  get chanCode(): string {\n    return this.channelCode;\n  }\n  /**\n   * Checks if the data is encoded\n   *\n   * @returns true if encoded, false otherwise\n   */\n  isEncoded(): boolean {\n    if (this._y && this._y.length > 0) {\n      return false;\n    } else if (this._compressed && this._compressed.length > 0) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n  /**\n   * Gets encoded data, if it is.\n   *\n   * @returns array of encoded data segments\n   * @throws Error if data is not encoded\n   */\n  getEncoded(): Array<seedcodec.EncodedDataSegment> {\n    if (this.isEncoded()) {\n      return ((this._compressed: any): Array<seedcodec.EncodedDataSegment>);\n    } else {\n      throw new Error(\"Data is not encoded.\");\n    }\n  }\n  yAtIndex(i: number): number {\n    return this.y[i];\n  }\n  /**\n   * Finds the min and max values of a SeismogramSegment, with an optional\n   * accumulator for use with gappy data.\n   *\n   * @param minMaxAccumulator optional initialized accumulator as an array\n   * of two numbers, min and max\n   * @returns min, max as arry of length two\n   */\n  findMinMax(minMaxAccumulator?: Array<number>): Array<number> {\n    let minAmp = Number.MAX_SAFE_INTEGER;\n    let maxAmp = -1 * (minAmp);\n    if ( minMaxAccumulator) {\n      minAmp = minMaxAccumulator[0];\n      maxAmp = minMaxAccumulator[1];\n    }\n    let yData = this.y;\n    for (let n = 0; n < yData.length; n++) {\n      if (minAmp > yData[n]) {\n        minAmp = yData[n];\n      }\n      if (maxAmp < yData[n]) {\n        maxAmp = yData[n];\n      }\n    }\n    return [ minAmp, maxAmp ];\n  }\n  timeOfSample(i: number ): moment {\n    return moment.utc(this.startTime).add(i/this.sampleRate, 'seconds');\n  }\n  indexOfTime(t: moment): number {\n    if (t.isBefore(this.startTime)\n        || t.isAfter(moment.utc(this.endTime).add(1/this.sampleRate, 'seconds'))) {\n        return -1;\n    }\n    return Math.round(t.diff(this.startTime) * this.sampleRate /1000);\n  }\n  hasCodes(): boolean {\n    return isDef(this.networkCode)\n      || isDef(this.stationCode)\n      || isDef(this.locationCode)\n      || isDef(this.channelCode);\n  }\n  /**\n   * return network, station, location and channels codes as one string\n   *\n   * @param sep separator, defaults to '.'\n   * @returns nslc codes separated by sep\n   */\n  codes(sep: string = '.'): string {\n    return (this.networkCode ? this.networkCode : '')\n    +sep+(this.stationCode ? this.stationCode : '')\n    +sep+(this.locationCode ? this.locationCode : '')\n    +sep+(this.channelCode ? this.channelCode : '');\n  }\n  seisId(): string {\n   return (this.codes()+\"_\"+this.startTime.toISOString()+\"_\"+this.endTime.toISOString()).replace(/\\./g,'_').replace(/:/g,'');\n  }\n  clone(): SeismogramSegment {\n    let clonedData = this._y;\n    if (clonedData !== null) {\n      clonedData = clonedData.slice();\n    } else if (this.isEncoded()) {\n      // shallow copy array, assume Encoded is immutable\n      clonedData = Array.from(this.getEncoded());\n    } else {\n      throw new Error(\"no _y and no _compressed\");\n    }\n    return this.cloneWithNewData(clonedData);\n  }\n\n  cloneWithNewData(clonedData: Array<seedcodec.EncodedDataSegment> | Int32Array | Float32Array | Float64Array,\n    clonedStartTime: moment = this._startTime): SeismogramSegment {\n    let out = new SeismogramSegment(clonedData,\n                          this.sampleRate,\n                          moment.utc(clonedStartTime));\n    out.networkCode = this.networkCode;\n    out.stationCode = this.stationCode;\n    out.locationCode = this.locationCode;\n    out.channelCode = this.channelCode;\n    out.yUnit = this.yUnit;\n    return out;\n  }\n  cut(timeWindow: StartEndDuration): SeismogramSegment | null {\n    if (timeWindow.endTime.isBefore(this._startTime) || timeWindow.startTime.isAfter(this.endTime)) {\n      return null;\n    }\n    let sIndex = 0;\n    if (timeWindow.startTime.isAfter(this._startTime)) {\n      let milliDiff = timeWindow.startTime.diff(this._startTime);\n      let offset = milliDiff * this.sampleRate /1000.0;\n      sIndex = Math.floor(offset);\n    }\n    let eIndex = this.y.length;\n    if (timeWindow.endTime.isBefore(this.endTime)) {\n      let milliDiff = moment.utc(this.endTime).diff(timeWindow.endTime);\n      let offset = milliDiff * this.sampleRate /1000.0;\n      eIndex = this.y.length - Math.floor(offset);\n    }\n    let cutY = this.y.slice(sIndex, eIndex);\n\n    let out = this.cloneWithNewData(cutY,\n        moment.utc(this._startTime).add(sIndex / this.sampleRate, 'seconds'));\n\n    return out;\n  }\n  _invalidate_endTime_cache() {\n    this._endTime_cache = null;\n    this._endTime_cache_numPoints = 0;\n  }\n}\n\n /** Represents time window for a single channel that may\n  * contain gaps or overlaps, but is otherwise more or less\n  * continuous, or at least adjacent data from the channel.\n  * Each segment within\n  * the Seismogram will have the same units, channel identifiers\n  * and sample rate, but cover different times.\n  */\nexport class Seismogram {\n  _segmentArray: Array<SeismogramSegment>;\n  _startTime: moment;\n  _endTime: moment;\n  _y: null | Int32Array | Float32Array | Float64Array;\n  constructor(segmentArray: SeismogramSegment | Array<SeismogramSegment>) {\n    this._y = null;\n    if ( Array.isArray(segmentArray) && segmentArray[0] instanceof SeismogramSegment) {\n      this._segmentArray = segmentArray;\n    } else if ( segmentArray instanceof SeismogramSegment) {\n      this._segmentArray = [ segmentArray ];\n    } else {\n      throw new Error(`segmentArray is not Array<SeismogramSegment> or SeismogramSegment: ${stringify(segmentArray)}`);\n    }\n    this.checkAllSimilar();\n    this.findStartEnd();\n  }\n  checkAllSimilar() {\n    if (this._segmentArray.length === 0) {throw new Error(\"Seismogram is empty\");}\n    let f = this._segmentArray[0];\n    this._segmentArray.forEach((s, i) => {\n      if (! s) {\n        throw new Error(`index ${i} is null in trace`);\n      }\n      this.checkSimilar(f, s);\n    });\n  }\n  checkSimilar(f: SeismogramSegment, s: SeismogramSegment) {\n    if (s.networkCode !== f.networkCode) {throw new Error(\"NetworkCode not same: \"+s.networkCode+\" !== \"+f.networkCode);}\n    if (s.stationCode !== f.stationCode) {throw new Error(\"StationCode not same: \"+s.stationCode+\" !== \"+f.stationCode);}\n    if (s.locationCode !== f.locationCode) {throw new Error(\"LocationCode not same: \"+s.locationCode+\" !== \"+f.locationCode);}\n    if (s.channelCode !== f.channelCode) {throw new Error(\"ChannelCode not same: \"+s.channelCode+\" !== \"+f.channelCode);}\n    if (s.yUnit !== f.yUnit) {throw new Error(\"yUnit not same: \"+s.yUnit+\" !== \"+f.yUnit);}\n  }\n  findStartEnd() {\n    let allStart = this._segmentArray.map(seis => {\n      return moment.utc(seis.startTime);\n    });\n    this._startTime = moment.min(allStart);\n    let allEnd = this._segmentArray.map(seis => {\n      return moment.utc(seis.endTime);\n    });\n    this._endTime = moment.max(allEnd);\n  }\n  findMinMax(minMaxAccumulator?: Array<number>): Array<number> {\n    if (this._segmentArray.length === 0) {\n      throw new Error(\"No data\");\n    }\n    for (let s of this._segmentArray) {\n      minMaxAccumulator = s.findMinMax(minMaxAccumulator);\n    }\n    if (minMaxAccumulator){\n      return minMaxAccumulator;\n    } else {\n      // should never happen, for flow\n      throw new Error(\"No data to calc minmax\");\n    }\n  }\n  /**\n   * calculates the mean of a seismogrma.\n   *\n   * @returns       mean value\n   */\n  mean(): number {\n    let meanVal = 0;\n\n    let npts = this.numPoints;\n    for (let s of this.segments) {\n      meanVal += meanOfSlice(s.y, s.y.length)*s.numPoints;\n    }\n    meanVal = meanVal / npts;\n    return meanVal;\n  }\n\n  get startTime(): moment {\n    return this._startTime;\n  }\n  get endTime(): moment {\n    return this._endTime;\n  }\n  get timeRange(): StartEndDuration {\n    return new StartEndDuration(this.startTime, this.endTime);\n  }\n  get networkCode(): string {\n    return this._segmentArray[0].networkCode;\n  }\n  set networkCode(value: string) {\n    this._segmentArray.forEach(s => s.networkCode = value);\n  }\n  get stationCode(): string {\n    return this._segmentArray[0].stationCode;\n  }\n  set stationCode(value: string) {\n    this._segmentArray.forEach(s => s.stationCode = value);\n  }\n  get locationCode(): string {\n    return this._segmentArray[0].locationCode;\n  }\n  set locationCode(value: string) {\n    this._segmentArray.forEach(s => s.locationCode = value);\n  }\n  get channelCode(): string {\n    return this._segmentArray[0].channelCode;\n  }\n  set channelCode(value: string) {\n    this._segmentArray.forEach(s => s.channelCode = value);\n  }\n  get sampleRate(): number {\n    return this._segmentArray[0].sampleRate;\n  }\n  get yUnit(): string {\n    return this._segmentArray[0].yUnit;\n  }\n  get numPoints(): number {\n    return this._segmentArray.reduce((accumulator, seis) => accumulator + seis.numPoints, 0);\n  }\n  hasCodes(): boolean {\n    return this._segmentArray[0].hasCodes();\n  }\n  codes(): string {\n    return this._segmentArray[0].codes();\n  }\n  get segments(): Array<SeismogramSegment> {\n    return this._segmentArray;\n  }\n  append(seismogram: SeismogramSegment | Seismogram) {\n    if (seismogram instanceof Seismogram) {\n      seismogram._segmentArray.forEach(s => this.append(s));\n    } else {\n      this.checkSimilar(this._segmentArray[0], seismogram);\n      this._startTime = moment.min([ this.startTime, moment.utc(seismogram.startTime)]);\n      this._endTime = moment.max([ this.endTime, moment.utc(seismogram.endTime)]);\n      this._segmentArray.push(seismogram);\n    }\n  }\n  /**\n   * Cut the seismogram. Creates a new seismogram with all datapoints\n   * contained in the time window.\n   *\n   * @param  timeWindow start and end of cut\n   * @returns            new seismogram\n   */\n  cut(timeWindow: StartEndDuration): null | Seismogram {\n    // coarse trim first\n    let out = this.trim(timeWindow);\n    if (out && out._segmentArray) {\n      let cutSeisArray = this._segmentArray.map(seg => seg.cut(timeWindow)).filter(Boolean);\n      if (cutSeisArray.length > 0) {\n        out = new Seismogram(cutSeisArray);\n      } else {\n        out = null;\n      }\n    } else {\n      out = null;\n    }\n    return out;\n  }\n  /**\n   * Creates a new Seismogram composed of all seismogram segments that overlap the\n   * given time window. If none do, this returns null. This is a faster but coarser\n   * version of cut as it only removes whole segments that do not overlap the\n   * time window. For most seismograms that consist of a single contiguous\n   * data segment, this will do nothing.\n   *\n   * @param timeWindow time range to trim to\n   * @returns seismogram if data in the window, null otherwise\n   * @see cut\n   */\n  trim(timeWindow: StartEndDuration): null | Seismogram {\n    let out = null;\n    if (this._segmentArray) {\n      let trimSeisArray = this._segmentArray.filter(function(d) {\n        return d.endTime.isSameOrAfter(timeWindow.startTime);\n      }).filter(function(d) {\n        return d.startTime.isSameOrBefore(timeWindow.endTime);\n      });\n      if (trimSeisArray.length > 0) {\n        out = new Seismogram(trimSeisArray);\n      }\n    }\n    return out;\n  }\n  break(duration: moment.Duration) {\n    if (this._segmentArray) {\n      let breakStart = moment.utc(this.startTime);\n      let out = [];\n      while (breakStart.isBefore(this.endTime)) {\n        let breakWindow = new StartEndDuration(breakStart, null, duration);\n        let cutSeisArray = this._segmentArray.map(seg => seg.cut(breakWindow));\n        out = out.concat(cutSeisArray);\n        breakStart.add(duration);\n      }\n      // check for null, filter true if seg not null\n      out = out.filter(Boolean);\n      this._segmentArray = out;\n    }\n    return this;\n  }\n  isContiguous() {\n    if (this._segmentArray.length === 1) {\n      return true;\n    }\n    let prev = null;\n    for (const s of this._segmentArray) {\n      if (prev && ! (prev.endTime.isBefore(s.startTime)\n          && prev.endTime.add(1000*1.5/prev.sampleRate, 'ms').isAfter(s.startTime))) {\n        return false;\n      }\n      prev = s;\n    }\n    return true;\n  }\n  merge(): Int32Array | Float32Array | Float64Array {\n    let outArray;\n    if (this._segmentArray[0].y instanceof Int32Array) {\n      outArray = new Int32Array(this.numPoints);\n    } else if (this._segmentArray[0].y instanceof Float32Array) {\n      outArray = new Float32Array(this.numPoints);\n    } else if (this._segmentArray[0].y instanceof Float64Array) {\n      outArray = new Float64Array(this.numPoints);\n    } else {\n      throw new Error(`data not one of Int32Array, Float32Array or Float64Array: ${this._segmentArray[0].y.constructor.name}`);\n    }\n    let i=0;\n    this._segmentArray.forEach( seg => {\n      for(let v of seg.y) {\n        outArray[i] = v;\n        i++;\n      }\n    });\n    return outArray;\n  }\n  /**\n   * Gets the timeseries as an typed array if it is contiguous.\n   *\n   * @throws {NonContiguousData} if data is not contiguous.\n   * @returns  timeseries as array of number\n   */\n  get y(): Int32Array | Float32Array | Float64Array {\n    if ( ! this._y) {\n      if (this.isContiguous()) {\n        this._y = this.merge();\n      }\n    }\n    if (this._y) {\n      return this._y;\n    } else {\n      throw new Error(\"Seismogram is not contiguous, acces each SeismogramSegment idividually.\");\n    }\n  }\n  set y(val: Int32Array | Float32Array | Float64Array ) {\n    // ToDo\n    throw new Error(\"seismogram y setter not impl, see cloneWithNewData()\");\n  }\n  clone(): Seismogram {\n    let cloned = this._segmentArray.map( s => s.clone());\n    return new Seismogram(cloned);\n  }\n\n  cloneWithNewData(newY: Int32Array | Float32Array | Float64Array): Seismogram {\n    if (newY && newY.length > 0) {\n      let seg = this._segmentArray[0].cloneWithNewData(newY);\n      return new Seismogram([seg]);\n    } else {\n      throw new Error(\"Y value is empty\");\n    }\n  }\n  /**\n   * factory method to create a single segment Seismogram from either encoded data\n   *  or a TypedArray, along with sample rate and start time.\n   *\n   * @param yArray array of encoded data or typed array\n   * @param sampleRate sample rate, samples per second of the data\n   * @param startTime time of first sample\n   * @returns seismogram initialized with the data\n   */\n  static createFromContiguousData(yArray: Array<seedcodec.EncodedDataSegment> | Int32Array | Float32Array | Float64Array,\n                                  sampleRate: number,\n                                  startTime: moment) {\n    const seg = new SeismogramSegment(yArray, sampleRate, startTime);\n    return new Seismogram([seg]);\n  }\n}\n\nexport class NonContiguousData extends Error {\n  constructor(message?: string) {\n    super(message);\n    this.name = this.constructor.name;\n  }\n}\n\nexport function ensureIsSeismogram(seisSeismogram: Seismogram | SeismogramSegment) {\n  if (typeof seisSeismogram === \"object\") {\n    if (seisSeismogram instanceof Seismogram) {\n      return seisSeismogram;\n    } else if (seisSeismogram instanceof SeismogramSegment) {\n      return new Seismogram([ seisSeismogram ]);\n    } else {\n      let s = typeof seisSeismogram;\n      if (seisSeismogram.prototype && seisSeismogram.prototype.constructor) {\n        s += \" \"+seisSeismogram.prototype.constructor.name;\n      } else {\n        s += \" \"+seisSeismogram;\n      }\n      throw new Error(\"must be Seismogram or SeismogramSegment but \"+s);\n    }\n  } else {\n    throw new Error(\"must be Seismogram or SeismogramSegment but not an object\");\n  }\n}\n\n\nexport class SeismogramDisplayData {\n  /** @private */\n  _seismogram: Seismogram | null;\n  _id: string | null;\n  label: string | null;\n  markerList: Array<MarkerType>;\n  channel: Channel | null;\n  _instrumentSensitivity: InstrumentSensitivity | null;\n  quakeList: Array<Quake>;\n  timeWindow: StartEndDuration;\n  alignmentTime: moment | null;\n  doShow: boolean;\n  _statsCache: SeismogramDisplayStats | null;\n  constructor(timeWindow: StartEndDuration) {\n    if ( ! timeWindow) {\n      throw new Error(\"StartEndDuration must not be missing.\");\n    }\n    this._id = null;\n    this._seismogram = null;\n    this.label = null;\n    this.markerList = [];\n    this.channel = null;\n    this._instrumentSensitivity = null;\n    this.quakeList = [];\n    this.timeWindow = timeWindow;\n    this.alignmentTime = null;\n    this.doShow = true;\n    this._statsCache = null;\n  }\n  static fromSeismogram(seismogram: Seismogram ): SeismogramDisplayData {\n    const out = new SeismogramDisplayData(new StartEndDuration(seismogram.startTime, seismogram.endTime, null, null));\n    out.seismogram = seismogram;\n    return out;\n  }\n  static fromChannelAndTimeWindow(channel: Channel, timeWindow: StartEndDuration): SeismogramDisplayData {\n    const out = new SeismogramDisplayData(timeWindow);\n    out.channel = channel;\n    return out;\n  }\n  static fromChannelAndTimes(channel: Channel, startTime: moment, endTime: moment): SeismogramDisplayData {\n    const out = new SeismogramDisplayData(new StartEndDuration(startTime, endTime));\n    out.channel = channel;\n    return out;\n  }\n  addQuake(quake: Quake | Array<Quake> ) {\n    if (Array.isArray(quake)) {\n      quake.forEach(q => this.quakeList.push(q));\n    } else {\n      this.quakeList.push(quake);\n    }\n  }\n  addMarkers(markers: MarkerType | Array<MarkerType>) {\n      if (Array.isArray(markers)) {\n        markers.forEach(m => this.markerList.push(m));\n      } else {\n        this.markerList.push(markers);\n      }\n  }\n  hasQuake(): boolean {\n    return this.quakeList.length > 0;\n  }\n  hasSeismogram(): boolean {\n    return isDef(this._seismogram);\n  }\n  hasChannel(): boolean {\n    return this.channel !== null;\n  }\n  hasSensitivity(): boolean {\n    return this._instrumentSensitivity !== null\n        || (isDef(this.channel) && this.channel.hasInstrumentSensitivity());\n  }\n  /**\n   * Allows id-ing a seismogram. Optional.\n   *\n   * @returns         string id\n   */\n  get id(): string | null {\n    return this._id;\n  }\n  /**\n   * Allows iding a seismogram. Optional.\n   *\n   * @param   value string id\n   */\n  set id(value: string | null) {\n    this._id = value;\n  }\n  /**\n   * return network code as a string.\n   * Uses this.channel if it exists, this.seismogram if not.\n   *\n   * @returns network code\n   */\n  get networkCode(): string {\n    if (this.channel !== null) {\n      return this.channel.networkCode;\n    } else if (isDef(this._seismogram)) {\n      return this._seismogram.networkCode;\n    } else {\n      return \"unknown\";\n    }\n  }\n  /**\n   * return station code as a string.\n   * Uses this.channel if it exists, this.seismogram if not.\n   *\n   * @returns station code\n   */\n  get stationCode(): string {\n    if (this.channel !== null) {\n      return this.channel.stationCode;\n    } else if (isDef(this._seismogram)) {\n      return this._seismogram.stationCode;\n    } else {\n      return \"unknown\";\n    }\n  }\n  /**\n   * return location code a a string.\n   * Uses this.channel if it exists, this.seismogram if not.\n   *\n   * @returns location code\n   */\n  get locationCode(): string {\n    if (this.channel !== null) {\n      return this.channel.locationCode;\n    } else if (isDef(this._seismogram)) {\n      return this._seismogram.locationCode;\n    } else {\n      return \"unknown\";\n    }\n  }\n  /**\n   * return channels code as a string.\n   * Uses this.channel if it exists, this.seismogram if not.\n   *\n   * @returns channel code\n   */\n  get channelCode(): string {\n    if (this.channel !== null) {\n      return this.channel.channelCode;\n    } else if (isDef(this._seismogram)) {\n      return this._seismogram.channelCode;\n    } else {\n      return \"unknown\";\n    }\n  }\n  /**\n   * return network, station, location and channels codes as one string.\n   * Uses this.channel if it exists, this.seismogram if not.\n   *\n   * @param sep separator, defaults to '.'\n   * @returns nslc codes separated by sep\n   */\n  codes(sep: string = '.'): string {\n    if (this.channel !== null) {\n      return this.channel.codes();\n    } else {\n    return (this.networkCode ? this.networkCode : '')\n      +sep+(this.stationCode ? this.stationCode : '')\n      +sep+(this.locationCode ? this.locationCode : '')\n      +sep+(this.channelCode ? this.channelCode : '');\n    }\n  }\n  get startTime(): moment {\n    return this.timeWindow.startTime;\n  }\n  get endTime(): moment {\n    return this.timeWindow.endTime;\n  }\n  get sensitivity(): InstrumentSensitivity | null {\n    const channel = this.channel;\n    if (this._instrumentSensitivity) {\n      return this._instrumentSensitivity;\n    } else if (isDef(channel) && channel.hasInstrumentSensitivity()) {\n      return channel.instrumentSensitivity;\n    } else {\n      return null;\n    }\n  }\n  set sensitivity(value: InstrumentSensitivity | null) {\n    this._instrumentSensitivity = value;\n  }\n  get min() {\n    if ( ! this._statsCache ) {\n      this._statsCache = this.calcStats();\n    }\n    return this._statsCache.min;\n  }\n  get max() {\n    if ( ! this._statsCache ) {\n      this._statsCache = this.calcStats();\n    }\n    return this._statsCache.max;\n  }\n  get mean() {\n    if ( ! this._statsCache ) {\n      this._statsCache = this.calcStats();\n    }\n    return this._statsCache.mean;\n  }\n  get seismogram() {\n    return this._seismogram;\n  }\n  set seismogram(value: Seismogram | null) {\n    this._seismogram = value;\n    this._statsCache = null;\n  }\n  calcStats() {\n    let stats = new SeismogramDisplayStats();\n    if (this.seismogram) {\n      let minMax = this.seismogram.findMinMax();\n      stats.min = minMax[0];\n      stats.max = minMax[1];\n      // $FlowFixMe  know seismogram is not null\n      stats.mean = this.seismogram.mean();\n    }\n    this._statsCache = stats;\n    return stats;\n  }\n  clone(): SeismogramDisplayData {\n    return this.cloneWithNewSeismogram(this.seismogram ? this.seismogram.clone() : null);\n  }\n  cloneWithNewSeismogram(seis: Seismogram | null): SeismogramDisplayData {\n      let out = new SeismogramDisplayData(this.timeWindow);\n      Object.getOwnPropertyNames(this).forEach( name => {\n        if (name === '_seismogram') {\n          out._seismogram = seis;\n        // $FlowFixMe\n        } else if (this[name] instanceof moment) {\n          // $FlowFixMe\n          out[name] = moment.utc(this[name]);\n          // $FlowFixMe\n        } else if ( Array.isArray(this[name]) ) {\n          // $FlowFixMe\n          out[name] = this[name].slice();\n        } else {\n          // $FlowFixMe\n          out[name] = this[name];\n        }\n      });\n      out.seismogram = seis;\n      out._statsCache = null;\n      return out;\n  }\n  /**\n   * Cut the seismogram. Creates a new seismogramDisplayData with the cut\n   * seismogram and the timeWindow set to the new time window.\n   *\n   * @param  timeWindow start and end of cut\n   * @returns           new seismogramDisplayData\n   */\n  cut(timeWindow: StartEndDuration): null | SeismogramDisplayData {\n    let cutSeis = this.seismogram;\n    let out;\n    if (cutSeis) {\n      cutSeis = cutSeis.cut(timeWindow);\n      out = this.cloneWithNewSeismogram(cutSeis);\n    } else {\n      // no seismogram, so just clone?\n      out = this.clone();\n    }\n    out.timeWindow = timeWindow;\n    return out;\n  }\n}\n\nexport class SeismogramDisplayStats {\n  min: number;\n  max: number;\n  mean: number;\n  trendSlope: number;\n  constructor() {\n    this.min = 0;\n    this.max = 0;\n    this.mean = 0;\n    this.trendSlope = 0;\n  }\n}\n\nexport function findStartEnd(sddList: Array<SeismogramDisplayData>): StartEndDuration {\n  let allStart = sddList.map(sdd => {\n    return moment.utc(sdd.timeWindow.startTime);\n  });\n  let startTime = moment.min(allStart);\n  let allEnd = sddList.map(sdd => {\n    return moment.utc(sdd.timeWindow.endTime);\n  });\n  let endTime = moment.max(allEnd);\n  return new StartEndDuration(startTime, endTime);\n}\n\nexport function findMinMax(sddList: Array<SeismogramDisplayData>): Array<number> {\n  let min = sddList.map(sdd => {\n    return sdd.min;\n  }).reduce(function (p, v) {\n    return ( p < v ? p : v );\n  });\n  let max = sddList.map(sdd => {\n    return sdd.max;\n  }).reduce(function (p, v) {\n    return ( p > v ? p : v );\n  });\n  return [min, max];\n}\n\nconst initial_minAmp = Number.MAX_SAFE_INTEGER;\nconst initial_maxAmp = -1 * (initial_minAmp);\n\nexport function findMinMaxOverTimeRange(sddList: Array<SeismogramDisplayData>, timeWindow: StartEndDuration): Array<number> {\n  let minMaxArr = sddList.map(sdd => {\n      if (sdd.seismogram) {\n        const cutSeis = sdd.seismogram.cut(timeWindow);\n        if (cutSeis) {\n          return cutSeis.findMinMax();\n        }\n      }\n      return [initial_minAmp,initial_maxAmp];\n    });\n  let min = minMaxArr.map(mm => {\n    return mm[0];\n  }).reduce(function (p, v) {\n    return ( p < v ? p : v );\n  });\n  let max = minMaxArr.map(mm => {\n    return mm[1];\n  }).reduce(function (p, v) {\n    return ( p > v ? p : v );\n  });\n  return [min, max];\n}\n\n\nexport function findStartEndOfSeismograms(data: Array<Seismogram>, accumulator?: StartEndDuration): StartEndDuration {\n  let out: StartEndDuration;\n  if ( ! accumulator && ! data) {\n    throw new Error(\"data and accumulator are not defined\");\n  } else if ( ! accumulator) {\n    out = new StartEndDuration( moment.utc('2500-01-01'), moment.utc('1001-01-01'));\n  } else {\n    out = accumulator;\n  }\n  if ( Array.isArray(data)) {\n    for (let s of data) {\n      if ( s.startTime < out.startTime) {\n        out = new StartEndDuration( moment.utc(s.startTime), out.endTime);\n      }\n      if ( out.endTime < s.endTime ) {\n        out = new StartEndDuration( out.startTime, moment.utc(s.endTime));\n      }\n    }\n  } else {\n    throw new Error(`Expected Array as first arg but was: ${typeof data}`);\n  }\n  return out;\n}\n\n\nexport function findMinMaxOfSeismograms(data: Array<Seismogram> , minMaxAccumulator ?: Array<number>): Array<number> {\n  for(let s of data) {\n    minMaxAccumulator = s.findMinMax(minMaxAccumulator);\n  }\n  if (minMaxAccumulator) {\n    return minMaxAccumulator;\n  } else {\n    return [-1, 1];\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n import moment from 'moment';\n\nimport {SeismogramSegment, Seismogram} from './seismogram';\nimport * as seedcodec from './seedcodec';\nimport { isDef, isNonEmptyStringArg } from './util.js';\n\nexport const MINISEED_MIME = \"application/vnd.fdsn.mseed\";\n\n/**\n * parse arrayBuffer into an array of DataRecords.\n *\n * @param arrayBuffer bytes to parse\n * @returns arry of data records\n */\nexport function parseDataRecords(arrayBuffer: ArrayBuffer): Array<DataRecord> {\n  let dataRecords = [];\n  let offset = 0;\n  while (offset < arrayBuffer.byteLength) {\n    let dataView = new DataView(arrayBuffer, offset);\n    let dr = parseSingleDataRecord(dataView);\n    dataRecords.push(dr);\n    offset += dr.header.recordSize;\n  }\n  return dataRecords;\n}\n\n/**\n * parse a single DataRecord starting at the beginning of the DataView.\n * Currently only some blockettes are parsed, 100, 1000, 1001, others are separated,\n * but left as just a DataView.\n *\n * @param dataView bytes as DataView\n * @returns data record\n */\nexport function parseSingleDataRecord(dataView: DataView): DataRecord {\n  let header = parseSingleDataRecordHeader(dataView);\n  let data = new DataView(dataView.buffer,\n                          dataView.byteOffset+header.dataOffset,\n                          header.recordSize-header.dataOffset);\n  return new DataRecord(header, data);\n}\n\n/**\n * parse the DataHeader from a single DataRecord starting at the beginning of the DataView.\n *\n * @param dataView bytes as DataView\n * @returns data record header\n */\nexport function parseSingleDataRecordHeader(dataView: DataView): DataHeader {\n  if (dataView.byteLength < 47) {\n    throw new Error(`Not enought bytes for header, need 47, found ${dataView.byteLength}`);\n  }\n  let out = new DataHeader();\n  out.seq = makeString(dataView, 0, 6);\n  out.typeCode = dataView.getUint8(6);\n  out.continuationCode = dataView.getUint8(7);\n  out.staCode = makeString(dataView, 8, 5);\n  out.locCode = makeString(dataView, 13, 2);\n  out.chanCode = makeString(dataView, 15, 3);\n  out.netCode = makeString(dataView, 18, 2);\n  out.startBTime = parseBTime(dataView, 20);\n  let headerByteSwap = checkByteSwap(out.startBTime);\n  if (headerByteSwap) {\n    out.startBTime = parseBTime(dataView, 20, headerByteSwap);\n  }\n  out.numSamples = dataView.getInt16(30, headerByteSwap);\n  out.sampRateFac = dataView.getInt16(32, headerByteSwap);\n  out.sampRateMul = dataView.getInt16(34, headerByteSwap);\n  out.activityFlags = dataView.getUint8(36);\n  out.ioClockFlags = dataView.getUint8(37);\n  out.dataQualityFlags = dataView.getUint8(38);\n  out.numBlockettes = dataView.getUint8(39);\n  out.timeCorrection = dataView.getInt32(40, headerByteSwap);\n  out.dataOffset = dataView.getUint16(44, headerByteSwap);\n  out.blocketteOffset = dataView.getUint16(46, headerByteSwap);\n  let offset = out.blocketteOffset;\n  out.blocketteList = [];\n  out.recordSize = 4096;\n  out.sampleRate = out.calcSampleRate();\n  out.startTime = out.startBTime.toMoment();\n  for (let i=0; i< out.numBlockettes; i++) {\n    let nextOffset = dataView.getUint16(offset+2, headerByteSwap);\n    if (nextOffset === 0) {\n      // last blockette\n      nextOffset = out.dataOffset;\n    }\n    if (nextOffset === 0) {\n      nextOffset = offset; // zero length, probably an error...\n    }\n    let blockette = parseBlockette(dataView, offset, nextOffset-offset, headerByteSwap);\n    out.blocketteList.push(blockette);\n    offset = nextOffset;\n    if (blockette instanceof Blockette1000) {\n      out.recordSize = 1 << blockette.dataRecordLengthByte;\n      out.encoding = blockette.encoding;\n      out.littleEndian = (blockette.wordOrder === 0);\n    } else if(blockette instanceof Blockette1001) {\n      out.startBTime.microsecond = blockette.microsecond;\n    } else if(blockette instanceof Blockette100) {\n      out.sampleRate = blockette.sampleRate;\n    }\n  }\n  out.endTime = out.timeOfSample(out.numSamples-1);\n  return out;\n}\n\n/**\n * parses a Blockette within the DataView.\n *\n * @param  dataView containing the data\n * @param  offset offset into the DataView to start\n * @param  length size in bytes of the Blockette\n * @param headerByteSwap true if byte swapping is needed\n * @returns Blockette instance\n */\nexport function parseBlockette(dataView: DataView, offset: number, length: number, headerByteSwap: boolean): Blockette {\n  const type = dataView.getUint16(offset, headerByteSwap);\n  const body = new DataView(dataView.buffer, dataView.byteOffset+offset, length);\n  if (type === 1000) {\n    const encoding = body.getUint8(4);\n    const wordOrder = body.getUint8(5);\n    const dataRecordLengthByte = body.getUint8(6);\n    return new Blockette1000(type, body, encoding, dataRecordLengthByte, wordOrder);\n  } else if (type === 1001) {\n    const timeQual = body.getUint8(4);\n    const microsecond = body.getUint8(5);\n    //const reserved = body.getUint8(6)\n    const frameCount = body.getUint8(7);\n    return new Blockette1001(type, body, timeQual, microsecond, frameCount);\n  } else if (type === 100) {\n    const sampleRate = body.getFloat32(4);\n    const flags = body.getUint8(8);\n    return new Blockette100(type, body, sampleRate, flags);\n  } else {\n    return new Blockette(type, body);\n  }\n}\n\n/**\n * Represents a SEED Data Record, with header, blockettes and data.\n *  */\nexport class DataRecord {\n  header: DataHeader;\n  data: DataView;\n\n  constructor(header: DataHeader, data: DataView) {\n    this.header = header;\n    this.data = data;\n  }\n  /**\n   * Decompresses the data , if the compression type is known.\n   *\n   * @returns decompressed data\n   */\n  decompress() {\n    return this.asEncodedDataSegment().decode();\n  }\n  asEncodedDataSegment() {\n    return new seedcodec.EncodedDataSegment(this.header.encoding, this.data, this.header.numSamples, this.header.littleEndian);\n  }\n\n  /**\n   * Concatenates the net, station, loc and channel codes,\n   * separated by the given seperator, or periods if not given.\n   *\n   * @param sep optional separater, defaults to .\n   * @returns string of codes\n   */\n  codes(sep?: string): string {\n    if ( ! isNonEmptyStringArg(sep)) { sep = '.';}\n    return this.header.netCode+sep+this.header.staCode+sep+this.header.locCode+sep+this.header.chanCode;\n  }\n}\n\n/**\n * Represents the header part of the DataRecord, including all the actual\n *  fixed header plus fields pulled from a blockette 1000 if present.\n */\nexport class DataHeader {\n  seq: string;\n  typeCode: number;\n  continuationCode: number;\n  staCode: string;\n  locCode: string;\n  chanCode: string;\n  netCode: string;\n  startBTime: BTime;\n  numSamples: number;\n  encoding: number;\n  littleEndian: boolean;\n  sampRateFac: number;\n  sampRateMul: number;\n  sampleRate: number;\n  activityFlags: number;\n  ioClockFlags: number;\n  dataQualityFlags: number;\n  numBlockettes: number;\n  timeCorrection: number;\n  dataOffset: number;\n  blocketteOffset: number;\n  recordSize: number;\n  blocketteList: Array<Blockette>;\n  startTime: moment;\n  endTime: moment;\n  constructor() {\n    this.seq = \"      \";\n    this.typeCode = 68; // D\n    this.continuationCode = 32; // space\n    this.staCode = '';\n    this.locCode = '';\n    this.chanCode = '';\n    this.netCode = '';\n    this.startBTime = new BTime(1900, 1, 0, 0, 0, 0);\n    this.numSamples = 0;\n    this.sampRateFac = 0;\n    this.sampRateMul = 0;\n    this.activityFlags = 0;\n    this.ioClockFlags = 0;\n    this.dataQualityFlags = 0;\n    this.numBlockettes = 0;\n    this.timeCorrection = 0;\n    this.dataOffset = 0;\n    this.blocketteOffset = 0;\n    this.blocketteList = [];\n    this.recordSize = 4096;\n    this.encoding = 0;\n    this.littleEndian = false;\n    this.sampleRate = 0;\n    this.startTime = this.startBTime.toMoment();\n    this.endTime = moment.utc(this.startTime);\n  }\n\n  toString() {\n    return this.netCode+\".\"+this.staCode+\".\"+this.locCode+\".\"+this.chanCode+\" \"+this.startTime.toISOString()+\" \"+this.encoding;\n  }\n\n  /**\n   * Calculates the sample rate in hertz from the sampRateFac and sampRateMul\n   * parameters. This.sampleRate value is set to this value at construction.\n   *\n   * @returns sample rate\n   */\n  calcSampleRate(): number {\n    let factor = this.sampRateFac;\n    let multiplier = this.sampRateMul;\n    let sampleRate = 10000.0; // default (impossible) value;\n    if((factor * multiplier) !== 0.0) { // in the case of log records\n        sampleRate = Math.pow(Math.abs(factor),\n                              (factor / Math.abs(factor)))\n                     * Math.pow(Math.abs(multiplier),\n                              (multiplier / Math.abs(multiplier)));\n    }\n    return sampleRate;\n  }\n\n  /**\n   * Calculates the time of the i-th sample in the record, zero based,\n   *  so timeOfSample(0) is the start and timeOfSample(this.numSamples-1) is end.\n   *\n   * @param i sample index\n   * @returns time at i-th sample as moment\n   */\n  timeOfSample(i: number): moment {\n    return moment.utc(this.startTime).add(i/this.sampleRate, 'second');\n  }\n}\n\nexport class Blockette {\n  type: number;\n  body: DataView;\n\n  constructor(type: number, body: DataView) {\n    this.type = type;\n    this.body = body;\n  }\n}\n\n\nexport class Blockette1000 extends Blockette {\n  encoding: number;\n  dataRecordLengthByte: number;\n  wordOrder: number;\n  constructor(type: number, body: DataView, encoding: number, dataRecordLengthByte: number, wordOrder: number) {\n    super(type, body);\n    if (type !== 1000) {throw new Error(\"Not a blockette1000: \"+this.type);}\n    this.encoding = encoding;\n    this.dataRecordLengthByte = dataRecordLengthByte;\n    this.wordOrder = wordOrder;\n  }\n}\n\nexport class Blockette1001 extends Blockette {\n  timeQual: number;\n  microsecond: number;\n  frameCount: number;\n  constructor(type: number, body: DataView, timeQual: number, microsecond: number, frameCount: number) {\n    super(type, body);\n    if (type !== 1001) {throw new Error(\"Not a blockette1001: \"+this.type);}\n    this.timeQual = timeQual;\n    this.microsecond = microsecond;\n    this.frameCount = frameCount;\n  }\n}\n\nexport class Blockette100 extends Blockette {\n  sampleRate: number;\n  flags: number;\n  constructor(type: number, body: DataView, sampleRate: number, flags: number) {\n    super(type, body);\n    if (type !== 100) {throw new Error(\"Not a blockette100: \"+this.type);}\n    this.sampleRate = sampleRate;\n    this.flags = flags;\n  }\n}\n\nfunction makeString(dataView: DataView, offset: number, length: number): string {\n  let out = \"\";\n  for (let i=offset; i<offset+length; i++) {\n    let charCode = dataView.getUint8(i);\n    if (charCode > 31) {\n      out += String.fromCharCode(charCode);\n    }\n  }\n  return out.trim();\n}\n\nexport function parseBTime(dataView: DataView, offset: number, byteSwap?: boolean): BTime {\n    if ( ! isDef(byteSwap) ) { byteSwap = false; }\n    let year = dataView.getInt16(offset, byteSwap);\n    let jday = dataView.getInt16(offset+2, byteSwap);\n    let hour = dataView.getInt8(offset+4);\n    let min = dataView.getInt8(offset+5);\n    let sec = dataView.getInt8(offset+6);\n    // byte 7 unused, alignment\n    let tenthMilli = dataView.getInt16(offset+8, byteSwap);\n    return new BTime(year, jday, hour, min, sec, tenthMilli);\n}\n\nexport class BTime {\n  year: number;\n  jday: number;\n  hour: number;\n  min: number;\n  sec: number;\n  tenthMilli: number;\n  microsecond: number; // -50 to 49, not part of BTime proper, but added in case of B1001\n  length: number;\n  constructor(year: number, jday: number, hour: number, min: number, sec: number, tenthMilli: number) {\n    this.length = 10;\n    this.year = year;\n    this.jday = jday;\n    this.hour = hour;\n    this.min = min;\n    this.sec = sec;\n    this.tenthMilli = tenthMilli;\n    this.microsecond = 0;\n  }\n  toString(): string {\n    return this.year+\"-\"+this.jday+\" \"+this.hour+\":\"+this.min+\":\"+this.sec+\".\"+this.tenthMilli.toFixed().padStart(4,'0')+\" \"+this.toMoment().toISOString();\n  }\n  /**\n   * Converts this BTime to a momentjs utc moment. Note momentjs's precision\n   * is limited to milliseconds.\n   *\n   * @returns         BTime as a moment\n   */\n  toMoment(): moment {\n    let m = new moment.utc([this.year, 0, 1, this.hour, this.min, this.sec, 0]);\n    m.add(Math.round(this.tenthMilli/10), 'ms');\n    m.dayOfYear(this.jday);\n    if (m.isValid()) {\n      return m;\n    } else {\n      throw new Error(`BTime.start is invalid moment: ${this.year} ${this.jday} ${this.hour} ${this.min} ${this.sec} ${this.tenthMilli}`);\n    }\n  }\n}\n\n/**\n * Sanity checks on a BTime to see if a record might be in the wrong byte order\n * and so need to be byte swapped before parsing. Checks year betwee 1960 and 2055.\n *\n * @param   bTime  time\n * @returns        true is byte order appears to be wrong, false if it seems ok\n */\nexport function checkByteSwap(bTime: BTime): boolean {\n  return bTime.year < 1960 || bTime.year > 2055;\n}\n\n/** Determines if two DataRecords are contiguous, ie if the second starts\n * after the end of the first and the start time of the second is within\n * 1.5 times the sample period of the end of the first.\n *\n * @param dr1 first data record\n * @param dr2 seconds data record\n * @returns true if contiguous\n */\nexport function areContiguous(dr1: DataRecord, dr2: DataRecord): boolean {\n    let h1 = dr1.header;\n    let h2 = dr2.header;\n    return h1.endTime.isBefore(h2.startTime)\n        && h1.endTime.valueOf() + 1000*1.5/h1.sampleRate > h2.startTime.valueOf();\n}\n\n/**\n * Concatentates a sequence of DataRecords into a single seismogram object.\n * Assumes that they are all contiguous and in order. Header values from the first\n * DataRecord are used.\n *\n * @param contig array of data records\n * @returns SeismogramSegment instance\n * */\nexport function createSeismogramSegment(contig: Array<DataRecord> | DataRecord): SeismogramSegment {\n  if ( ! Array.isArray(contig)) { contig = [ contig ];}\n  let contigData = contig.map(dr => dr.asEncodedDataSegment());\n  let out = new SeismogramSegment(contigData,\n                           contig[0].header.sampleRate,\n                           contig[0].header.startTime);\n  out.networkCode = contig[0].header.netCode;\n  out.stationCode = contig[0].header.staCode;\n  out.locationCode = contig[0].header.locCode;\n  out.channelCode = contig[0].header.chanCode;\n\n  return out;\n}\n\n\n/**\n * Merges data records into a Seismogram object, each of\n * which consists of SeismogramSegment objects\n * containing the data as EncodedDataSegment objects. DataRecords are\n * sorted by startTime.\n * This assumes all data records are from the same channel, byChannel\n * can be used first if multiple channels may be present.\n *\n * @param drList array of data records\n * @returns Seismogram instance\n */\nexport function merge(drList: Array<DataRecord>): Seismogram {\n  let out = [];\n  let currDR;\n  drList.sort(function(a,b) {\n      return a.header.startTime.diff(b.header.startTime);\n  });\n  let contig = [];\n  for (let i=0; i<drList.length; i++) {\n    currDR = drList[i];\n    if ( contig.length === 0 ) {\n      contig.push(currDR);\n    } else if (areContiguous(contig[contig.length-1], currDR)) {\n      contig.push(currDR);\n    } else {\n      //found a gap\n      out.push(createSeismogramSegment(contig));\n      contig = [ currDR ];\n    }\n  }\n  if (contig.length > 0) {\n      // last segment\n      out.push(createSeismogramSegment(contig));\n      contig = [];\n  }\n  return new Seismogram(out);\n}\n\n\n/**\n * Splits a list of data records by channel code, returning a Map\n * with each NSLC string mapped to an array of data records.\n *\n * @param drList array of data records\n * @returns map of arrays of data records keyed by channel\n * */\nexport function byChannel(drList: Array<DataRecord>): Map<string, Array<DataRecord>> {\n  let out: Map<string, Array<DataRecord>> = new Map();\n  let key;\n  for (let i=0; i<drList.length; i++) {\n    let currDR = drList[i];\n    key = currDR.codes();\n    let drArray = out.get(key);\n    if ( ! drArray) {\n      drArray = [currDR];\n      out.set(key, drArray);\n    } else {\n      drArray.push(currDR);\n    }\n  }\n  return out;\n}\n\n/**\n * splits the DataRecords by channel and creates a single\n * Seismogram for each channel.\n *\n * @param   drList DataRecords array\n * @returns         Array of Seismogram\n */\nexport function seismogramPerChannel(drList: Array<DataRecord> ): Array<Seismogram> {\n  let out = [];\n  let byChannelMap = byChannel(drList);\n  byChannelMap.forEach(segments => out.push(merge(segments)));\n  return out;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as util from './util.js'; // for util.log\nimport {dataViewToString, stringify, isDef, isNonEmptyStringArg} from './util';\nimport * as miniseed from './miniseed';\nimport * as RSVP from 'rsvp';\nimport moment from 'moment';\n\n/** const for datalink protocol for web sockets, DataLink1.0 */\nexport const DATALINK_PROTOCOL = \"DataLink1.0\";\n/** const for query mode, QUERY */\nexport const QUERY_MODE = \"QUERY\";\n/** const for streaming mode, STREAM */\nexport const STREAM_MODE = \"STREAM\";\n/** const for maximum process number to create fake number for datalink id, 2^16-2 */\nexport const MAX_PROC_NUM = Math.pow(2, 16)-2;\n/** const for fake user name for datalink id, browser */\nexport const USER_BROWSER = \"browser\";\n/** const for fake program name for datalink id, seisplotjs */\nexport const DEFAULT_PROGRAM = \"seisplotjs\";\n/** const for fake architecture for datalink id, javascript */\nexport const DEFAULT_ARCH = \"javascript\";\n\n/** const for error response, ERROR */\nexport const ERROR = \"ERROR\";\nexport const PACKET = \"PACKET\";\nexport const STREAM = \"STREAM\";\nexport const ENDSTREAM = \"ENDSTREAM\";\nexport const MSEED_TYPE = \"/MSEED\";\n\nexport const IRIS_RINGSERVER_URL = \"ws://rtserve.iris.washington.edu/datalink\";\n\nlet defaultHandleResponse = function(message) {\n  util.log(\"Unhandled datalink response: \"+message);\n};\n\n/**\n * A websocket based Datalink connection to a ringserver.\n * Currently only the IRIS\n * ringserver, https://github.com/iris-edu/ringserver,\n * supports websockets, but it may be possible to use thrid party\n * tools to proxy the websocket to a TCP datalink socket.\n * The datalink protocol is documented here\n *  https://raw.githubusercontent.com/iris-edu/libdali/master/doc/DataLink.protocol\n *\n * @param url websocket url to the ringserver\n * @param packetHandler callback for packets as they arrive\n * @param errorHandler callback for errors\n */\nexport class DataLinkConnection {\n  url: string;\n  /** @private */\n  _mode: string | null;\n  packetHandler: (packet: DataLinkPacket) => void;\n  errorHandler: (error: Error) => void;\n  closeHandler: null | (close: CloseEvent) => void;\n  serverId: string | null;\n  clientIdNum: number;\n  programname: string;\n  username: string;\n  architecture: string;\n  _responseResolve: null | (response: DataLinkResponse) => void;\n  _responseReject: null | (error: Error) => void;\n  webSocket: WebSocket | null;\n  constructor(url: string, packetHandler: (packet: DataLinkPacket) => void, errorHandler: (error: Error) => void) {\n    this.url = url;\n    this._mode = QUERY_MODE;\n    this.packetHandler = packetHandler;\n    this.errorHandler = errorHandler;\n    this.closeHandler = null;\n    this.serverId = null;\n    // meant to be processId, so use 1 <= num <= 2^15 to be safe\n    this.clientIdNum = Math.floor(Math.random() * MAX_PROC_NUM)+1;\n    this.programname = DEFAULT_PROGRAM;\n    this.username = USER_BROWSER;\n    this.architecture = DEFAULT_ARCH;\n    this._responseResolve = null;\n    this._responseReject = null;\n  }\n\n  /**\n   * Set a callback function called when the connection is closed.\n   *\n   * @param  closeHandler callback function\n   */\n  setOnClose(closeHandler: (close: CloseEvent) => void) {\n    this.closeHandler = closeHandler;\n  }\n\n  /**\n   * creates the websocket connection and sends the client ID.\n   *\n   *  @returns a Promise that resolves to the server's ID.\n   */\n  connect() {\n    const that = this;\n    return new RSVP.Promise(function(resolve, reject) {\n      const webSocket = new WebSocket(that.url, DATALINK_PROTOCOL);\n      that.webSocket = webSocket;\n      webSocket.binaryType = 'arraybuffer';\n      webSocket.onmessage = function(event) {\n        that.handle(event);\n      };\n      webSocket.onerror = function(event) {\n        that.handleError(new Error(\"\"+stringify(event)));\n        reject(event);\n      };\n      webSocket.onclose = function(closeEvent) {\n        that.webSocket = null; // clean up\n        that._mode = QUERY_MODE;\n        if (that.closeHandler) {\n          that.closeHandler(closeEvent);\n        }\n      };\n      webSocket.onopen = function() {\n        resolve(that);\n      };\n    }).then(datalink => {\n      return datalink.sendId();\n    }).then( idmsg => {\n      that.serverId = idmsg;\n      return idmsg;\n    });\n  }\n\n/**\n * @returns true if the websocket is connected (non-null)\n */\n  isConnected(): boolean {\n    return this.webSocket !== null;\n  }\n  /**\n   * @returns the current mode, QUERY_MODE or STREAM_MODE\n   *\n   */\n  get mode() { return this._mode;}\n\n  /**\n   * Switches to streaming mode to receive data packets from the ringserver.\n   */\n  stream(): void {\n    if (this._mode === STREAM_MODE) {return;}\n    this._mode = STREAM_MODE;\n    this.sendDLCommand(STREAM, \"\");\n  }\n\n  /**\n   * Switches back to query mode to enable commands to be sent to the ringserver.\n   */\n  endStream(): void {\n    if (this.webSocket === null || this._mode === null || this._mode === QUERY_MODE) {return;}\n    this._mode = QUERY_MODE;\n    this.sendDLCommand(ENDSTREAM, \"\");\n  }\n\n  /**\n   * Closes the connection and the underlying websocket. No communication\n   * is possible until connect() is called again.\n   */\n  close(): void {\n    if (this.webSocket) {\n      this.endStream(); // end streaming just in case\n      if (this.webSocket) {this.webSocket.close();}\n      this.webSocket = null;\n      this._mode = null;\n    }\n  }\n\n  /**\n   * Send a ID Command. Command is a string.\n   *\n   * @returns a Promise that resolves to the response from the ringserver.\n   */\n  sendId(): Promise<string> {\n    const that = this;\n    return this.id(this.programname, this.username, stringify(this.clientIdNum), this.architecture)\n    .then(this.ensureDataLinkResponse)\n    .then(dlResponse => {\n      if (dlResponse.type === 'ID') {\n        that.serverId = ''+dlResponse.message;\n        return that.serverId;\n      } else {\n        throw new Error(\"not ID response: \"+stringify(dlResponse.type));\n      }\n    });\n  }\n\n  /**\n   * encodes as a Datalink packet, header with optional data section as\n   * binary Uint8Array. Size of the binary data is appended\n   * to the header if present.\n   *\n   * @param header the command/header string\n   * @param data optional data portion\n   * @returns datalink packet as an ArrayBuffer\n   */\n  encodeDL(header: string, data?: Uint8Array): ArrayBuffer {\n    let cmdLen = header.length;\n    let len = 3+header.length;\n    let lenStr = \"\";\n    if (data && data.length > 0) {\n      lenStr = String(data.length);\n      len+=lenStr.length+1;\n      cmdLen += lenStr.length+1;\n      len+=data.length;\n\n    }\n    let rawPacket = new ArrayBuffer(len);\n    const binaryPacket = new Uint8Array(rawPacket);\n    let packet = new DataView(rawPacket);\n    packet.setUint8(0, 68); // ascii D\n    packet.setUint8(1, 76); // ascii L\n    packet.setUint8(2, cmdLen);\n    let i = 3;\n    for (const c of header) {\n      packet.setUint8(i, c.charCodeAt(0));\n      i++;\n    }\n    const SPACE = ' ';\n    if (data && data.length > 0) {\n      packet.setUint8(i, SPACE.charCodeAt(0)); // ascii space\n      i++;\n      for (const c of lenStr) {\n        packet.setUint8(i, c.charCodeAt(0));\n        i++;\n      }\n      binaryPacket.set(data, i);\n    }\n    return rawPacket;\n  }\n\n  /** sends the header with optional binary data\n   * as the data section. Size of the data is appended\n   * to the header before sending if present.\n   *\n   * @param header header to send\n   * @param data optional data to send\n   */\n  sendDLBinary(header: string, data?: Uint8Array): void {\n    const rawPacket = this.encodeDL(header, data);\n    if (this.webSocket) {\n      this.webSocket.send(rawPacket);\n    } else {\n      throw new Error(\"WebSocket has been closed.\");\n    }\n  }\n\n  /** sends the command as header with optional dataString\n   * as the data section. Size of the dataString is appended\n   * to the header before sending.\n   *\n   * @param command the command/header string\n   * @param dataString optional data portion of packet\n   */\n  sendDLCommand(command: string, dataString?: string): void {\n    this.sendDLBinary(command, stringToUint8Array(dataString));\n  }\n\n  /**\n   * Send a DataLink Command and await the response. Command is a string.\n   *\n   * @param header packet header\n   * @param data optional data portion of packet\n   * @returns a Promise that resolves with the webSocket MessageEvent.\n   */\n  awaitDLBinary(header: string, data?: Uint8Array): Promise<DataLinkResponse> |  Promise<DataLinkPacket> {\n    let that = this;\n    let promise = new RSVP.Promise(function(resolve, reject) {\n      that._responseResolve = resolve;\n      that._responseReject = reject;\n      that.sendDLBinary(header, data);\n    }).then(response => {\n      that._responseResolve = null;\n      that._responseReject = null;\n      return response;\n    }).catch(error => {\n      that._responseResolve = null;\n      that._responseReject = null;\n      throw error;\n    });\n    return promise;\n  }\n\n\n  /**\n   * Send a DataLink Command and await the response. Command is a string.\n   * Returns a Promise that resolves with the webSocket MessageEvent.\n   *\n   * @param command the command/header string\n   * @param dataString optional data portion of packet\n   * @returns promise to server's response\n   */\n  awaitDLCommand(command: string, dataString?: string): Promise<DataLinkResponse> |  Promise<DataLinkPacket> {\n    return this.awaitDLBinary(command, stringToUint8Array(dataString));\n  }\n\n  /**\n   * Writes data to the ringserver and awaits a acknowledgement.\n   *\n   * @param   streamid    stream id for packet header\n   * @param   hpdatastart start of timewindow the packet covers\n   * @param   hpdataend   end of timewindow the packet covers\n   * @param   data        optional data to send\n   * @returns             promise to server's response\n   */\n  writeAck(streamid: string, hpdatastart: number, hpdataend: number, data?: Uint8Array): Promise<DataLinkResponse> |  Promise<DataLinkPacket>  {\n    let header = `WRITE ${streamid} ${momentToHPTime(hpdatastart)} ${momentToHPTime(hpdataend)} A`;\n    return this.awaitDLBinary(header, data);\n  }\n\n  /**\n   * Makes sure a response actually is a DataLinkResponse\n   *\n   * @param   dl datalink packet/response\n   * @returns DataLinkResponse after checking instanceof\n   * @throws Error if not a DataLinkResponse\n   */\n  ensureDataLinkResponse(dl: DataLinkResponse | DataLinkPacket): DataLinkResponse {\n    if (dl instanceof DataLinkResponse) {\n      return dl;\n    }\n    throw new Error(`Expected DataLinkResponse but got ${dl.header}`);\n  }\n\n  /**\n   * Makes sure a response actually is a DataLinkPacket\n   *\n   * @param   dl datalink packet/response\n   * @returns DataLinkPacket after checking instanceof\n   * @throws Error if not a DataLinkPacket\n   */\n  ensureDataLinkPacket(dl: DataLinkResponse | DataLinkPacket): DataLinkPacket {\n    if (dl instanceof DataLinkPacket) {\n      return dl;\n    }\n    throw new Error(`Expected DataLinkPacket but got ${dl.type}`);\n  }\n\n  /**\n   * Send id and await server's response. All of these are can more or less\n   * be filled with dummy values. They are mostly used for logging and debugging\n   * on the server side.\n   *\n   * @param programname name of program, ex seisplotjs\n   * @param username name of user, ex browser\n   * @param processid process number, used to differentiate between multiple running instances\n   * @param architecture cpu architecture, ex javascript\n   * @returns promise to servers response\n   */\n  id(programname: string, username: string, processid: string, architecture: string): Promise<DataLinkResponse> {\n    let command = `ID ${programname}:${username}:${processid}:${architecture}`;\n    return this.awaitDLCommand(command).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Send info command for infoType.\n   *\n   * @param infoType type to get info for\n   * @returns promise to server's response\n   */\n  info(infoType: string): Promise<DataLinkResponse> {\n    let command = `INFO ${infoType}`;\n    return this.awaitDLCommand(command).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Send position after command.\n   *\n   * @param time time to position after\n   * @returns promise to server's response\n   */\n  positionAfter(time: moment): Promise<DataLinkResponse> {\n    return this.positionAfterHPTime(momentToHPTime(time)).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Send position after command.\n   *\n   * @param hpTime time to position after\n   * @returns promise to server's response\n   */\n  positionAfterHPTime(hpTime: number): Promise<DataLinkResponse> {\n    let command = `POSITION AFTER ${hpTime}`;\n    return this.awaitDLCommand(command).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Send match command.\n   *\n   * @param pattern regular expression to match streams\n   * @returns promise to server's response\n   */\n  match(pattern: string): Promise<DataLinkResponse> {\n    let command = `MATCH`;\n    return this.awaitDLCommand(command, pattern).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Send reject command.\n   *\n   * @param pattern regular expression to reject streams\n   * @returns promise to server's response\n   */\n  reject(pattern: string): Promise<DataLinkResponse> {\n    let command = `REJECT ${pattern}`;\n    return this.awaitDLCommand(command).then(this.ensureDataLinkResponse);\n  }\n\n  /**\n   * Read a single packet for the given id.\n   *\n   * @param packetId id of the packet of interest\n   * @returns promise to server's response\n   */\n  read(packetId: string): Promise<DataLinkPacket> {\n    let command = `READ ${packetId}`;\n    return this.awaitDLBinary(command).then(this.ensureDataLinkPacket);\n  }\n\n  /**\n   * Handles a web socket message from the data link connection.\n   *\n   * @private\n   * @param wsEvent web socket event to handle\n   */\n  handle(wsEvent: MessageEvent ): void {\n    const rawData: ArrayBuffer = ((wsEvent.data: any): ArrayBuffer);\n    let dlPreHeader = new DataView(rawData, 0, 3);\n    if ('D' === String.fromCharCode(dlPreHeader.getUint8(0))\n        && 'L' === String.fromCharCode(dlPreHeader.getUint8(1))) {\n      const headerLen = dlPreHeader.getUint8(2);\n      const header = dataViewToString(new DataView(rawData, 3, headerLen));\n      if (header.startsWith(PACKET)) {\n        let packet = new DataLinkPacket(header,\n                new DataView(rawData, 3+headerLen));\n        if (this.packetHandler) {\n          try {\n            this.packetHandler(packet);\n          } catch (e) {\n            this.errorHandler(e);\n          }\n        } else {\n          this.errorHandler(new Error(\"packetHandler not defined\"));\n        }\n      } else {\n        let dv;\n        if (rawData.byteLength > 3+headerLen) {\n          dv = new DataView(rawData, 3+headerLen);\n        }\n        const dlResponse = DataLinkResponse.parse(header, dv);\n        if (dlResponse.type === 'ERROR') {\n          this.handleError(new Error(`value=${dlResponse.value} ${dlResponse.message}`));\n        } else {\n          if (this._responseResolve) {\n            this._responseResolve(dlResponse);\n          } else {\n            defaultHandleResponse(header);\n          }\n        }\n      }\n    } else {\n      throw new Error(\"DataLink Packet did not start with DL\");\n    }\n  }\n\n  /**\n   * handle errors that arise\n   *\n   * @private\n   * @param   error the error\n   */\n  handleError(error: Error): void {\n    if (this._responseReject) {\n      this._responseReject(error);\n    }\n    if (this.errorHandler) {\n      this.errorHandler(error);\n    } else {\n      util.log(\"datalink handleError: \"+error.message);\n    }\n  }\n}\n\n/**\n * Datalink response, used for ID, INFO, OK and ERROR responses.\n */\nexport class DataLinkResponse {\n  type: string;\n  value: string;\n  message: string;\n  constructor(type: string, value: string, message: string) {\n    this.type = type;\n    this.value = value;\n    this.message = message;\n  }\n  toString(): string {\n    return `${this.type} ${this.value} | ${this.message}`;\n  }\n  static parse(header: string, data?: DataView): DataLinkResponse {\n    let value = \"\";\n    let s = header.split(' ');\n    let type = s[0];\n    let message = '';\n    if (type === 'ID') {\n      message = ''+header.substring(3);\n    } else if (type === 'INFO' || type === 'OK' || type === 'ERROR') {\n      value = s[1];\n      if (data) {\n        message = dataViewToString(new DataView(data.buffer, 3+header.length));\n      }\n    } else {\n      util.log(`unknown DataLink response type: ${type}  ${header}`);\n      message = header.substring(type.length+1);\n    }\n    return new DataLinkResponse(type, value, message);\n  }\n}\n\n/**\n * Represents a Datalink packet from the ringserver.\n * Note this cannot connect directly to a native TCP socket, instead it\n * sends the datalink protocol over a websocket. Currently only the IRIS\n * ringserver supports websockets, but it may be possible to use thrid party\n * tools to proxy the websocket to a TCP datalink socket.\n *\n */\nexport class DataLinkPacket {\n  header: string;\n  data: DataView;\n  streamId: string;\n  pktid: string;\n  hppackettime: string;\n  hppacketstart: string;\n  hppacketend: string;\n  dataSize: number;\n  _miniseed: null | miniseed.DataRecord;\n  constructor(header: string, dataview: DataView) {\n    this._miniseed = null;\n    this.header = header;\n    this.data = dataview;\n    let split = this.header.split(' ');\n    this.streamId = split[1];\n    this.pktid = split[2];\n    this.hppackettime = split[3];\n    this.hppacketstart = split[4];\n    this.hppacketend = split[5];\n    this.dataSize = Number.parseInt(split[6]);\n    if (dataview.byteLength < this.dataSize) {\n      throw new Error(\"not enough bytes in dataview for packet: \"+this.dataSize);\n    }\n  }\n  /**\n   * Packet start time as a moment.\n   *\n   * @returns start time\n   */\n  get packetStart(): moment {\n    return hpTimeToMoment(parseInt(this.hppacketstart));\n  }\n  /**\n   * Packet end time as a moment.\n   *\n   * @returns end time\n   */\n  get packetEnd(): moment {\n    return hpTimeToMoment(parseInt(this.hppacketend));\n  }\n  /**\n   * Packet time as a moment.\n   *\n   * @returns packet time\n   */\n  get packetTime(): moment {\n    return hpTimeToMoment(parseInt(this.hppackettime));\n  }\n  /**\n   * is this packet a miniseed packet\n   *\n   * @returns          true if it is miniseed\n   */\n  isMiniseed(): boolean {\n    return isDef(this._miniseed) || this.streamId.endsWith(MSEED_TYPE);\n  }\n  /**\n   * Parsed payload as a miniseed data record, if the streamid\n   * ends with '/MSEED', null otherwise.\n   *\n   * @returns miniseed DataRecord or null\n   */\n  get miniseed() {\n    if ( ! isDef(this._miniseed) ) {\n      if (this.streamId.endsWith(MSEED_TYPE)) {\n        this._miniseed = miniseed.parseSingleDataRecord(this.data);\n      } else {\n        this._miniseed = null;\n      }\n    }\n    return this._miniseed;\n  }\n}\n\n/**\n * Convert moment to a HPTime number.\n *\n * @param   m moment to convert\n * @returns  microseconds since epoch\n */\n  export function momentToHPTime(m: moment): number {\n    return m.valueOf()*1000;\n  }\n  /**\n   * Convert hptime number to a moment.\n   *\n   * @param   hptime hptime to convert\n   * @returns  moment in utc for the hptime\n   */\n  export function hpTimeToMoment(hptime: number): moment {\n    return moment.utc(hptime/1000);\n  }\n\n  /**\n   * Encode string into a Uint8Array.\n   *\n   * @param   dataString String to encode.\n   * @returns             String as bytes in Uint8Array.\n   */\n  export function stringToUint8Array(dataString?: string): Uint8Array | void {\n    let binaryData = undefined;\n    if (isNonEmptyStringArg(dataString)) {\n      binaryData = new Uint8Array(dataString.length);\n      for (let i=0; i<dataString.length;i++) {\n        binaryData[i] = dataString.charCodeAt(i);\n      }\n    }\n    return binaryData;\n  }\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport Pikaday from 'pikaday';\n\nimport moment from 'moment';\nimport * as d3 from 'd3';\n\nimport {insertCSS} from './cssutil.js';\n\nimport {StartEndDuration} from './util.js';\n\n/**\n * Hour and Minute chooser using sliders.\n *\n * @param div selected div to append chooser to\n * @param initialTime initial chooser time value\n * @param updateCallback optional callback function when time is selected\n */\nexport class HourMinChooser {\n\n  div: any; // d3 not yet in flow-typed :(\n  time: moment;\n  updateCallback: ( time: moment) => void;\n  hourMinRegEx: RegExp;\n  myOnClick: (event: Event) => void;\n  hourMinField: any; // d3 not yet in flow-typed :(\n  popupDiv: any; // d3 not yet in flow-typed :(\n  hourDiv: any; // d3 not yet in flow-typed :(\n  hourSlider: any; // d3 not yet in flow-typed :(\n  minuteDiv: any; // d3 not yet in flow-typed :(\n  minuteSlider: any; // d3 not yet in flow-typed :(\n  constructor(div: any, initialTime: moment, updateCallback?: ( time: moment) => void) {\n    let mythis = this;\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.time = moment.utc(initialTime);\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    this.hourMinRegEx = /^([0-1]?[0-9]):([0-5]?[0-9])$/;\n    this.myOnClick = function(e) {\n      // click document outside popup closes popup\n      // not sure this if matters???\n          if (e.target !== mythis.hourMinField && e.target !== mythis.popupDiv) {\n            mythis.hide();\n          }\n    };\n    this.hourMinField = this.div.append(\"input\")\n      .classed(\"pikatime\", true)\n      .attr(\"value\", this.time.format('HH:mm'))\n      .attr(\"type\", \"text\")\n      .on(\"click\", function() {\n        mythis.showHide();\n        // don't propagate click up to document\n        d3.event.stopPropagation();\n      })\n      .on(\"change\", function() {\n        let match = mythis.hourMinRegEx.exec(mythis.hourMinField.property(\"value\"));\n        if (match) {\n          mythis.hourMinField.style(\"background-color\", null);\n          let h = match[1];\n          let m = match[2];\n          mythis.time.hours(h);\n          mythis.time.minutes(m);\n          mythis.popupDiv.style(\"visibility\", \"hidden\");\n          mythis.timeModified();\n        } else {\n          mythis.hourMinField.property(\"value\", mythis.time.format('HH:mm'));\n        }\n\n      });\n    this.div.append(\"span\").classed(\"utclabel\", true).text(\"UTC\");\n    this.popupDiv = this.div.append(\"div\")\n      .classed(\"hourminpopup\", true)\n      .style(\"position\", \"absolute\")\n      .style(\"visibility\", \"hidden\")\n      .on(\"click\", function() {\n        // don't propagate click up to document\n        d3.event.stopPropagation();\n      });\n    this.hourDiv = this.popupDiv.append(\"div\").classed(\"hour\", true);\n    this.hourSlider = this.hourDiv.append(\"label\").text(\"Hour:\").append(\"input\");\n    this.hourSlider.attr(\"type\", \"range\")\n      .attr(\"min\",\"0\")\n      .attr(\"max\", \"23\")\n      .classed(\"hourSlider\", true)\n      .on(\"input\", function() {\n        let nHour = +this.value;\n        if (mythis.time.hours() !== nHour) {\n          mythis.time.hours(nHour);\n          mythis.hourSlider.property(\"value\", nHour);\n          mythis.timeModified();\n        }\n      });\n    this.hourSlider.attr(\"value\", this.time.hour());\n    this.minuteDiv = this.popupDiv.append(\"div\").classed(\"minute\", true);\n    this.minuteSlider = this.minuteDiv.append(\"label\").text(\"Minute:\").append(\"input\");\n    this.minuteSlider.attr(\"type\", \"range\")\n      .attr(\"min\",\"0\")\n      .attr(\"max\", \"59\")\n      .classed(\"minuteSlider\", true)\n      .on(\"input\", function() {\n        let nMinute = +this.value;\n        if (mythis.time.minutes() !== nMinute) {\n          mythis.time.minutes(nMinute);\n          mythis.minuteSlider.property(\"value\", nMinute);\n          mythis.timeModified();\n        }\n      });\n    this.minuteSlider.attr(\"value\", this.time.minute());\n  }\n  /**\n   * Updates the time without triggering the callback function.\n   *\n   * @param  newTime new time to update sliders\n   */\n  updateTime(newTime: moment): void {\n    this.time = newTime;\n    this.hourMinField.property(\"value\", this.time.format('HH:mm'));\n    this.hourSlider.property(\"value\", this.time.hour());\n    this.minuteSlider.property(\"value\", this.time.minute());\n  }\n  /**\n   * Updates the sliders based on this.time and triggers the callback function.\n   */\n  timeModified(): void {\n    this.hourSlider.property(\"value\", this.time.hour());\n    this.minuteSlider.property(\"value\", this.time.minute());\n    this.hourMinField.property(\"value\", this.time.format('HH:mm'));\n    this.updateCallback(this.time);\n  }\n  /**\n   * Shows or hides the popup based on current visibility style\n   */\n  showHide(): void {\n    if (this.popupDiv.style(\"visibility\") === \"hidden\") {\n      this.popupDiv.style(\"visibility\", \"visible\")\n        .classed(\"is-bound\", true);\n      this._adjustPopupPosition();\n      window.document.addEventListener(\"click\", this.myOnClick, false);\n    } else {\n      this.popupDiv.style(\"visibility\", \"hidden\");\n      window.document.removeEventListener(\"click\", this.myOnClick);\n    }\n  }\n  /**\n   * Hides the popup with sliders.\n   */\n  hide(): void {\n    this.popupDiv.style(\"visibility\", \"hidden\")\n      .classed(\"is-bound\", false);\n    window.document.removeEventListener(\"click\", this.myOnClick);\n  }\n  /** @private */\n  _adjustPopupPosition(): void {\n\n      let field = this.hourMinField.node();\n      let width = this.hourMinField.offsetWidth;\n      let height = this.hourMinField.offsetHeight;\n      let viewportWidth: number = window.innerWidth;\n      let viewportHeight: number = window.innerHeight;\n      let scrollTop: number = window.pageYOffset;\n      let left = field.offsetLeft;\n      let top  = field.offsetTop + field.offsetHeight;\n      while((field = field.offsetParent)) {\n          left += field.offsetLeft;\n          top  += field.offsetTop;\n      }\n\n\n      // default position is bottom & left\n      if ((left + width > viewportWidth)) {\n          left = left - width + field.offsetWidth;\n      }\n      if ((top + height > viewportHeight + scrollTop)) {\n          top = top - height - field.offsetHeight;\n      }\n      this.popupDiv.style(\"left\", left + 'px');\n      this.popupDiv.style(\"top\", top + 'px');\n  }\n}\n\n/**\n * Date and Time chooser using pikaday for the date and the above\n * HourMinChooser for the hour and minute of time.\n *\n * @param div selected div to append chooser to\n * @param label label for chooser\n * @param initialTime initial chooser time value\n * @param updateCallback optional callback function when time is selected\n */\nexport class DateTimeChooser {\n  div: any; // d3 not yet in flow-typed :(\n  time: moment;\n  updateCallback: ( time: moment) => void;\n  label: string;\n  dateField: any;\n  picker: Pikaday;\n  hourMin: HourMinChooser;\n  constructor(div: any, label: string, initialTime: moment, updateCallback?: ( time: moment) => void) {\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.label = label;\n    this.time = moment.utc(initialTime);\n    this.time.second(0).millisecond(0); // only hour and min?\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    this.dateField = div.append(\"label\").text(this.label).append(\"input\")\n      .classed(\"pikaday\", true)\n      .attr(\"value\", this.time.toISOString())\n      .attr(\"type\", \"text\")\n      .on(\"click\", function() {\n        if (mythis.picker.isVisible()) {\n          mythis.picker.hide();\n        }\n      });\n    let mythis = this;\n    this.picker = new Pikaday({ field: this.dateField.node(),\n                              //  trigger: inputField.node(),\n                                format: \"YYYY-MM-DD\",\n                                onSelect: function() {\n                                  let pikaValue = this.getMoment();\n                                  let origTime = moment.utc(mythis.time);\n                                  if (origTime.year() !== pikaValue.year() || origTime.dayOfYear() !== pikaValue.dayOfYear()) {\n                                    mythis.time.year(pikaValue.year());\n                                    mythis.time.dayOfYear(pikaValue.dayOfYear());\n                                    mythis.timeModified();\n                                  }\n                                }\n                            });\n    this._internalSetTime(this.time);\n    this.hourMin = new HourMinChooser(div, this.time, function(time) {\n      mythis._internalSetTime(time);\n      mythis.timeModified();\n    });\n  }\n  /**\n   * Updates the time without triggering the callback function.\n   *\n   * @param  newTime new time to update sliders\n   */\n  updateTime(newTime: moment): void {\n    this._internalSetTime(newTime);\n    this.hourMin.updateTime(newTime);\n  }\n  /**\n   * triggers the callback function.\n   */\n  timeModified(): void {\n    this.updateCallback(this.time);\n  }\n  getTime(): moment {\n    return this.time;\n  }\n\n  /**\n   * internal time set\n   *\n   * @private\n   * @param  newTime new time to update\n   */\n  _internalSetTime(newTime: moment): void {\n    this.time = moment.utc(newTime);\n    this.dateField.attr(\"value\", this.time.toISOString());\n    // re-moment to avoid utc issue, using utc messes up picker, so pretend\n    this.picker.setMoment(moment([this.time.year(), this.time.month(), this.time.date()]));\n  }\n}\n\n/**\n * Combination of two DateTimeChoosers to specify a start and end time.\n *\n * @param div selected div to append chooser to\n * @param updateCallback optional callback function when time is selected/changed\n */\nexport class TimeRangeChooser {\n  div: any;\n  updateCallback: (timerange: StartEndDuration) => void;\n  duration: number;\n  startChooser: DateTimeChooser;\n  endChooser: DateTimeChooser;\n  _mostRecentChanged: string;\n  constructor(div: any, updateCallback?: (timerange: StartEndDuration) => void) {\n    this._mostRecentChanged = 'start';\n    this.updateCallback = updateCallback ? updateCallback : dummyCallback;\n    let endTime = moment.utc();\n    this.duration = 300;\n    let startTime = moment.utc(endTime).subtract(this.duration, 'second');\n    if (typeof div === 'string') {\n      this.div = d3.select(div);\n    } else {\n      this.div = div;\n    }\n    this.div.classed(\"timeRangeChooser\", true);\n    let mythis = this;\n    let startDiv = this.div.append(\"span\").classed(\"start\", true);\n    this.startChooser = new DateTimeChooser(startDiv, \"Start:\", startTime, function(startTime) {\n      mythis.endChooser.updateTime(moment.utc(startTime).add(mythis.duration, 'seconds'));\n      mythis.updateCallback(mythis.getTimeRange());\n      mythis._mostRecentChanged = 'start';\n    });\n\n    let durationDiv = this.div.append(\"span\").classed(\"duration\", true);\n    durationDiv.append(\"label\").text(\"Duration:\").append(\"input\")\n      .classed(\"pikatime\", true)\n      .attr(\"value\", this.duration)\n      .attr(\"type\", \"text\")\n      .on(\"input\", function() {\n        let nDur = +Number.parseInt(this.value);\n        mythis.duration = nDur;\n        if (mythis._mostRecentChanged === 'end') {\n          mythis.startChooser.updateTime(moment.utc(mythis.endChooser.getTime()).subtract(mythis.duration, 'seconds'));\n          mythis.updateCallback(mythis.getTimeRange());\n        } else {\n          // change end\n          mythis.endChooser.updateTime(moment.utc(mythis.startChooser.getTime()).add(mythis.duration, 'seconds'));\n          mythis.updateCallback(mythis.getTimeRange());\n        }\n      });\n\n    let endDiv = this.div.append(\"span\").classed(\"end\", true);\n    this.endChooser = new DateTimeChooser(endDiv, \"End:\", endTime, function(endTime) {\n      mythis.startChooser.updateTime(moment.utc(endTime).subtract(mythis.duration, 'seconds'));\n      mythis.updateCallback(mythis.getTimeRange());\n      mythis._mostRecentChanged = 'end';\n    });\n  }\n  getTimeRange(): StartEndDuration {\n    return new StartEndDuration(this.startChooser.getTime(),\n                                this.endChooser.getTime());\n  }\n}\n\n/**\n * Dummy callback function for cases where user doesn't need this. Mainly here\n * to keep eslint happy.\n *\n * @param   t new time/time range, not used\n */\n// eslint-disable-next-line no-unused-vars\nfunction dummyCallback(t) { }\n\n/**\n * CSS for the parts of HourMin, DateTime and TimeRange choosers\n * that are not using pikaday.\n */\nexport const chooser_css = `\n\ndiv.timeRangeChooser .utclabel {\n  font-size: smaller;\n}\n\ndiv.timeRangeChooser span div.hourminpopup {\n    z-index: 9999;\n    display: block;\n    position: relative;\n    color: #333;\n    background-color: white;\n    border: 1px solid #ccc;\n    border-bottom-color: #bbb;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n}\n\n\n\n.hourminpopup.is-hidden {\n    display: none;\n}\n.hourminpopup.is-bound {\n    position: absolute;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n    background-color: white;\n}\n\ndiv.hourminpopup div label {\n  display: block;\n  float: right;\n}\ndiv.hourminpopup div {\n    display: block;\n    float: right;\n    clear: both;\n}\n\ndiv.hourminpopup input {\n    width: 150px;\n}\n\ndiv.timeRangeChooser span {\n  margin: 2px;\n  margin-right: 5px;\n}\n\ninput.pikaday {\n  width: 70px;\n}\ninput.pikatime {\n  width: 50px;\n}\n\n`;\n\n\n/**\n * CSS for the pikaday chooser.\n */\nexport const pikaday_css = `\n@charset \"UTF-8\";\n\n/*!\n * Pikaday\n * Copyright © 2014 David Bushell | BSD & MIT license | http://dbushell.com/\n */\n\n.pika-single {\n    z-index: 9999;\n    display: block;\n    position: relative;\n    color: #333;\n    background: #fff;\n    border: 1px solid #ccc;\n    border-bottom-color: #bbb;\n    font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n}\n\n/*\nclear child float (pika-lendar), using the famous micro clearfix hack\nhttp://nicolasgallagher.com/micro-clearfix-hack/\n*/\n.pika-single:before,\n.pika-single:after {\n    content: \" \";\n    display: table;\n}\n.pika-single:after { clear: both }\n\n.pika-single.is-hidden {\n    display: none;\n}\n\n.pika-single.is-bound {\n    position: absolute;\n    box-shadow: 0 5px 15px -5px rgba(0,0,0,.5);\n}\n\n.pika-lendar {\n    float: left;\n    width: 240px;\n    margin: 8px;\n}\n\n.pika-title {\n    position: relative;\n    text-align: center;\n}\n\n.pika-label {\n    display: inline-block;\n    position: relative;\n    z-index: 9999;\n    overflow: hidden;\n    margin: 0;\n    padding: 5px 3px;\n    font-size: 14px;\n    line-height: 20px;\n    font-weight: bold;\n    background-color: #fff;\n}\n.pika-title select {\n    cursor: pointer;\n    position: absolute;\n    z-index: 9998;\n    margin: 0;\n    left: 0;\n    top: 5px;\n    opacity: 0;\n}\n\n.pika-prev,\n.pika-next {\n    display: block;\n    cursor: pointer;\n    position: relative;\n    outline: none;\n    border: 0;\n    padding: 0;\n    width: 20px;\n    height: 30px;\n    /* hide text using text-indent trick, using width value (it's enough) */\n    text-indent: 20px;\n    white-space: nowrap;\n    overflow: hidden;\n    background-color: transparent;\n    background-position: center center;\n    background-repeat: no-repeat;\n    background-size: 75% 75%;\n    opacity: .5;\n}\n\n.pika-prev:hover,\n.pika-next:hover {\n    opacity: 1;\n}\n\n.pika-prev,\n.is-rtl .pika-next {\n    float: left;\n    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj+OD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8+AqBIl6kKgHiXqQqAeJepBo/z38J/U0uAHlaBkBl9I4GwAAAABJRU5ErkJggg==');\n}\n\n.pika-next,\n.is-rtl .pika-prev {\n    float: right;\n    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO+BJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII=');\n}\n\n.pika-prev.is-disabled,\n.pika-next.is-disabled {\n    cursor: default;\n    opacity: .2;\n}\n\n.pika-select {\n    display: inline-block;\n}\n\n.pika-table {\n    width: 100%;\n    border-collapse: collapse;\n    border-spacing: 0;\n    border: 0;\n}\n\n.pika-table th,\n.pika-table td {\n    width: 14.285714285714286%;\n    padding: 0;\n}\n\n.pika-table th {\n    color: #999;\n    font-size: 12px;\n    line-height: 25px;\n    font-weight: bold;\n    text-align: center;\n}\n\n.pika-button {\n    cursor: pointer;\n    display: block;\n    box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    outline: none;\n    border: 0;\n    margin: 0;\n    width: 100%;\n    padding: 5px;\n    color: #666;\n    font-size: 12px;\n    line-height: 15px;\n    text-align: right;\n    background: #f5f5f5;\n}\n\n.pika-week {\n    font-size: 11px;\n    color: #999;\n}\n\n.is-today .pika-button {\n    color: #33aaff;\n    font-weight: bold;\n}\n\n.is-selected .pika-button,\n.has-event .pika-button {\n    color: #fff;\n    font-weight: bold;\n    background: #33aaff;\n    box-shadow: inset 0 1px 3px #178fe5;\n    border-radius: 3px;\n}\n\n.has-event .pika-button {\n    background: #005da9;\n    box-shadow: inset 0 1px 3px #0076c9;\n}\n\n.is-disabled .pika-button,\n.is-inrange .pika-button {\n    background: #D5E9F7;\n}\n\n.is-startrange .pika-button {\n    color: #fff;\n    background: #6CB31D;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n.is-endrange .pika-button {\n    color: #fff;\n    background: #33aaff;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n.is-disabled .pika-button {\n    pointer-events: none;\n    cursor: default;\n    color: #999;\n    opacity: .3;\n}\n\n.is-outside-current-month .pika-button {\n    color: #999;\n    opacity: .3;\n}\n\n.is-selection-disabled {\n    pointer-events: none;\n    cursor: default;\n}\n\n.pika-button:hover,\n.pika-row.pick-whole-week:hover .pika-button {\n    color: #fff;\n    background: #ff8000;\n    box-shadow: none;\n    border-radius: 3px;\n}\n\n/* styling for abbr */\n.pika-table abbr {\n    border-bottom: none;\n    cursor: help;\n}\n\n`;\n\n\nif (document){\n  insertCSS(chooser_css);\n  insertCSS(pikaday_css);\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n/** const for kilometers per degree on the earth, 111.19 */\nexport const kmPerDeg = 111.19;\n\n/**\n * Convert degrees into kilometers along the earth surface\n *\n * @param deg degrees to convert\n * @returns kilometers\n */\nexport function degtokm(deg: number): number {\n  return deg * kmPerDeg;\n}\n\n/**\n * Convert kilometers into degrees along the earth surface\n *\n * @param km kilometers to convert\n * @returns degrees\n */\nexport function kmtodeg(km: number): number {\n  return km / kmPerDeg;\n}\n\ntype DistAzOutput = {\n  delta: number,\n  az: number,\n  baz: number\n}\n\n/**\n *\n * Returns a simple object (DistAzOutput) with:\n *```\n *     delta       => Great Circle Arc distance in degrees\n *     az          => Azimuth of pt. 1 wrt pt. 2 in degrees\n *     baz         => Azimuth of pt. 2 wrt pt. 1 in degrees\n *```\n *\n * azimuth is if you stand at point 2 and measure angle between north\n *   and point 1. I.E. point 1 is the station and point 2 is the event.\n *\n * @param lat1 Latitude of first point (station) (+N, -S) in degrees\n * @param lon1 Longitude of first point(station) (+E, -W) in degrees\n * @param lat2 Latitude of second point (event)\n * @param lon2 Longitude of second point (event)\n * @returns delta, az, baz in a DistAzOutput\n */\nexport function distaz(lat1: number, lon1: number, lat2: number, lon2: number): DistAzOutput {\n    let result = {\n        stalat: lat1,\n        stalon: lon1,\n        evtlat: lat2,\n        evtlon: lon2,\n        delta: 0.0,\n        az: 0.0,\n        baz: 0.0\n    };\n\n    if ((lat1 === lat2)&&(lon1 === lon2)) {\n        // don't do calc, just return zero for idential points\n        result.delta = 0;\n        result.az = 0;\n        result.baz = 0;\n        return result;\n    }\n    let scolat, slon, ecolat, elon;\n    let a,b,c,d,e,aa,bb,cc,dd,ee,g,gg,h,hh,k,kk;\n    let rhs1,rhs2,sph,rad,del,daz,dbaz;\n\n    rad=2.*Math.PI/360.0;\n    /*\n     *\n     * scolat and ecolat are the geocentric colatitudes\n     * as defined by Richter (pg. 318)\n     *\n     * Earth Flattening of 1/298.257 take from Bott (pg. 3)\n     *\n     */\n    sph=1.0/298.257;\n\n    scolat=Math.PI/2.0 - Math.atan((1.-sph)*(1.-sph)*Math.tan(lat1*rad));\n    ecolat=Math.PI/2.0 - Math.atan((1.-sph)*(1.-sph)*Math.tan(lat2*rad));\n    slon=lon1*rad;\n    elon=lon2*rad;\n    /*\n     *\n     *  a - e are as defined by Bullen (pg. 154, Sec 10.2)\n     *     These are defined for the pt. 1\n     *\n     */\n    a=Math.sin(scolat)*Math.cos(slon);\n    b=Math.sin(scolat)*Math.sin(slon);\n    c=Math.cos(scolat);\n    d=Math.sin(slon);\n    e=-Math.cos(slon);\n    g=-c*e;\n    h=c*d;\n    k=-Math.sin(scolat);\n    /*\n     *\n     *  aa - ee are the same as a - e, except for pt. 2\n     *\n     */\n    aa=Math.sin(ecolat)*Math.cos(elon);\n    bb=Math.sin(ecolat)*Math.sin(elon);\n    cc=Math.cos(ecolat);\n    dd=Math.sin(elon);\n    ee=-Math.cos(elon);\n    gg=-cc*ee;\n    hh=cc*dd;\n    kk=-Math.sin(ecolat);\n    /*\n     *\n     *  Bullen, Sec 10.2, eqn. 4\n     *\n     */\n    del=Math.acos(a*aa + b*bb + c*cc);\n    result.delta=del/rad;\n    /*\n     *\n     *  Bullen, Sec 10.2, eqn 7 / eqn 8\n     *\n     *    pt. 1 is unprimed, so this is technically the baz\n     *\n     *  Calculate baz this way to avoid quadrant problems\n     *\n     */\n    rhs1=(aa-d)*(aa-d)+(bb-e)*(bb-e)+cc*cc - 2.;\n    rhs2=(aa-g)*(aa-g)+(bb-h)*(bb-h)+(cc-k)*(cc-k) - 2.;\n    dbaz=Math.atan2(rhs1,rhs2);\n    if (dbaz<0.0) {\n        dbaz=dbaz+2*Math.PI;\n    }\n    result.baz=dbaz/rad;\n    /*\n     *\n     *  Bullen, Sec 10.2, eqn 7 / eqn 8\n     *\n     *    pt. 2 is unprimed, so this is technically the az\n     *\n     */\n    rhs1=(a-dd)*(a-dd)+(b-ee)*(b-ee)+c*c - 2.;\n    rhs2=(a-gg)*(a-gg)+(b-hh)*(b-hh)+(c-kk)*(c-kk) - 2.;\n    daz=Math.atan2(rhs1,rhs2);\n    if(daz<0.0) {\n        daz=daz+2*Math.PI;\n    }\n    result.az=daz/rad;\n    /*\n     *\n     *   Make sure 0.0 is always 0.0, not 360.\n     *\n     */\n    if(Math.abs(result.baz-360.) < .00001) result.baz=0.0;\n    if(Math.abs(result.az-360.) < .00001) result.az=0.0;\n    return result;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport RSVP from 'rsvp';\n\n// special due to flow\nimport {checkProtocol, toIsoWoZ, isDef, hasArgs, hasNoArgs, isStringArg,\n        isNonEmptyStringArg, isNumArg, checkStringOrDate, stringify} from './util';\n\nimport {SeismogramDisplayData } from './seismogram.js';\nimport { TEXT_MIME, JSON_MIME, StartEndDuration, makeParam, doFetchWithTimeout, defaultFetchInitObj} from './util.js';\nimport {Network, Station, Channel} from './stationxml.js';\n\n/** const for json format, json */\nexport const FORMAT_JSON = 'json';\n/** const for text format, text */\nexport const FORMAT_TEXT = 'text';\n/** const for geocsv format, geocsv */\nexport const FORMAT_GEOCSV = 'geocsv';\n/** const for request format, request */\nexport const FORMAT_REQUEST = 'request';\n\n/** const of completely empty json, {} */\nexport const EMPTY_JSON = JSON.parse('{}');\n\n/**\n * Major version of the FDSN spec supported here.\n * Currently is 1.\n */\nexport const SERVICE_VERSION = 1;\n/**\n * Service name as used in the FDSN DataCenters registry,\n * http://www.fdsn.org/datacenters\n */\nexport const SERVICE_NAME = `fdsnws-availability-${SERVICE_VERSION}`;\n\nexport const IRIS_HOST = \"service.iris.edu\";\n\n/**\n * Query to a FDSN Availability web service.\n *\n * @see http://www.fdsn.org/webservices/\n *\n * @param host optional host to connect to, defaults to IRIS\n */\nexport class AvailabilityQuery {\n  /** @private */\n  _specVersion: number;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _port: number;\n  /** @private */\n  _networkCode: string;\n  /** @private */\n  _stationCode: string;\n  /** @private */\n  _locationCode: string;\n  /** @private */\n  _channelCode: string;\n  /** @private */\n  _startTime: moment;\n  /** @private */\n  _endTime: moment;\n  /** @private */\n  _quality: string;\n  /** @private */\n  _merge: string;\n  /** @private */\n  _show: string;\n  /** @private */\n  _mergeGaps: number;\n  /** @private */\n  _limit: number;\n  /** @private */\n  _orderby: string;\n  /** @private */\n  _includerestricted: boolean;\n  /** @private */\n  _format: string;\n  /** @private */\n  _timeoutSec: number;\n  constructor(host?: string) {\n    this._specVersion = 1;\n    this._protocol = checkProtocol();\n    if (isNonEmptyStringArg(host)) {\n      this._host = host;\n    } else {\n      this._host = IRIS_HOST;\n    }\n    this._port = 80;\n    this._timeoutSec = 30;\n  }\n  /**\n   * Gets/Sets the version of the fdsnws spec, 1 is currently the only value.\n   *  Setting this is probably a bad idea as the code may not be compatible with\n   *  the web service.\n   *\n   * @param value spec version, usually 1\n   * @returns the query when setting, the current value when no argument\n   */\n  specVersion(value?: number): number | AvailabilityQuery {\n    if (hasArgs(value)) {\n      this._specVersion = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._specVersion;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the protocol, http or https. This should match the protocol\n   *  of the page loaded, but is autocalculated and generally need not be set.\n   *\n   * @param value protocol, usually http or https\n   * @returns the query when setting, the current value when no argument\n   */\n  protocol(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._protocol = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._protocol;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the remote host to connect to.\n   *\n   * @param value host\n   * @returns the query when setting, the current value when no argument\n   */\n  host(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the nodata parameter, usually 404 or 204 (default), controlling\n   * the status code when no matching data is found by the service.\n   *\n   * @param value number for nodata, usually 404 or 204\n   * @returns the query when setting, the current value when no argument\n   */\n  nodata(value?: number): number | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._nodata;\n    } else if (hasArgs(value)) {\n      this._nodata = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the port, not usually set unless not on standard http or https ports\n   *\n   * @param value port\n   * @returns the query when setting, the current value when no argument\n   */\n  port(value?: number): number | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (hasArgs(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the network code to check.\n   *\n   * @param value network code like IU\n   * @returns the query when setting, the current value when no argument\n   */\n  networkCode(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._networkCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._networkCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the station code to check.\n   *\n   * @param value station code like ANMO\n   * @returns the query when setting, the current value when no argument\n   */\n  stationCode(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._stationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._stationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the location code to check.\n   *\n   * @param value location code like 00\n   * @returns the query when setting, the current value when no argument\n   */\n  locationCode(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._locationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._locationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the channel code to check.\n   *\n   * @param value channel code like BHZ\n   * @returns the query when setting, the current value when no argument\n   */\n  channelCode(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._channelCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._channelCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the start time parameter for the query.\n   *\n   * @param value start time\n   * @returns the query when setting, the current value when no argument\n   */\n  startTime(value?: moment): moment | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._startTime;\n    } else if (hasArgs(value)) {\n      this._startTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the end time parameter for the query.\n   *\n   * @param value end time\n   * @returns the query when setting, the current value when no argument\n   */\n  endTime(value?: moment): moment | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._endTime;\n    } else if (hasArgs(value)) {\n      this._endTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Sets startTime and endTime using the given time window\n   *\n   * @param   se time window\n   * @returns    the query\n   */\n  timeWindow(se: StartEndDuration): AvailabilityQuery {\n    this.startTime(se.startTime);\n    this.endTime(se.endTime);\n    return this;\n  }\n  /**\n   * Gets/Sets the quality parameter for the query.\n   *\n   * @param value quality\n   * @returns the query when setting, the current value when no argument\n   */\n  quality(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._quality = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._quality;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the merge parameter for the query.\n   *\n   * @param value merge\n   * @returns the query when setting, the current value when no argument\n   */\n  merge(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._merge = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._merge;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the mergegaps parameter for the query.\n   *\n   * @param value merge gaps\n   * @returns the query when setting, the current value when no argument\n   */\n  mergeGaps(value?: number): number | AvailabilityQuery {\n    if (isNumArg(value)) {\n      this._mergeGaps = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._mergeGaps;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the show parameter for the query.\n   *\n   * @param value show\n   * @returns the query when setting, the current value when no argument\n   */\n  show(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._show = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._show;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the limit parameter for the query.\n   *\n   * @param value limit\n   * @returns the query when setting, the current value when no argument\n   */\n  limit(value?: number): number | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._limit;\n    } else if (hasArgs(value)) {\n      this._limit = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the order by parameter for the query.\n   *\n   * @param value order by\n   * @returns the query when setting, the current value when no argument\n   */\n  orderby(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._orderby = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._orderby;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Gets/Sets the include restricted data parameter for the query.\n   *\n   * @param value true to include restricted data\n   * @returns the query when setting, the current value when no argument\n   */\n  includeRestricted(value?: boolean): boolean | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._includerestricted;\n    } else if (hasArgs(value)) {\n      this._includerestricted = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n\n  /**\n   * Gets/Sets the format parameter for the query. Usually not needed as is set\n   * by the various query methods.\n   *\n   * @param value format\n   * @returns the query when setting, the current value when no argument\n   */\n  format(value?: string): string | AvailabilityQuery {\n    if (isStringArg(value)) {\n      this._format = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._format;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the timeout in seconds for the request. Default is 30.\n   *\n   * @param value timeout in seconds\n   * @returns the query when setting, the current value when no argument\n   */\n  timeout(value?: number): number | AvailabilityQuery {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Calls query on the remote service, using configured parameters. Calls\n   * queryJson internally, then unpacks the result into array of SeismogramDisplayData\n   * objects.\n   *\n   * @returns          promise to array of SeismogramDisplayData, each representing\n   * a channel-time window\n   */\n  query(): Promise<Array<SeismogramDisplayData>> {\n    return this.queryJson().then(function(json) {\n          return this.extractFromJson(json);\n      });\n  }\n  /**\n   * Calls the query function the remote server and parses the returned data as json.\n   *\n   * @returns promise to the result as json\n   */\n  queryJson(): Promise<string> {\n    const mythis = this;\n    this.format(FORMAT_JSON);\n    const url = this.formURL(\"query\");\n    const fetchInit = defaultFetchInitObj(JSON_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(function(response) {\n        if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n          return EMPTY_JSON;\n        }\n        let contentType = response.headers.get('content-type');\n        if(isNonEmptyStringArg(contentType) && contentType.includes(JSON_MIME)) {\n          return response.json();\n        }\n        // $FlowFixMe\n        throw new TypeError(`Oops, we did not get JSON! ${contentType}`);\n      });\n  }\n\n  /**\n   * Calls extent on the remote service, using configured parameters. Calls\n   * extentJson internally, then unpacks the result into array of SeismogramDisplayData\n   * objects.\n   *\n   * @returns          promise to array of SeismogramDisplayData, each representing\n   * a channel-time window\n   */\n  extent(): Promise<Array<SeismogramDisplayData>> {\n    return this.extentJson().then(function(json) {\n          return this.extractFromJson(json);\n      });\n  }\n  /**\n   * Call the extend function on the remote server and parses the returned data as json.\n   *\n   * @returns promise to the result as json\n   */\n  extentJson() {\n    const mythis = this;\n    this.format(FORMAT_JSON);\n    const url = this.formURL(\"extent\");\n    const fetchInit = defaultFetchInitObj(JSON_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n    .then(function(response) {\n        if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n          return EMPTY_JSON;\n        }\n        let contentType = response.headers.get('content-type');\n        if(isNonEmptyStringArg(contentType) && contentType.includes(JSON_MIME)) {\n          return response.json();\n        }\n        // $FlowFixMe\n        throw new TypeError(`Oops, we did not get JSON! ${contentType}`);\n      });\n  }\n\n  /**\n   * Calls query on the remote service using POST, using configured parameters\n   * and forms the POST body using the channelTimeList. Calls\n   * postQueryJson internally, then unpacks the result into array of SeismogramDisplayData\n   * objects.\n   *\n   * @param channelTimeList array of channel-time windows for the request\n   * @returns          promise to array of SeismogramDisplayData, each representing\n   * a channel-time window\n   */\n  postQuery(channelTimeList: Array<SeismogramDisplayData>): Promise<Array<SeismogramDisplayData>> {\n    return this.postQueryJson(channelTimeList).then(json => {\n      return this.extractFromJson(json);\n    });\n  }\n  postExtent(channelTimeList: Array<SeismogramDisplayData>): Promise<Array<SeismogramDisplayData>> {\n    return this.postExtentJson(channelTimeList).then(json => {\n      return this.extractFromJson(json);\n    });\n  }\n\n  postExtentJson(channelTimeList: Array<SeismogramDisplayData>): Promise<RootType> {\n    return this.postJson(channelTimeList, 'extent');\n  }\n  postQueryJson(channelTimeList: Array<SeismogramDisplayData>): Promise<RootType> {\n    return this.postJson(channelTimeList, 'query');\n  }\n  postJson(channelTimeList: Array<SeismogramDisplayData>, method: string): Promise<RootType> {\n    const mythis = this;\n    this.format(FORMAT_JSON);\n    return this.postRaw(channelTimeList, method).then(function(response) {\n        if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n          return EMPTY_JSON;\n        }\n        let contentType = response.headers.get('content-type');\n        if(isNonEmptyStringArg(contentType) && contentType.includes(JSON_MIME)) {\n          return response.json();\n        }\n        // $FlowFixMe\n        throw new TypeError(`Oops, we did not get JSON! ${contentType}`);\n      });\n  }\n  postRaw(channelTimeList: Array<SeismogramDisplayData>, method: string): Promise<Response> {\n    if (channelTimeList.length === 0) {\n      // return promise faking an not ok fetch response\n      return RSVP.hash({\n        ok: false\n      });\n    } else {\n      const fetchInit = defaultFetchInitObj(JSON_MIME);\n      fetchInit.method = \"POST\";\n      fetchInit.body = this.createPostBody(channelTimeList);\n      return fetch(this.formBaseURL()+`/${method}?`, fetchInit).then(function(response) {\n          if(response.ok) {\n            return response;\n          }\n          throw new Error('Fetch response was not ok.');\n        });\n    }\n  }\n\n  extractFromJson(jsonChanTimes: RootType): Array<SeismogramDisplayData> {\n    let out = [];\n    let knownNets = new Map();\n    if (isDef(jsonChanTimes.datasources)){\n      for (let ds of jsonChanTimes.datasources) {\n        let n = knownNets.get(ds.network);\n        if ( ! n) {\n          n = new Network(ds.network);\n          knownNets.set(ds.network, n);\n        }\n        let s = null;\n        for (let ss of n.stations) {\n          if (ss.stationCode === ds.station) {\n            s = ss;\n          }\n        }\n        if ( ! s) {\n          s = new Station(n, ds.station);\n          n.stations.push(s);\n        }\n        let c = new Channel(s, ds.channel, ds.locationCode);\n        if (isNonEmptyStringArg(ds.earliest) && isNonEmptyStringArg(ds.latest)){\n          out.push( SeismogramDisplayData.fromChannelAndTimes(c, moment.utc(ds.earliest), moment.utc(ds.latest)));\n        } else if (ds.timespans) {\n          for (let ts of ds.timespans) {\n            out.push(SeismogramDisplayData.fromChannelAndTimes(c,  moment.utc(ts[0]), moment.utc(ts[1])));\n          }\n        }\n      }\n    }\n    return out;\n  }\n\n  createPostBody(channelTimeList: Array<SeismogramDisplayData>): string {\n    let out = \"\";\n    if (this._quality) { out += this.makePostParm(\"quality\", this.quality());}\n    if (this._merge) { out += this.makePostParm(\"merge\", this.merge());}\n    if (isNumArg(this._mergeGaps) && (this._format === 'query' || this._format === 'queryauth')) {\n      out += this.makePostParm(\"mergegaps\", this.mergeGaps());\n    }\n    if (this._show && (this._format === 'query' || this._format === 'queryauth')) {\n      out += this.makePostParm(\"show\", this.show());\n    }\n    if (isNumArg(this._limit) && this._limit>0) { out += this.makePostParm(\"limit\", this.limit());}\n    if (this._orderby) { out += this.makePostParm(\"orderby\", this.orderby());}\n    if (this._includerestricted) { out += this.makePostParm(\"includerestricted\", this.includeRestricted());}\n    if (this._format) { out += this.makePostParm(\"format\", this.format());}\n    if (this._nodata) { out += this.makePostParm(\"nodata\", this.nodata());}\n\n    for (let ct of channelTimeList) {\n      if ( isDef(ct.channel)) {\n        let sta = ct.channel.station;\n        let net = sta.network;\n        out += `${net.networkCode} ${sta.stationCode} ${ct.channel.locationCode} ${ct.channel.channelCode} ${ct.startTime.toISOString()} ${ct.endTime.toISOString()}`;\n        out += '\\n';\n      } else {\n        throw new Error(\"Channel in missing in createPostBody\");\n      }\n    }\n    return out;\n  }\n\n  formBaseURL(): string {\n      let colon = \":\";\n      if (this._protocol.endsWith(colon)) {\n        colon = \"\";\n      }\n      return this._protocol+colon+\"//\"+this._host+(this._port===80?\"\":(\":\"+this._port))+\"/fdsnws/availability/\"+this._specVersion;\n  }\n\n  formVersionURL(): string {\n    return this.formBaseURL()+\"/version\";\n  }\n  /**\n   * Queries the remote web service to get its version\n   *\n   * @returns Promise to version string\n   */\n  queryVersion(): Promise<string> {\n    let url = this.formVersionURL();\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n\n  makePostParm(name: string, val: mixed): string {\n    return name+\"=\"+stringify(val)+\"\\n\";\n  }\n\n  formURL(method: string): string {\n    if (hasNoArgs(method)) {\n      method = \"query\";\n    }\n    let url = this.formBaseURL()+`/${method}?`;\n    if (this._networkCode) { url = url+makeParam(\"net\", this.networkCode());}\n    if (this._stationCode) { url = url+makeParam(\"sta\", this.stationCode());}\n    if (this._locationCode) { url = url+makeParam(\"loc\", this.locationCode());}\n    if (this._channelCode) { url = url+makeParam(\"cha\", this.channelCode());}\n    if (this._startTime) { url = url+makeParam(\"starttime\", toIsoWoZ(this.startTime()));}\n    if (this._endTime) { url = url+makeParam(\"endtime\", toIsoWoZ(this.endTime()));}\n    if (this._quality) { url = url+makeParam(\"quality\", this.quality());}\n    if (this._merge) { url = url+makeParam(\"merge\", this.merge());}\n    if (this._mergeGaps) { url = url+makeParam(\"mergegaps\", this.mergeGaps());}\n    if (this._show) { url = url+makeParam(\"show\", this.show());}\n    if (isNumArg(this._limit) && this._limit>0) { url = url+makeParam(\"limit\", this.limit());}\n    if (this._orderby) { url = url+makeParam(\"orderby\", this.orderby());}\n    if (this._includerestricted) { url = url+makeParam(\"includerestricted\", this.includeRestricted());}\n    if (this._format) { url = url+makeParam(\"format\", this.format());}\n    if (this._nodata) { url = url+makeParam(\"nodata\", this.nodata());}\n\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n}\n\n/* The below are slighly modified from json schema to flow autogenerator.\n*\n* */\n\n/**\n * Root type of availablility json query.\n */\nexport type RootType = {\n  created?: FdsnDateTime,\n  version: Object,\n  datasources: Array<Datasource>\n} & Object;\nexport type FdsnDateTime = string;\nexport type Datasource = ({\n  network: string,\n  station: string,\n  location: string,\n  channel: string,\n  quality?: string,\n  samplerate?: number,\n  timespans?: Array<Array<FdsnDateTime>>,\n  earliest?: FdsnDateTime,\n  latest?: FdsnDateTime,\n  updated?: FdsnDateTime,\n  timespanCount?: number,\n  restriction?: string\n} & Object) &\n  (({ timespans: any } & Object) | ({ earliest: any, latest: any } & Object));\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport RSVP from 'rsvp';\n\nimport * as util from './util.js'; // for util.log\n// special due to flow\nimport {checkProtocol, toIsoWoZ, hasArgs, hasNoArgs, isStringArg,\n        isNonEmptyStringArg,isNumArg, checkStringOrDate} from './util';\n\nimport * as miniseed from './miniseed';\nimport { Seismogram, SeismogramDisplayData } from './seismogram';\nimport { TEXT_MIME, StartEndDuration, makeParam, doFetchWithTimeout, defaultFetchInitObj, isDef} from './util.js';\n\n/** const for miniseed format, mseed */\nexport const FORMAT_MINISEED = 'miniseed';\n\n/**\n * Major version of the FDSN spec supported here.\n * Currently is 1.\n */\nexport const SERVICE_VERSION = 1;\n/**\n * Service name as used in the FDSN DataCenters registry,\n * http://www.fdsn.org/datacenters\n */\nexport const SERVICE_NAME = `fdsnws-dataselect-${SERVICE_VERSION}`;\n\n/** const for the default IRIS web service host, service.iris.edu */\nexport const IRIS_HOST = \"service.iris.edu\";\n\n/**\n * Query to a FDSN Dataselect web service.\n *\n * @see http://www.fdsn.org/webservices/\n *\n * @param host optional host to connect to, defaults to IRIS\n */\nexport class DataSelectQuery {\n  /** @private */\n  _specVersion: number;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _port: number;\n  /** @private */\n  _networkCode: string;\n  /** @private */\n  _stationCode: string;\n  /** @private */\n  _locationCode: string;\n  /** @private */\n  _channelCode: string;\n  /** @private */\n  _startTime: moment;\n  /** @private */\n  _endTime: moment;\n  /** @private */\n  _quality: string;\n  /** @private */\n  _minimumLength: number;\n  /** @private */\n  _longestOnly: boolean;\n  /** @private */\n  _repository: string;\n  /** @private */\n  _format: string;\n  /** @private */\n  _timeoutSec: number;\n  constructor(host?: string) {\n    this._specVersion = 1;\n    this._protocol = checkProtocol();\n    if (isNonEmptyStringArg(host)) {\n      this._host = host;\n    } else {\n      this._host = IRIS_HOST;\n    }\n    this._port = 80;\n    this._timeoutSec = 30;\n  }\n  /**\n   * Gets/Sets the version of the fdsnws spec, 1 is currently the only value.\n   *  Setting this is probably a bad idea as the code may not be compatible with\n   *  the web service.\n   *\n   * @param value spec version, usually 1\n   * @returns new value if getting, this if setting\n   */\n  specVersion(value?: number): number | DataSelectQuery {\n    if (hasArgs(value)) {\n      this._specVersion = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._specVersion;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the protocol, http or https. This should match the protocol\n   *  of the page loaded, but is autocalculated and generally need not be set.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  protocol(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._protocol = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._protocol;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the remote host to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  host(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the nodata parameter, usually 404 or 204 (default), controlling\n   * the status code when no matching data is found by the service.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  nodata(value?: number): number | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._nodata;\n    } else if (hasArgs(value)) {\n      this._nodata = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the remote port to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  port(value?: number): number | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (isNumArg(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the network query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  networkCode(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._networkCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._networkCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the station query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  stationCode(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._stationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._stationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the location code query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  locationCode(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._locationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._locationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the channel query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  channelCode(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._channelCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._channelCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the starttime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  startTime(value?: moment): moment | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._startTime;\n    } else if (hasArgs(value)) {\n      this._startTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the endtime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  endTime(value?: moment): moment | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._endTime;\n    } else if (hasArgs(value)) {\n      this._endTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Sets startTime and endTime using the given time window\n   *\n   * @param   se time window\n   * @returns     this\n   */\n  timeWindow(se: StartEndDuration) {\n    this.startTime(se.startTime);\n    this.endTime(se.endTime);\n    return this;\n  }\n  /** Get/Set the quality query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  quality(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._quality = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._quality;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the minimum length query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minimumLength(value?: number): number | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._minimumLength;\n    } else if (hasArgs(value)) {\n      this._minimumLength = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the longest only query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  longestOnly(value?: boolean): boolean | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._longestOnly;\n    } else if (hasArgs(value)) {\n      this._longestOnly = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n\n  /**\n   * set or get the repository paramter. This is an IRIS-specific\n   * parameter that will not work with other dataselect web services.\n   *\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  repository(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._repository = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._repository;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the format query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  format(value?: string): string | DataSelectQuery {\n    if (isStringArg(value)) {\n      this._format = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._format;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * Get/Set the timeout in seconds for the request. Default is 30.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  timeout(value?: number): number | DataSelectQuery {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n\n  /**\n   * queries the web service using the configured parameters, parsing the response\n   * into miniseed data records.\n   *\n   * @returns Promise to Array of miniseed.DataRecords\n   */\n  queryDataRecords(): Promise<Array<miniseed.DataRecord>> {\n    const mythis = this;\n    this.format(FORMAT_MINISEED);\n    const url = this.formURL();\n    const fetchInit = defaultFetchInitObj(miniseed.MINISEED_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(function(response) {\n        if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n          // no data\n          return new ArrayBuffer(0);\n        } else {\n          return response.arrayBuffer();\n        }\n      }).then(function(rawBuffer) {\n        let dataRecords = miniseed.parseDataRecords(rawBuffer);\n        return dataRecords;\n    });\n  }\n\n  /**\n   * queries the web service using the configured parameters, parsing the response\n   * into miniseed data records and then combining the data records into\n   * Seismogram objects.\n   *\n   * @returns Promise to Array of Seismogram objects\n   */\n  querySeismograms(): Promise<Array<Seismogram>> {\n    return this.queryDataRecords().then(dataRecords => {\n      return miniseed.seismogramPerChannel(dataRecords);\n    });\n  }\n\n  postQueryDataRecords(channelTimeList: Array<SeismogramDisplayData>): Promise<Array<miniseed.DataRecord>> {\n    return this.postQueryRaw(channelTimeList)\n    .then( fetchResponse => {\n      if(fetchResponse.ok) {\n        return fetchResponse.arrayBuffer().then(ab => {\n          return miniseed.parseDataRecords(ab);\n        });\n      } else {\n        util.log(\"fetchRespone not ok\");\n        return [];\n      }\n    });\n  }\n  /**\n   * query the dataselect server using post, which allows for multiple\n   * channel-timeranges at once. This assumes that there are not multiple\n   * time ranges for the same channel as the results, encapsulated as\n   * SeismogramDisplayData objects, are returned one seismogram\n   * per channel, which may contain gaps. The original channel and timerange are\n   * also populated with each result.\n   *\n   * @param   channelTimeList array of SeismogramDisplayData objects\n   * that will be filled in with the resulting seismogram\n   * @returns Promise to the input Array of SeismogramDisplayData objects, each with the\n   * seismogram containing the data returned from the server\n   */\n  postQuerySeismograms(channelTimeList: Array<SeismogramDisplayData>): Promise<Array<SeismogramDisplayData>> {\n    return this.postQueryDataRecords(channelTimeList).then(dataRecords => {\n      return miniseed.seismogramPerChannel(dataRecords);\n    }).then(seisArray => {\n      for (let ct of channelTimeList) {\n        if (isDef(ct.channel)) {\n          let channel = ct.channel;\n          let codes = channel.codes();\n          let seis = seisArray.find(s => s.codes() === codes);\n          if (seis) {\n            ct.seismogram = seis;\n          }\n        } else {\n          throw new Error(\"Channel in missing in postQuerySeismograms\");\n        }\n      }\n      return channelTimeList;\n    });\n  }\n  postQueryRaw(channelTimeList: Array<SeismogramDisplayData>): Promise<Response> {\n    if (channelTimeList.length === 0) {\n      // return promise faking an not ok fetch response\n      return RSVP.hash({\n        ok: false\n      });\n    } else {\n      const fetchInit = defaultFetchInitObj(miniseed.MINISEED_MIME);\n      fetchInit.method = \"POST\";\n      fetchInit.body = this.createPostBody(channelTimeList);\n      return doFetchWithTimeout(this.formURL(), fetchInit, this._timeoutSec * 1000 );\n    }\n  }\n\n  createPostBody(channelTimeList: Array<SeismogramDisplayData>): string {\n    let out = \"\";\n    for (let ct of channelTimeList) {\n      if (isDef(ct.channel)) {\n        let channel = ct.channel;\n        let sta = channel.station;\n        let net = sta.network;\n        out += `${net.networkCode} ${sta.stationCode} ${channel.locationCode} ${channel.channelCode} ${ct.startTime.toISOString()} ${ct.endTime.toISOString()}`;\n        out += '\\n';\n      } else {\n        throw new Error(\"Channel in missing in createPostBody\");\n      }\n    }\n    return out;\n  }\n\n  formBaseURL(): string {\n      let colon = \":\";\n      if (this._protocol.endsWith(colon)) {\n        colon = \"\";\n      }\n      return this._protocol+colon+\"//\"+this._host+(this._port===80?\"\":(\":\"+this._port))+\"/fdsnws/dataselect/\"+this._specVersion;\n  }\n\n  formVersionURL(): string {\n    return this.formBaseURL()+\"/version\";\n  }\n  /**\n   * Queries the remote web service to get its version\n   *\n   * @returns Promise to version string\n   */\n  queryVersion(): Promise<string> {\n    let url = this.formVersionURL();\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n\n  formURL(): string {\n    let url = this.formBaseURL()+\"/query?\";\n    if (this._networkCode) { url = url+makeParam(\"net\", this.networkCode());}\n    if (this._stationCode) { url = url+makeParam(\"sta\", this.stationCode());}\n    if (this._locationCode) { url = url+makeParam(\"loc\", this.locationCode());}\n    if (this._channelCode) { url = url+makeParam(\"cha\", this.channelCode());}\n    if (this._startTime) { url = url+makeParam(\"starttime\", toIsoWoZ(this.startTime()));}\n    if (this._endTime) { url = url+makeParam(\"endtime\", toIsoWoZ(this.endTime()));}\n    if (this._quality) { url = url+makeParam(\"quality\", this.quality());}\n    if (this._minimumLength) { url = url+makeParam(\"minimumlength\", this.minimumLength());}\n    if (this._repository) { url = url+makeParam(\"repository\", this.repository());}\n    if (this._longestOnly) { url = url+makeParam(\"longestonly\", this.longestOnly());}\n    if (this._format) { url = url+makeParam(\"format\", this.format());}\n    if (this._nodata) { url = url+makeParam(\"nodata\", this.nodata());}\n\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n}\n\n\nexport function createDataSelectQuery(params: Object): DataSelectQuery {\n  if ( ! params || typeof params !== 'object' ) {\n    throw new Error(\"params null or not an object\");\n  }\n  let out = new DataSelectQuery();\n  if (params.net) { out.networkCode(params.net); }\n  if (params.network) { out.networkCode(params.network); }\n  if (params.networkCode) { out.networkCode(params.networkCode); }\n  if (params.sta) { out.stationCode(params.sta); }\n  if (params.station) { out.stationCode(params.station); }\n  if (params.stationCode) { out.stationCode(params.stationCode); }\n  if (params.loc) { out.locationCode(params.loc); }\n  if (params.location) { out.locationCode(params.location); }\n  if (params.locationCode) { out.locationCode(params.locationCode); }\n  if (params.chan) { out.channelCode(params.chan); }\n  if (params.channel) { out.channelCode(params.channel); }\n  if (params.channelCode) { out.channelCode(params.channelCode); }\n  if (params.start) { out.startTime(params.start); }\n  if (params.starttime) { out.startTime(params.starttime); }\n  if (params.end) { out.endTime(params.end); }\n  if (params.endtime) { out.endTime(params.endtime); }\n  if (params.quality) { out.quality(params.quality); }\n  if (params.minimumlength) { out.minimumLength(params.minimumlength); }\n  if (params.repository) { out.repository(params.repository); }\n  if (params.longestonly) { out.longestOnly(params.longestonly); }\n  if (params.format) { out.format(params.format); }\n  if (params.nodata) { out.nodata(params.nodata); }\n  if (params.host) { out.host(params.host); }\n  if (params.port) { out.port(params.port); }\n  if (params.specVersion) { out.specVersion(params.specVersion); }\n  return out;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport { moment } from 'moment';\nimport { Quake, USGS_HOST, parseQuakeML } from './quakeml';\nimport {XML_MIME, TEXT_MIME, StartEndDuration, makeParam, doFetchWithTimeout, defaultFetchInitObj} from './util.js';\n\n// special due to flow\nimport {checkProtocol, toIsoWoZ, hasArgs, hasNoArgs, isDef, isObject,\n        isStringArg, isNonEmptyStringArg, isNumArg, checkStringOrDate} from './util';\n\n/**\n * Major version of the FDSN spec supported here.\n * Currently is 1.\n */\nexport const SERVICE_VERSION = 1;\n/**\n * Service name as used in the FDSN DataCenters registry,\n * http://www.fdsn.org/datacenters\n */\nexport const SERVICE_NAME = `fdsnws-event-${SERVICE_VERSION}`;\n\nexport { USGS_HOST };\n\nexport const FAKE_EMPTY_XML = '<?xml version=\"1.0\"?><q:quakeml xmlns=\"http://quakeml.org/xmlns/bed/1.2\" xmlns:q=\"http://quakeml.org/xmlns/quakeml/1.2\"><eventParameters publicID=\"quakeml:fake/empty\"></eventParameters></q:quakeml>';\n\n/**\n * Query to a FDSN Event web service.\n *\n * @see http://www.fdsn.org/webservices/\n *\n * @param host optional host to connect to, defaults to USGS\n */\nexport class EventQuery {\n  /** @private */\n  _specVersion: number;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _port: number;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _eventId: string;\n  /** @private */\n  _startTime: moment;\n  /** @private */\n  _endTime: moment;\n  /** @private */\n  _updatedAfter: moment;\n  /** @private */\n  _minMag: number;\n  /** @private */\n  _maxMag: number;\n  /** @private */\n  _magnitudeType: string;\n  /** @private */\n  _minDepth: number;\n  /** @private */\n  _maxDepth: number;\n  /** @private */\n  _minLat: number;\n  /** @private */\n  _maxLat: number;\n  /** @private */\n  _minLon: number;\n  /** @private */\n  _maxLon: number;\n  /** @private */\n  _latitude: number;\n  /** @private */\n  _longitude: number;\n  /** @private */\n  _minRadius: number;\n  /** @private */\n  _maxRadius: number;\n  /** @private */\n  _includeArrivals: boolean;\n  /** @private */\n  _includeAllOrigins: boolean;\n  /** @private */\n  _includeAllMagnitudes: boolean;\n  /** @private */\n  _limit: number;\n  /** @private */\n  _offset: number;\n  /** @private */\n  _orderBy: string;\n  /** @private */\n  _contributor: string;\n  /** @private */\n  _catalog: string;\n  /** @private */\n  _format: string;\n  /** @private */\n  _timeoutSec: number;\n  constructor(host?: string) {\n    this._specVersion = 1;\n    this._protocol = checkProtocol();\n    this.host(host);\n    if (! isNonEmptyStringArg(host)) {\n      this._host = USGS_HOST;\n    }\n    this._port = 80;\n    this._timeoutSec = 30;\n  }\n  /**\n   * Gets/Sets the version of the fdsnws spec, 1 is currently the only value.\n   *  Setting this is probably a bad idea as the code may not be compatible with\n   *  the web service.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  specVersion(value?: number): number | EventQuery {\n    if (hasArgs(value)) {\n      this._specVersion = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._specVersion;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the protocol, http or https. This should match the protocol\n   *  of the page loaded, but is autocalculated and generally need not be set.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  protocol(value?: string): string | EventQuery {\n    if (isStringArg(value)) {\n      this._protocol = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._protocol;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the remote host to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  host(value?: string): string | EventQuery {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the remote port to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  port(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (isNumArg(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Gets/Sets the nodata parameter, usually 404 or 204 (default), controlling\n   * the status code when no matching data is found by the service.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  nodata(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._nodata;\n    } else if (hasArgs(value)) {\n      this._nodata = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the eventid query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  eventId(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._eventId;\n    } else if (isStringArg(value)) {\n      this._eventId = value;\n      return this;\n    } else  {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the starttime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  startTime(value?: moment): moment | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._startTime;\n    } else if (hasArgs(value)) {\n      this._startTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the endtime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  endTime(value?: moment): moment | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._endTime;\n    } else if (hasArgs(value)) {\n      this._endTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Sets startTime and endTime using the given time window\n   *\n   * @param   se time window\n   * @returns     this\n   */\n  timeWindow(se: StartEndDuration) {\n    this.startTime(se.startTime);\n    this.endTime(se.endTime);\n    return this;\n  }\n  /**\n   * Get/Set the updatedafter query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  updatedAfter(value?: moment): moment | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._updatedAfter;\n    } else if (hasArgs(value)) {\n      this._updatedAfter = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the minmag query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minMag(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._minMag;\n    } else if (isNumArg(value)) {\n      this._minMag = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the maxmag query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxMag(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._maxMag;\n    } else if (isNumArg(value)) {\n      this._maxMag = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the magnitudetype query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  magnitudeType(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._magnitudeType;\n    } else if (isStringArg(value)) {\n      this._magnitudeType = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the mindepth query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minDepth(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._minDepth;\n    } else if (isNumArg(value)) {\n      this._minDepth = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the maxdepth query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxDepth(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._maxDepth;\n    } else if (isNumArg(value)) {\n      this._maxDepth = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the minlat query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minLat(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._minLat;\n    } else if (isNumArg(value)) {\n      this._minLat = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the maxlat query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxLat(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._maxLat;\n    } else if (isNumArg(value)) {\n      this._maxLat = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the minlon query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minLon(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._minLon;\n    } else if (isNumArg(value)) {\n      this._minLon = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the maxlon query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxLon(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._maxLon;\n    } else if (isNumArg(value)) {\n      this._maxLon = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the latitude query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  latitude(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._latitude;\n    } else if (isNumArg(value)) {\n      this._latitude = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the longitude query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  longitude(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._longitude;\n    } else if (isNumArg(value)) {\n      this._longitude = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the minradius query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minRadius(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._minRadius;\n    } else if (isNumArg(value)) {\n      this._minRadius = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the maxradius query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxRadius(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._maxRadius;\n    } else if (isNumArg(value)) {\n      this._maxRadius = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the includearrivals query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  includeArrivals(value?: boolean): boolean | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._includeArrivals;\n    } else if (hasArgs(value)) {\n      this._includeArrivals = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the includeallorigins query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  includeAllOrigins(value?: boolean): boolean | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._includeAllOrigins;\n    } else if (hasArgs(value)) {\n      this._includeAllOrigins = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the includeallmagnitudes query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  includeAllMagnitudes(value?: boolean): boolean | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._includeAllMagnitudes;\n    } else if (hasArgs(value)) {\n      this._includeAllMagnitudes = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the format query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  format(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._format;\n    } else if (isStringArg(value)) {\n      this._format = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the limit query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  limit(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._limit;\n    } else if (isNumArg(value)) {\n      this._limit = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the offset query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  offset(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._offset;\n    } else if (isNumArg(value)) {\n      this._offset = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the orderby query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  orderBy(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._orderBy;\n    } else if (isStringArg(value)) {\n      this._orderBy = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the catalog query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  catalog(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._catalog;\n    } else if (isStringArg(value)) {\n      this._catalog = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the contributor query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  contributor(value?: string): string | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._contributor;\n    } else if (isStringArg(value)) {\n      this._contributor = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Get/Set the timeout in seconds for the request. Default is 30.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  timeout(value?: number): number | EventQuery {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * Checks to see if any parameter that would limit the data\n   * returned is set. This is a crude, coarse check to make sure\n   * the client doesn't ask for EVERYTHING the server has.\n   *\n   * @returns true is some parameter is set\n   */\n  isSomeParameterSet(): boolean {\n    return isDef(this._eventId) ||\n      isDef(this._startTime) ||\n      isDef(this._endTime) ||\n      isDef(this._minLat) ||\n      isDef(this._maxLat) ||\n      isDef(this._minLon) ||\n      isDef(this._maxLon) ||\n      isDef(this._latitude) ||\n      isDef(this._longitude) ||\n      isDef(this._minRadius) ||\n      isDef(this._maxRadius) ||\n      isDef(this.minDepth) ||\n      isDef(this.maxDepth) ||\n      isDef(this.limit) ||\n      isDef(this.minMag) ||\n      isDef(this.maxMag) ||\n      isDef(this.updatedAfter) ||\n      isDef(this.catalog) ||\n      isDef(this.contributor);\n  }\n  /**\n   * Queries the remote service and parses the returned xml.\n   *\n   *  @returns Promise to an Array of Quake objects.\n   */\n  query(): Promise<Array<Quake>> {\n    return this.queryRawXml().then(rawXml => {\n        return parseQuakeML(rawXml, this._host);\n    });\n  }\n  /**\n   * Queries the remote server, to get QuakeML xml.\n   *\n   * @returns xml Document\n   */\n  queryRawXml(): Promise<Document> {\n    let mythis = this;\n    const url = this.formURL();\n    const fetchInit = defaultFetchInitObj(XML_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n    .then(response => {\n        if (response.status === 200) {\n          return response.text();\n        } else if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n          // 204 is nodata, so successful but empty\n          return FAKE_EMPTY_XML;\n        } else {\n          throw new Error(`Status not successful: ${response.status}`);\n        }\n    }).then(function(rawXmlText) {\n      return new DOMParser().parseFromString(rawXmlText, XML_MIME);\n    });\n  }\n  /**\n   * Forms the basic URL to contact the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formBaseURL(): string {\n      let colon = \":\";\n      if (! this.host || this._host === USGS_HOST) {\n        this._host = USGS_HOST;\n        // usgs does 301 moved permanently to https\n        this._protocol = 'https:';\n      }\n      if (this._protocol.endsWith(colon)) {\n        colon = \"\";\n      }\n      return this._protocol+colon+\"//\"+this._host+(this._port===80?\"\":(\":\"+this._port))+\"/fdsnws/event/\"+this._specVersion;\n  }\n  /**\n   * Forms the URL to get catalogs from the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formCatalogsURL(): string {\n    return this.formBaseURL()+\"/catalogs\";\n  }\n  /**\n   * Queries the remote web service to get known catalogs\n   *\n   * @returns Promise to Array of catalog names\n   */\n  queryCatalogs(): Promise<Array<string>> {\n    let mythis = this;\n    let url = mythis.formCatalogsURL();\n    const fetchInit = defaultFetchInitObj(XML_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      }).then(function(rawXmlText) {\n        return new DOMParser().parseFromString(rawXmlText, XML_MIME);\n      }).then(function(rawXml) {\n          // for flow\n          if ( ! rawXml) { throw new Error(\"raw xml from DOMParser is null.\");}\n          let top = rawXml.documentElement;\n          // for flow\n          if ( ! top) { throw new Error(\"documentElement in xml from DOMParser is null.\");}\n          let catalogArray = top.getElementsByTagName(\"Catalog\");\n          let out = [];\n          if (catalogArray){\n            for (let i=0; i<catalogArray.length; i++) {\n              // for flow\n              let item = catalogArray.item(i);\n              if (item) {\n                out.push(item.textContent);\n              }\n            }\n          }\n          return out;\n      });\n  }\n  /**\n   * Forms the URL to get contributors from the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formContributorsURL(): string {\n    return this.formBaseURL()+\"/contributors\";\n  }\n  /**\n   * Queries the remote web service to get known contributors\n   *\n   * @returns Promise to Array of contributor names\n   */\n  queryContributors(): Promise<Array<string>> {\n    let url = this.formContributorsURL();\n    const fetchInit = defaultFetchInitObj(XML_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      }).then(function(rawXmlText) {\n        return new DOMParser().parseFromString(rawXmlText, XML_MIME);\n      }).then(function(rawXml) {\n          let top = rawXml.documentElement;\n          // for flow\n          if ( ! top) { throw new Error(\"documentElement in xml from DOMParser is null.\");}\n          let contributorArray = top.getElementsByTagName(\"Contributor\");\n          let out = [];\n          if (contributorArray){\n            for (let i=0; i<contributorArray.length; i++) {\n              // for flow\n              let item = contributorArray.item(i);\n              if (item) {\n                out.push(item.textContent);\n              }\n            }\n          }\n          return out;\n      });\n  }\n  /**\n   * Forms the URL to get version from the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formVersionURL(): string {\n    return this.formBaseURL()+\"/version\";\n  }\n  /**\n   * Queries the remote web service to get its version\n   *\n   * @returns Promise to version string\n   */\n  queryVersion(): Promise<string> {\n    let url = this.formVersionURL();\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n  /**\n   * Form URL to query the remote web service, encoding the query parameters.\n   *\n   * @returns url\n   */\n  formURL(): string {\n    let colon = \":\";\n    if (this._protocol.endsWith(colon)) {\n      colon = \"\";\n    }\n    let url = this.formBaseURL()+\"/query?\";\n    if (this._eventId) { url = url+makeParam(\"eventid\", this.eventId());}\n    if (this._startTime) { url = url+makeParam(\"starttime\", toIsoWoZ(this.startTime()));}\n    if (this._endTime) { url = url+makeParam(\"endtime\", toIsoWoZ(this.endTime()));}\n    if (isNumArg(this._minMag)) { url = url+makeParam(\"minmag\", this.minMag());}\n    if (isNumArg(this._maxMag)) { url = url+makeParam(\"maxmag\", this.maxMag());}\n    if (isStringArg(this._magnitudeType)) { url = url+makeParam(\"magnitudetype\", this.magnitudeType());}\n    if (isNumArg(this._minDepth)) { url = url+makeParam(\"mindepth\", this.minDepth());}\n    if (isNumArg(this._maxDepth)) { url = url+makeParam(\"maxdepth\", this.maxDepth());}\n    if (isNumArg(this._minLat)) { url = url+makeParam(\"minlat\", this.minLat());}\n    if (isNumArg(this._maxLat)) { url = url+makeParam(\"maxlat\", this.maxLat());}\n    if (isNumArg(this._minLon)) { url = url+makeParam(\"minlon\", this.minLon());}\n    if (isNumArg(this._maxLon)) { url = url+makeParam(\"maxlon\", this.maxLon());}\n    if (isNumArg(this._minRadius) || isNumArg(this._maxRadius)) {\n      if (isNumArg(this._latitude) && isNumArg(this._longitude)) {\n        url = url+makeParam(\"latitude\", this.latitude())+makeParam(\"longitude\", this.longitude());\n        if (isNumArg(this._minRadius)) { url = url+makeParam(\"minradius\", this.minRadius());}\n        if (isNumArg(this._maxRadius)) { url = url+makeParam(\"maxradius\", this.maxRadius());}\n      } else {\n        throw new Error(\"Cannot use minRadius or maxRadius without latitude and longitude: lat=\"+this._latitude+\" lon=\"+this._longitude);\n      }\n    }\n    if (this._includeArrivals) {\n      if (this._host !== USGS_HOST) {\n        url = url+\"includearrivals=true&\";\n      } else {\n        // USGS does not support includearrivals, but does actually\n        // include the arrivals for an eventid= style query\n        if (this._eventId) {\n          // ok, works without the param\n        } else {\n          throw new Error(\"USGS host, earthquake.usgs.gov, does not support includearrivals parameter.\");\n        }\n      }\n    }\n    if (isObject(this._updatedAfter)) { url = url+makeParam(\"updatedafter\", this.updatedAfter());}\n    if (isDef(this._includeAllOrigins)) { url = url+makeParam(\"includeallorigins\", this.includeAllOrigins());}\n    if (isDef(this._includeAllMagnitudes)) { url = url+makeParam(\"includeallmagnitudes\", this.includeAllMagnitudes());}\n    if (isStringArg(this._format)) { url = url+makeParam(\"format\", this.format());}\n    if (isNumArg(this._limit)) { url = url+makeParam(\"limit\", this.limit());}\n    if (isNumArg(this._offset)) { url = url+makeParam(\"offset\", this.offset());}\n    if (isStringArg(this._orderBy)) { url = url+makeParam(\"orderby\", this.orderBy());}\n    if (isStringArg(this._catalog)) { url = url+makeParam(\"catalog\", this.catalog());}\n    if (isStringArg(this._contributor)) { url = url+makeParam(\"contributor\", this.contributor());}\n\n    if (isDef(this._nodata)) { url = url+makeParam(\"nodata\", this.nodata());}\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport {parseStationXml, Network} from './stationxml';\nimport {XML_MIME, TEXT_MIME, StartEndDuration, makeParam, doFetchWithTimeout, defaultFetchInitObj} from './util.js';\n\n// special due to flow\nimport {checkProtocol, toIsoWoZ, isDef, hasArgs, hasNoArgs, isObject, isStringArg,\n        isNonEmptyStringArg, isNumArg, checkStringOrDate} from './util';\n\nexport const LEVEL_NETWORK = 'network';\nexport const LEVEL_STATION = 'station';\nexport const LEVEL_CHANNEL = 'channel';\nexport const LEVEL_RESPONSE = 'response';\n\nexport const LEVELS = [ LEVEL_NETWORK, LEVEL_STATION, LEVEL_CHANNEL, LEVEL_RESPONSE];\n\n/**\n * Major version of the FDSN spec supported here.\n * Currently is 1.\n */\nexport const SERVICE_VERSION = 1;\n/**\n * Service name as used in the FDSN DataCenters registry,\n * http://www.fdsn.org/datacenters\n */\nexport const SERVICE_NAME = `fdsnws-station-${SERVICE_VERSION}`;\n\nexport const IRIS_HOST = \"service.iris.edu\";\n\n/** a fake, completely empty stationxml document in case of no data. */\nexport const FAKE_EMPTY_XML = '<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?> <FDSNStationXML xmlns=\"http://www.fdsn.org/xml/station/1\" schemaVersion=\"1.0\" xsi:schemaLocation=\"http://www.fdsn.org/xml/station/1 http://www.fdsn.org/xml/station/fdsn-station-1.0.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:iris=\"http://www.fdsn.org/xml/station/1/iris\"> </FDSNStationXML>';\n\n\n/**\n * Query to a FDSN Station web service.\n *\n * @see http://www.fdsn.org/webservices/\n *\n * @param host optional host to connect to, defaults to IRIS\n */\nexport class StationQuery {\n  /** @private */\n  _specVersion: number;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _port: number;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _networkCode: string;\n  /** @private */\n  _stationCode: string;\n  /** @private */\n  _locationCode: string;\n  /** @private */\n  _channelCode: string;\n  /** @private */\n  _startTime: moment;\n  /** @private */\n  _endTime: moment;\n  /** @private */\n  _startBefore: moment;\n  /** @private */\n  _endBefore: moment;\n  /** @private */\n  _startAfter: moment;\n  /** @private */\n  _endAfter: moment;\n  /** @private */\n  _minLat: number;\n  /** @private */\n  _maxLat: number;\n  /** @private */\n  _minLon: number;\n  /** @private */\n  _maxLon: number;\n  /** @private */\n  _latitude: number;\n  /** @private */\n  _longitude: number;\n  /** @private */\n  _minRadius: number;\n  /** @private */\n  _maxRadius: number;\n  /** @private */\n  _includeRestricted: boolean;\n  /** @private */\n  _includeAvailability: boolean;\n  /** @private */\n  _format: string;\n  /** @private */\n  _updatedAfter: moment;\n  /** @private */\n  _matchTimeseries: boolean;\n  /** @private */\n  _timeoutSec: number;\n  /** Construct a query\n   *\n   * @param host the host to connect to , defaults to service.iris.edu\n   */\n  constructor(host?: string) {\n    this._specVersion = 1;\n    this._protocol = checkProtocol();\n    this.host(host);\n    if (! isNonEmptyStringArg(host)) {\n      this._host = IRIS_HOST;\n    }\n    this._port = 80;\n    this._timeoutSec = 30;\n  }\n  /** Gets/Sets the version of the fdsnws spec, 1 is currently the only value.\n   *  Setting this is probably a bad idea as the code may not be compatible with\n   *  the web service.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  specVersion(value?: number): number | StationQuery {\n    if (hasArgs(value)) {\n      this._specVersion = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._specVersion;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the protocol, http or https. This should match the protocol\n   *  of the page loaded, but is autocalculated and generally need not be set.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  protocol(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._protocol = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._protocol;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the remote host to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  host(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the remote port to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  port(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (isNumArg(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the nodata parameter, usually 404 or 204 (default), controlling\n   * the status code when no matching data is found by the service.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  nodata(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._nodata;\n    } else if (hasArgs(value)) {\n      this._nodata = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the network query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  networkCode(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._networkCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._networkCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the station query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  stationCode(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._stationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._stationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the location code query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  locationCode(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._locationCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._locationCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the channel query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  channelCode(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._channelCode = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._channelCode;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the starttime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  startTime(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._startTime;\n    } else if (hasArgs(value)) {\n      this._startTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the endtime query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  endTime(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._endTime;\n    } else if (hasArgs(value)) {\n      this._endTime = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /**\n   * Sets startTime and endTime using the given time window\n   *\n   * @param   se time window\n   * @returns     this\n   */\n  timeWindow(se: StartEndDuration) {\n    this.startTime(se.startTime);\n    this.endTime(se.endTime);\n    return this;\n  }\n  /** Get/Set the startbefore query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  startBefore(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._startBefore;\n    } else if (hasArgs(value)) {\n      this._startBefore = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the endbefore query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  endBefore(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._endBefore;\n    } else if (hasArgs(value)) {\n      this._endBefore = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the startafter query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  startAfter(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._startAfter;\n    } else if (hasArgs(value)) {\n      this._startAfter = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the endafter query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  endAfter(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._endAfter;\n    } else if (hasArgs(value)) {\n      this._endAfter = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the minlat query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minLat(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._minLat;\n    } else if (isNumArg(value)) {\n      this._minLat = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the maxlon query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxLat(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._maxLat;\n    } else if (isNumArg(value)) {\n      this._maxLat = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the minlon query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minLon(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._minLon;\n    } else if (isNumArg(value)) {\n      this._minLon = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the maxlon query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxLon(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._maxLon;\n    } else if (isNumArg(value)) {\n      this._maxLon = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the latitude query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  latitude(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._latitude;\n    } else if (isNumArg(value)) {\n      this._latitude = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the longitude query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  longitude(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._longitude;\n    } else if (isNumArg(value)) {\n      this._longitude = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the minradius query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  minRadius(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._minRadius;\n    } else if (isNumArg(value)) {\n      this._minRadius = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the maxradius query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  maxRadius(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._maxRadius;\n    } else if (isNumArg(value)) {\n      this._maxRadius = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Get/Set the includerestricted query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  includeRestricted(value?: boolean): boolean | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._includeRestricted;\n    } else if (hasArgs(value)) {\n      this._includeRestricted = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /** Get/Set the includeavailability query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  includeAvailability(value?: boolean): boolean | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._includeAvailability;\n    } else if (hasArgs(value)) {\n      this._includeAvailability = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /** Get/Set the format query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  format(value?: string): string | StationQuery {\n    if (isStringArg(value)) {\n      this._format = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._format;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /** Get/Set the updatedafter query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  updatedAfter(value?: moment): moment | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._updatedAfter;\n    } else if (hasArgs(value)) {\n      this._updatedAfter = checkStringOrDate(value);\n      return this;\n    } else {\n      throw new Error('value argument is optional or moment or string, but was '+typeof value);\n    }\n  }\n  /** Get/Set the matchtimeseries query parameter.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  matchTimeseries(value?: boolean): boolean | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._matchTimeseries;\n    } else if (hasArgs(value)) {\n      this._matchTimeseries = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n  /** Get/Set the timeout in seconds for the request. Default is 30.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  timeout(value?: number): number | StationQuery {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n\n  /** Checks to see if any parameter that would limit the data\n   * returned is set. This is a crude, coarse check to make sure\n   * the client doesn't ask for EVERYTHING the server has.\n   *\n   * @returns true if some parameter set\n   * */\n  isSomeParameterSet(): boolean {\n    return isDef(this._networkCode) ||\n    isDef(this._stationCode) ||\n    isDef(this._locationCode) ||\n    isDef(this._channelCode) ||\n    isDef(this._startTime) ||\n    isDef(this._endTime) ||\n    isDef(this._startBefore) ||\n    isDef(this._endBefore) ||\n    isDef(this._startAfter) ||\n    isDef(this._endAfter) ||\n    isDef(this._minLat) ||\n    isDef(this._maxLat) ||\n    isDef(this._minLon) ||\n    isDef(this._maxLon) ||\n    isDef(this._latitude) ||\n    isDef(this._longitude) ||\n    isDef(this._minRadius) ||\n    isDef(this._maxRadius) ||\n    isDef(this._updatedAfter);\n  }\n\n  /**\n   * Queries the remote web service for networks.\n   *\n   * @returns a Promise to an Array of Network objects.\n   */\n  queryNetworks(): Promise<Array<Network>> {\n    return this.query(LEVEL_NETWORK);\n  }\n  /**\n   * Queries the remote web service for stations. The stations\n   * are contained within their respective Networks.\n   *\n   * @returns a Promise to an Array of Network objects.\n   */\n  queryStations(): Promise<Array<Network>> {\n    return this.query(LEVEL_STATION);\n  }\n  /**\n   * Queries the remote web service for channels. The Channels\n   * are contained within their respective Stations which are in Networks.\n   *\n   * @returns a Promise to an Array of Network objects.\n   */\n  queryChannels(): Promise<Array<Network>> {\n    return this.query(LEVEL_CHANNEL);\n  }\n  /**\n   * Queries the remote web service for responses. The Responses\n   * are contained within their respective Channels,\n   * which are in Stations which are in Networks.\n   *\n   * @returns a Promise to an Array of Network objects.\n   */\n  queryResponses(): Promise<Array<Network>> {\n    return this.query(LEVEL_RESPONSE);\n  }\n\n  /**\n   * Queries the remote web service at the given level.\n   *\n   * @param level the level to query at, networ, station, channel or response.\n   * @returns a Promise to an Array of Network objects.\n   */\n  query(level: string): Promise<Array<Network>> {\n    if (! LEVELS.includes(level)) {throw new Error(\"Unknown level: '\"+level+\"'\");}\n    return this.queryRawXml(level).then(function(rawXml) {\n        return parseStationXml(rawXml);\n    });\n  }\n\n  /**\n   * Queries the remote web service at the given level for raw xml.\n   *\n   * @param level the level to query at, network, station, channel or response.\n   * @returns a Promise to an xml Document.\n   */\n  queryRawXml(level: string): Promise<Document> {\n    const mythis = this;\n    const url = this.formURL(level);\n    const fetchInit = defaultFetchInitObj(XML_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else if (response.status === 204 || (mythis.nodata() && response.status === mythis.nodata())) {\n            // 204 is nodata, so successful but empty\n            return FAKE_EMPTY_XML;\n          } else {\n            throw new Error(`Status not successful: ${response.status}`);\n          }\n      }).then(function(rawXmlText) {\n        return new DOMParser().parseFromString(rawXmlText, \"text/xml\");\n      });\n  }\n\n  /**\n   * Forms the URL to get version from the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formVersionURL() {\n      return this.formBaseURL()+\"/version\";\n  }\n\n\n  /**\n   * Queries the remote web service to get its version\n   *\n   * @returns Promise to version string\n   */\n  queryVersion(): Promise<string> {\n    let url = this.formVersionURL();\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n  /**\n   * Forms the basic URL to contact the web service, without any query paramters\n   *\n   * @returns the url\n   */\n  formBaseURL() {\n    let colon = \":\";\n    if (this._protocol.endsWith(colon)) {\n      colon = \"\";\n    }\n    return this._protocol+colon+\"//\"+this._host+(this._port===80?\"\":(\":\"+this._port))+\"/fdsnws/station/\"+this._specVersion;\n  }\n  /**\n   * Form URL to query the remote web service, encoding the query parameters.\n   *\n   * @param level network, station, channel or response\n   * @returns url\n   */\n  formURL(level: string) {\n    let url = this.formBaseURL()+\"/query?\";\n    if (! isStringArg(level)) {throw new Error(\"level not specified, should be one of network, station, channel, response.\");}\n    url = url+makeParam(\"level\", level);\n    if (isStringArg(this._networkCode)) { url = url+makeParam(\"net\", this.networkCode());}\n    if (isStringArg(this._stationCode)) { url = url+makeParam(\"sta\", this.stationCode());}\n    if (isStringArg(this._locationCode)) { url = url+makeParam(\"loc\", this.locationCode());}\n    if (isStringArg(this._channelCode)) { url = url+makeParam(\"cha\", this.channelCode());}\n    if (isObject(this._startTime)) { url = url+makeParam(\"starttime\", toIsoWoZ(this.startTime()));}\n    if (isObject(this._endTime)) { url = url+makeParam(\"endtime\", toIsoWoZ(this.endTime()));}\n    if (isObject(this._startBefore)) { url = url+makeParam(\"startbefore\", toIsoWoZ(this.startBefore()));}\n    if (isObject(this._startAfter)) { url = url+makeParam(\"startafter\", toIsoWoZ(this.startAfter()));}\n    if (isObject(this._endBefore)) { url = url+makeParam(\"endbefore\", toIsoWoZ(this.endBefore()));}\n    if (isObject(this._endAfter)) { url = url+makeParam(\"endafter\", toIsoWoZ(this.endAfter()));}\n    if (isNumArg(this._minLat)) { url = url+makeParam(\"minlat\", this.minLat());}\n    if (isNumArg(this._maxLat)) { url = url+makeParam(\"maxlat\", this.maxLat());}\n    if (isNumArg(this._minLon)) { url = url+makeParam(\"minlon\", this.minLon());}\n    if (isNumArg(this._maxLon)) { url = url+makeParam(\"maxlon\", this.maxLon());}\n    if (isNumArg(this._latitude)) { url = url+makeParam(\"lat\", this.latitude());}\n    if (isNumArg(this._longitude)) { url = url+makeParam(\"lon\", this.longitude());}\n    if (isNumArg(this._minRadius)) { url = url+makeParam(\"minradius\", this.minRadius());}\n    if (isNumArg(this._maxRadius)) { url = url+makeParam(\"maxradius\", this.maxRadius());}\n    if (isDef(this._includeRestricted)) { url = url+makeParam(\"includerestricted\", this.includeRestricted());}\n    if (isDef(this._includeAvailability)) { url = url+makeParam(\"includeavailability\", this.includeAvailability());}\n    if (isObject(this._updatedAfter)) { url = url+makeParam(\"updatedafter\", toIsoWoZ(this.updatedAfter()));}\n    if (isDef(this._matchTimeseries)) { url = url+makeParam(\"matchtimeseries\", this.matchTimeseries());}\n    if (isStringArg(this._format)) { url = url+makeParam(\"format\", this.format());}\n    if (isNumArg(this._nodata)) { url = url+makeParam(\"nodata\", this.nodata());}\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n// special due to flow\nimport {checkProtocol, makeParam, isDef, hasArgs, hasNoArgs, isStringArg,\n        isNonEmptyStringArg, isNumArg} from './util';\n\nimport { TEXT_MIME, JSON_MIME , doFetchWithTimeout, defaultFetchInitObj} from './util.js';\n\nimport * as fdsnavailability from './fdsnavailability.js';\nimport * as fdsndataselect from './fdsndataselect.js';\nimport * as fdsnevent from './fdsnevent.js';\nimport * as fdsnstation from './fdsnstation.js';\n\n/** const for fdsn web service host, www.fdsn.org */\nexport const FDSN_HOST = \"www.fdsn.org\";\n\n/**\n * Query to a FDSN Data Centers Registry web service.\n *\n * @see http://www.fdsn.org/webservices/\n *\n * @param host optional host to connect to, defaults to FDSN\n */\nexport class DataCentersQuery {\n  /** @private */\n  _specVersion: number;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _port: number;\n  /** @private */\n  _name: string;\n  /** @private */\n  _services: string;\n  /** @private */\n  _includedatasets: boolean;\n  /** @private */\n  _timeoutSec: number;\n  constructor(host?: string) {\n    this._specVersion = 1;\n    this._protocol = checkProtocol();\n    if (isNonEmptyStringArg(host)) {\n      this._host = host;\n    } else {\n      this._host = FDSN_HOST;\n    }\n    this._port = 80;\n    this._timeoutSec = 30;\n  }\n  /** Gets/Sets the version of the fdsnws spec, 1 is currently the only value.\n   *  Setting this is probably a bad idea as the code may not be compatible with\n   *  the web service.\n   *\n   * @param value optional new value if setting\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  specVersion(value?: number): number | DataCentersQuery {\n    if (hasArgs(value)) {\n      this._specVersion = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._specVersion;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the protocol, http or https. This should match the protocol\n   *  of the page loaded, but is autocalculated and generally need not be set.\n   *\n   * @param value optional new value if setting\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  protocol(value?: string): string | DataCentersQuery {\n    if (isStringArg(value)) {\n      this._protocol = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._protocol;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the remote host to connect to. This defaults to\n   * www.fdsn.org and generally should not be set.\n   *\n   * @param value optional new value if setting\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  host(value?: string): string | DataCentersQuery {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n  /** Gets/Sets the remote port to connect to. This defaults to\n   * the standard port for the protocol and generally should not be set.\n   *\n   * @param value optional new value if setting\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  port(value?: number): number | DataCentersQuery {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (hasArgs(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n  /**\n   * limits results to the named data center, default is all data centers\n   *\n   * @param   value names to search for\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  name(value?: string): string | DataCentersQuery {\n    if (isStringArg(value)) {\n      this._name = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._name;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * limits results to services that match the glob style pattern\n   *\n   * @param  value glob style pattern to match against\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  services(value?: string): string | DataCentersQuery {\n    if (isStringArg(value)) {\n      this._services = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._services;\n    } else {\n      throw new Error('value argument is optional or string, but was '+value);\n    }\n  }\n  /**\n   * whether the results include detailed information about\n   * the data sets offered by each center, default is false\n   *\n   * @param  value true to include datasets\n   * @returns the query when setting, the current value os services if no arguments\n   */\n  includeDataSets(value?: boolean): boolean | DataCentersQuery {\n    if (hasNoArgs(value)) {\n      return this._includedatasets;\n    } else if (hasArgs(value)) {\n      this._includedatasets = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or boolean, but was '+typeof value);\n    }\n  }\n\n   /** Get/Set the timeout in seconds for the request. Default is 30.\n    *\n    * @param  value timeout seconds\n    * @returns the query when setting, the current value os services if no arguments\n    */\n  timeout(value?: number): number | DataCentersQuery {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n\n  /**\n   * queries the fdsn registry web service, returning the result as a parsed json object.\n   *\n   * @returns Promise to the json object.\n   */\n  queryJson(): Promise<RootType> {\n    const url = this.formURL();\n    const fetchInit = defaultFetchInitObj(JSON_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(function(response) {\n        let contentType = response.headers.get('content-type');\n        if(isNonEmptyStringArg(contentType) && contentType.includes(JSON_MIME)) {\n          return response.json();\n        }\n        // $FlowFixMe\n        throw new TypeError(`Oops, we did not get JSON! ${contentType}`);\n      });\n  }\n\n   /**\n    * queries the registry to find fdsn availability compatible web services within\n    * a datacenter of the given name, optionally within the repository with\n    * the repo name.\n    *\n    * @param   name     datacenter name\n    * @param   repoName optional repository name\n    * @returns           Promise to Array of fdsnavailability.AvailabilityQuery objects\n    */\n  findFdsnAvailability(name: string, repoName?: string): Promise<Array<fdsnavailability.AvailabilityQuery>> {\n    if (name && name.length > 0) {\n      this.name(name);\n    }\n    this.services(fdsnavailability.SERVICE_NAME);\n    return this.queryJson().then(json => {\n      let out = this.extractCompatibleServices(json, fdsnavailability.SERVICE_NAME, repoName);\n      return out.map(service => {\n        let url = new URL(service.url);\n        let q = new fdsnavailability.AvailabilityQuery(url.hostname);\n        if (url.port && url.port.length > 0) {q.port(Number.parseInt(url.port));}\n        return q;\n      });\n    });\n  }\n\n   /**\n    * queries the registry to find fdsn dataselect compatible web services within\n    * a datacenter of the given name, optionally within the repository with\n    * the repo name.\n    *\n    * @param   name     datacenter name\n    * @param   repoName optional repository name\n    * @returns           Promise to Array of fdsndataselect.DataSelectQuery objects\n    */\n  findFdsnDataSelect(name: string, repoName?: string): Promise<Array<fdsndataselect.DataSelectQuery>> {\n    if (name && name.length > 0) {\n      this.name(name);\n    }\n    this.services(fdsndataselect.SERVICE_NAME);\n    return this.queryJson().then(json => {\n      let out = this.extractCompatibleServices(json, fdsndataselect.SERVICE_NAME, repoName);\n      return out.map(service => {\n        let url = new URL(service.url);\n        let q = new fdsndataselect.DataSelectQuery(url.hostname);\n        if (url.port && url.port.length > 0) {q.port(Number.parseInt(url.port));}\n        return q;\n      });\n    });\n  }\n\n  /**\n   * queries the registry to find a fdsn event compatible web services within\n   * a datacenter of the given name, optionally within the repository with\n   * the repo name.\n   *\n   * @param   dcname     datacenter name\n   * @param   repoName optional repository name\n   * @returns           Promise to Array of fdsnevent.EventQuery objects\n   */\n  findFdsnEvent(dcname: string, repoName?: string ): Promise<Array<fdsnevent.EventQuery>> {\n    if (dcname && dcname.length > 0) {\n      this.name(dcname);\n    }\n    this.services(fdsnevent.SERVICE_NAME);\n    return this.queryJson().then(json => {\n      let out = this.extractCompatibleServices(json, fdsnevent.SERVICE_NAME, repoName);\n      return out.map(service => {\n        let url = new URL(service.url);\n        let q = new fdsnevent.EventQuery(url.hostname);\n        if (url.port && url.port.length > 0) {q.port(Number.parseInt(url.port));}\n        return q;\n      });\n    });\n  }\n\n   /**\n    * queries the registry to find a fdsn station compatible web services within\n    * a datacenter of the given name, optionally within the repository with\n    * the repo name.\n    *\n    * @param   dcname     datacenter name\n    * @param   repoName optional repository name\n    * @returns           Promise to Array of fdsnstation.StationQuery objects\n    */\n  findFdsnStation(dcname: string, repoName?: string ): Promise<Array<fdsnstation.StationQuery>> {\n    if (dcname && dcname.length > 0) {\n      this.name(dcname);\n    }\n    this.services(fdsnstation.SERVICE_NAME);\n    return this.queryJson().then(json => {\n      let out = this.extractCompatibleServices(json, fdsnstation.SERVICE_NAME, repoName);\n      return out.map(service => {\n        let url = new URL(service.url);\n        let q = new fdsnstation.StationQuery(url.hostname);\n        if (url.port && url.port.length > 0) {q.port(Number.parseInt(url.port));}\n        return q;\n      });\n    });\n  }\n\n/**\n * Extracts services comaptible with the given service name, optionally within\n * the given repository, from the json.\n *\n * @param   json           json containing services\n * @param   compatibleName service name to be compatible with\n * @param   repoName       optional repository within the json to search\n * @returns                array of services found\n */\n  extractCompatibleServices( json: RootType, compatibleName: string, repoName?: string): Array<any> {\n    let out = [];\n    json.datacenters.forEach( dc => {\n      dc.repositories.forEach( repo => {\n        if ( ! isDef(repoName) || repoName === repo.name) {\n          repo.services.forEach( service => {\n            if (service.name === compatibleName || (\n                isDef(service.compatibleWith) && service.compatibleWith.includes(compatibleName)) ) {\n              out.push(service);\n            }\n          });\n        }\n      });\n    });\n    return out;\n  }\n\n/**\n * Forms the base of the url for accessing the datacenters service.\n *\n * @returns         URL\n */\n  formBaseURL(): string {\n      let colon = \":\";\n      if (this._protocol.endsWith(colon)) {\n        colon = \"\";\n      }\n      return this._protocol+colon+\"//\"+this._host+(this._port===80?\"\":(\":\"+this._port))+\"/ws/datacenters/\"+this._specVersion;\n  }\n\n  /**\n   * Forms version url, not part of spec and so may not be supported.\n   *\n   * @returns         version\n   */\n  formVersionURL(): string {\n    return this.formBaseURL()+\"/version\";\n  }\n\n  /** Queries the remote web service to get its version\n   *\n   * @returns Promise to version string\n   */\n  queryVersion(): Promise<string> {\n    let url = this.formVersionURL();\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n\n\n  /**\n   * forms a url to the fdsn registry based on the configured parameters.\n   *\n   * @returns the url\n   */\n  formURL(): string {\n    const method = \"query\";\n    let url = this.formBaseURL()+`/${method}?`;\n    if (this._name) { url = url+makeParam(\"name\", this.name());}\n    if (this._services) { url = url+makeParam(\"services\", this.services());}\n    if (this._includedatasets) { url = url+makeParam(\"includedatasets\", this.includeDataSets());}\n\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n}\n\n\n\n/* original json schema from\nhttps://github.com/FDSN/datacenter-registry\n\n{\n    \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n    \"id\": \"http://www.fdsn.org/schemas/FDSN-datacenter-registry-1.0.schema.json\",\n    \"description\": \"Data center registry exchange format\",\n    \"definitions\": {\n        \"services\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"additionalProperties\": false,\n                \"required\": [\"name\"],\n                \"properties\": {\n                    \"name\": {\n                        \"description\": \"Service name (no white space)\",\n                        \"type\": \"string\",\n                        \"pattern\": \"^[-_a-zA-Z0-9]+$\"\n                    },\n                    \"description\": {\n                        \"description\": \"Description of service\",\n                        \"type\": \"string\"\n                    },\n                    \"url\": {\n                        \"description\": \"URL to web service, ideally with documentation\",\n                        \"type\": \"string\",\n                        \"format\": \"uri\"\n                    },\n                    \"compatibleWith\": {\n                        \"description\": \"Description of service compatibility with a standard or alternate service (e.g. fdsnws-dataselect, fdsnws-station, fdsnws-event)\",\n                        \"type\": \"string\"\n                    }\n                }\n            }\n        }\n    },\n    \"type\": \"object\",\n    \"required\": [\"version\", \"datacenters\"],\n    \"properties\": {\n        \"version\": {\n            \"description\": \"Data center registry message format version\",\n            \"const\": 1.0\n        },\n        \"datacenters\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"additionalProperties\": false,\n                \"required\": [\n                    \"name\",\n                    \"website\"\n                ],\n                \"properties\": {\n                    \"name\": {\n                        \"description\": \"Data center name (no white space)\",\n                        \"type\": \"string\",\n                        \"pattern\": \"^[-_a-zA-Z0-9]+$\"\n                    },\n                    \"website\": {\n                        \"description\": \"URL to data center website\",\n                        \"type\": \"string\",\n                        \"format\": \"uri\"\n                    },\n                    \"fullName\": {\n                        \"description\": \"Full name of data center\",\n                        \"type\": \"string\"\n                    },\n                    \"summary\": {\n                        \"description\": \"Summary of data center\",\n                        \"type\": \"string\"\n                    },\n                    \"repositories\": {\n                        \"description\": \"Repositories of data center\",\n                        \"type\": \"array\",\n                        \"items\": {\n                            \"type\": \"object\",\n                            \"additionalProperties\": false,\n                            \"required\": [\"name\"],\n                            \"properties\": {\n                                \"name\": {\n                                    \"description\": \"Repository name (no white space)\",\n                                    \"type\": \"string\",\n                                    \"pattern\": \"^[-_a-zA-Z0-9]+$\"\n                                },\n                                \"description\": {\n                                    \"description\": \"Description of repository\",\n                                    \"type\": \"string\"\n                                },\n                                \"website\": {\n                                    \"description\": \"URL to repository website\",\n                                    \"type\": \"string\",\n                                    \"format\": \"uri\"\n                                },\n                                \"services\": {\"$ref\": \"#/definitions/services\"},\n                                \"datasets\": {\n                                    \"description\": \"Data sets offered by the data center\",\n                                    \"type\": \"array\",\n                                    \"items\": {\n                                        \"type\": \"object\",\n                                        \"additionalProperties\": false,\n                                        \"properties\": {\n                                            \"network\": {\"type\": \"string\"},\n                                            \"station\": {\"type\": \"string\"},\n                                            \"location\": {\"type\": \"string\"},\n                                            \"channel\": {\"type\": \"string\"},\n                                            \"starttime\": {\n                                                \"type\": \"string\",\n                                                \"format\": \"date-time\"\n                                            },\n                                            \"endtime\": {\n                                                \"type\": \"string\",\n                                                \"format\": \"date-time\"\n                                            },\n                                            \"priority\": {\n                                                \"description\": \"Priority of data center for this data set, with 1 being highest\",\n                                                \"type\": \"integer\"\n                                            },\n                                            \"description\": {\n                                                \"description\": \"Description of data set\",\n                                                \"type\": \"string\"\n                                            },\n                                            \"url\": {\n                                                \"description\": \"URL to data set or summary page\",\n                                                \"type\": \"string\",\n                                                \"format\": \"uri\"\n                                            },\n                                            \"services\": {\n                                                \"description\": \"Services for this data set, overriding repository service declarations\",\n                                                \"$ref\": \"#/definitions/services\"\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n */\n\n/* The below are slighly modified from json schema to flow autogenerator.\n*\n* */\n\n/**\n * Root type of fdsn datacenters json query.\n */\nexport type RootType = {\n  version: Object,\n  datacenters: Array<{\n    name: string,\n    website: string,\n    fullName?: string,\n    summary?: string,\n    repositories: Array<Repository>\n  }>\n} & Object;\nexport type Repository = {\n  name: string,\n  description?: string,\n  website?: string,\n  services: Array<Service>,\n  datasets?: Array<Dataset>\n};\nexport type Dataset = {\n  network?: string,\n  station?: string,\n  location?: string,\n  channel?: string,\n  starttime?: string,\n  endtime?: string,\n  priority?: number,\n  description?: string,\n  url?: string,\n  services?: Array<Service>\n};\nexport type Service = {\n  name: string,\n  description?: string,\n  url?: string,\n  compatibleWith?: string\n};\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {Seismogram } from './seismogram.js';\nimport {InstrumentSensitivity} from './stationxml.js';\nimport {OregonDSP} from './oregondsputil.js';\nimport {isDef} from './util.js';\n\n\nconst CenteredHilbertTransform = OregonDSP.filter.fir.equiripple.CenteredHilbertTransform;\n\n\n/**\n * Constant for bandpass OregonDSP filter creation.\n */\nexport const BAND_PASS = OregonDSP.filter.iir.PassbandType.BANDPASS;\n/**\n * Constant for lowpass OregonDSP filter creation.\n */\nexport const LOW_PASS = OregonDSP.filter.iir.PassbandType.LOWPASS;\n/**\n * Constant for highpass OregonDSP filter creation.\n */\nexport const HIGH_PASS = OregonDSP.filter.iir.PassbandType.HIGHPASS;\n\nexport function amplitude(real: number, imag: number) {\n  return Math.hypot(real, imag);\n}\n\n/**\n * Remove the mean from a seismogram. Subtract the mean from each data point.\n *\n * @param   seis input seismogram\n * @returns       seismogram with mean of zero\n */\nexport function rMean(seis: Seismogram): Seismogram {\n  if (seis instanceof Seismogram) {\n    let meanVal = seis.mean();\n    let rmeanSeismogram = new Seismogram(seis.segments.map(s =>{\n        let demeanY = s.y.map(function(d) {\n          return d-meanVal;\n        });\n        let out = s.cloneWithNewData(demeanY);\n        return out;\n      }));\n    return rmeanSeismogram;\n  } else {\n    throw new Error(\"rMean arg not a Seismogram\");\n  }\n}\n\n/**\n * Apply the frequency independent overall gain to a seismogram. This does not\n * do a full transfer using poles and zero, this only applies the scalar conversion\n * factor to convert counts back to original real world units and update the units.\n *\n * @param   seis                  the seismogram to correct\n * @param   instrumentSensitivity overall gain object, usually pulled from stationxml\n * @returns                        new seismogram with original units, like m/s and gain applied.\n */\nexport function gainCorrect(seis: Seismogram, instrumentSensitivity: InstrumentSensitivity): Seismogram {\n  if (seis instanceof Seismogram) {\n    let gain = instrumentSensitivity.sensitivity;\n    let gainSeismogram = new Seismogram(seis.segments.map(s => {\n      let gainY;\n      if ( s.y instanceof Int32Array || s.y instanceof Float32Array) {\n        gainY = Float32Array.from(s.y);\n      } else {\n        gainY = Float64Array.from(s.y);\n      }\n      gainY = gainY.map(function(d) {\n        return d/gain;\n      });\n      let outS = s.cloneWithNewData(gainY);\n      outS.yUnit = instrumentSensitivity.inputUnits;\n      return outS;\n      }));\n    return gainSeismogram;\n  } else {\n      throw new Error(`Expected Seismogram but was ${typeof seis}`);\n  }\n}\n\nexport type MinMaxMean = {\n  min: number;\n  max: number;\n  mean: number;\n};\n\n\n/**\n * Creates a Butterworth IIR filter using the OregonDSP library.\n *\n * @param   numPoles       number of poles\n * @param   passband       type, use constants of BAND_PASS, LOW_PASS, HIGH_PASS\n * @param   lowFreqCorner  low corner frequency\n * @param   highFreqCorner high corner frequency\n * @param   delta          delta, period, of timeseries\n * @returns                 Butterworth IIR filter\n */\nexport function createButterworth(numPoles: number,\n                                  passband: string,\n                                  lowFreqCorner: number,\n                                  highFreqCorner: number,\n                                  delta: number) {\n  return new OregonDSP.filter.iir.Butterworth(numPoles,\n                                     passband,\n                                     lowFreqCorner,\n                                     highFreqCorner,\n                                     delta);\n}\n\n/**\n * Creates a Chebyshev I IIR filter using the OregonDSP library.\n *\n * @param   numPoles       number of poles\n * @param   epsilon        Chebyshev epsilon value\n * @param   passband       type, use constants of BAND_PASS, LOW_PASS, HIGH_PASS\n * @param   lowFreqCorner  low corner frequency\n * @param   highFreqCorner high corner frequency\n * @param   delta          delta, period, of timeseries\n * @returns                 Chebyshev I IIR filter\n */\nexport function createChebyshevI(numPoles: number,\n                                  epsilon: number,\n                                  passband: string,\n                                  lowFreqCorner: number,\n                                  highFreqCorner: number,\n                                  delta: number) {\n  return new OregonDSP.filter.iir.ChebyshevI(numPoles,\n                                    epsilon,\n                                    passband,\n                                    lowFreqCorner,\n                                    highFreqCorner,\n                                    delta);\n}\n\n/**\n * Creates a Chebyshev II IIR filter using the OregonDSP library.\n *\n * @param   numPoles       number of poles\n * @param   epsilon        Chebyshev epsilon value\n * @param   passband       type, use constants of BAND_PASS, LOW_PASS, HIGH_PASS\n * @param   lowFreqCorner  low corner frequency\n * @param   highFreqCorner high corner frequency\n * @param   delta          delta, period, of timeseries\n * @returns                 Chebyshev II IIR filter\n */\nexport function createChebyshevII(numPoles: number,\n                                  epsilon: number,\n                                  passband: string,\n                                  lowFreqCorner: number,\n                                  highFreqCorner: number,\n                                  delta: number) {\n  return new OregonDSP.filter.iir.ChebyshevII(numPoles,\n                                     epsilon,\n                                     passband,\n                                     lowFreqCorner,\n                                     highFreqCorner,\n                                     delta);\n}\n\n/**\n * Applies the filter to the given seismogram.\n *\n * @param   iirFilter filter to apply\n * @param   seis      seismogram to apply filter to\n * @returns            filtered seismogram\n */\nexport function applyFilter(iirFilter: OregonDSP.filter.iir.IIRFilter, seis: Seismogram): Seismogram {\n  let filteredSegments = [];\n  for(let i=0; i<seis.segments.length; i++) {\n    let outData = Float32Array.from(seis.segments[i].y);\n    iirFilter.filterInPlace(outData);\n    filteredSegments.push(seis.segments[i].cloneWithNewData(outData));\n  }\n  return new Seismogram(filteredSegments);\n}\n\n\n/**\n * Calculates the envelope, y_i = sqrt( y_i * y_i + h_i * h_i)\n *  where h is the hilber transform of y. The default configuration\n *  for the hilbet transform is n=100, lowEdge=.05 and highEdge = 0.95\n *\n * @param seis seismogram to apply envelope to\n * @returns seismogram cloned but with data as the envelope\n */\nexport function envelope(seis: Seismogram): Seismogram {\n  if (seis.isContiguous()) {\n    let seisY = seis.y;\n    let s = hilbert(seis);\n    let hilbertY = s.y;\n    let outY;\n    if ( seis.y instanceof Int32Array || seis.y instanceof Float32Array) {\n      outY = new Float32Array(seisY.length);\n    } else {\n      outY = new Float64Array(seisY.length);\n    }\n    for(let n=0; n<seisY.length; n++) {\n      outY[n] = Math.sqrt(hilbertY[n]*hilbertY[n] + seisY[n]*seisY[n]);\n    }\n    return seis.cloneWithNewData(outY);\n  } else {\n    throw new Error(\"Cannot take envelope of non-contiguous seismogram\");\n  }\n}\n\n/**\n * Calculates the hilbert transform using the OregonDSP library\n *  with default number of points, n=10 (to yield a 21 pt FIR transform)\n *  and default low and high edge of 0.05 and 0.95. Low and high edge are\n *  given normalized 0 to 1.\n *\n * @param seis seismogram to calculate from\n * @param n optional number of points in transform, default is 10\n * @param lowEdge low edge of filter, normailized to 0-1, default is 0.05\n * @param highEdge high edge of filter, normailized to 0-1, default is 0.95\n * @returns hilbert transformed data\n *\n */\nexport function hilbert(seis: Seismogram, n?: number, lowEdge?: number, highEdge?: number ): Seismogram {\n  if (seis.isContiguous()) {\n    let seisY = seis.y;\n    if (! isDef(n)) { n = 10;}\n    if (! isDef(lowEdge)) { lowEdge = .05;}\n    if (! isDef(highEdge)) { highEdge = .95;}\n    let hilbert = new CenteredHilbertTransform(n, lowEdge, highEdge);\n    let coeff = hilbert.getCoefficients();\n    for (let c of coeff) {\n      if ( Number.isNaN(c)) {\n        throw new Error(`Hilbert FIR coeff includes NaN: ${coeff.join()}`);\n      }\n    }\n    let hilbertY = hilbert.filter(seisY);\n    let s = seis.cloneWithNewData(hilbertY);\n    return s;\n  } else {\n    throw new Error(\"Cannot take hilbert of non-contiguous seismogram\");\n  }\n}\n","//@flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {Seismogram } from './seismogram.js';\n\nimport {OregonDSP, Complex, createComplex} from './oregondsputil.js';\n\n/** A higher level function to calculate DFT. Returns a\n * FFTResult for easier access to the result as\n * complex, amp, phase arrays. Calls calcDFT internally.\n * Inverse FFT is available as FFTResult.fftInverse().\n *\n * @param seis seismogram to transform\n * @returns fft of seismogram\n */\nexport function fftForward(seis: Seismogram) {\n  if ( seis.isContiguous()) {\n    let result = FFTResult.createFromPackedFreq(calcDFT(seis.y), seis.numPoints, seis.sampleRate);\n    return result;\n  } else {\n    throw new Error(\"Can only take FFT is seismogram is contiguous.\");\n  }\n}\n\n/**\n * Calculates the discrete fourier transform using the OregonDSP library.\n *\n * @param   timeseries timeseries array\n * @returns           DFT as packed array Float32Array\n */\nexport function calcDFT(timeseries: Int32Array | Float32Array | Float64Array): Float32Array {\n  let log2N = 4;\n  let npts = timeseries.length;\n  let N = 16;\n  while(N < npts) { log2N += 1; N = 2 * N;}\n  let dft = new OregonDSP.fft.RDFT(log2N);\n  let inArray = new Float32Array(N);\n  inArray.fill(0);\n  for(let i=0; i<timeseries.length; i++) {\n    inArray[i] = timeseries[i];\n  }\n\n  let out = new Float32Array(N).fill(0);\n  dft.evaluate(inArray, out);\n  return out;\n}\n\n/**\n * Calculates the inverse discrete fourier transform using the OregonDSP library.\n *\n * @param   packedFreq DFT as packed array Float32Array\n * @param   numPoints     number of points in original timeseries array.\n * @returns           inverse of DFT as a timeseries array\n */\nexport function inverseDFT(packedFreq: Float32Array, numPoints: number): Float32Array {\n  if (numPoints > packedFreq.length) {\n    throw new Error(\"Not enough points in packed freq array for \"+numPoints+\", only \"+packedFreq.length);\n  }\n  let log2N = 4;\n  let N = 16;\n  while(N < packedFreq.length) { log2N += 1; N = 2 * N;}\n  if (N !== packedFreq.length) {\n    throw new Error(\"power of two check fails: \"+N+\" \"+packedFreq.length);\n  }\n  let dft = new OregonDSP.fft.RDFT(log2N);\n  let out = new Float32Array(N).fill(0);\n  dft.evaluateInverse(packedFreq, out);\n  return out.slice(0, numPoints);\n}\n\n/**\n * Results of FFT calculateion. Allows convertion of the packed real/imag array output from calcDFT into\n * amplitude and phase.\n */\nexport class FFTResult {\n/** number of points in the original timeseries, may be less than fft size. */\n  origLength: number;\n  packedFreq: Float32Array;\n  complex: Array<Complex>;\n  amp: Float32Array;\n  phase: Float32Array;\n  /** number of points in the fft, usually power of 2 larger than origLength. */\n  numPoints: number;\n  /** sample rate of the original time series, maybe be null. */\n  sampleRate: number;\n  constructor(origLength: number, sampleRate: number) {\n      this.origLength = origLength;\n      this.sampleRate = sampleRate;\n  }\n  /**\n   * Factory method to create FFTResult from packed array.\n   *\n   * @param   packedFreq real and imag values in packed format\n   * @param   origLength length of the original timeseries before padding.\n   * @param   sampleRate sample rate of original data\n   * @returns            FFTResult\n   */\n  static createFromPackedFreq(packedFreq: Float32Array, origLength: number, sampleRate: number) {\n    let fftResult = new FFTResult(origLength, sampleRate);\n    fftResult.packedFreq = packedFreq;\n    fftResult.recalcFromPackedFreq();\n    return fftResult;\n  }\n  /**\n   * Factory method to create from array of complex numbers.\n   *\n   * @param   complexArray real and imag values as array of Complex objects.\n   * @param   origLength   length of the original timeseries before padding.\n   * @param   sampleRate sample rate of original data\n   * @returns               FFTResult\n   */\n  static createFromComplex(complexArray: Array<Complex>, origLength: number, sampleRate: number) {\n    let fftResult = new FFTResult(origLength, sampleRate);\n    fftResult.complex = complexArray;\n    fftResult.recalcFromComplex();\n    return fftResult;\n  }\n  /**\n   * Factory method to create from amp and phase arrays\n   *\n   * @param   amp        amplitude values\n   * @param   phase      phase values\n   * @param   origLength length of the original timeseries before padding.\n   * @param   sampleRate sample rate of original data\n   * @returns             FFTResult\n   */\n  static createFromAmpPhase(amp: Float32Array, phase: Float32Array, origLength: number, sampleRate: number) {\n    let fftResult = new FFTResult(origLength, sampleRate);\n    if (amp.length !== phase.length) {throw new Error(`amp and phase must be same length: ${amp.length} ${phase.length}`);}\n    fftResult.amp = amp;\n    fftResult.phase = phase;\n    fftResult.recalcFromAmpPhase();\n    return fftResult;\n  }\n  /**\n   * The minimum non-zero frequency in the fft\n   *\n   * @returns fundamental frequency\n   */\n  get fundamentalFrequency() {\n    if (this.sampleRate) {\n      return this.sampleRate/this.numPoints;\n    } else {\n      throw new Error(\"sample rate not set on FFTResult, needed to calc min frequency\");\n    }\n  }\n  recalcFromPackedFreq(): void {\n    this.complex = [];\n    this.amp = new Float32Array(this.packedFreq.length/2+1);\n    this.phase = new Float32Array(this.packedFreq.length/2+1);\n    this.numPoints = this.packedFreq.length;\n\n    let c = createComplex(this.packedFreq[0], 0);\n    this.complex.push(c);\n    this.amp[0] = c.abs();\n    this.phase[0] = c.angle();\n    const L = this.packedFreq.length;\n    for(let i=1; i<this.packedFreq.length/2; i++) {\n      c = createComplex(this.packedFreq[i], this.packedFreq[L-i]);\n      this.complex.push(c);\n      this.amp[i] = c.abs();\n      this.phase[i] = c.angle();\n    }\n    c = createComplex(this.packedFreq[L/2], 0);\n    this.complex.push(c);\n    this.amp[this.packedFreq.length/2] = c.abs();\n    this.phase[this.packedFreq.length/2] = c.angle();\n  }\n  /**\n   * recalculate the packedFreq array after modifications\n   * to the complex array.\n   * */\n  recalcFromComplex() {\n    const N = this.complex.length;\n    let modFreq = new Float32Array(N).fill(0);\n    modFreq[0] = this.complex[0].real;\n    for (let i=1; i< this.complex.length-1; i++) {\n      modFreq[i] = this.complex[i].real;\n      modFreq[N-i] = this.complex[i].imag;\n    }\n    modFreq[N/2] = this.complex[N-1].real;\n    this.packedFreq = modFreq;\n    this.numPoints = this.packedFreq.length;\n  }\n  /**\n   * recalculate the packedFreq array after modifications\n   * to the amp and/or phase arrays.\n   */\n  recalcFromAmpPhase() {\n    let modComplex = new Array(this.amp.length);\n    for (let i=0; i< this.amp.length; i++) {\n      modComplex[i] = OregonDSP.filter.iir.Complex.Companion.ComplexFromPolar(this.amp[i], this.phase[i]);\n    }\n    this.complex = modComplex;\n    this.recalcFromComplex();\n  }\n  /**\n   * calculates the inverse fft of this.packedFreq\n   *\n   * @returns time domain representation\n   */\n  fftInverse() {\n    return inverseDFT(this.packedFreq, this.origLength);\n  }\n  clone() {\n    return FFTResult.createFromPackedFreq(this.packedFreq.slice(), this.origLength, this.sampleRate);\n  }\n}\n","//@flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport { SeismogramDisplayData, Seismogram } from './seismogram.js';\nimport {StartEndDuration, isDef } from './util.js';\nimport moment from 'moment';\nimport * as d3 from 'd3';\n\nexport type MarginType = {\n  top: number,\n  right: number,\n  bottom: number,\n  left: number\n};\n\n/** Constant for drawing seismogram using svg. */\nexport const DRAW_SVG = \"svg\";\n/** Constant for drawing seismogram using canvas, axies are still svg. */\nexport const DRAW_CANVAS = \"canvas\";\n/** Constant for drawing seismogram using both canvas and svg, for testing. */\nexport const DRAW_BOTH = \"both\"; // for testing\n/** Constant for drawing seismogram using both canvas and svg plus alignment markers, for testing. */\nexport const DRAW_BOTH_ALIGN = \"alignment\"; // for testing\n\n/**\n * Configuration object for Seismograph display.\n * \n */\nexport class SeismographConfig {\n  drawingType: string;\n  xScaleFormat: (date: Date) => string;\n  yScaleFormat: string | (value: number) => string;\n  _title: Array<string>;\n  isXAxis: boolean;\n  isXAxisTop: boolean;\n  xLabel: string;\n  xLabelOrientation: string;\n  xSublabel: string;\n  isYAxis: boolean;\n  isYAxisRight: boolean;\n  isYAxisNice: boolean;\n  yLabel: string;\n  yLabelRight: string;\n  yLabelOrientation: string;\n  ySublabel: string;\n  ySublabelTrans: number;\n  ySublabelIsUnits: boolean;\n  doMarkers: boolean;\n  markerTextOffset: number;\n  markerTextAngle: number;\n  markerFlagpoleBase: string;\n  minHeight: number;\n  maxHeight: number;\n  margin: MarginType;\n  segmentDrawCompressedCutoff: number;//below this draw all points, above draw minmax\n  maxZoomPixelPerSample: number; // no zoom in past point of sample\n                                 // separated by pixels\n\n  connectSegments: boolean;\n  lineColors: Array<string>;\n  lineWidth: number;\n  wheelZoom: boolean;\n  doRMean: boolean;\n  doGain: boolean;\n  windowAmp: boolean;\n  fixedYScale: null | Array<number>;\n  fixedTimeScale: null | StartEndDuration;\n\n  constructor() {\n    this.drawingType = DRAW_CANVAS;\n    this.isXAxis = true;\n    this.isXAxisTop = false;\n    this.isYAxisNice = true;\n    this.isYAxis = true;\n    this.isYAxisRight = false;\n    this.xScaleFormat = multiFormatHour;\n    this.yScaleFormat = formatCountOrAmp;\n    this._title = [ ];\n    this.xLabel = \"Time\";\n    this.xLabelOrientation = \"horizontal\";\n    this.xSublabel = \"\";\n    this.yLabel = \"Amplitude\";\n    this.yLabelRight = \"\";\n    this.yLabelOrientation = \"vertical\";\n    this.ySublabel = \"\";\n    this.ySublabelTrans = 15;\n    this.ySublabelIsUnits = true;\n    this.doRMean = true;\n    this.doGain = true;\n    this.windowAmp = true;\n    this.fixedYScale = null;\n    this.fixedTimeScale = null;\n    this.doMarkers = true;\n    this.markerTextOffset = .85;\n    this.markerTextAngle = 45;\n    this.markerFlagpoleBase = \"bottom\"; // bottom or center\n    this.minHeight=0;\n    this.margin = {top: 20, right: 20, bottom: 42, left: 85, toString: function() {return \"t:\"+this.top+\" l:\"+this.left+\" b:\"+this.bottom+\" r:\"+this.right;}};\n    this.segmentDrawCompressedCutoff=10;//below this draw all points, above draw minmax\n    this.maxZoomPixelPerSample = 20; // no zoom in past point of sample\n                                     // separated by pixels\n\n    this.wheelZoom = true;\n    this.connectSegments = false;\n    this.lineColors = [\n       \"skyblue\",\n       \"olivedrab\",\n       \"goldenrod\",\n       \"firebrick\",\n       \"darkcyan\",\n       \"orange\",\n       \"darkmagenta\",\n       \"mediumvioletred\",\n       \"sienna\",\n       \"black\"];\n    this.lineWidth = 1;\n  }\n\n/**\n * gets the current title\n *\n * @returns        title as an array of strings\n */\n  get title(): Array<string> {\n    return this._title;\n  }\n  /**\n   * Sets the title as simple string or array of strings. If an array\n   * then each item will be in a separate tspan for easier formatting.\n   *\n   * @param value string or array of strings to be the title\n   */\n  set title(value: string | Array<string>) {\n    if (Array.isArray(value)) {\n      this._title = value;\n    } else {\n      this._title = [ value ];\n    }\n  }\n\n  /** Fake data to use to test alignment of seismograph axis and between canvas\n   *  and svg drawing.\n   *\n   * @param   timeWindow start and end of fake data\n   * @param   min        min amplitude for fake data, default is -100\n   * @param   max        max amplitude for fake data, default is 100\n   * @returns             fake data\n   */\n  createAlignmentData(timeWindow: StartEndDuration,\n        min: number = -100,\n        max: number = 100): SeismogramDisplayData {\n    const mid = (max+min)/2;\n    const fakeData = Float32Array.from([max, min, max, min, mid, mid, max, mid, mid, min]);\n\n    const fakeSampleRate = 1/(timeWindow.duration.asSeconds()/(fakeData.length-1));\n    const fakeSeis = Seismogram.createFromContiguousData(fakeData,\n                                          fakeSampleRate,\n                                          timeWindow.startTime );\n    const fakeSDD = SeismogramDisplayData.fromSeismogram(fakeSeis);\n    return fakeSDD;\n  }\n\n  getColorForIndex(i: number): string {\n    if (isDef(this.lineColors) && this.lineColors.length > 0) {\n      return this.lineColors[i%this.lineColors.length];\n    } else {\n        return \"black\";\n    }\n  }\n  clone(): SeismographConfig {\n    let out = new SeismographConfig();\n    Object.getOwnPropertyNames(this).forEach( name => {\n      // $FlowFixMe\n      if (this[name] instanceof moment) {\n        // $FlowFixMe\n        out[name] = moment.utc(this[name]);\n        // $FlowFixMe\n      } else if ( Array.isArray(this[name]) ) {\n        // $FlowFixMe\n        out[name] = this[name].slice();\n      } else {\n        // $FlowFixMe\n        out[name] = this[name];\n      }\n      // handle margin separately\n      out.margin = {\n        top: this.margin.top,\n        right: this.margin.right,\n        bottom: this.margin.bottom,\n        left: this.margin.left,\n        toString: function() {return \"t:\"+this.top+\" l:\"+this.left+\" b:\"+this.bottom+\" r:\"+this.right;}\n      };\n    });\n    return out;\n  }\n  toString() {\n    let outS = \"\";\n    Object.getOwnPropertyNames(this).forEach( name => {\n      // $FlowFixMe\n      outS += `  seisConfig.${name} = ${JSON.stringify(this[name])}\\n`;\n    });\n    return outS;\n  }\n}\n\nexport const formatCount = d3.format('~s');\nexport const formatExp = d3.format('.2e');\nexport const formatCountOrAmp = function(v: number): string {\n  return -1<v && v<1 && v !== 0 ? formatExp(v) : formatCount(v);\n};\n\nexport const formatMillisecond = d3.utcFormat(\".%L\");\nexport const formatSecond = d3.utcFormat(\":%S\");\nexport const formatMinute = d3.utcFormat(\"%H:%M\");\nexport const formatHour = d3.utcFormat(\"%H:%M\");\nexport const formatDay = d3.utcFormat(\"%m/%d\");\nexport const formatMonth = d3.utcFormat(\"%Y/%m\");\nexport const formatYear = d3.utcFormat(\"%Y\");\n\nexport const multiFormatHour = function(date: Date): string {\n  return (d3.utcSecond(date) < date ? formatMillisecond\n      : d3.utcMinute(date) < date ? formatSecond\n      : d3.utcHour(date) < date ? formatMinute\n      : d3.utcDay(date) < date ? formatHour\n      : d3.utcMonth(date) < date ?  formatDay\n      : d3.utcYear(date) < date ? formatMonth\n      : formatYear)(date);\n};\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {FFTResult} from './fft.js';\nimport { SeismographConfig } from './seismographconfig';\n\nimport * as d3 from 'd3';\n\nimport {insertCSS} from './cssutil.js';\n\n/**\n * Create a single amplitude plot of FFT data.\n *\n * @param   cssSelector selection of the containing element, usually a div\n * @param   fftResult         data to plot\n * @param   config configuration of the plot, note not all options are supported by fft plots\n * @param   loglog      true for loglog plot, false for linlog\n * @returns             the plot\n */\nexport function createSimpleFFTPlot(cssSelector: string, fftResult: FFTResult, config: SeismographConfig, loglog: boolean = true) {\n  let fftplot =  new FFTPlot(cssSelector, config, fftResult, loglog);\n  fftplot.draw();\n  return fftplot;\n}\n\n/**\n * Create a amplitude plot of multiple FFT data.\n *\n * @param   cssSelector selection of the containing element, usually a div\n * @param   fftResults         data to plot\n * @param   config configuration of the plot, note not all options are supported by fft plots\n * @param   loglog      true for loglog plot, false for linlog\n * @returns             the plot\n */\nexport function createOverlayFFTPlot(cssSelector: string, fftResults: Array<FFTResult>, config: SeismographConfig = new SeismographConfig(), loglog: boolean = true) {\n  let fftplot =  new FFTPlot(cssSelector, config, fftResults, loglog);\n  fftplot.draw();\n  return fftplot;\n}\n\n/**\n * A amplitude plot of fft data.\n *\n * @param cssSelector selector or d3 selection\n * @param seismographConfig config of the plot, not all values are used\n * @param fftResult fft data to plot\n * @param loglog log or linear frequency\n */\nexport class FFTPlot {\n  svgParent: any;\n  seismographConfig: SeismographConfig;\n  fftResults: Array<FFTResult>;\n  xScale: d3.scale;\n  yScale: d3.scale;\n  svg: any;\n  loglog: boolean;\n  constructor(cssSelector: string,\n              seismographConfig: SeismographConfig,\n              fftResult: FFTResult | Array<FFTResult>,\n              loglog: boolean = true) {\n    this.svgParent = cssSelector;\n    this.seismographConfig = seismographConfig;\n    this.fftResults = Array.isArray(fftResult) ? fftResult : [fftResult];\n    this.xScale = null;\n    this.yScale = null;\n    this.svg = null;\n    this.loglog = loglog;\n    if (typeof cssSelector === 'string') {\n      this.svgParent = d3.select(cssSelector);\n    } else {\n      this.svgParent = cssSelector;\n    }\n\n  }\n  draw() {\n    const that = this;\n    let ampPhaseList = [];\n    let ampSliceMap = new Map();\n    let maxFFTAmpLen = 0;\n    let extentFFTData = null;\n    let freqMinMax = [];\n    for (const fftA of this.fftResults) {\n      if (this.loglog) {\n        freqMinMax.push(fftA.fundamentalFrequency); // min freq\n      } else {\n        freqMinMax.push(0);\n      }\n      freqMinMax.push(fftA.sampleRate/2); // max freq\n      let ap: FFTResult;\n      if (fftA instanceof FFTResult) {\n        ap = fftA;\n      } else {\n        throw new Error(\"fftResults must be array of FFTResult\");\n      }\n      ampPhaseList.push(ap);\n      if (maxFFTAmpLen < ap.amp.length) {\n        maxFFTAmpLen = ap.amp.length;\n      }\n      let ampSlice;\n      if (this.loglog) {\n        // don't plot zero freq amp\n        ampSlice = ap.amp.slice(1);\n      } else {\n        ampSlice = ap.amp;\n      }\n      let currExtent = d3.extent(ampSlice);\n      if (currExtent[0] === 0) {\n        // replace zero with smallest non-zero / 10 for loglog plot\n        currExtent[0] = 0.1 * ampSlice.reduce((acc, curr) => {\n          if (curr > 0 && curr < acc) {\n            return curr;\n          } else {\n            return acc;\n          }\n          }, 1e-9);\n      }\n      ampSliceMap.set(ap, ampSlice);\n      if (extentFFTData) {\n        extentFFTData = d3.extent([ extentFFTData[0],\n                                    extentFFTData[1],\n                                    currExtent[0],\n                                    currExtent[1]],\n                                    function(d) { return d; });\n      } else {\n        extentFFTData = currExtent;\n      }\n    }\n\n    let svg = this.svgParent.append(\"svg\");\n    this.svg = svg;\n    svg.classed(\"fftplot\", true);\n\n\n    let rect = svg.node().getBoundingClientRect();\n\n    let width = +rect.width - this.seismographConfig.margin.left - this.seismographConfig.margin.right;\n    let height = +rect.height - this.seismographConfig.margin.top - this.seismographConfig.margin.bottom;\n    let g = svg.append(\"g\").attr(\"transform\", \"translate(\" + this.seismographConfig.margin.left + \",\" + this.seismographConfig.margin.top + \")\");\n\n    if (this.loglog) {\n      this.xScale = d3.scaleLog()\n          .rangeRound([0, width]);\n    } else {\n      this.xScale = d3.scaleLinear()\n          .rangeRound([0, width]);\n    }\n    this.xScale.domain(d3.extent(freqMinMax));\n    this.yScale = d3.scaleLog()\n        .rangeRound([height, 0]);\n    this.yScale.domain(extentFFTData);\n    if (this.yScale.domain()[0] === this.yScale.domain()[1]) {\n      this.yScale.domain( [ this.yScale.domain()[0]/2, this.yScale.domain()[1]*2]);\n    }\n    const xAxis = d3.axisBottom(this.xScale);\n    g.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        .call(xAxis);\n    g.append(\"g\")\n        .attr(\"transform\", `translate(0, ${height+ this.seismographConfig.margin.bottom} )`)\n      .append(\"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"y\", 0)\n        .attr(\"x\", width/2)\n        .attr(\"dy\", \"0.71em\")\n        .attr(\"text-anchor\", \"end\")\n        .text(\"Hertz\");\n\n    const yAxis = d3.axisLeft(this.yScale);\n    g.append(\"g\")\n        .call(yAxis);\n    svg.append(\"g\")\n        .attr(\"transform\", `translate(0, ${this.seismographConfig.margin.top+height/2} )`)\n      .append(\"text\")\n        .attr(\"fill\", \"#000\")\n        .attr(\"dy\", \"0.71em\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"text-anchor\", \"end\")\n        .text(\"Amp\");\n    let pathg = g.append(\"g\").classed(\"allfftpaths\", true);\n    for (const ap of ampPhaseList) {\n      let ampSlice = ampSliceMap.get(ap);\n      let minFreq = ap.fundamentalFrequency;\n      let line = d3.line();\n      if (this.loglog) {\n        line.x(function(d, i) { return that.xScale((i+1)*minFreq); });\n        // minus one as slice off zero freq above\n      } else {\n        line.x(function(d, i) { return that.xScale((i  )*minFreq); });\n      }\n      line.y(function(d) {if (d !== 0.0 && ! isNaN(d)) {return that.yScale(d);} else {return that.yScale.range()[0];} });\n      pathg.append(\"g\").append(\"path\")\n          .classed(\"fftpath\", true)\n          .datum(ampSlice)\n          .attr(\"d\", line);\n    }\n    return this;\n  }\n}\n\n/**\n * Defualt CSS for styling fft plots.\n */\nexport const fftplot_css = `\n\n\npath.fftpath {\n  stroke: skyblue;\n  fill: none;\n  stroke-width: 1px;\n}\n\nsvg.fftplot {\n  height: 100%;\n  width: 100%;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+1) path.fftpath {\n  stroke: skyblue;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+2) path.fftpath {\n  stroke: olivedrab;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+3) path.fftpath {\n  stroke: goldenrod;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+4) path.fftpath {\n  stroke: firebrick;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+5) path.fftpath {\n  stroke: darkcyan;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+6) path.fftpath {\n  stroke: orange;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+7) path.fftpath {\n  stroke: darkmagenta;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+8) path.fftpath {\n  stroke: mediumvioletred;\n}\n\nsvg.fftplot g.allfftpaths g:nth-child(9n+9) path.fftpath {\n  stroke: sienna;\n}\n\n/* same colors for titles */\n\nsvg.fftplot g.title tspan:nth-child(9n+1)  {\n  fill: skyblue;\n}\n\nsvg.fftplot g.title text tspan:nth-child(9n+2)  {\n  stroke: olivedrab;\n}\n\nsvg.fftplot g.title text tspan:nth-child(9n+3)  {\n  stroke: goldenrod;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+4)  {\n  stroke: firebrick;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+5)  {\n  stroke: darkcyan;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+6)  {\n  stroke: orange;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+7)  {\n  stroke: darkmagenta;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+8)  {\n  stroke: mediumvioletred;\n}\n\nsvg.fftplot g.title tspan:nth-child(9n+9)  {\n  stroke: sienna;\n}\n\n\n/* links in svg */\nsvg.fftplot text a {\n  fill: #0000EE;\n  text-decoration: underline;\n}\n\n`;\n\nif (document){\n  insertCSS(fftplot_css);\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n\nimport moment from 'moment';\nimport * as d3 from 'd3';\n\nimport {insertCSS} from './cssutil.js';\n\nimport {SeismographConfig,\n        DRAW_SVG, DRAW_CANVAS, DRAW_BOTH, DRAW_BOTH_ALIGN} from './seismographconfig';\nimport type { MarkerType } from './seismogram.js';\nimport type { MarginType } from './seismographconfig';\nimport {SeismogramDisplayData, findStartEnd, findMinMax, findMinMaxOverTimeRange,\n        SeismogramSegment, Seismogram, COUNT_UNIT } from './seismogram.js';\nimport {Quake} from './quakeml.js';\n\nimport * as util from './util.js';\nimport {StartEndDuration, isDef, isNumArg } from './util';\n\n\n\nconst CLIP_PREFIX = \"seismographclip\";\n\n\nexport type ScaleChangeListenerType = {\n  destinationKey: any,\n  notifyScaleChange: (value: any) => void\n}\n\n/* A seismogram plot, using d3. The actual waveform can be drawn\n  * with a separate Canvas (default) or with SVG.\n  * Note that for SVG you must have\n  * stroke and fill set in css like:<br>\n  * path.seispath {\n  *   stroke: skyblue;\n  *   fill: none;\n  * }<br/>\n  * in order to have the seismogram display.\n  */\nexport class Seismograph {\n  /** @private */\n  static _lastID: number;\n  plotId: number;\n  beforeFirstDraw: boolean;\n\n  svgParent: any;\n  seismographConfig: SeismographConfig;\n  seisDataList: Array<SeismogramDisplayData>;\n  alignmentSeisData: Array<SeismogramDisplayData>;\n\n  width: number;\n  height: number;\n  outerWidth: number;\n  outerHeight: number;\n  svg: any;\n  canvasHolder: any;\n  canvas: any;\n  origXScale: d3.scale;\n  currZoomXScale: any;\n  yScale: d3.scale; // for drawing seismogram\n  yScaleRmean: d3.scale; // for drawing y axis\n  yScaleData: d3.scale; // holds min max of data in time window\n  linkedAmpScale: LinkedAmpScale;\n  lineFunc: any;\n  zoom: any;\n  xAxis: any;\n  xAxisTop: any;\n  yAxis: any;\n  yAxisRight: any;\n  g: any;\n  throttleRescale: any;\n  throttleResize: any;\n  xScaleChangeListeners: Array<ScaleChangeListenerType>;\n  constructor(inSvgParent: any,\n              seismographConfig: SeismographConfig,\n              seisData: Array<SeismogramDisplayData> | Array<Seismogram> | SeismogramDisplayData | Seismogram) {\n    if (inSvgParent === null) {throw new Error(\"inSvgParent cannot be null\");}\n    if ( ! isDef(seismographConfig)) {\n      if (isDef(seisData) && ( ! Array.isArray(seisData) || seisData.length > 0)) {\n        // need at least one of seismographConfig or seisData to get time window\n        seismographConfig = new SeismographConfig();\n      } else {\n        throw new Error(\"seismographConfig and seisData cannot both be null\");\n      }\n    }\n    this.plotId = ++Seismograph._lastID;\n    this.beforeFirstDraw = true;\n    this.seismographConfig = seismographConfig;\n    this.seisDataList = [];\n    this._internalAppend(seisData);\n    this.alignmentSeisData = [];\n\n    this.width = 200;\n    this.height = 100;\n\n    if (typeof inSvgParent === 'string') {\n      this.svgParent = d3.select(inSvgParent);\n    } else {\n      this.svgParent = inSvgParent;\n    }\n\n    this.canvas = null;\n\n    this.svg = this.svgParent.append(\"svg\")\n      .style(\"z-index\", 100);\n    if (isNumArg(this.seismographConfig.minHeight) && this.seismographConfig.minHeight > 0) {\n      this.svg.style(\"min-height\", this.seismographConfig.minHeight+'px');\n    }\n    if (isNumArg(this.seismographConfig.maxHeight) && this.seismographConfig.maxHeight > 0) {\n      this.svg.style(\"max-height\", this.seismographConfig.maxHeight+'px');\n    }\n    this.svg.classed(\"seismograph\", true);\n    this.svg.attr(\"version\", \"1.1\");\n    this.svg.attr(\"plotId\", this.plotId);\n\n\n    this.calcTimeScaleDomain();\n    this.yScale = d3.scaleLinear();\n    this.yScaleData = d3.scaleLinear();\n    // yScale for axis (not drawing) that puts mean at 0 in center\n    this.yScaleRmean = d3.scaleLinear();\n    this.linkedAmpScale = new LinkedAmpScale([this]);\n\n    this.xScaleChangeListeners = [];\n\n    if (this.seismographConfig.isXAxis) {\n      this.xAxis = d3.axisBottom(this.currZoomXScale).tickFormat(this.seismographConfig.xScaleFormat);\n    }\n    if (this.seismographConfig.isXAxisTop) {\n      this.xAxisTop = d3.axisTop(this.currZoomXScale).tickFormat(this.seismographConfig.xScaleFormat);\n    }\n    if (this.seismographConfig.isYAxis) {\n      this.yAxis = d3.axisLeft(this.yScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    }\n    if (this.seismographConfig.isYAxisRight) {\n      this.yAxisRight = d3.axisRight(this.yScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    }\n\n    let mythis = this;\n\n    this.g = this.svg.append(\"g\")\n      .classed(\"marginTransform\", true)\n      .attr(\"transform\", \"translate(\" + this.seismographConfig.margin.left + \",\" + (this.seismographConfig.margin.top) + \")\");\n    this.g.append(\"g\").classed(\"allseismograms\", true);\n\n    let z = this.svg.call(d3.zoom().on(\"zoom\", function () {\n        mythis.zoomed(mythis);\n      }));\n    if ( ! this.seismographConfig.wheelZoom) {\n      z.on(\"wheel.zoom\", null);\n    }\n\n    this.calcAmpScaleDomain();\n\n    // create marker g\n    this.g.append(\"g\").attr(\"class\", \"allmarkers\")\n        .attr(\"style\", \"clip-path: url(#\"+CLIP_PREFIX+this.plotId+\")\");\n    d3.select(window).on('resize.canvasseismograph'+mythis.plotId, function() {\n      if ( ! mythis.beforeFirstDraw && mythis.checkResize() ) {\n        mythis.draw();\n      }\n    });\n\n  }\n  static fromSeismograms(inSvgParent: any,\n                seismographConfig: SeismographConfig,\n                seismogramList: Array<Seismogram>) {\n    return new Seismograph(inSvgParent,\n                           seismographConfig,\n                           seismogramList.map(s => SeismogramDisplayData.fromSeismogram(s)));\n  }\n\n  checkResize(): boolean {\n    let rect = this.svg.node().getBoundingClientRect();\n    if (rect.width !== this.outerWidth || rect.height !== this.outerHeight) {\n      return true;\n    }\n    return false;\n  }\n  draw(): void {\n    let rect = this.svg.node().getBoundingClientRect();\n    if ((rect.width !== this.outerWidth || rect.height !== this.outerHeight)) {\n      if (rect.height < this.seismographConfig.minHeight) {\n        rect.height = this.seismographConfig.minHeight;\n      }\n      if (rect.height > this.seismographConfig.maxHeight) {\n        rect.height = this.seismographConfig.maxHeight;\n      }\n      this.calcWidthHeight(rect.width, rect.height);\n    }\n    if (this.canvas) {\n      this.canvasHolder.attr(\"width\", this.width)\n         .attr(\"height\", this.height);\n      this.canvas.attr(\"width\", this.width)\n         .attr(\"height\", this.height);\n    } else {\n      this.canvasHolder = this.svg\n        .insert(\"foreignObject\",\":first-child\").classed(\"seismograph\", true)\n        .attr(\"x\", this.seismographConfig.margin.left)\n        .attr(\"y\", this.seismographConfig.margin.top)\n        .attr(\"width\", this.width)\n        .attr(\"height\", this.height+1);\n      this.canvas = this.canvasHolder.append(\"xhtml:canvas\").classed(\"seismograph\", true)\n        .attr(\"xmlns\", \"http://www.w3.org/1999/xhtml\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"width\", this.width)\n        .attr(\"height\", this.height+1);\n      const mythis = this;\n      let z = this.canvas.call(d3.zoom().on(\"zoom\", function () {\n          mythis.zoomed(mythis);\n        }));\n      if ( ! this.seismographConfig.wheelZoom) {\n        z.on(\"wheel.zoom\", null);\n      }\n\n      let style = window.getComputedStyle(this.svg.node());\n      let padTop = style.getPropertyValue('padding-top');\n      if (padTop.endsWith(\"px\")) {\n        padTop = Number(padTop.replace(\"px\", \"\"));\n      }\n      let borderTop = style.getPropertyValue('border-top-width');\n      if (borderTop.endsWith(\"px\")) {\n        borderTop = Number(borderTop.replace(\"px\", \"\"));\n      }\n    }\n    this.drawSeismograms();\n    this.drawAxis(this.g);\n    this.drawAxisLabels();\n    if (this.seismographConfig.doMarkers) {\n      this.drawMarkers();\n    }\n    this.beforeFirstDraw = false;\n    return this.svg;\n  }\n  printSizes(): void {\n    let out = \"\";\n    let rect = this.svg.node().getBoundingClientRect();\n    out += \"svg rect.height \"+rect.height+\"\\n\";\n    out += \"svg rect.width \"+rect.width+\"\\n\";\n    let grect = this.svgParent.node().getBoundingClientRect();\n    out += \"parent rect.height \"+grect.height+\"\\n\";\n    out += \"parent rect.width \"+grect.width+\"\\n\";\n      let crect = this.canvas.node().getBoundingClientRect();\n      out += \"c rect.height \"+crect.height+\"\\n\";\n      out += \"c rect.width \"+crect.width+\"\\n\";\n        out += \"c style.height \"+this.canvas.style(\"height\")+\"\\n\";\n        out += \"c style.width \"+this.canvas.style(\"width\")+\"\\n\";\n    out += \"this.height \"+this.height+\"\\n\";\n    out += \"this.width \"+this.width+\"\\n\";\n  out += \"canvas.height \"+this.canvas.node().height+\"\\n\";\n  out += \"canvas.width \"+this.canvas.node().width+\"\\n\";\n    out += \"this.outerHeight \"+this.outerHeight+\"\\n\";\n    out += \"this.outerWidth \"+this.outerWidth+\"\\n\";\n    // $FlowFixMe\n    out += \"this.margin \"+this.seismographConfig.margin+\"\\n\";\n    util.log(out);\n  }\n\n  drawSeismograms() {\n    if (this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n      if (this.alignmentSeisData.length === 0) {\n        const startenddur = new StartEndDuration(this.currZoomXScale.domain()[0], this.currZoomXScale.domain()[1]);\n        const fakeSDD = this.seismographConfig.createAlignmentData(startenddur);\n        this.alignmentSeisData.push(fakeSDD);\n      }\n    } else {\n      this.alignmentSeisData = [];\n    }\n    if (this.seismographConfig.drawingType === DRAW_CANVAS\n      || this.seismographConfig.drawingType === DRAW_BOTH\n      || this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n      this.drawSeismogramsCanvas();\n    }\n    if (this.seismographConfig.drawingType === DRAW_SVG\n      || this.seismographConfig.drawingType === DRAW_BOTH\n      || this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n      this.drawSeismogramsSvg();\n    }\n    if (this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n      this.drawCanvasAlignment();\n    }\n  }\n  isVisible(): boolean {\n    const elem = this.canvas.node();\n    if (! elem) { return false; }\n    return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );\n  }\n  drawSeismogramsCanvas(): void {\n    const mythis = this;\n    if (! this.isVisible()) {\n      // no need to draw if we are not visible\n      return;\n    }\n    // get the canvas drawing context\n    const canvasNode = this.canvas.node();\n    const context = canvasNode.getContext(\"2d\");\n    context.save();\n    // clear the canvas from previous drawing\n    context.clearRect(0, 0, canvasNode.width, canvasNode.height);\n\n    context.lineWidth = this.seismographConfig.lineWidth;\n    if (this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n      context.lineWidth = this.seismographConfig.lineWidth *2;\n    }\n\n    const plotStart = moment.utc(this.currZoomXScale.domain()[0]);\n    const plotEnd = moment.utc(this.currZoomXScale.domain()[1]);\n    const plotDuration = moment.duration(plotEnd.diff(plotStart));\n    const secondsPerPixel = plotDuration.asSeconds()/\n        (this.currZoomXScale.range()[1]-this.currZoomXScale.range()[0]);\n    const sddList = this.seisDataList.concat(this.alignmentSeisData);\n    sddList.forEach( (t,ti) => {\n      let color;\n      if (this.seismographConfig.drawingType === DRAW_BOTH_ALIGN) {\n        color = mythis.seismographConfig.getColorForIndex(ti + sddList.length);\n      } else {\n        color = mythis.seismographConfig.getColorForIndex(ti);\n      }\n\n      let firstTime = true;\n      if ( t.seismogram) {\n        t.seismogram.segments.forEach((s) => {\n          if (s.startTime.isAfter(plotEnd) ||\n              s.endTime.isBefore(plotStart)) {\n                // segment either totally off to left or right of visible\n                return;\n          }\n          const samplesPerPixel = 1.0*s.sampleRate*secondsPerPixel;\n          const pixelsPerSample = 1.0/samplesPerPixel;\n          const startPixel = this.currZoomXScale(s.startTime.toDate());\n          const endPixel = this.currZoomXScale(s.endTime.toDate());\n          let leftVisibleSample = 0;\n          let rightVisibleSample = s.y.length;\n          let leftVisiblePixel = startPixel;\n          if (startPixel < 0) {\n            leftVisibleSample = Math.floor(-1*startPixel*samplesPerPixel) -1;\n            leftVisiblePixel = 0;\n          }\n          if (endPixel > this.currZoomXScale.range()[1]+1) {\n            rightVisibleSample = leftVisibleSample+Math.ceil((this.width+1)*samplesPerPixel) +1;\n          }\n          if (firstTime || ! this.seismographConfig.connectSegments ){\n            context.beginPath();\n            context.strokeStyle = color;\n            //context.lineWidth = 5;\n            context.moveTo(leftVisiblePixel, this.yScale(s.y[leftVisibleSample]));\n            firstTime = false;\n          }\n          for(let i=leftVisibleSample; i<rightVisibleSample+2 && i<s.y.length; i++) {\n            context.lineTo(startPixel+i*pixelsPerSample, this.yScale(s.y[i]));\n          }\n          if (! this.seismographConfig.connectSegments ){\n            context.stroke();\n          }\n        });\n      } else {\n        util.log(`seisdata has no seismogram ${util.stringify(ti)}`);\n      }\n\n      if (this.seismographConfig.connectSegments ){\n        context.stroke();\n      }\n    });\n    context.restore();\n  }\n  drawCanvasAlignment(): void {\n    const mythis = this;\n    let radius = 10;\n    // draw corners in svg for comparison\n    let minX = this.currZoomXScale.domain()[0];\n    let maxX = this.currZoomXScale.domain()[1];\n    let minY = this.yScale.domain()[0];\n    let maxY = this.yScale.domain()[1];\n    this.g.selectAll(\"circle\").remove();\n    let circles = this.g.selectAll(\"circle\").data([ [minX, minY],\n                                      [minX, maxY],\n                                      [maxX, minY],\n                                      [maxX, maxY]]);\n    circles.exit().remove();\n    circles\n      .enter().append(\"circle\")\n      .attr('fill-opacity', '0.4')\n      .attr('cx', function(d){  return mythis.currZoomXScale(d[0]);})\n      .attr('cy', function(d){  return mythis.yScale(d[1]);})\n      .attr('r', radius-2);\n\n    this.g.selectAll(\"path.diagonal\").remove();\n    this.g.append(\"path\").attr(\"class\",  \"seispath diagonal\").attr(\"d\", \"M0,0L\"+mythis.currZoomXScale(maxX)+\", \"+mythis.yScale(minY));\n\n\n    // svg text color\n    let textcolor = this.seismographConfig.getColorForIndex(this.seisDataList.length);\n    let textcolorArr = [ textcolor];\n    this.g.selectAll(\"text\").data(textcolorArr).enter().append(\"text\").style(\"fill\", textcolor).text(\"svg \"+textcolor).attr(\"x\", this.width*3/4).attr(\"y\", this.height/4+20);\n\n\n    // get the canvas drawing context\n    const canvasNode = this.canvas.node();\n    //canvasNode.height = this.height;\n    //canvasNode.width = this.width;\n    const context = canvasNode.getContext(\"2d\");\n\n    // canvas text color\n    textcolor = this.seismographConfig.getColorForIndex(2*this.seisDataList.length+this.alignmentSeisData.length);\n    context.strokeStyle=textcolor;\n    context.strokeText(\"canvas \"+textcolor, this.width*3/4, this.height/4);\n\n    context.beginPath();\n    context.fillStyle = \"lightblue\";\n    context.arc(this.currZoomXScale((minX+maxX)/2), this.yScale((minY+maxY)/2), radius, 0, 2*Math.PI, true);\n    context.fill();\n\n    context.beginPath();\n    context.fillStyle = \"lightblue\";\n    context.arc(this.currZoomXScale(minX), this.yScale(minY), radius, 0, 2*Math.PI, true);\n    context.fill();\n    context.beginPath();\n    context.fillStyle = \"red\";\n    context.arc(this.currZoomXScale(maxX), this.yScale(minY), radius, 0, 2*Math.PI, true);\n    context.fill();\n    context.beginPath();\n    context.fillStyle = \"green\";\n    context.arc(this.currZoomXScale(minX), this.yScale(maxY), radius, 0, 2*Math.PI, true);\n    context.fill();\n    context.beginPath();\n    context.fillStyle = \"black\";\n    context.arc(this.currZoomXScale(maxX), this.yScale(maxY), radius, 0, 2*Math.PI, true);\n    context.fill();\n    context.beginPath();\n    context.moveTo(this.currZoomXScale(this.currZoomXScale.domain()[0]), this.yScaleRmean(0));\n    context.lineTo(this.currZoomXScale(this.currZoomXScale.domain()[1]), this.yScaleRmean(0));\n    context.moveTo(0,0);\n    context.lineTo(this.width, this.height);\n    context.stroke();\n  //  this.printSizes();\n  }\n  calcScaleAndZoom(): void {\n    this.rescaleYAxis();\n    // check if clip exists, wonky d3 convention\n    let container = this.svg.select(\"defs\").select(\"#\"+CLIP_PREFIX+this.plotId);\n    if (container.empty()) {\n      this.svg.append(\"defs\").append(\"clipPath\").attr(\"id\", CLIP_PREFIX+this.plotId);\n    }\n    let clip = this.svg.select(\"defs\").select(\"#\"+CLIP_PREFIX+this.plotId);\n\n    clip.selectAll(\"rect\").remove();\n    clip.append(\"rect\")\n            .attr(\"width\", this.width)\n            .attr(\"height\", this.height);\n  }\n  drawSeismogramsSvg() {\n    const sddList = this.seisDataList.concat(this.alignmentSeisData);\n    const mythis = this;\n    const allSegG = this.g.select(\"g.allseismograms\");\n    const traceJoin = allSegG.selectAll(\"g.seismogram\")\n      .data(sddList)\n      .enter()\n      .append(\"g\")\n        .attr(\"label\", s => s ? s.label : 'none')\n        .attr(\"codes\", s => s.seismogram && s.seismogram.hasCodes() ? s.seismogram.codes() : 'none')\n        .classed(\"seismogram\", true);\n    traceJoin.exit().remove();\n\n    const subtraceJoin = traceJoin\n      .selectAll('path')\n       .data(sdd => sdd.seismogram ? sdd.seismogram.segments : []);\n    subtraceJoin.enter()\n      .append(\"path\")\n        .classed(\"seispath\", true)\n        .classed(DRAW_BOTH_ALIGN, this.seismographConfig.drawingType === DRAW_BOTH_ALIGN)\n        .attr(\"style\", \"clip-path: url(#\"+CLIP_PREFIX+mythis.plotId+\")\")\n        .attr(\"shape-rendering\", \"crispEdges\")\n        .attr(\"d\", function(seg) {\n           return mythis.segmentDrawLine(seg, mythis.currZoomXScale);\n         });\n    subtraceJoin.exit().remove();\n  }\n\n  calcSecondsPerPixel(xScale: any): number {\n    let domain = xScale.domain(); // time so milliseconds\n    let range = xScale.range(); // pixels\n    return (domain[1].getTime()-domain[0].getTime())/1000 / (range[1]-range[0]);\n  }\n\n  segmentDrawLine(seg: SeismogramSegment, xScale: any): void {\n    const mythis = this;\n    let secondsPerPixel = this.calcSecondsPerPixel(xScale);\n    let samplesPerPixel = seg.sampleRate * secondsPerPixel;\n    let lineFunc = d3.line()\n      .curve(d3.curveLinear)\n      .x(function(d) {return xScale(d.time); })\n      .y(function(d) {return mythis.yScale(d.y); });\n    if (samplesPerPixel < this.seismographConfig.segmentDrawCompressedCutoff) {\n      if (! seg.y) {\n        // $FlowFixMe\n        util.log(\"canvasSeis seg.y not defined: \"+(typeof seg)+\" \"+(seg instanceof Seismogram));\n        return;\n      }\n      return lineFunc(Array.from(seg.y, function(d,i) {\n        return {time: seg.timeOfSample(i).toDate(), y: d };\n      }));\n    } else {\n      // lots of points per pixel so use high/low lines\n      if ( ! seg._highlow\n           || seg._highlow.secondsPerPixel !== secondsPerPixel\n           || seg._highlow.xScaleDomain[1] !== xScale.domain()[1]) {\n        let highlow = [];\n        let numHL = 2*Math.ceil(seg.y.length/samplesPerPixel);\n        for(let i=0; i<numHL; i++) {\n          let snippet = seg.y.slice(i * samplesPerPixel,\n                                    (i+1) * samplesPerPixel);\n          if (snippet.length !== 0) {\n          highlow[2*i] = snippet.reduce(function(acc, val) {\n            return Math.min(acc, val);\n          }, snippet[0]);\n          highlow[2*i+1] = snippet.reduce(function(acc, val) {\n            return Math.max(acc, val);\n          }, snippet[0]);\n          }\n        }\n        seg._highlow = {\n            xScaleDomain: xScale.domain(),\n            xScaleRange: xScale.range(),\n            secondsPerPixel: secondsPerPixel,\n            samplesPerPixel: samplesPerPixel,\n            highlowArray: highlow\n        };\n      }\n      return lineFunc(seg._highlow.highlowArray.map(function(d: number,i: number) {\n        return {time: new Date(seg.startTime.valueOf()+1000*((Math.floor(i/2)+.5)*secondsPerPixel)), y: d };\n      }));\n    }\n  }\n\n  drawAxis(svgG: any): void {\n    svgG.selectAll(\"g.axis\").remove();\n    if (this.seismographConfig.isXAxis) {\n      this.xAxis.scale(this.currZoomXScale);\n      this.xAxis.tickFormat(this.seismographConfig.xScaleFormat);\n      svgG.append(\"g\")\n          .attr(\"class\", \"axis axis--x\")\n          .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n          .call(this.xAxis);\n    }\n    if (this.seismographConfig.isXAxisTop) {\n      this.xAxisTop.scale(this.currZoomXScale);\n      this.xAxisTop.tickFormat(this.seismographConfig.xScaleFormat);\n      svgG.append(\"g\")\n          .attr(\"class\", \"axis axis--x\")\n          .call(this.xAxisTop);\n    }\n    if (this.seismographConfig.isYAxis) {\n      this.yAxis.scale(this.yScaleRmean);\n      this.yAxis.ticks(8, this.seismographConfig.yScaleFormat);\n      svgG.append(\"g\")\n          .attr(\"class\", \"axis axis--y\")\n          .call(this.yAxis);\n    }\n    if (this.seismographConfig.isYAxisRight) {\n      this.yAxisRight.scale(this.yScaleRmean);\n      this.yAxisRight.ticks(8, this.seismographConfig.yScaleFormat);\n      svgG.append(\"g\")\n          .attr(\"class\", \"axis axis--y-right\")\n          .attr(\"transform\", \"translate(\" + this.width + \",0)\")\n          .call(this.yAxisRight);\n    }\n  }\n\n  rescaleYAxis(): void {\n    if ( ! this.beforeFirstDraw) {\n      let delay = 500;\n      let myThis = this;\n      if (this.throttleRescale) {\n        window.clearTimeout(this.throttleRescale);\n      }\n      this.throttleRescale = window.setTimeout(\n        function(){\n          if (myThis.seismographConfig.isYAxis) {\n            myThis.g.select(\".axis--y\").transition().duration(delay/2).call(myThis.yAxis);\n          }\n          if (myThis.seismographConfig.isYAxisRight) {\n            myThis.g.select(\".axis--y-right\").transition().duration(delay/2).call(myThis.yAxisRight);\n          }\n          myThis.throttleRescale = null;\n        }, delay);\n    }\n  }\n\n  drawAxisLabels(): void {\n    this.drawTitle();\n    this.drawXLabel();\n    this.drawXSublabel();\n    this.drawYLabel();\n    this.drawYSublabel();\n  }\n\n  cloneXScale(scale: d3.scale): d3.scale {\n    let outxScale = d3.scaleUtc();\n    outxScale.domain([scale.domain()[0], scale.domain()[1]]);\n    outxScale.range([scale.range()[0], scale.range()[1]]);\n    return outxScale;\n  }\n  resetZoom(): void {\n    this.redrawWithXScale(this.cloneXScale(this.origXScale));\n  }\n\n  zoomed(mythis: Seismograph): void {\n    let t = d3.event.transform;\n    let xt = t.rescaleX(this.origXScale);\n    mythis.redrawWithXScale(xt);\n  }\n\n  redrawWithXScale(xt: any): void {\n    if (xt.range()[0] === this.currZoomXScale.range()[0]\n        && xt.range()[1] === this.currZoomXScale.range()[1]\n        && xt.domain()[0].getTime() === this.currZoomXScale.domain()[0].getTime()\n        && xt.domain()[1].getTime() === this.currZoomXScale.domain()[1].getTime()) {\n      return;\n    }\n    let prevZoomXScale = this.currZoomXScale;\n    this.currZoomXScale = xt;\n    let mythis = this;\n    if (! this.beforeFirstDraw) {\n      this.g.select(\"g.allseismograms\").selectAll(\"g.seismogram\").remove();\n      if (this.seismographConfig.windowAmp) {\n        this.calcAmpScaleDomain();\n      }\n      this.drawSeismograms();\n      this.g.select(\"g.allmarkers\").selectAll(\"g.marker\")\n            .attr(\"transform\", function(marker: MarkerType) {\n              let textx = xt( marker.time.toDate());\n              return  \"translate(\"+textx+\",\"+0+\")\";});\n\n       this.g.select(\"g.allmarkers\").selectAll(\"g.markertext\")\n           .attr(\"transform\", function() {\n               // shift up by this.seismographConfig.markerTextOffset percentage\n               let maxY = mythis.yScale.range()[0];\n               let deltaY = mythis.yScale.range()[0]-mythis.yScale.range()[1];\n               let texty = maxY - mythis.seismographConfig.markerTextOffset*(deltaY);\n               return  \"translate(\"+0+\",\"+texty+\") rotate(\"+mythis.seismographConfig.markerTextAngle+\")\";\n             });\n\n       this.g.select(\"g.allmarkers\").selectAll(\"path.markerpath\")\n         .attr(\"d\", () => {\n           return d3.line()\n             .x(function() {\n               return 0; // g is translated so marker time is zero\n             }).y(function(d, i) {\n               return (i===0) ? 0 : mythis.yScale.range()[0];\n             }).curve(d3.curveLinear)([ mythis.yScale.domain()[0], mythis.yScale.domain()[1] ] ); // call the d3 function created by line with data\n        });\n        let startEnd = new StartEndDuration(prevZoomXScale.domain()[0], prevZoomXScale.domain()[1]);\n        let undrawnMarkers = this.seisDataList.reduce((acc, sdd) => {\n            sdd.markerList.forEach(m => acc.push(m));\n            return acc;\n          }, []).filter( m => ! startEnd.contains(m.time));\n        if (undrawnMarkers.length !== 0) {\n          this.drawMarkers();\n        }\n\n      if (this.seismographConfig.isXAxis) {\n        this.g.select(\".axis--x\").call(this.xAxis.scale(xt));\n      }\n      if (this.seismographConfig.isXAxisTop) {\n        this.g.select(\".axis--x-top\").call(this.xAxisTop.scale(xt));\n      }\n    }\n    this.xScaleChangeListeners.forEach(l => l.notifyScaleChange(xt));\n  }\n\n  drawMarkers() {\n    let startEnd = new StartEndDuration(this.currZoomXScale.domain()[0], this.currZoomXScale.domain()[1]);\n    let allMarkers = this.seisDataList.reduce((acc, sdd) => {\n        sdd.markerList.forEach(m => acc.push(m));\n        return acc;\n      }, []).filter( m => startEnd.contains(m.time));\n    // marker overlay\n    let mythis = this;\n    let markerG = this.g.select(\"g.allmarkers\");\n    markerG.selectAll(\"g.marker\").remove();\n    let labelSelection = markerG.selectAll(\"g.marker\")\n        .data(allMarkers, function(d) {\n              // key for data\n              return `${d.name}_${d.time.toISOString()}`;\n            });\n    labelSelection.exit().remove();\n\n    let radianTextAngle = this.seismographConfig.markerTextAngle*Math.PI/180;\n\n    labelSelection.enter()\n        .append(\"g\")\n        .classed(\"marker\", true)\n           // translate so marker time is zero\n        .attr(\"transform\", function(marker) {\n            let textx = mythis.currZoomXScale( marker.time.toDate());\n            return  \"translate(\"+textx+\",\"+0+\")\";\n          })\n        .each(function(marker) {\n\n          let drawG = d3.select(this);\n          drawG.classed(marker.name, true)\n            .classed(marker.type, true);\n\n          let innerTextG = drawG.append(\"g\")\n            .attr(\"class\", \"markertext\")\n            .attr(\"transform\", () => {\n              // shift up by this.seismographConfig.markerTextOffset percentage\n              let maxY = mythis.yScale.range()[0];\n              let deltaY = mythis.yScale.range()[0]-mythis.yScale.range()[1];\n              let texty = maxY - mythis.seismographConfig.markerTextOffset*(deltaY);\n              return  \"translate(\"+0+\",\"+texty+\") rotate(\"+mythis.seismographConfig.markerTextAngle+\")\";});\n          innerTextG.append(\"title\").text( marker => {\n            if (marker.description) {\n              return marker.description;\n            } else {\n              return marker.name+\" \"+marker.time.toISOString();\n            }\n          });\n          let textSel = innerTextG.append(\"text\");\n          if (marker.link && marker.link.length > 0) {\n            // if marker has link, make it clickable\n            textSel.append(\"svg:a\")\n              .attr(\"xlink:href\",function(marker) {return marker.link;})\n              .text(function(marker) {return marker.name;});\n          } else {\n            textSel.text(function(marker) {return marker.name;});\n          }\n          textSel\n              .attr(\"dy\", \"-0.35em\")\n              .call(function(selection) {\n                // this stores the BBox of the text in the bbox field for later use\n                selection.each(function(t){\n                    // set a default just in case\n                    t.bbox = {height: 15, width:20};\n                    try {\n                      t.bbox = this.getBBox();\n                    } catch(error) {\n                      // eslint-disable-next-line no-console\n                      console.warn(error);\n                      // this happens if the text is not yet in the DOM, I think\n                      //  https://bugzilla.mozilla.org/show_bug.cgi?id=612118\n                    }\n                });\n              });\n          // draw/insert flag behind/before text\n          innerTextG.insert(\"polygon\", \"text\")\n              .attr(\"points\", function(marker) {\n                let bboxH = marker.bbox.height+5;\n                let bboxW = marker.bbox.width;\n                return \"0,0 \"\n                  +(-1*bboxH*Math.tan(radianTextAngle))+\",-\"+bboxH+\" \"\n                  +bboxW+\",-\"+bboxH+\" \"\n                  +bboxW+\",0\";\n              });\n// let style be in css?\n//              .style(\"fill\", \"rgba(220,220,220,.4)\");\n          drawG.append(\"path\")\n            .classed(\"markerpath\", true)\n            .attr(\"d\", () => {\n              return d3.line()\n                .x(0) // g is translated so marker time is zero\n                .y(function(d, i) {\n                  let out = 0;\n                  if (mythis.seismographConfig.markerFlagpoleBase === 'center') {\n                    out = (i===0) ? 0: (mythis.yScale.range()[0]+mythis.yScale.range()[1])/2 ;\n                  } else {\n                    // mythis.seismographConfig.markerFlagpoleBase === 'bottom'\n                    out = (i===0) ? 0 : mythis.yScale.range()[0];\n                  }\n                  return out;\n                }).curve(d3.curveLinear)([ mythis.yScale.domain()[0], mythis.yScale.domain()[1] ] ); // call the d3 function created by line with data\n\n            });\n        });\n  }\n\n  calcWidthHeight(nOuterWidth: number, nOuterHeight: number): void {\n    if (nOuterWidth < this.seismographConfig.margin.left + this.seismographConfig.margin.right) {\n      throw new Error(`width too small for margin: ${nOuterWidth} < ${this.seismographConfig.margin.left} + ${this.seismographConfig.margin.right}`);\n    }\n    if (nOuterHeight < this.seismographConfig.margin.top + this.seismographConfig.margin.bottom) {\n      throw new Error(`height too small for margin: ${nOuterWidth} < ${this.seismographConfig.margin.top} + ${this.seismographConfig.margin.bottom}`);\n    }\n    this.outerWidth = nOuterWidth;\n    this.outerHeight = nOuterHeight;\n    this.height = this.outerHeight - this.seismographConfig.margin.top - this.seismographConfig.margin.bottom;\n    this.width = this.outerWidth - this.seismographConfig.margin.left - this.seismographConfig.margin.right;\n    this.origXScale.range([0, this.width]);\n    this.yScale.range([this.height, 0]);\n    this.yScaleRmean.range([this.height, 0]);\n    if (this.seismographConfig.isYAxis) {\n      this.yAxis.scale(this.yScaleRmean);\n    }\n    if (this.seismographConfig.isYAxisRight) {\n      this.yAxisRight.scale(this.yScaleRmean);\n    }\n    this.calcScaleAndZoom();\n    if (this.canvas) {\n      this.canvasHolder.attr(\"width\", this.width)\n        .attr(\"height\", this.height+1);\n      this.canvas.attr(\"width\", this.width)\n        .attr(\"height\", this.height+1);\n    }\n    const resizeXScale = this.cloneXScale(this.currZoomXScale);\n    // keep same time window\n    // but use new pixel range\n    resizeXScale.range([0, this.width]);\n    // this updates currZoomXScale\n    this.redrawWithXScale(resizeXScale);\n  }\n\n\n  // see http://blog.kevinchisholm.com/javascript/javascript-function-throttling/\n  throttle(func: () => void, delay: number): void {\n    if (this.throttleResize) {\n      window.clearTimeout(this.throttleResize);\n    }\n    this.throttleResize = window.setTimeout(func, delay);\n  }\n\n  resizeNeeded() {\n    let myThis = this;\n    this.throttle(function(){\n        myThis.draw();\n    }, 250);\n  }\n\n  setMargin(value: MarginType ): Seismograph {\n    this.seismographConfig.margin = value;\n    if ( ! this.beforeFirstDraw) {\n      this.calcWidthHeight(this.outerWidth, this.outerHeight);\n      this.g.attr(\"transform\", \"translate(\" + this.seismographConfig.margin.left + \",\" + this.seismographConfig.margin.top + \")\");\n    }\n    return this;\n  }\n  drawTitle() {\n    this.svg.selectAll(\"g.title\").remove();\n    let titleSVGText = this.svg.append(\"g\")\n       .classed(\"title\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+0+\")\")\n       .append(\"text\").classed(\"title label\", true)\n       .attr(\"x\",0).attr(\"y\",0)\n       .attr(\"text-anchor\", \"middle\");\n    if (Array.isArray(this.seismographConfig.title)) {\n      this.seismographConfig.title.forEach(function(s) {\n        titleSVGText.append(\"tspan\").text(s+\" \");\n      });\n    } else {\n      titleSVGText\n        .text(this.seismographConfig.title);\n    }\n  }\n  drawXLabel(): Seismograph {\n    this.svg.selectAll(\"g.xLabel\").remove();\n    if (this.seismographConfig.xLabel && this.seismographConfig.xLabel.length > 0) {\n      this.svg.append(\"g\")\n         .classed(\"xLabel\", true)\n         .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight - this.seismographConfig.margin.bottom/3  )+\")\")\n         .append(\"text\").classed(\"x label\", true)\n         .attr(\"text-anchor\", \"middle\")\n         .text(this.seismographConfig.xLabel);\n    }\n    return this;\n  }\n  drawYLabel(): Seismograph {\n    this.svg.selectAll('g.yLabel').remove();\n    for(let side of [ 'left', 'right']) {\n      let hTranslate = (side===\"left\"?0:this.seismographConfig.margin.left+this.width+1);\n      let svgText = this.svg.append(\"g\")\n         .classed(\"yLabel\", true)\n         .classed(side, true)\n         .attr(\"x\", 0)\n         .attr(\"transform\", `translate(${hTranslate}, ${(this.seismographConfig.margin.top+(this.height)/2)})`)\n         .append(\"text\");\n      svgText\n         .classed(\"y label\", true);\n      if (this.seismographConfig.yLabelOrientation === \"vertical\") {\n        // vertical\n        svgText\n          .attr(\"text-anchor\", \"middle\")\n          .attr(\"dy\", \".75em\")\n          .attr(\"transform\", \"rotate(-90, 0, 0)\");\n      } else {\n        // horizontal\n        svgText.attr(\"text-anchor\", \"start\")\n        .attr(\"dominant-baseline\", \"central\");\n      }\n      if (side===\"left\") {\n        svgText.text(this.seismographConfig.yLabel);\n      } else {\n        svgText.text(this.seismographConfig.yLabelRight);\n      }\n    }\n    return this;\n  }\n  drawXSublabel(): Seismograph {\n    this.svg.selectAll('g.xSublabel').remove();\n    this.svg.append(\"g\")\n       .classed(\"xSublabel\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight  )+\")\")\n       .append(\"text\").classed(\"x label sublabel\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .text(this.seismographConfig.xSublabel);\n    return this;\n  }\n  drawYSublabel(): Seismograph {\n    this.svg.selectAll('g.ySublabel').remove();\n    let svgText = this.svg.append(\"g\")\n       .classed(\"ySublabel\", true)\n       .attr(\"x\", 0)\n       .attr(\"transform\", \"translate( \"+this.seismographConfig.ySublabelTrans+\" , \"+(this.seismographConfig.margin.top+(this.height)/2)+\")\")\n       .append(\"text\")\n       .classed(\"y label sublabel\", true);\n    if (this.seismographConfig.yLabelOrientation === \"vertical\") {\n      // vertical\n      svgText\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"dy\", \".75em\")\n        .attr(\"transform\", \"rotate(-90, 0, 0)\");\n    } else {\n      // horizontal\n      svgText.attr(\"text-anchor\", \"start\")\n      .attr(\"dominant-baseline\", \"central\");\n    }\n    svgText\n       .text(this.seismographConfig.ySublabel);\n    return this;\n  }\n  calcTimeScaleDomain(): void {\n      let timeWindow;\n      if (this.seismographConfig.fixedTimeScale) {\n        timeWindow = this.seismographConfig.fixedTimeScale;\n      } else {\n        timeWindow = findStartEnd(this.seisDataList);\n      }\n      if ( ! isDef(this.origXScale)) {\n        this.origXScale = d3.scaleUtc();\n      }\n      this.origXScale.domain([timeWindow.startTime.toDate(), timeWindow.endTime.toDate()]);\n      // force to be same but not to share same array\n      this.currZoomXScale = this.cloneXScale(this.origXScale);\n  }\n  calcAmpScaleDomain(): void {\n    const oldMinMax = this.yScaleData.domain();\n    if (this.seismographConfig.fixedYScale) {\n      this.yScaleData.domain(this.seismographConfig.fixedYScale);\n      this.yScale.domain(this.seismographConfig.fixedYScale);\n    } else {\n      let minMax;\n      if (this.seismographConfig.windowAmp) {\n        let timeWindow = new StartEndDuration(this.currZoomXScale.domain()[0], this.currZoomXScale.domain()[1]);\n        minMax = findMinMaxOverTimeRange(this.seisDataList, timeWindow);\n      } else {\n        minMax = findMinMax(this.seisDataList);\n      }\n      if (minMax[0] === minMax[1]) {\n        // flatlined data, use -1, +1\n        minMax = [ minMax[0]-1, minMax[1]+1];\n      }\n      this.yScaleData.domain(minMax);\n\n      if (this.linkedAmpScale) {\n        if (oldMinMax[0] !== minMax[0] || oldMinMax[1] !== minMax[1]) {\n          this.linkedAmpScale.recalculate(); // sets yScale.domain\n        }\n      } else {\n        this.yScale.domain(minMax);\n        if (this.seismographConfig.isYAxisNice) {\n          this.yScale.nice();\n        }\n        this.redoDisplayYScale();\n      }\n\n    }\n  }\n  redoDisplayYScale(): void {\n    let niceMinMax = this.yScale.domain();\n    if (this.seismographConfig.doGain\n        && this.seisDataList.length > 0\n        && this.seisDataList.every(sdd => sdd.hasSensitivity())\n        && this.seisDataList.every(sdd => sdd.seismogram.yUnit === COUNT_UNIT )) {\n      // each has seisitivity\n      const firstSensitivity = this.seisDataList[0].sensitivity;\n      if (isDef(firstSensitivity) && this.seisDataList.every(sdd => (\n          isDef(firstSensitivity) && sdd.sensitivity\n          && firstSensitivity.sensitivity===sdd.sensitivity.sensitivity\n          && firstSensitivity.inputUnits===sdd.sensitivity.inputUnits\n          && firstSensitivity.outputUnits===sdd.sensitivity.outputUnits\n        ))) {\n          niceMinMax[0] = niceMinMax[0] / firstSensitivity.sensitivity;\n          niceMinMax[1] = niceMinMax[1] / firstSensitivity.sensitivity;\n          if (this.seismographConfig.ySublabelIsUnits) {\n            this.seismographConfig.ySublabel = firstSensitivity.inputUnits;\n          }\n      } else {\n        throw new Error(\"doGain with different seisitivities not yet implemented.\");\n      }\n    } else {\n      if (this.seismographConfig.ySublabelIsUnits ) {\n        this.seismographConfig.ySublabel = \"\";\n        let allUnits = [];\n        for (let t of this.seisDataList) {\n          if (t.seismogram){\n            let u = t.seismogram.yUnit;\n            allUnits.push(u);\n            this.seismographConfig.ySublabel += `${u} `;\n          }\n        }\n        if (allUnits.length === 0) {\n          allUnits.push(\"Count\");\n        }\n        this.seismographConfig.ySublabel = allUnits.join(' ');\n      }\n    }\n    if (this.seismographConfig.doRMean) {\n      this.seismographConfig.ySublabel = `centered ${this.seismographConfig.ySublabel}`;\n      this.yScaleRmean.domain([ (niceMinMax[0]-niceMinMax[1])/2, (niceMinMax[1]-niceMinMax[0])/2 ]);\n    } else {\n      this.yScaleRmean.domain(niceMinMax);\n    }\n    this.rescaleYAxis();\n    this.drawYSublabel();\n  }\n  getSeismogramData(): Array<SeismogramDisplayData> {\n    return this.seisDataList;\n  }\n  /**\n   * can append single seismogram segment or an array of segments.\n   *\n   * @param sddList array or single SeismogramDisplayData or Seismogram\n   * @private\n   */\n  _internalAppend(sddList: Array<SeismogramDisplayData> | SeismogramDisplayData | Array<Seismogram> | Seismogram  ): void {\n    if ( ! sddList) {\n      // don't append a null\n    } else if (Array.isArray(sddList)) {\n      for(let s of sddList) {\n        if (s instanceof SeismogramDisplayData ) {\n          this.seisDataList.push(s);\n        } else {\n          this.seisDataList.push(SeismogramDisplayData.fromSeismogram(s));\n        }\n      }\n    } else {\n      if (sddList instanceof SeismogramDisplayData ) {\n        this.seisDataList.push(sddList);\n      } else {\n        this.seisDataList.push(SeismogramDisplayData.fromSeismogram(sddList));\n      }\n    }\n  }\n  /**\n   * appends the seismogram(s) or SeismogramDisplayData as separate time series.\n   *\n   * @param seismogram data to append\n   * @returns this Seismograph\n   */\n  append(seismogram: Array<Seismogram> | Seismogram | SeismogramDisplayData) {\n    if (seismogram instanceof SeismogramDisplayData) {\n      this._internalAppend(seismogram);\n    } else if (Array.isArray(seismogram)) {\n      let sdd = seismogram.map(s => SeismogramDisplayData.fromSeismogram(s));\n      this._internalAppend(sdd);\n    } else if (seismogram instanceof Seismogram) {\n      this._internalAppend(SeismogramDisplayData.fromSeismogram(seismogram));\n    } else {\n      throw new Error(`Unable to append, doesn't look like Array of Seismogram, Seismogram or SeismogramDisplayData: ${seismogram.constructor.name}`);\n    }\n    this.calcAmpScaleDomain();\n    if ( ! this.beforeFirstDraw) {\n      // only trigger a draw if appending after already drawn on screen\n      // otherwise, just append the data and wait for outside to call first draw()\n      this.drawSeismograms();\n    }\n    return this;\n  }\n  /**\n   * Finds the SeismogramDisplayData within the display containing the given\n   * Seismogram.\n   *\n   * @param   seis seismogram to search for\n   * @returns       SeismogramDisplayData if found or null if not\n   */\n  getDisplayDataForSeismogram(seis: Seismogram): SeismogramDisplayData | null {\n    let out = this.seisDataList.find(sd => sd.seismogram === seis);\n    if (out) {return out; } else { return null;}\n  }\n  /**\n   * Removes a seismogram from the display.\n   *\n   * @param   seisData seis data to remove\n   */\n  remove(seisData: SeismogramDisplayData): void {\n    this.seisDataList = this.seisDataList.filter( sd => sd !== seisData);\n  }\n  /**\n   * Removes seismograms that do not overlap the window.\n   *\n   * @param   timeWindow overlap data to keep\n   */\n  trim(timeWindow: StartEndDuration): void {\n    if (this.seisDataList) {\n      this.seisDataList = this.seisDataList.filter(function(d) {\n        return d.timeWindow.overlaps(timeWindow);\n      });\n      if (this.seisDataList.length > 0) {\n        this.calcAmpScaleDomain();\n        this.drawSeismograms();\n      }\n    }\n  }\n  linkXScaleTo(seismograph: Seismograph) {\n    this.origXScale.domain(seismograph.origXScale.domain());\n    this.currZoomXScale.domain(seismograph.currZoomXScale.domain());\n    if ( ! this.beforeFirstDraw && seismograph.currZoomXScale.range()[1] !== 1) {\n      // default range is 0,1, so don't draw then.\n      this.redrawWithXScale(seismograph.currZoomXScale);\n    }\n    if ( ! this.xScaleChangeListeners.find(l => l.destinationKey === seismograph)) {\n      this.xScaleChangeListeners.push({\n          destinationKey: seismograph,\n          notifyScaleChange: function(xScale) {\n            if ( ! seismograph.beforeFirstDraw) {\n              seismograph.redrawWithXScale(xScale);\n            }\n          }\n        });\n    }\n    if (! seismograph.xScaleChangeListeners.find(l => l.destinationKey === this)) {\n      seismograph.linkXScaleTo(this);\n    }\n  }\n  unlinkXScaleTo(seismograph: Seismograph) {\n    this.xScaleChangeListeners = this.xScaleChangeListeners.filter( l => l.destinationKey !==seismograph);\n    if (seismograph.xScaleChangeListeners.find(l => l.destinationKey === this)) {\n      seismograph.unlinkXScaleTo(this);\n    }\n  }\n}\n\n/**\n * Links amplitude scales across multiple seismographs, respecting doRmean.\n *\n * @param graphList optional list of Seismographs to link\n */\nexport class LinkedAmpScale {\n  /**\n   * @private\n   */\n  _graphSet: Set<Seismograph>;\n  constructor(graphList: ?Array<Seismograph>) {\n    const glist = graphList ? graphList : []; // in case null\n    this._graphSet = new Set(glist);\n    this._graphSet.forEach(g => {\n      g.linkedAmpScale = this;\n    });\n  }\n  /**\n   * Link new Seismograph with this amplitude scale.\n   *\n   * @param   graph Seismograph to link\n   */\n  link(graph: Seismograph) {\n    this._graphSet.add(graph);\n    graph.linkedAmpScale = this;\n    this.recalculate();\n  }\n  /**\n   * Unlink Seismograph with this amplitude scale.\n   *\n   * @param   graph Seismograph to unlink\n   */\n  unlink(graph: Seismograph) {\n    this._graphSet.delete(graph);\n    this.recalculate();\n  }\n  /**\n   * Recalculate the best amplitude scale for all Seismographs. Causes a redraw.\n   */\n  recalculate() {\n    const graphList = Array.from(this._graphSet.values());\n    const maxRange = graphList.reduce((acc, cur) => {\n      let graphMaxRange = cur.yScaleData.domain()[1]-cur.yScaleData.domain()[0];\n      return acc >  graphMaxRange ? acc : graphMaxRange;\n    }, 0);\n    const min = graphList.reduce((acc, cur) => {\n      let graphMin = cur.yScaleData.domain()[0];\n      return acc < graphMin ? acc : graphMin;\n    }, Number.MAX_SAFE_INTEGER);\n    const max = graphList.reduce((acc, cur) => {\n      let graphMax = cur.yScaleData.domain()[1];\n      return acc > graphMax ? acc : graphMax;\n    }, -1*Number.MAX_SAFE_INTEGER);\n    graphList.forEach(g => {\n      if (g.seismographConfig.doRMean) {\n        const mean = (g.yScaleData.domain()[1]+g.yScaleData.domain()[0]) / 2;\n        g.yScale.domain([mean-maxRange/2, mean+maxRange/2]);\n        g.yScaleRmean.domain([-1*maxRange/2, maxRange/2]);\n      } else {\n        g.yScale.domain([min, max]);\n        g.yScaleRmean.domain([min, max]);\n      }\n      g.redoDisplayYScale();\n      if ( ! g.beforeFirstDraw) {\n        // only trigger a draw if appending after already drawn on screen\n        // otherwise, just append the data and wait for outside to call first draw()\n        g.draw();\n      }\n    });\n  }\n}\n\n\n// static ID for seismogram\nSeismograph._lastID = 0;\n\n/**\n * Creates Markers for all of the arrivals in ttime.arrivals, relative\n * to the given Quake.\n *\n * @param   quake quake the travel times are relative to\n * @param   ttime travel times json object as returned from the\n * IRIS traveltime web service, or the json output of TauP\n * @returns        array of Markers suitable for adding to a seismograph\n */\nexport function createMarkersForTravelTimes(quake: Quake, ttime: any): Array<MarkerType> {\n  return ttime.arrivals.map( a => {\n    return {\n      type: 'predicted',\n      name: a.phase,\n      time: moment.utc(quake.time).add(a.time, 'seconds')\n    };\n  });\n}\n\nexport const seismograph_css = `\n\n\n.marker .markerpath {\n  fill: none;\n  stroke: black;\n  stroke-width: 1px;\n}\n\n.marker polygon {\n  fill: rgba(150,220,150,.4);\n}\n\n.marker.predicted polygon {\n  fill: rgba(220,220,220,.4);\n}\n\n.marker.pick polygon {\n  fill: rgba(255,100,100,.4);\n}\n\npath.seispath {\n  stroke: skyblue;\n  fill: none;\n  stroke-width: 1px;\n}\n\npath.orientZ {\n  stroke: seagreen;\n}\n\npath.orientN {\n  stroke: cornflowerblue;\n}\n\npath.orientE {\n  stroke: orange;\n}\n\npath.alignment {\n  stroke-dasharray: 8;\n  stroke-width: 2px;\n}\n\nsvg.seismograph {\n  height: 100%;\n  width: 100%;\n  min-height: 25px;\n  min-width: 25px;\n}\n\nsvg.seismograph g.ySublabel text {\n  font-size: smaller;\n}\n\nsvg.seismograph g.xSublabel text {\n  font-size: smaller;\n}\n\nsvg.seismograph text.title {\n  font-size: larger;\n  font-weight: bold;\n  fill: black;\n  color: black;\n  dominant-baseline: hanging;\n}\n\nsvg.realtimePlot g.allseismograms path.seispath {\n  stroke: skyblue;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+1) path.seispath {\n  stroke: skyblue;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+2) path.seispath {\n  stroke: olivedrab;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+3) path.seispath {\n  stroke: goldenrod;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+4) path.seispath {\n  stroke: firebrick;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+5) path.seispath {\n  stroke: darkcyan;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+6) path.seispath {\n  stroke: orange;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+7) path.seispath {\n  stroke: darkmagenta;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+8) path.seispath {\n  stroke: mediumvioletred;\n}\n\nsvg.seismograph g.allseismograms g:nth-child(9n+9) path.seispath {\n  stroke: sienna;\n}\n\n/* same colors for titles */\n\nsvg.seismograph g.title text tspan:nth-child(9n+1)  {\n  fill: skyblue;\n}\n\nsvg.seismograph g.title text tspan:nth-child(9n+2)  {\n  stroke: olivedrab;\n}\n\nsvg.seismograph g.title text tspan:nth-child(9n+3)  {\n  stroke: goldenrod;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+4)  {\n  stroke: firebrick;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+5)  {\n  stroke: darkcyan;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+6)  {\n  stroke: orange;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+7)  {\n  stroke: darkmagenta;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+8)  {\n  stroke: mediumvioletred;\n}\n\nsvg.seismograph g.title tspan:nth-child(9n+9)  {\n  stroke: sienna;\n}\n\n\n/* links in svg */\nsvg.seismograph text a {\n  fill: #0000EE;\n  text-decoration: underline;\n}\n\n`;\n\nif (document){\n  insertCSS(seismograph_css);\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as d3 from 'd3';\nimport moment from 'moment';\n\nimport {insertCSS} from './cssutil.js';\nimport { SeismogramDisplayData } from './seismogram.js';\nimport { Seismograph } from './seismograph.js';\nimport { SeismographConfig } from './seismographconfig';\nimport {StartEndDuration, isDef} from './util.js';\n\n/**\n * A helicorder-like multi-line seismogram display usually covering 24 hours\n * \n * @param inSvgParent the parent element, usually a div tag\n * @param heliConfig configuration object\n * @param seisData the data to display\n */\nexport class Helicorder {\n  seismographArray: Array<Seismograph>;\n  svgParent: any;\n  heliConfig: HelicorderConfig;\n  seisData: SeismogramDisplayData;\n  xScaleArray: any;\n  yScale: any;\n  constructor(inSvgParent: any,\n              heliConfig: HelicorderConfig,\n              seisData: SeismogramDisplayData) {\n    this.seismographArray = [];\n    this.seisData = seisData;\n\n    if (typeof inSvgParent === 'string') {\n      this.svgParent = d3.select(inSvgParent);\n    } else {\n      this.svgParent = inSvgParent;\n    }\n    this.svgParent = this.svgParent.append('div').classed('helicorder', true);\n    this.heliConfig = heliConfig;\n  }\n  /**\n   * draws, or redraws, the helicorder.\n   */\n  draw() {\n    this.heliConfig.lineSeisConfig.doRMean = this.heliConfig.doRMean;\n    this.drawSeismograms();\n  }\n  /**\n   * draws or redraws the seismograms in the helicorder\n   *\n   * @private\n   */\n  drawSeismograms(): void {\n    if ( ! this.seisData) {\n      // no data\n      return;\n    }\n\n    const timeWindow = this.heliConfig.fixedTimeScale;\n    if ( ! isDef(timeWindow)){\n      throw new Error(\"Helicorder config must have fixedTimeScale set\");\n    }\n    let maxVariation = 1;\n    if (this.seisData.seismogram) {\n      const seis = this.seisData.seismogram; // for flow\n      if ( ! this.heliConfig.fixedYScale) {\n        if ( this.heliConfig.maxVariation === 0) {\n          let cutSeis = seis.cut(timeWindow);\n          if (cutSeis) {\n            let [min,max] = cutSeis.findMinMax();\n            let mean = cutSeis.mean();\n            let posOffset = max - mean;\n            let negOffset = mean - min;\n            maxVariation = Math.max(posOffset, negOffset);\n          }\n        } else {\n          maxVariation = this.heliConfig.maxVariation;\n        }\n      }\n    }\n\n    let startTime = moment.utc(timeWindow.startTime);\n    this.seismographArray = [];\n    const secondsPerLine = timeWindow.duration.asSeconds()/this.heliConfig.numLines;\n    this.svgParent.selectAll(\"div.heliLine\").remove();\n    let lineTimes = this.calcTimesForLines(startTime, secondsPerLine, this.heliConfig.numLines);\n    const margin = this.heliConfig.margin;\n    const nl = this.heliConfig.numLines;\n    const baseHeight = (this.heliConfig.maxHeight-margin.top-margin.bottom) /\n                       (nl-(nl-1)*this.heliConfig.overlap) ;\n    for(let lineTime of lineTimes) {\n      let startTime = lineTime.startTime;\n      let endTime = lineTime.endTime;\n      let height = baseHeight;\n      let marginTop = lineTime.lineNumber===0?0:Math.round(-1.0*height*this.heliConfig.overlap);\n\n      let lineSeisConfig = this.heliConfig.lineSeisConfig.clone();\n      if (lineTime.lineNumber===0) {\n        lineSeisConfig.title = this.heliConfig.title;\n        lineSeisConfig.isXAxisTop = this.heliConfig.isXAxisTop;\n        lineSeisConfig.margin.top += this.heliConfig.margin.top;\n        height += this.heliConfig.margin.top;\n      } else if (lineTime.lineNumber === nl-1) {\n        lineSeisConfig.isXAxis = this.heliConfig.isXAxis;\n        lineSeisConfig.margin.bottom += this.heliConfig.margin.bottom;\n        height += this.heliConfig.margin.bottom;\n      }\n      let seisDiv = this.svgParent.append('div')\n        .classed('heliLine', true)\n        .style('height', height+'px')\n        .style('margin-top', marginTop+'px');\n      lineSeisConfig.fixedTimeScale = lineTime;\n      lineSeisConfig.yLabel = `${startTime.format(\"HH:mm\")}`;\n      lineSeisConfig.yLabelRight = `${endTime.format(\"HH:mm\")}`;\n      lineSeisConfig.lineColors = [ seisDiv.style(\"color\")];\n\n      let lineCutSeis = null;\n      let lineSeisData;\n      let lineMean = 0;\n      if (this.seisData.seismogram) {\n        lineCutSeis = this.seisData.seismogram.cut(lineTime);\n        lineSeisData = this.seisData.cloneWithNewSeismogram(lineCutSeis);\n        lineMean = lineSeisData.mean;\n      } else {\n        // no data in window, but keep seisData in case of markers, etc\n        lineSeisData = this.seisData.clone();\n      }\n      lineSeisData.timeWindow = lineTime;\n\n      if (this.heliConfig.fixedYScale) {\n        lineSeisConfig.fixedYScale = this.heliConfig.fixedYScale;\n      } else {\n        if (this.heliConfig.doRMean) {\n          lineSeisConfig.fixedYScale = [lineMean-maxVariation, lineMean+maxVariation];\n        } else {\n          lineSeisConfig.fixedYScale = [lineMean-maxVariation, lineMean+maxVariation];\n        }\n      }\n      let seismograph = new Seismograph(seisDiv, lineSeisConfig, lineSeisData);\n      seismograph.draw();\n      if (lineTime.lineNumber===0) {\n        // add UTC to top left\n        seismograph.svg.append(\"g\")\n        .classed(\"yLabel\", true)\n        .classed(\"utcLabel\", true)\n        .append(\"text\")\n        .attr(\"x\", 0).attr(\"y\",0)\n        .attr(\"text-anchor\", \"start\")\n        .attr(\"dy\", \".75em\")\n        .text(\"UTC\");\n      }\n      this.seismographArray.push(seismograph);\n      startTime = endTime;\n    }\n  }\n  /**\n   * Calculates the time range covered by each line of the display\n   *\n   * @param   startTime      start of display\n   * @param   secondsPerLine seconds covered by each line\n   * @param   numberOfLines  number of lines\n   * @returns Array of HeliTimeRange, one per line\n   */\n  calcTimesForLines(startTime: moment, secondsPerLine: number, numberOfLines: number): Array<HeliTimeRange> {\n    let out = [];\n    let s = moment.utc(startTime);\n    for (let lineNum=0; lineNum < numberOfLines; lineNum++) {\n      let startEnd = new HeliTimeRange(s, null, secondsPerLine);\n      startEnd.lineNumber = lineNum;\n      out.push(startEnd);\n      s = moment.utc(startEnd.endTime);\n    }\n    return out;\n  }\n}\n\n/**\n * Configuration of the helicorder\n *\n * @param timeWindow the time range covered by the helicorder, required\n */\nexport class HelicorderConfig extends SeismographConfig {\n  lineSeisConfig: SeismographConfig;\n  overlap: number;\n  numLines: number;\n  maxVariation: number;\n  constructor(timeWindow: StartEndDuration) {\n    super();\n    if ( ! isDef(timeWindow)){\n      throw new Error(\"Helicorder config must have fixedTimeScale set\");\n    }\n    this.fixedTimeScale = timeWindow;\n    this.maxVariation = 0;\n    this.maxHeight = 600;\n    this.xLabel = '';\n    this.yLabel = '';\n    this.xSublabel = '';\n    this.ySublabel = ' ';\n    this.ySublabelIsUnits = false;\n    this.isXAxis = true;\n    this.isXAxisTop = true;\n    this.isYAxis = false;\n    this.overlap = 0.5;\n    this.numLines = 12;\n    this.margin.left = 20;\n    this.margin.right = 20;\n    this.margin.top = 40;\n\n    this.lineSeisConfig = new SeismographConfig();\n    this.lineSeisConfig.ySublabel = ` `;\n    this.lineSeisConfig.xLabel = ' ';\n    this.lineSeisConfig.yLabel = '';// replace later with `${startTime.format(\"HH:mm\")}`;\n    this.lineSeisConfig.yLabelOrientation = 'horizontal';\n    this.lineSeisConfig.ySublabelIsUnits = false;\n    this.lineSeisConfig.isXAxis = false;\n    this.lineSeisConfig.isYAxis = false;\n    this.lineSeisConfig.margin.top = 0;\n    this.lineSeisConfig.margin.bottom = 0;\n    this.lineSeisConfig.margin.left = 37;\n    this.lineSeisConfig.margin.right = 37;\n    this.lineSeisConfig.wheelZoom = false;\n    this.lineSeisConfig.doRMean = true;\n  }\n}\n\n/**\n * Time range for a single line of the helicorder, extends StartEndDuration\n * to add the line number\n */\nexport class HeliTimeRange extends StartEndDuration {\n  lineNumber: number;\n  constructor(startTime: moment | null, endTime: moment | null, duration: number | null =null, clockOffset?: number | null =0) {\n    super(startTime, endTime, duration, clockOffset);\n  }\n}\n\n/** default styling for helicorder plots. */\nexport const helicorder_css = `\n\ndiv.helicorder {\n  height: 100%;\n  width: 100%;\n}\n\ndiv.helicorder div.heliLine .yLabel text {\n  font-size: smaller;\n}\n\ndiv.helicorder div.heliLine:nth-child(3n+1) {\n  color: skyblue;\n}\ndiv.helicorder div.heliLine:nth-child(3n+1) path.seispath {\n  stroke: skyblue;\n}\ndiv.helicorder div.heliLine:nth-child(3n+2) {\n  color: olivedrab;\n}\ndiv.helicorder div.heliLine:nth-child(3n+2) path.seispath {\n  stroke: olivedrab;\n}\ndiv.helicorder div.heliLine:nth-child(3n) {\n  color: goldenrod;\n}\ndiv.helicorder div.heliLine:nth-child(3n) path.seispath {\n  stroke: goldenrod;\n}\ndiv.helicorder div.heliLine:nth-child(3n+1) .yLabel text {\n  fill: skyblue;\n}\ndiv.helicorder div.heliLine:nth-child(3n+2) .yLabel text {\n  fill: olivedrab;\n}\ndiv.helicorder div.heliLine:nth-child(3n) .yLabel text {\n  fill: goldenrod;\n}\n\n`;\n\nif (document){\n  insertCSS(helicorder_css);\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport { checkProtocol } from './util';\n\n// flow type for json known datacenters type\n//import type { moment as momentType } from 'moment';\n\ntype SupportsType = {\n  type: string,\n  versions: Array<number>,\n  host?: string\n}\ntype DataCenterType = {\n  \"id\": string,\n  \"name\": string,\n  \"website\": string,\n  \"email\": string,\n  \"host\": string,\n  \"region\": string,\n  \"supports\": Array<SupportsType>,\n}\ntype KnownDCS_JSON = {\n  accesstime?: moment,\n  created: moment,\n  datacenters: Array<DataCenterType>\n}\n\nconst DS = \"fdsnws-dataselect\";\nconst EV= \"fdsn-event\";\nconst ST= \"fdsn-station\";\nconst RS= \"ringserver\";\n\nconst BestDCIdMap = new Map();\n\nfunction initBestDCIdMap() {\n  BestDCIdMap.set(knownDataCenters.DS, \"IRIS\");\n  BestDCIdMap.set(ST, \"IRIS\");\n  BestDCIdMap.set(RS, \"IRIS\");\n  BestDCIdMap.set(EV, \"USGS\");\n}\n\nlet knownDCs = null;\n\n/**\n * Lookup system for FDSN web services, predates the new FDSN DataCenters\n * web service, which is now the preferred method, as this may be out of date.\n * \n */\nexport const knownDataCenters = {\n  knownDataCentersJsonURL: checkProtocol()+\"//www.seis.sc.edu/fdsnServiceCheck/fdsnDataCenters.json\",\n\n  DS: DS,\n  EV: EV,\n  ST: ST,\n  RS: RS,\n  allDCTypes: [ DS, EV, ST, RS ],\n\n  getDefaultDC(type: string) {\n    return this.getDataCenter(BestDCIdMap.get(type));\n  },\n\n  /**\n   * Loads all known data centers. JSON top level has:\n   *  created - modification date,\n   *  datacenters - array of objects, each with\n   *  id, name, website, email, host, region and\n   *  and supports that is an array of type and version.\n   *\n   *  @returns a Promise that resolves to the returned json.\n   */\n  getKnownDataCenters(): Promise<KnownDCS_JSON> {\n    if ( ! knownDCs) {\n      knownDCs = fetch(this.knownDataCentersJsonURL)\n        .then(response => {\n          return (response: {json(): any}).json();\n        }).then(function(json: any): KnownDCS_JSON {\n          json.accesstime = moment.utc();\n          return json;\n        });\n    }\n    return knownDCs;\n  },\n\n  /**\n   * Forces a reload of the remote json. In general, because the data\n   *  is updated infrequently, this is unlikely to be needed. However,\n   *  a very long running instance may wish to update this periodically,\n   *  likely at most daily.\n   *\n   *  @returns a Promise to known datacenters.\n   */\n  updateKnownDataCenters(): Promise<KnownDCS_JSON> {\n    knownDCs = null;\n    return this.getKnownDataCenters();\n  },\n\n  /**\n   * Gets the data center associated with the id.\n   *\n   * @param id string id\n   * @returns a Promise to data center\n   */\n  getDataCenter(id: string): DataCenterType {\n    return this.getKnownDataCenters().then(kdcs => {\n      for (const dc of kdcs.datacenters) {\n        if (dc.id === id) {\n          return dc;\n        }\n      }\n      return null;\n    });\n  },\n\n  /**\n   *\n   * @param dc data center\n   * @param type type of service\n   * @returns true is the dc datacenter supports type web service,\n   * false otherwise.\n   */\n  doesSupport(dc: DataCenterType, type: string) {\n    let out = dc.supports.find(function(s) { return s.type === type;});\n    return typeof out !== 'undefined';\n  },\n\n  /**\n   * returns the hostname for type web service. In many cases this\n   *  is the same as the host for the overall datacenter, but sometimes\n   *  not all web services are hosted on the same machine. For example\n   *  all fdsn web services at IRIS are hosted at service.iris.edu\n   *  but the ringserver is hosted at rtserve.iris.edu\n   *\n   * @param dc data center\n   * @param type type of service\n   * @returns host\n   */\n  serviceHost(dc: DataCenterType, type: string): string {\n    let does = this.doesSupport(dc, type);\n    if (does) {\n      return does.host ? does.host : dc.host;\n    }\n    throw new Error(dc.id+\" does not support \"+type);\n  },\n\n  /**\n   * returns the port for type web service. In many cases this\n   *  is 80, but sometimes web services are hosted on alternative\n   *  ports.\n   *\n   * @param dc data center\n   * @param type type of service\n   * @returns port number\n   */\n  servicePort(dc: DataCenterType, type: string): number {\n    let does = this.doesSupport(dc, type);\n    if (does) {\n      return does.port ? does.port : 80;\n    }\n    throw new Error(dc.id+\" does not support \"+type);\n  }\n\n};\n\ninitBestDCIdMap();\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport * as util from './util';\nimport * as miniseed from './miniseed';\nimport * as RSVP from 'rsvp';\n\nimport {SeismogramDisplayData } from './seismogram';\nimport {Channel} from './stationxml';\nimport {StartEndDuration, isDef} from './util.js';\n\nexport const Allowed_Flags = [ 'n', 's', 'l', 'c', 'Y', 'j', 'H'];\n\n/**\n * A web based connection to an archive of miniseed files\n * arranged based on a pattern using n, s, l, c, Y, j, H\n * for network, station, locid, channel, year, day of year\n * and hour. This is a subset of the options available within\n * the IRIS Ringserver MSeedArchive option, on which this\n * is based. Retrieved seismograms are cut from the larger\n * miniseed files retrieved via http(s), and so there is\n * wasted bandwidth to the server. On the other hand this\n * requires no extra software on the server side beyond\n * a directory structure with suitably small miniseed files.\n * Generally we find channel-hour is a reasonable size for\n * most seismic channels. The URL to needed files is\n * constructed by concatenating the rootUrl with the pattern\n * using a time range large enough to get all overlaps\n * based on the smallest sample rate per channel band code\n * and record size, which defaults to 512.\n *\n */\nexport class MSeedArchive {\n  _rootUrl: string;\n  _pattern: string;\n  _recordSize: number;\n  _timeoutSec: number;\n  constructor(rootUrl: string, pattern: string) {\n    this._rootUrl = rootUrl;\n    this._pattern = pattern;\n    this._recordSize = 512;\n    this._timeoutSec = 30;\n    this.checkPattern(this._pattern);\n  }\n  get rootUrl(): string {\n    return this._rootUrl;\n  }\n  get pattern(): string {\n    return this._pattern;\n  }\n  get recordSize(): number {\n    return this._recordSize;\n  }\n  /**\n   * checks pattern for allowed flags as not all that are supported\n   * by ringserver are supported here. Must only include:\n   * * n network code, white space removed\n   * * s station code, white space removed\n   * * l  location code, white space removed\n   * * c  channel code, white space removed\n   * * Y  year, 4 digits\n   * * j  day of year, 3 digits zero padded\n   * * H  hour, 2 digits zero padded\n   *\n   * @param p mseed archive pattern string\n   * @returns true if all flags are allowed\n   */\n  checkPattern(p: string): boolean {\n    let regexp = /%[a-zA-Z]/g;\n    let allFlags = p.match(regexp);\n    if ( ! allFlags) {\n      return false;\n    } else {\n      for( let f of allFlags) {\n        if (Allowed_Flags.indexOf(f.slice(1)) === -1) {\n          throw new Error(`${f} not allowed in pattern`);\n        }\n      }\n    }\n    return true;\n  }\n  /**\n   * Loads seismograms from the remote miniseed archive via\n   * http(s). Files downloaded include all that might overlap\n   * the given time window based on record size,\n   * the minimum sample rate\n   * for the channel band code and the given time window.\n   *\n   * @param   channelTimeList requst channels and time windows\n   * @returns Promise to the same SeismogramDisplayData array, but with seismograms populated\n   */\n  loadSeismograms(channelTimeList: Array<SeismogramDisplayData>): Promise<Array<SeismogramDisplayData>> {\n    let promiseArray = channelTimeList.map(ct => {\n      if (isDef(ct.channel)) {\n        const channel = ct.channel;\n        return RSVP.hash({\n            \"request\": ct,\n            \"dataRecords\": this.loadDataForChannel(channel, ct.startTime, ct.endTime)\n          });\n        } else {\n          throw new Error(\"channel is missing in loadSeismograms \");\n        }\n      });\n    return RSVP.all(promiseArray).then(pArray => {\n        let out = [];\n        pArray.forEach(p => {\n          let seisArray = miniseed.seismogramPerChannel(p.dataRecords);\n          // should only be one\n          for (let seis of seisArray) {\n            let cutSeis = seis.cut(new StartEndDuration(p.request.startTime, p.request.endTime));\n            p.request.seismogram = cutSeis;\n            out.push(p.request);\n          }\n        });\n        return out;\n    });\n  }\n  /**\n   * Loads miniseed records based on channel and time window.\n   *\n   * @param   channel   channel to request\n   * @param   startTime start time\n   * @param   endTime   end time\n   * @returns Promise to array of miniseed records\n   */\n  loadDataForChannel(channel: Channel, startTime: moment, endTime: moment): Promise<Array<miniseed.DataRecord>> {\n    return this.loadData(channel.station.network.networkCode,\n                    channel.station.stationCode,\n                    channel.locationCode,\n                    channel.channelCode,\n                    startTime,\n                    endTime,\n                    channel.sampleRate);\n  }\n  /**\n   * Loads miniseed records based on string channel codes.\n   *\n   * @param   net        network code\n   * @param   sta        station code\n   * @param   loc        location code\n   * @param   chan       channel code\n   * @param   startTime  start time\n   * @param   endTime    end time\n   * @param   sampleRate known sample rate for this channel\n   * @returns             Promise to array of miniseed records\n   */\n  loadData(net: string, sta: string, loc: string, chan: string, startTime: moment, endTime: moment, sampleRate: number): Promise<Array<miniseed.DataRecord>> {\n    let basePattern = this.fillBasePattern(net, sta, loc, chan);\n    if ( ! util.isDef(sampleRate)) {\n      sampleRate = minSampleRate(chan);\n    }\n    let recordTime = maxTimeForRecord(this._recordSize, sampleRate);\n    let t = moment.utc(startTime).subtract(recordTime, 'seconds');\n    let urlList = [];\n    while (t.isBefore(endTime)) {\n      let url = this.rootUrl+'/'+this.fillTimePattern(basePattern, t);\n      t.add(1, 'hour');\n      urlList.push(url);\n    }\n    if (moment.utc(t).add(recordTime, 'seconds').isAfter(endTime)) {\n      let url = this.rootUrl+'/'+this.fillTimePattern(basePattern, t);\n      urlList.push(url);\n    }\n    return loadDataRecords(urlList).then(dataRecords => {\n      if (dataRecords) {\n        dataRecords =  dataRecords.filter(dr => dr.header.endTime.isSameOrAfter(startTime) &&\n                                        dr.header.startTime.isSameOrBefore(endTime));\n      } else {\n        dataRecords = []; // for flow\n      }\n      return dataRecords;\n    });\n  }\n  /**\n   * Replaces codes from channel in base pattern.\n   *\n   * @param   net  string to replace '%n'\n   * @param   sta  string to replace '%s'\n   * @param   loc  string to replace '%l'\n   * @param   chan string to replace '%c'\n   * @returns       new string with channel replacements made\n   */\n  fillBasePattern(net: string, sta: string, loc: string, chan: string): string {\n    return this.pattern.replace(/%n/g, net)\n      .replace(/%s/g, sta)\n      .replace(/%l/g, loc)\n      .replace(/%c/g, chan);\n  }\n  /**\n   * Replaces time entries ( %Y, %j, %H ) in pattern.\n   *\n   * @param   basePattern pattern to replace in\n   * @param   t           moment in time\n   * @returns              string with time replaces\n   */\n  fillTimePattern(basePattern: string, t: moment): string {\n    return basePattern.replace(/%Y/g, t.format('YYYY'))\n      .replace(/%j/g, t.format('DDDD'))\n      .replace(/%H/g, t.format('HH'));\n\n  }\n}\n\nexport function loadDataRecords(urlList: Array<string>,\n                                fetchInit?: { [key: string]: any},\n                                timeoutSec?: number): Promise<Array<miniseed.DataRecord>> {\n  let promiseArray = urlList.map( (url) => {\n    return util.doFetchWithTimeout(url, fetchInit, timeoutSec)\n    .then(fetchResponse => {\n      if (fetchResponse.ok) {\n        if (fetchResponse.status === 200 || fetchResponse.status === 304) {\n          return fetchResponse.arrayBuffer().then(ab => {\n            let dataRecords = [];\n            if (ab.byteLength > 0) {\n              dataRecords = miniseed.parseDataRecords(ab);\n            }\n            return dataRecords;\n          });\n        } else if (fetchResponse.status === 404 ) {\n          return []; // empty array means no data\n        } else {\n          util.log(\"no data: status=\"+fetchResponse.status+\" \"+fetchResponse.url);\n          return [];\n        }\n      } else if (fetchResponse.status === 404 ) {\n        return []; // empty array means no data\n      } else {\n        // $FlowFixMe\n        throw new Error(\"fetch error: \"+fetchResponse.ok+\" \"+fetchResponse.status+\" \"+fetchResponse.url);\n      }\n    }).catch(err => {\n      util.log(\"caught fetch err, continuing with empty: \"+err);\n      return [];\n    });\n  });\n\n  return RSVP.all(promiseArray).then(pArray => {\n      let dataRecords: Array<miniseed.DataRecord> = [];\n      pArray.forEach(p => {\n        dataRecords = dataRecords.concat(p);\n      });\n      return dataRecords;\n  });\n}\n\n\n/**\n * Gives the maximum sample rate for the channel, based on the\n * band code, first char, of the channel code.\n *\n * @param chan channel code like BHZ, only the first letter is used\n * @returns mimumum sample rate this could be\n */\nexport function maxSampleRate(chan: string): number {\n  let f = chan.slice(0,1);\n  switch(f) {\n    case 'F':\n    case 'G':\n      return 5000;\n    case 'D':\n    case 'C':\n      return 1000;\n    case 'E':\n    case 'H':\n      return 250;\n    case 'S':\n    case 'B':\n      return 80;\n    case 'M':\n      return 10;\n    case 'L':\n      return 1;\n    case 'V':\n      return .1;\n    case 'U':\n      return .01;\n    case 'R':\n      return .001;\n    case 'P':\n      return .0001;\n    case 'Q':\n      return .000001;\n    default:\n      throw new Error(\"Unknown band code \"+f+\" in \"+chan);\n  }\n}\n\n\n /**\n  * Gives the minimum sample rate for the channel, based on the\n  * band code, first char, of the channel code.\n  *\n  * @param chan channel code like BHZ, only the first letter is used\n  * @returns mimumum sample rate this could be\n  **/\nexport function minSampleRate(chan: string): number {\n  let f = chan.slice(0,1);\n  switch(f) {\n    case 'F':\n    case 'G':\n      return 1000;\n    case 'D':\n    case 'C':\n      return 2500;\n    case 'E':\n    case 'H':\n      return 80;\n    case 'S':\n    case 'B':\n      return 10;\n    case 'M':\n      return 1;\n    case 'L':\n      return 1; // maybe wrong, seed manual not clear\n    case 'V':\n      return .1; // maybe wrong, seed manual not clear\n    case 'U':\n      return .01; // maybe wrong, seed manual not clear\n    case 'R':\n      return .0001;\n    case 'P':\n      return .00001;\n    case 'Q':\n      return .0000001;\n    default:\n      throw new Error(\"Unknown band code \"+f+\" in \"+chan);\n  }\n}\n /** Calculates the maximum time coverage for a single miniseed record\n  * given the record size (usually 512 or 4096) and the sample rate (Hertz).\n  * This assumes 40 bytes of header and maximum compression of 2 samples\n  * per byte (4 bit per sample) which is the best Steim2.\n  *\n  * @param recordSize record size (usually 512 or 4096)\n  * @param sampleRate sample rate of record\n  * @returns maximum interval of time that a full record could cover when\n  * compression is at its most efficient\n  */\nexport function maxTimeForRecord(recordSize: number, sampleRate: number): number {\n  return (recordSize-40)*2/sampleRate;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\nimport RSVP from 'rsvp';\nimport * as d3 from 'd3';\nimport * as dataselect from './fdsndataselect.js';\nimport * as miniseed from './miniseed.js';\nimport {Seismogram, SeismogramDisplayData} from './seismogram.js';\nimport { SeismographConfig } from './seismographconfig';\nimport {Seismograph} from './seismograph.js';\nimport {StartEndDuration, isDef } from './util.js';\n\nexport { dataselect, miniseed, d3, RSVP, moment };\n\nexport type PlotDataType = {\n  \"sddList\": Array<SeismogramDisplayData>,\n  \"svgParent\": any\n};\n\n/**\n * Returns an array of Promises, one per selected element. This assumes each\n * element has some combination of start, end, duration, net, sta, loc, and chan\n * attributes sufficient to form the data query. Or an href to a miniseed file.\n *\n * @param selector css selector\n * @returns promise to array of plot data types\n */\nexport function createPlotsBySelectorPromise(selector: string): Promise<Array<PlotDataType>> {\n  let out = [];\n  d3.selectAll(selector).each(function() {\n    let svgParent = d3.select(this);\n    let url;\n    let startAttr = svgParent.attr(\"start\") ? svgParent.attr(\"start\") : null;\n    let endAttr = svgParent.attr(\"end\") ? svgParent.attr(\"end\") : null;\n    let duration = svgParent.attr(\"duration\");\n    let timeWindow = null;\n    if (isDef(startAttr) || isDef(endAttr) || isDef(duration)) {\n      timeWindow = new StartEndDuration(startAttr, endAttr, duration);\n    } else {\n      throw new Error(`Need at least one of start, end, duration.`);\n    }\n    if (svgParent.attr(\"href\")) {\n      // url to miniseed file\n      url = svgParent.attr(\"href\");\n      out.push( fetch(url)\n        .then(response => {\n          if (response.ok) {\n            return response.arrayBuffer();\n          } else {\n            throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n          }\n        })\n        .then(ab => {\n          let seismograms = miniseed.seismogramPerChannel(miniseed.parseDataRecords(ab));\n          let sddList = seismograms.map(s => {\n              let sdd = SeismogramDisplayData.fromSeismogram(s);\n              if (timeWindow) {sdd.timeWindow = timeWindow;}\n              return sdd;\n            });\n          return {\n            \"sddList\": sddList,\n            \"svgParent\": svgParent,\n          };\n        }));\n    } else {\n      let net = svgParent.attr(\"net\");\n      let sta = svgParent.attr(\"sta\");\n      let loc = svgParent.attr(\"loc\");\n      let chan = svgParent.attr(\"chan\");\n      if (! ( net && sta && loc && chan)) {\n        throw new Error(`Must set all of net, sta, loc, chan, but got ${net}, ${sta}, ${loc}, ${chan}`);\n      }\n      let host = svgParent.attr(\"host\");\n      if (! host) {\n          host = \"service.iris.edu\";\n      }\n\n      // $FlowFixMe\n      let request = new dataselect.DataSelectQuery().timeWindow(timeWindow);\n      if (host) { request.host(host); }\n      if (net) { request.networkCode(net); }\n      if (sta) { request.stationCode(sta); }\n      if (loc) { request.locationCode(loc); }\n      if (chan) { request.channelCode(chan); }\n\n      out.push(request.querySeismograms().then(seismograms => {\n        let sddList = seismograms.map(s => {\n            let sdd = SeismogramDisplayData.fromSeismogram(s);\n            if (isDef(timeWindow)) { sdd.timeWindow = timeWindow; }\n            return sdd;\n          });\n        return {\n          \"sddList\": sddList,\n          \"svgParent\": svgParent\n        };\n      }));\n    }\n  });\n  return RSVP.all(out);\n}\n\n\nexport function createPlotsBySelector(selector: string) {\n  return createPlotsBySelectorPromise(selector).then(function(resultArray){\n    resultArray.forEach(function(result: PlotDataType) {\n      result.svgParent.append(\"p\").text(\"Build plot\");\n        if (result.sddList.length >0) {\n          let svgDiv = result.svgParent.append(\"div\");\n          svgDiv.classed(\"svg-container-wide\", true);\n          let seisConfig = new SeismographConfig();\n          let seismogram = new Seismograph(svgDiv, seisConfig, result.sddList);\n          seismogram.draw();\n        } else {\n          result.svgParent.append(\"p\").text(\"No Data\");\n        }\n      });\n      return resultArray;\n  });\n}\n\nexport function alphabeticalSort(traceA: Seismogram, traceB: Seismogram) {\n  if (traceA.codes() < traceB.codes()) {\n    return -1;\n  } else {\n    return 1;\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as d3 from 'd3';\n\nimport {\n    createPlotsBySelectorPromise\n  } from './plotutil.js';\n\nimport {insertCSS} from './cssutil.js';\nimport { SeismographConfig } from './seismographconfig';\nimport {SeismogramSegment, Seismogram, SeismogramDisplayData } from './seismogram.js';\nimport { isDef, isNumArg, StartEndDuration } from './util.js';\n\n/**\n * Creates particle motion plots, for each selected element. This assumes each\n * element has some combination of start, end, duration, net, sta, loc, and chan\n * attributes sufficient to form the data query to return all components of\n * motion. Or an href to a miniseed file.\n *\n * @param selector css selector\n */\nexport function createParticleMotionBySelector(selector: string): void {\n    createPlotsBySelectorPromise(selector)\n    .then(function(resultArray) {\n      resultArray.forEach(function(result) {\n        result.svgParent.append(\"p\").text(\"Build plot\");\n        const sddList = result.sddList;\n          if (sddList.length >1) {\n            addDivForParticleMotion(result.svgParent, sddList[0], sddList[1]);\n            if (sddList.length > 2) {\n              addDivForParticleMotion(result.svgParent, sddList[0], sddList[2]);\n              addDivForParticleMotion(result.svgParent, sddList[1], sddList[2]);\n            }\n          } else {\n            result.svgParent.append(\"p\").text(`Not Enough Data: ${sddList.length}`);\n          }\n      });\n    });\n  }\n\nexport function addDivForParticleMotion(svgParent: any, xSeisData: SeismogramDisplayData, ySeisData: SeismogramDisplayData, timeWindow?: StartEndDuration): ParticleMotion {\n  let svgDiv = svgParent.append(\"div\");\n  if ( ! isDef(xSeisData)) {throw new Error(\"xSeisData cannot be null\");}\n  if ( ! isDef(ySeisData)) {throw new Error(\"ySeisData cannot be null\");}\n  const xSeis = xSeisData.seismogram;\n  const ySeis = ySeisData.seismogram;\n  const xLabel = xSeis ? xSeis.channelCode : \"unknown\";\n  const yLabel = ySeis ? ySeis.channelCode : \"unknown\";\n  svgDiv.classed(xLabel+\" \"+yLabel, true);\n  svgDiv.classed(\"particleMotionContainer\", true);\n  return addParticleMotion(svgDiv, xSeisData, ySeisData, timeWindow);\n}\n\nexport function addParticleMotion(svgParent: any, xSeisData: SeismogramDisplayData, ySeisData: SeismogramDisplayData, timeWindow?: StartEndDuration): ParticleMotion {\n  if ( ! isDef(xSeisData.seismogram) || ! isDef(ySeisData.seismogram)) {\n    // $FlowFixMe\n    throw new Error(`Seismogram has no data: ${xSeisData.seismogram} ${ySeisData.seismogram}`);\n  }\n  const xSeis = xSeisData.seismogram;\n  const ySeis = ySeisData.seismogram;\n\n  let seisConfig = new SeismographConfig();\n  if (isDef(timeWindow)) {\n    seisConfig.fixedTimeScale = timeWindow;\n  }\n  seisConfig.title = xSeis.channelCode+\" \"+ySeis.channelCode;\n  seisConfig.xLabel = xSeis.channelCode;\n  seisConfig.yLabel = ySeis.channelCode;\n  seisConfig.margin.top = seisConfig.margin.bottom;\n  seisConfig.margin.right = seisConfig.margin.left;\n  let pmp = new ParticleMotion(svgParent, seisConfig, xSeisData, ySeisData);\n  pmp.draw();\n  return pmp;\n}\n\n/**\n * Particle motion plot.\n *\n * @param inSvgParent parent element, often a div\n * @param seismographConfig config, not all parameters are used in\n * particle motion plots. Can be null for defaults.\n * @param xSeisData x axis seismogram\n * @param ySeisData y axis seismogram\n */\nexport class ParticleMotion {\n  plotId: number;\n  xSeisData: SeismogramDisplayData;\n  ySeisData: SeismogramDisplayData;\n  seismographConfig: SeismographConfig;\n  timeWindow: StartEndDuration;\n  width: number;\n  height: number;\n  outerWidth: number;\n  outerHeight: number;\n  xScale: any;\n  xScaleRmean: any;\n  xAxis: any;\n  yScale: any;\n  yScaleRmean: any;\n  yAxis: any;\n  svg: any;\n  svgParent: any;\n  g: any;\n  static _lastID: number;\n  constructor(inSvgParent: any,\n              seismographConfig: SeismographConfig,\n              xSeisData: SeismogramDisplayData | Seismogram,\n              ySeisData: SeismogramDisplayData | Seismogram): void {\n    if ( ! isDef(inSvgParent)) {throw new Error(\"inSvgParent cannot be null\");}\n    if ( ! isDef(xSeisData)) {throw new Error(\"xSeisData cannot be null\");}\n    if ( ! isDef(ySeisData)) {throw new Error(\"ySeisData cannot be null\");}\n    this.plotId = ++ParticleMotion._lastID;\n    if ( xSeisData instanceof Seismogram) {\n      this.xSeisData = SeismogramDisplayData.fromSeismogram(xSeisData);\n    } else if ( xSeisData instanceof SeismogramDisplayData) {\n      this.xSeisData = xSeisData;\n    }\n    if ( ySeisData instanceof Seismogram) {\n      this.ySeisData = SeismogramDisplayData.fromSeismogram(ySeisData);\n    } else if ( ySeisData instanceof SeismogramDisplayData) {\n      this.ySeisData = ySeisData;\n    }\n    if (isDef(seismographConfig)) {\n      this.seismographConfig = seismographConfig;\n    } else {\n      this.seismographConfig = new SeismographConfig();\n      this.seismographConfig.xLabel = this.xSeisData.channelCode;\n      this.seismographConfig.yLabel = this.ySeisData.channelCode;\n      this.seismographConfig.margin.left = 40;\n      this.seismographConfig.margin.top = this.seismographConfig.margin.bottom;\n      this.seismographConfig.margin.right = this.seismographConfig.margin.left;\n    }\n    this.calcTimeWindow();\n    this.svg = inSvgParent.append(\"svg\");\n    this.svg.attr(\"version\", \"1.1\");\n    this.svg.classed(\"particleMotion\", true);\n    this.svg.attr(\"plotId\", this.plotId);\n    this.xScale = d3.scaleLinear();\n    // yScale for axis (not drawing) that puts mean at 0 in center\n    this.xScaleRmean = d3.scaleLinear();\n    this.yScale = d3.scaleLinear();\n    // yScale for axis (not drawing) that puts mean at 0 in center\n    this.yScaleRmean = d3.scaleLinear();\n    this.svgParent = inSvgParent;\n\n    this.xAxis = d3.axisBottom(this.xScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    this.yAxis = d3.axisLeft(this.yScaleRmean).tickFormat(this.seismographConfig.yScaleFormat);\n    this.width = 100;\n    this.height = 100;\n    let mythis = this;\n\n    this.g = this.svg.append(\"g\")\n        .attr(\"transform\", \"translate(\" + this.seismographConfig.margin.left + \",\" + this.seismographConfig.margin.top + \")\");\n    this.calcScaleDomain();\n    d3.select(window).on('resize.particleMotion'+this.plotId, function() {if (mythis.checkResize()) {mythis.draw();}});\n  }\n  draw() {\n    this.checkResize();\n    this.drawAxis();\n    this.drawAxisLabels();\n    this.drawParticleMotion();\n    return this;\n  }\n  checkResize(): boolean {\n    let rect = this.svgParent.node().getBoundingClientRect();\n    if (rect.width !== this.outerWidth || rect.height !== this.outerHeight) {\n      this.calcWidthHeight(rect.width, rect.height);\n      return true;\n    }\n    return false;\n  }\n  drawParticleMotion() {\n    this.g.selectAll(\"g.particleMotion\").remove();\n    let lineG = this.g.append(\"g\");\n    lineG.classed(\"particleMotion\", true)\n      .classed(\"seispath\", true)\n      .classed(this.xSeisData.codes(), true)\n      .classed(\"orient\"+this.xSeisData.channelCode.charAt(2)+\"_\"+this.ySeisData.channelCode.charAt(2), true);\n\n    // for flow\n    let xSegments = this.xSeisData.seismogram ? this.xSeisData.seismogram.segments : [];\n    let ySegments = this.ySeisData.seismogram ? this.ySeisData.seismogram.segments : [];\n    xSegments.forEach(segX => {\n        ySegments.forEach(segY => {\n          this.drawParticleMotionForSegment(lineG, segX, segY);\n        });\n      });\n  }\n  drawParticleMotionForSegment(lineG: d3.selection, segA: SeismogramSegment, segB: SeismogramSegment) {\n    const mythis = this;\n    const timeWindow = segA.timeWindow.intersect(segB.timeWindow);\n    if ( ! isDef(timeWindow)) {\n      // no overlap\n      return;\n    }\n    const idxA = segA.indexOfTime(timeWindow.startTime);\n    const lastIdxA = segA.indexOfTime(timeWindow.endTime);\n    const idxB = segB.indexOfTime(timeWindow.startTime);\n    const lastIdxB = segB.indexOfTime(timeWindow.endTime);\n    if (idxA === -1 || lastIdxA === -1 || idxB === -1 || lastIdxB === -1) {\n      return;\n    }\n    const numPts = Math.min(lastIdxA-idxA, lastIdxB-idxB)+1;\n    let segmentG = lineG.append(\"g\").classed(\"segment\", true);\n    let path = segmentG.selectAll(\"path\").data( [ segA.y.slice(idxA, numPts) ] );\n    path.exit().remove();\n    path.enter()\n      .append(\"path\")\n      .classed(\"seispath\", true)\n    .attr(\"d\", d3.line().curve(d3.curveLinear)\n      .x(d => mythis.xScale(d))\n      .y((d,i) => mythis.yScale(segB.yAtIndex(idxB+i))));\n  }\n\n  drawAxis() {\n    let svgG = this.g;\n    svgG.selectAll(\"g.axis\").remove();\n    svgG.append(\"g\")\n        .attr(\"class\", \"axis axis--x\")\n        .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxis);\n    svgG.append(\"g\")\n        .attr(\"class\", \"axis axis--y\")\n        .call(this.yAxis);\n  }\n  drawAxisLabels() {\n    this.drawTitle();\n    this.drawXLabel();\n    this.drawXSublabel();\n    this.drawYLabel();\n    this.drawYSublabel();\n    return this;\n  }\n\n  rescaleAxis() {\n    let delay = 500;\n    this.g.select(\".axis--y\").transition().duration(delay/2).call(this.yAxis);\n    this.g.select(\".axis--x\").transition().duration(delay/2).call(this.xAxis);\n    return this;\n  }\n\n  calcScaleDomain() {\n    let halfDomainDelta = 1;\n    if (this.seismographConfig.fixedYScale) {\n      halfDomainDelta = (this.seismographConfig.fixedYScale[1] - this.seismographConfig.fixedYScale[0])/2;\n      this.xScale.domain(this.seismographConfig.fixedYScale).nice();\n      this.yScale.domain(this.seismographConfig.fixedYScale).nice();\n    } else {\n      let xMinMax = [this.xSeisData.min, this.xSeisData.max];\n      let yMinMax = [this.ySeisData.min, this.ySeisData.max];\n      halfDomainDelta = (xMinMax[1] - xMinMax[0])/2;\n      if (yMinMax[1]-yMinMax[0] > xMinMax[1] - xMinMax[0]) {\n        halfDomainDelta = (yMinMax[1]-yMinMax[0])/2;\n      }\n      let xMid = (xMinMax[1] + xMinMax[0])/2;\n      let yMid = (yMinMax[1] + yMinMax[0])/2;\n      xMinMax = [xMid - halfDomainDelta, xMid + halfDomainDelta ];\n      yMinMax = [yMid - halfDomainDelta, yMid + halfDomainDelta ];\n      this.xScale.domain(xMinMax).nice();\n      this.yScale.domain(yMinMax).nice();\n    }\n    let xNiceMinMax = this.xScale.domain();\n    let xHalfNice = (xNiceMinMax[1] - xNiceMinMax[0])/2;\n    this.xScaleRmean.domain([ -1 * xHalfNice,  xHalfNice ]);\n\n    let yNiceMinMax = this.yScale.domain();\n    let yHalfNice = (yNiceMinMax[1] - yNiceMinMax[0])/2;\n    this.yScaleRmean.domain([ -1 * yHalfNice,  yHalfNice ]);\n    this.rescaleAxis();\n    return this;\n  }\n\n  calcTimeWindow(): void {\n    let tw = null;\n    if ( this.seismographConfig.fixedTimeScale) {\n      tw = this.seismographConfig.fixedTimeScale;\n    } else {\n      tw = this.xSeisData.timeWindow.intersect(this.ySeisData.timeWindow);\n    }\n    if ( ! tw) {\n      // intersection might be null\n      throw new Error(`Seismograms do not overlap: ${this.xSeisData.timeWindow.toString()} ${this.ySeisData.timeWindow.toString()}`);\n    }\n    this.timeWindow = tw;\n  }\n\n  calcWidthHeight(nOuterWidth: number, nOuterHeight: number) {\n    this.outerWidth = nOuterWidth ? Math.max(100, nOuterWidth) : 100;\n    this.outerHeight = nOuterHeight ? Math.max(100, nOuterHeight) : 100;\n    this.height = this.outerHeight - this.seismographConfig.margin.top - this.seismographConfig.margin.bottom;\n    this.width = this.outerWidth - this.seismographConfig.margin.left - this.seismographConfig.margin.right;\n    this.xScale.range([0, this.width]);\n    this.yScale.range([this.height, 0]);\n    this.xScaleRmean.range([0, this.width]);\n    this.yScaleRmean.range([this.height, 0]);\n    return this;\n  }\n  /**\n   * Draws the title as simple string or array of strings. If an array\n   * then each item will be in a separate tspan for easier formatting.\n   *\n   * @returns this\n   */\n  drawTitle(): ParticleMotion {\n    this.svg.selectAll(\"g.title\").remove();\n    let titleSVGText = this.svg.append(\"g\")\n       .classed(\"title\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+( this.seismographConfig.margin.bottom/3  )+\")\")\n       .append(\"text\").classed(\"title label\", true)\n       .attr(\"text-anchor\", \"middle\");\n    if (Array.isArray(this.seismographConfig.title)) {\n      this.seismographConfig.title.forEach(function(s) {\n        titleSVGText.append(\"tspan\").text(s+\" \");\n      });\n    } else {\n      titleSVGText\n        .text(this.seismographConfig.title);\n    }\n    return this;\n  }\n  drawXLabel() {\n    this.svg.selectAll(\"g.xLabel\").remove();\n    if (isNumArg(this.width) && isNumArg(this.outerWidth)) {\n    this.svg.append(\"g\")\n       .classed(\"xLabel\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight - this.seismographConfig.margin.bottom/3  )+\")\")\n       .append(\"text\").classed(\"x label\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .text(this.seismographConfig.xLabel);\n    }\n    return this;\n  }\n  drawYLabel() {\n    this.svg.selectAll('g.yLabel').remove();\n    if (this.height) {\n      this.svg.append(\"g\")\n       .classed(\"yLabel\", true)\n       .attr(\"x\", 0)\n       .attr(\"transform\", \"translate(0, \"+(this.seismographConfig.margin.top+(this.height)/2)+\")\")\n       .append(\"text\")\n       .classed(\"y label\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .attr(\"dy\", \".75em\")\n       .attr(\"transform-origin\", \"center center\")\n       .attr(\"transform\", \"rotate(-90)\")\n       .text(this.seismographConfig.yLabel);\n     }\n    return this;\n  }\n  drawXSublabel() {\n    this.svg.selectAll('g.xSublabel').remove();\n    this.svg.append(\"g\")\n       .classed(\"xSublabel\", true)\n       .attr(\"transform\", \"translate(\"+(this.seismographConfig.margin.left+(this.width)/2)+\", \"+(this.outerHeight  )+\")\")\n       .append(\"text\").classed(\"x label sublabel\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .text(this.seismographConfig.xSublabel);\n    return this;\n  }\n  drawYSublabel()  {\n    this.svg.selectAll('g.ySublabel').remove();\n\n    this.svg.append(\"g\")\n       .classed(\"ySublabel\", true)\n       .attr(\"x\", 0)\n       .attr(\"transform\", \"translate( \"+this.seismographConfig.ySublabelTrans+\" , \"+(this.seismographConfig.margin.top+(this.height)/2)+\")\")\n       .append(\"text\")\n       .classed(\"y label sublabel\", true)\n       .attr(\"text-anchor\", \"middle\")\n       .attr(\"dy\", \".75em\")\n       .attr(\"transform-origin\", \"center center\")\n       .attr(\"transform\", \"rotate(-90)\")\n       .text(this.seismographConfig.ySublabel);\n    return this;\n  }\n}\n\nexport const particleMotion_css = `\n.particleMotionContainer {\n  height: 100%;\n  width: 100%;\n  min-height: 25px;\n  min-width: 25px;\n}\n\nsvg.particleMotion {\n  height: 100%;\n  width: 100%;\n  min-height: 25px;\n  min-width: 25px;\n}\n\nsvg.particleMotion text.title {\n  font-size: larger;\n  font-weight: bold;\n  fill: black;\n  color: black;\n  dominant-baseline: hanging;\n}\n\nsvg.particleMotion path.seispath {\n    stroke: skyblue;\n    fill: none;\n    stroke-width: 1px;\n}\n`;\n\nif (document){\n  insertCSS(particleMotion_css);\n}\n\n// static ID for particle motion\nParticleMotion._lastID = 0;\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport moment from 'moment';\n\nimport * as util from './util.js'; // for util.log\nimport { checkProtocol, hasNoArgs, isStringArg, isNonEmptyStringArg, isNumArg,\n         isDef, TEXT_MIME, doFetchWithTimeout, defaultFetchInitObj} from './util.js';\n\n\nexport type RingserverVersion = {\n  'ringserverVersion': string,\n  'serverId': string\n};\n\nexport type StreamsResult = {\n  accessTime: moment,\n  streams: Array<StreamStat>\n};\n\nexport const IRIS_HOST = 'rtserve.iris.washington.edu';\n\nconst ORG = 'Organization: ';\n/**\n * Web connection to a Ringserver.\n *\n *\n * @param host optional host to connect to, defaults to IRIS\n * @param port optional host to connect to, defaults to 80\n */\nexport class RingserverConnection {\n  /** @private */\n  _host: string;\n  /** @private */\n  _port: number;\n  /** @private */\n  _timeoutSec: number;\n  constructor(host?: string, port?: number) {\n    this._host = (isNonEmptyStringArg(host) ? host : IRIS_HOST);\n    this._port = (isDef(port) ? port : 80);\n    this._timeoutSec = 30;\n  }\n\n  /**\n   * Gets/Sets the remote host to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  host(value?: string): string | RingserverConnection {\n    if (isStringArg(value)) {\n      this._host = value;\n      return this;\n    } else if (hasNoArgs(value)) {\n      return this._host;\n    } else {\n      throw new Error('value argument is optional or string, but was '+typeof value);\n    }\n  }\n\n  /**\n   * Gets/Sets the remote port to connect to.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  port(value?: number): number | RingserverConnection {\n    if (hasNoArgs(value)) {\n      return this._port;\n    } else if (isNumArg(value)) {\n      this._port = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n\n  /**\n   * Get/Set the timeout in seconds for the request. Default is 30.\n   *\n   * @param value optional new value if setting\n   * @returns new value if getting, this if setting\n   */\n  timeout(value?: number): number | RingserverConnection {\n    if (hasNoArgs(value)) {\n      return this._timeoutSec;\n    } else if (isNumArg(value)) {\n      this._timeoutSec = value;\n      return this;\n    } else {\n      throw new Error('value argument is optional or number, but was '+typeof value);\n    }\n  }\n\n\n  /**\n   * Pulls id result from ringserver /id parsed into an object with\n   * 'ringserverVersion' and 'serverId' fields.\n   *\n   * @returns Result as an RSVP Promise.\n   */\n  pullId(): Promise<RingserverVersion> {\n    return this.pullRaw(this.formIdURL()).then(raw => {\n      let lines = raw.split('\\n');\n      let organization = lines[1];\n      if (organization.startsWith(ORG)) {\n        organization = organization.substring(ORG.length);\n      }\n      return {\n        'ringserverVersion': lines[0],\n        'serverId': organization\n      };\n    });\n  }\n\n  /**\n   *  Use numeric level (1-6) to pull just IDs from ringserver.\n   *  In a default ringserver,\n   *  level=1 would return all networks like\n   *  CO\n   *  and level=2 would return all stations like\n   *  CO_JSC\n   *  If level is falsy/missing, level=6 is used.\n   *  The optional matchPattern is a regular expression, so for example\n   *  '.+_JSC_00_HH.' would get all HH? channels from any station name JSC.\n   *\n   * @param level 1-6\n   * @param matchPattern regular expression to match\n   * @returns Result as an RSVP Promise.\n   */\n  pullStreamIds(level: number, matchPattern: string): Promise<Array<string>> {\n    let queryParams = 'level=6';\n    if (isNumArg(level) && level > 0) { queryParams = 'level='+level; }\n    if (matchPattern) { queryParams = queryParams+'&match='+matchPattern; }\n    const url = this.formStreamIdsURL(queryParams);\n    return this.pullRaw(url).then(raw => {\n      return raw.split('\\n').filter( line => line.length > 0);\n    });\n  }\n\n  /**\n   * Pull streams, including start and end times, from the ringserver.\n   * The optional matchPattern is a regular expression, so for example\n   * '.+_JSC_00_HH.' would get all HH? channels from any station name JSC.\n   * Result returned is an RSVP Promise.\n   *\n   * @param matchPattern regular expression to match\n   * @returns promise to object with 'accessTime' as a moment\n   * and 'streams' as an array of StreamStat objects.\n   */\n  pullStreams(matchPattern: string ): Promise<StreamsResult> {\n    let queryParams = \"\";\n    if (matchPattern) { queryParams = 'match='+matchPattern; }\n    const url = this.formStreamsURL(queryParams);\n    return this.pullRaw(url).then(raw => {\n      let lines = raw.split('\\n');\n      let out = {};\n      out.accessTime = moment.utc();\n      out.streams = [];\n      for(let line of lines) {\n        if(line.length === 0 ) {continue;}\n        let vals = line.split(/\\s+/);\n        if (vals.length === 0) {\n          // blank line, skip\n          continue;\n        } else if (vals.length >= 2) {\n          out.streams.push(new StreamStat(vals[0], vals[1], vals[2]));\n        } else {\n          util.log(\"Bad /streams line, skipping: '\"+line+\"'\");\n        }\n      }\n      return out;\n    });\n  }\n\n  /**\n   * Utility method to pull raw result from ringserver url.\n   * Result returned is an RSVP Promise.\n   *\n   * @param url the url\n   * @returns promise to string result\n   */\n  pullRaw(url: string): Promise<string>{\n    const fetchInit = defaultFetchInitObj(TEXT_MIME);\n    return doFetchWithTimeout(url, fetchInit, this._timeoutSec * 1000 )\n      .then(response => {\n          if (response.status === 200) {\n            return response.text();\n          } else {\n            throw new Error(`Status not 200: ${response.status}`);\n          }\n      });\n  }\n\n  /**\n   * Forms base url from protocol, host and port.\n   *\n   * @returns the string url\n   */\n  formBaseURL(): string {\n    return checkProtocol()+'//'+this._host+(this._port===80 ? '' : (':'+this._port));\n  }\n\n  /**\n   * Forms the ringserver id url.\n   *\n   * @returns the id url\n   */\n  formIdURL(): string {\n    return this.formBaseURL()+'/id';\n  }\n\n  /**\n   * Forms the ringserver streams url using the query parameters.\n   *\n   * @param queryParams optional string of query parameters\n   * @returns the streams url\n   */\n  formStreamsURL(queryParams?: string): string {\n    return this.formBaseURL()+'/streams'+((isNonEmptyStringArg(queryParams) && queryParams.length > 0) ? '?'+queryParams : '');\n  }\n\n  /**\n   * Forms the ringserver stream ids url using the query parameters.\n   *\n   * @param queryParams optional string of query parameters\n   * @returns the stream ids url\n   */\n  formStreamIdsURL(queryParams: string): string {\n    return this.formBaseURL()+'/streamids'+((queryParams && queryParams.length > 0) ? '?'+queryParams : '');\n  }\n\n}\n\n/**\n * Extract one StreamStat per station from an array of channel level\n * StreamStats. The start and end times are the min and max times for all\n * the channels within the station. Can be used to get most time of most\n * recent packet from the stations to give an idea of current latency.\n *\n * @param   streams array of channel level StreamStats\n * @returns array of station level StreamStats\n */\nexport function stationsFromStreams(streams: Array<StreamStat>): Array<StreamStat> {\n  let out: Map<string, StreamStat> = new Map();\n  for (const s of streams) {\n    const nslc = nslcSplit(s.key);\n    const staKey = nslc.networkCode+\".\"+nslc.stationCode;\n    let stat = out.get(staKey);\n    if (! isDef(stat)) {\n      stat = new StreamStat(staKey, s.startRaw, s.endRaw);\n      out.set(staKey, stat);\n    } else {\n      if (stat.start.isAfter(s.start)) {\n        stat.start = s.start;\n        stat.startRaw = s.startRaw;\n      }\n      if (stat.end.isBefore(s.end)) {\n        stat.end = s.end;\n        stat.endRaw = s.endRaw;\n      }\n    }\n  }\n  return Array.from(out.values());\n}\n\nexport type NSLCType = {\n  type: string,\n  networkCode: string,\n  stationCode: string,\n  locationCode: string,\n  channelCode: string\n};\n\n/**\n * Split type, networkCode, stationCode, locationCode and channelCode\n * from a ringserver id formatted like net_sta_loc_chan/type\n *\n * @param   id id string to split\n * @returns  object with the split fields\n */\nexport function nslcSplit(id: string): NSLCType {\n  let split = id.split('/');\n  let out = {};\n  out.type = split[1];\n  let nslc = split[0].split('_');\n  if (nslc.length === 4) {\n    // assume net, station, loc, chan\n    out.networkCode = nslc[0];\n    out.stationCode = nslc[1];\n    out.locationCode = nslc[2];\n    out.channelCode = nslc[3];\n  } else {\n    throw new Error(\"tried to split, did not find 4 elements in array: \"+id);\n  }\n  return out;\n}\n\n/**\n * Object to hold start and end times for a key, usually channel or station.\n *\n * @param key id, usually station or channel\n * @param start start time\n * @param end end time\n */\nexport class StreamStat {\n  key: string;\n  startRaw: string;\n  endRaw: string;\n  start: moment;\n  end: moment;\n  constructor(key: string, start: moment, end: moment) {\n    this.key = key;\n    this.startRaw = start;\n    this.endRaw = end;\n    if (this.startRaw.indexOf('.') !== -1 && this.startRaw.indexOf('.') < this.startRaw.length-4) {\n      this.startRaw = this.startRaw.substring(0, this.startRaw.indexOf('.')+4);\n    }\n    if (this.startRaw.charAt(this.startRaw.length-1) !== 'Z') {\n      this.startRaw = this.startRaw+'Z';\n    }\n    if (this.endRaw.indexOf('.') !== -1 && this.endRaw.indexOf('.') < this.endRaw.length-4) {\n      this.endRaw = this.endRaw.substring(0, this.endRaw.indexOf('.')+4);\n    }\n    if (this.endRaw.charAt(this.endRaw.length-1) !== 'Z') {\n      this.endRaw = this.endRaw+'Z';\n    }\n    this.start = moment.utc(this.startRaw);\n    this.end = moment.utc(this.endRaw);\n    this.startRaw = start; // reset to unchanged strings\n    this.endRaw = end;\n  }\n  /**\n   * Calculates latency time difference between last packet and current time.\n   *\n   * @param accessTime time latency is calculated relative to\n   * @returns latency\n   */\n  calcLatency(accessTime: moment): moment.duration {\n    return this.end.from(accessTime);\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\n import { Complex, createComplex} from './oregondsputil.js';\n import { isNumArg } from './util.js';\n\n/**\n * SAC style response file. This contains poles and zeros to represent the\n * analog stage, plus a constant for the overall gain. See\n * seisplotjs.transfer.convertToSacPoleZero() for conversion from a\n * StationXML response to SacPoleZero.\n */\nexport class SacPoleZero {\n  /**\n   * Complex poles\n   */\n  poles: Array<Complex>;\n  /**\n   * Complex zeros\n   */\n  zeros: Array<Complex>;\n  /**\n   * Scalar overall gain\n   */\n  constant: number;\n  /** number of zeros added to convert to displacement, for debugging */\n  gamma: number;\n  /** hertz/radian factor, for debugging */\n  mulFactor: number;\n  /** sensitivity accounting for gamma, for debugging */\n  sd: number;\n  /** normalization factor for poles and zeros accounting for gamma, for debugging */\n  A0: number;\n  constructor(poles: Array<Complex>, zeros: Array<Complex>, constant: number) {\n    this.poles = poles;\n    this.zeros = zeros;\n    this.constant = constant;\n  }\n  toString(): string {\n    let s = [\"sacPoleZero:\"];\n    s.push(\"ZEROS \"+this.zeros.length);\n    for(let i=0; i<this.zeros.length; i++ ) {\n      s.push(\"    \"+this.zeros[i].real()+\" \"+this.zeros[i].imag());\n    }\n    s.push(\"POLES \"+this.poles.length);\n    for(let i=0; i<this.poles.length; i++ ) {\n      s.push(\"    \"+this.poles[i].real()+\" \"+this.poles[i].imag());\n    }\n    s.push(\"CONSTANT \"+this.constant);\n    if (isNumArg(this.gamma) && isNumArg(this.mulFactor) && isNumArg(this.sd) && isNumArg(this.A0)) {\n      s.push(\"*    gamma: \"+this.gamma);\n      s.push(\"*    mulFactor: \"+this.mulFactor);\n      s.push(\"*    sd: \"+this.sd);\n      s.push(\"*    A0: \"+this.A0);\n    }\n    return s.join('\\n');\n  }\n  toText(): string {\n    let s = [];\n    s.push(\"ZEROS \"+this.zeros.length);\n    for(let i=0; i<this.zeros.length; i++ ) {\n      s.push(\"    \"+this.zeros[i].real()+\" \"+this.zeros[i].imag());\n    }\n    s.push(\"POLES \"+this.poles.length);\n    for(let i=0; i<this.poles.length; i++ ) {\n      s.push(\"    \"+this.poles[i].real()+\" \"+this.poles[i].imag());\n    }\n    s.push(\"CONSTANT \"+this.constant);\n    return s.join('\\n');\n  }\n  /**\n   * Parses a string in sac polezero format into a SacPoleZero.\n   *\n   * @param data string to parse\n   * @returns SacPoleZero instance\n   */\n  static parse(data: string) {\n      let pz = {\n        zeros: [],\n        poles: [],\n        constant: 1\n      };\n      let lines = data.split('\\n');\n      let numZeros = 0;\n      let numPoles = 0;\n      let i=0;\n      while (i < lines.length) {\n        let l = lines[i];\n        let items = l.trim().split(/ +/);\n        if (items[0] === 'ZEROS') {\n          numZeros = parseInt(items[1]);\n          i++;\n          l = lines[i];\n          items = l.trim().split(/ +/);\n          while (i < lines.length && pz.zeros.length < numZeros) {\n            if (items[0] === 'POLES') {\n              // no more zeros, fill array with 0\n              for(let z = pz.zeros.length; z < numZeros; z++) {\n                pz.zeros.push(createComplex(0,0));\n              }\n              break;\n            } else {\n              let real = parseFloat(items[0]);\n              let imag = parseFloat(items[1]);\n              pz.zeros.push(createComplex(real, imag));\n            }\n            i++;\n            l = lines[i];\n            items = l.trim().split(/ +/);\n          }\n        }\n        if (items[0] === 'POLES') {\n          numPoles = parseInt(items[1]);\n          i++;\n          l = lines[i];\n          items = l.trim().split(/ +/);\n          while (i < lines.length && pz.poles.length < numPoles) {\n            if (items[0] === 'CONSTANT') {\n              // no more poles, fill array with 0\n              for(let z = pz.poles.length; z < numPoles; z++) {\n                pz.poles.push(createComplex(0,0));\n              }\n              break;\n            } else {\n              let real = parseFloat(items[0]);\n              let imag = parseFloat(items[1]);\n              pz.poles.push(createComplex(real, imag));\n            }\n            i++;\n            l = lines[i];\n            items = l.trim().split(/ +/);\n          }\n        }\n        if (items[0] === 'CONSTANT') {\n          pz.constant = parseFloat(items[1]);\n        }\n        i++;\n      }\n      return new SacPoleZero(pz.poles, pz.zeros, pz.constant);\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as miniseed from './miniseed';\nimport * as RSVP from 'rsvp';\nimport moment from 'moment';\n\nimport {dataViewToString} from './util';\n\nexport const SEEDLINK_PROTOCOL = \"SeedLink3.1\";\n\nexport type SequencedDataRecord = {\n  rawsequence: string,\n  sequence: number,\n  miniseed: miniseed.DataRecord\n};\n\n /**\n  * A seedlink websocket connection to the given url.\n  * The connection is not made until the connect() method is called.\n  * Note this cannot connect directly to a native TCP socket, instead it\n  * sends the seedlink protocol over a websocket. Currently only the IRIS\n  * ringserver, https://github.com/iris-edu/ringserver,\n  * supports websockets, but it may be possible to use thrid party\n  * tools to proxy the websocket to a TCP seedlink socket.\n  *\n  * @param url websocket URL to connect to\n  * @param requestConfig an array of seedlink commands\n  * like:<pre><code>\n  *   [ 'STATION JSC CO',\n  *     'SELECT 00BHZ.D' ]\n  *     </pre></code>\n  * @param receiveMiniseedFn the callback function that\n  * will be invoked for each seedlink packet received\n  * which contains 'sequence', a sequence number\n  * and 'miniseed', a single miniseed record.\n  */\nexport class SeedlinkConnection {\n  url: string;\n  requestConfig: Array<string>;\n  receiveMiniseedFn: (packet: SequencedDataRecord) => void;\n  errorFn: (error: Error) => void;\n  closeFn: null | (close: CloseEvent) => void;\n  webSocket: null | WebSocket;\n  command: string;\n  constructor(url: string, requestConfig: Array<string>, receiveMiniseedFn: (packet: SequencedDataRecord) => void, errorFn: (error: Error) => void) {\n    this.url = url;\n    this.requestConfig = requestConfig;\n    this.receiveMiniseedFn = receiveMiniseedFn;\n    this.errorFn = errorFn;\n    this.closeFn = null;\n    this.command = 'DATA';\n  }\n  setTimeCommand(startTime: moment) {\n    this.command = \"TIME \"+moment.utc(startTime).format(\"YYYY,MM,DD,HH,mm,ss\");\n  }\n  setOnError(errorFn: (error: Error) => void) {\n    this.errorFn = errorFn;\n  }\n  setOnClose(closeFn: (close: CloseEvent) => void) {\n    this.closeFn = closeFn;\n  }\n\n  connect() {\n    if (this.webSocket) {\n      this.webSocket.close();\n      this.webSocket = null;\n    }\n    try {\n      const webSocket = new WebSocket(this.url, SEEDLINK_PROTOCOL);\n      this.webSocket = webSocket;\n      webSocket.binaryType = 'arraybuffer';\n      const that = this;\n      webSocket.onopen = function() {\n        that.sendHello()\n        .then(function() {\n          return that.sendCmdArray(that.requestConfig);\n        })\n        .then(function() {\n          return that.sendCmdArray([ that.command ]);\n        })\n        .then(function(val) {\n          webSocket.onmessage = function(event) {\n            that.handle(event);\n          };\n          webSocket.send('END\\r');\n          return val;\n        }).catch(err => {\n          if (that.errorFn) {\n            that.errorFn(err);\n          } else {\n            throw err;\n          }\n          that.close();\n        });\n      };\n      webSocket.onerror = function(err) {\n        if (that.errorFn) {\n          that.errorFn(err);\n        } else {\n          throw err;\n        }\n      };\n      webSocket.onclose = function(closeEvent) {\n        if (that.closeFn) {\n          that.closeFn(closeEvent);\n        }\n        if (that.webSocket) {\n          that.webSocket = null;\n        }\n      };\n    } catch(err) {\n      if (this.errorFn) {\n        this.errorFn(err);\n      } else {\n        throw err;\n      }\n    }\n  }\n\n  close(): void {\n    if (this.webSocket) {\n      this.webSocket.close();\n    }\n  }\n\n  handle(event: MessageEvent ): void {\n    //for flow\n    const data = ((event.data: any): ArrayBuffer);\n    if (data.byteLength < 64) {\n      //assume text\n    } else {\n      this.handleMiniseed(event);\n    }\n  }\n\n  handleMiniseed(event: MessageEvent): void {\n    //for flow\n    const data = ((event.data: any): ArrayBuffer);\n    try {\n        if (data.byteLength < 64) {\n          this.errorFn(new Error(\"message too small to be miniseed: \"+data.byteLength +\" \"+dataViewToString(new DataView(data))));\n          return;\n        }\n        let slHeader = new DataView(data, 0, 8);\n        // check for 'SL' at start\n        if (slHeader.getInt8(0) === 83 && slHeader.getInt8(1) === 76) {\n          let seqStr = '';\n          for (let i=0; i<6; i++) {\n            seqStr = seqStr + String.fromCharCode(slHeader.getInt8(2+i));\n          }\n          let dataView = new DataView(data, 8, data.byteLength-8);\n          let out = {\n            rawsequence: seqStr,\n            sequence: parseInt(seqStr, 16),\n            miniseed: miniseed.parseSingleDataRecord(dataView)\n          };\n          this.receiveMiniseedFn(out);\n        } else {\n          throw new Error(\"Not a seedlink packet, no starting SL: \"+slHeader.getInt8(0)+' '+slHeader.getInt8(1));\n        }\n     } catch(e) {\n        this.errorFn(\"Error, closing seedlink. \"+e);\n        this.close();\n     }\n  }\n  isConnected(): boolean  {\n    return this.webSocket !== null;\n  }\n\n  /**\n   * Sends initial HELLO to server and waits for response.\n   *\n   * @returns            Promise that resolves to the response from the server.\n   */\n  sendHello(): Promise<string> {\n    let webSocket = this.webSocket;\n    let promise = new RSVP.Promise(function(resolve, reject) {\n      if (webSocket) {\n        webSocket.onmessage = function(event) {\n          //for flow\n          const data = ((event.data: any): ArrayBuffer);\n          let replyMsg = dataViewToString(new DataView(data));\n          let lines = replyMsg.trim().split('\\r');\n          if (lines.length === 2) {\n            resolve(lines);\n          } else {\n            reject(\"not 2 lines: \"+replyMsg);\n          }\n        };\n        webSocket.send(\"HELLO\\r\");\n      } else {\n        reject(\"webSocket has been closed\");\n      }\n    });\n    return promise;\n  }\n\n  /**\n   * Sends an array of commands, each as a Promise waiting for the 'OK' response\n   * before sending the next.\n   *\n   * @param   cmd array of commands to send\n   * @returns      Promise that resolves to the 'OK' returned by the last\n   *   command if successful, or rejects on the first failure.\n   */\n  sendCmdArray(cmd: Array<string>): Promise<string> {\n    let that = this;\n    return cmd.reduce(function(accum: Promise<string>, next: string) {\n      return accum.then(function() {\n        return that.createCmdPromise(next);\n      });\n    }, RSVP.resolve());\n  }\n\n  /**\n   * creates a Promise that sends a command and waits resolved with the result.\n   *\n   * @param   mycmd command string to send.\n   * @returns        Promise that resolves to the reply from the server.\n   */\n  createCmdPromise(mycmd: string): Promise<string> {\n    let webSocket = this.webSocket;\n    let promise = new RSVP.Promise(function(resolve, reject) {\n      if (webSocket) {\n        webSocket.onmessage = function(event) {\n          //for flow\n          const data = ((event.data: any): ArrayBuffer);\n          let replyMsg = dataViewToString(new DataView(data)).trim();\n          if (replyMsg === 'OK') {\n            resolve(replyMsg);\n          } else {\n            reject(\"msg not OK: \"+replyMsg);\n          }\n        };\n        webSocket.send(mycmd+'\\r\\n');\n      } else {\n        reject(\"webSocket has been closed\");\n      }\n    });\n    return promise;\n  }\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {Seismogram } from './seismogram.js';\n\n/**\n * Applies a time domain taper of the given type.\n *\n * @param   seis      Seismogram to taper\n * @param   width     width as a fraction of seismogram length, default is 0.05\n * @param   taperType taper type, default is HANNING, others are HAMMING and COSINE\n * @returns            copy of seismogram with taper applied.\n */\nexport function taper(seis: Seismogram, width: number = 0.05, taperType: string = HANNING): Seismogram {\n  if (width > 0.5) {\n    throw new Error(\"Taper width cannot be larger than 0.5, width=\"+width);\n  }\n  if (seis.isContiguous()) {\n    let data = seis.y;\n    let outData = Float32Array.from(data);\n    let w = Math.floor(data.length * width);\n    let coeff = getCoefficients(taperType, w);\n    const omega = coeff[0];\n    const f0 = coeff[1];\n    const f1 = coeff[2];\n    for(let i = 0; i < w; i++) {\n      const taperFactor = (f0 - f1 * Math.cos(omega * i));\n      outData[i] = outData[i] * taperFactor;\n      outData[outData.length - i - 1] = outData[outData.length - i - 1] * taperFactor;\n    }\n    return seis.cloneWithNewData(outData);\n  } else {\n    throw new Error(\"Cannot take taper of non-contiguous seismogram\");\n  }\n}\n\n\n/**\n * Calculates the coefficients for tapering, [omega, f0, f1]\n *\n * @param type HANNING, HAMMING or COSINE\n * @param length number of data points\n * @returns tapering coefficients as an array of length 3\n */\nexport function getCoefficients(type: string, length: number ): Array<number> {\n  let omega, f0, f1;\n  if(type === HANNING) {\n      omega = Math.PI / length;\n      f0 = .5;\n      f1 = .5;\n  } else if(type === HAMMING) {\n      omega = Math.PI / length;\n      f0 = .54;\n      f1 = .46;\n  } else {\n      // cosine\n      omega = Math.PI / 2 / length;\n      f0 = 1;\n      f1 = 1;\n  }\n  return [ omega, f0, f1 ];\n}\n\nexport const HANNING = \"HANNING\";\nexport const HAMMING = \"HAMMING\";\nexport const COSINE = \"COSINE\";\n","//@flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {calcDFT, inverseDFT, FFTResult } from './fft.js';\nimport {SeismogramSegment, Seismogram } from './seismogram.js';\nimport { SacPoleZero } from './sacpolezero.js';\nimport {Response, PolesZeros } from './stationxml.js';\nimport Qty from 'js-quantities';\nimport { Complex, createComplex} from './oregondsputil.js';\n\n/**\n * Applies response, poles and zeros along with overall gain to the seismogram.\n * Should produce results similar to the sac command:\n * transfer from polezero to none\n *\n * @param   seis     seismogram to instrument correct\n * @param   response response to apply\n * @param   lowCut   low cut\n * @param   lowPass  low pass\n * @param   highPass high pass\n * @param   highCut  high cut\n * @returns           instrument corrected seismogram\n */\nexport function transfer(seis: Seismogram,\n                        response: Response,\n                        lowCut: number,\n                        lowPass: number,\n                        highPass: number,\n                        highCut: number): Seismogram {\n        if (! response) {\n          throw new Error(\"Response not exist???\");\n        }\n        const sacPoleZero = convertToSacPoleZero(response);\n\n        return transferSacPZ(seis, sacPoleZero, lowCut, lowPass, highPass, highCut);\n      }\n\n\nexport function transferSacPZ(seis: Seismogram,\n                              sacPoleZero: SacPoleZero,\n                              lowCut: number,\n                              lowPass: number,\n                              highPass: number,\n                              highCut: number): Seismogram {\n  let outSeis = [];\n  for( let i=0; i< seis.segments.length; i++) {\n    let result = transferSacPZSegment(seis.segments[i],\n                                      sacPoleZero,\n                                      lowCut,\n                                      lowPass,\n                                      highPass,\n                                      highCut);\n    outSeis.push(result);\n  }\n  return new Seismogram(outSeis);\n}\n\nexport function transferSacPZSegment(seis: SeismogramSegment,\n                              sacPoleZero: SacPoleZero,\n                              lowCut: number,\n                              lowPass: number,\n                              highPass: number,\n                              highCut: number): SeismogramSegment {\n        const sampFreq = seis.sampleRate;\n\n        let values = seis.y;\n        let outData = Float32Array.from(values);\n        /* sac premultiplies the data by the sample period before doing the fft. Later it\n         * seems to be cancled out by premultiplying the pole zeros by a similar factor.\n         * I don't understand why they do this, but am reproducing it in order to be\n         * compatible.\n         */\n        outData.forEach((d,i) => outData[i] = d/sampFreq);\n\n        let freqValues = calcDFT(outData);\n        freqValues = combine(freqValues, sampFreq, sacPoleZero, lowCut, lowPass, highPass, highCut);\n\n        outData = inverseDFT(freqValues, values.length);\n        // a extra factor of nfft gets in somehow???\n        outData.forEach((d,i) => outData[i] = d * freqValues.length);\n        let out = seis.cloneWithNewData(outData);\n        //out.y_unit = UNITS.METER;\n        out.yUnit = 'm';\n        return out;\n    }\n\n\nexport function calcResponse(response: Response, numPoints: number, sampleRate: number, unit: string | Qty =\"m\"): FFTResult {\n  const sacPoleZero = convertToSacPoleZero(response);\n\n  const unitQty = new Qty(unit);\n  let gamma = 0;\n  if (unitQty.isCompatible(UNITS.METER)) {\n      gamma = 0;\n  } else if (unitQty.isCompatible(UNITS.METER_PER_SECOND)) {\n      gamma = 1;\n  } else if (unitQty.isCompatible(UNITS.METER_PER_SECOND_PER_SECOND)) {\n      gamma = 2;\n  } else {\n      throw new Error(\"response unit is not displacement (m), velocity (m/s) or acceleration (m/s^2): \"+unit);\n  }\n  for(let i=0; i<gamma; i++) {\n    let z = sacPoleZero.zeros[sacPoleZero.zeros.length-1-i];\n    if (z.real() !== 0 || z.imag() !== 0) {\n      throw new Error(`Attempt to trim ${gamma} zeros from SacPoleZero, but zero isn't 0+i0: ${z}`);\n    }\n  }\n  // subtract gama zeros, ex 1 to get\n  let trimmedZeros = sacPoleZero.zeros.slice().reverse();\n  for(let i=0; i<gamma; i++) {\n    let idx = trimmedZeros.findIndex((d) => d.real() === 0 && d.imag() === 0);\n    trimmedZeros.splice(idx, 1);\n  }\n  trimmedZeros = trimmedZeros.reverse();\n  sacPoleZero.zeros = trimmedZeros;\n  let out = calcResponseFromSacPoleZero( sacPoleZero, numPoints, sampleRate);\n  return out;\n}\n\n/**\n * Caclulates the frequency response from the given poles and zeros.\n *\n * @param   sacPoleZero poles and zeros\n * @param   numPoints   number of points in the output fft\n * @param   sampleRate  sample rate to compute at\n * @returns             frequency response\n */\nexport function calcResponseFromSacPoleZero(sacPoleZero: SacPoleZero, numPoints: number, sampleRate: number): FFTResult {\n  // inst response as packed frequency array\n  let freqValues = new Float32Array(numPoints);\n  const deltaF = sampleRate / freqValues.length;\n  // zero freq\n  freqValues[0] = 0;\n  // nyquist\n  let freq = sampleRate / 2;\n  let respAtS = evalPoleZeroInverse(sacPoleZero, freq);\n  respAtS = createComplex(1, 0).overComplex(respAtS);\n  freqValues[freqValues.length/2 ] = respAtS.real();\n  for(let i = 1; i < freqValues.length / 2 ; i++) {\n    freq = i * deltaF;\n    respAtS = evalPoleZeroInverse(sacPoleZero, freq);\n    //respAtS = respAtS.timesReal(deltaF*i);\n    respAtS = createComplex(1, 0).overComplex(respAtS);\n    if (respAtS.real() !== 0 && respAtS.imag() !== 0) {\n      freqValues[i] = respAtS.real();\n      freqValues[freqValues.length-i] = respAtS.imag();\n    } else {\n      freqValues[i] = 1e-10;\n      freqValues[freqValues.length-i] = 0;\n    }\n  }\n  let out = FFTResult.createFromPackedFreq(freqValues, numPoints, sampleRate);\n  return out;\n}\n\n/**\n * Applies poles and zeros to the fft of a time series. Modifies the freqValues\n * in place.\n *\n * @param   freqValues  fft of a timeseries\n * @param   sampFreq    sampling frequency\n * @param   sacPoleZero poles and zeros\n * @param   lowCut      low cut\n * @param   lowPass     low pass\n * @param   highPass    high pass\n * @param   highCut     high cut\n * @returns             input freq values, with poles and zeros applied\n */\nexport function combine(freqValues: Float32Array,\n                        sampFreq: number,\n                        sacPoleZero: SacPoleZero,\n                        lowCut: number,\n                        lowPass: number,\n                        highPass: number,\n                        highCut: number) {\n        const deltaF = sampFreq / freqValues.length;\n\n        // handle zero freq, no imag, set real to 0\n        freqValues[0] = 0;\n        // handle nyquist\n        let freq = sampFreq / 2;\n        let respAtS = evalPoleZeroInverse(sacPoleZero, freq);\n        respAtS = respAtS.timesReal(deltaF*calcFreqTaper(freq,\n                                               lowCut,\n                                               lowPass,\n                                               highPass,\n                                               highCut));\n        freqValues[freqValues.length/2 ] = respAtS.timesReal(freqValues[freqValues.length/2 ]).real();\n        for(let i = 1; i < freqValues.length / 2 ; i++) {\n            freq = i * deltaF;\n            respAtS = evalPoleZeroInverse(sacPoleZero, freq);\n            respAtS = respAtS.timesReal(deltaF*calcFreqTaper(freq,\n                                                               lowCut,\n                                                               lowPass,\n                                                               highPass,\n                                                               highCut));\n            let freqComplex = createComplex(freqValues[i], freqValues[freqValues.length-i])\n                .timesComplex(respAtS);\n            freqValues[i] = freqComplex.real();\n            freqValues[freqValues.length-i] = freqComplex.imag();\n        }\n        return freqValues;\n    }\n\n  /**\n   * Evaluates the poles and zeros at the given value. The return value is\n   * 1/(pz(s) to avoid divide by zero issues. If there is a divide by zero\n   * situation, then the response is set to be 0+0i.\n   *\n   * @param sacPoleZero SAC PoleZero response\n   * @param freq frequency to evaluate\n   * @returns complex frequency domain value for this frequency\n   */\n  export function evalPoleZeroInverse(sacPoleZero: SacPoleZero, freq: number) {\n        const s = createComplex(0, 2 * Math.PI * freq);\n        let zeroOut = createComplex(1, 0);\n        let poleOut = createComplex(1, 0);\n        for(let i = 0; i < sacPoleZero.poles.length; i++) {\n            poleOut = poleOut.timesComplex( s.minusComplex(sacPoleZero.poles[i]) );\n        }\n        for(let i = 0; i < sacPoleZero.zeros.length; i++) {\n            if(s.real() === sacPoleZero.zeros[i].real()\n                    && s.imag() === sacPoleZero.zeros[i].imag()) {\n                return createComplex(0,0);\n            }\n            zeroOut = zeroOut.timesComplex( s.minusComplex(sacPoleZero.zeros[i]) );\n        }\n        let out = poleOut.overComplex(zeroOut);\n        return out.overReal( sacPoleZero.constant);\n    }\n\n/**\n * Calculates the frequency taper for the given parameters.\n *\n * @param   freq     frequency\n * @param   lowCut   low cut\n * @param   lowPass  low pass\n * @param   highPass high pass\n * @param   highCut  high cut\n * @returns           taper value at the frequency\n */\nexport function calcFreqTaper(freq: number,\n                          lowCut: number,\n                          lowPass: number,\n                          highPass: number,\n                          highCut: number): number {\n    if (lowCut > lowPass || lowPass > highPass || highPass > highCut) {\n        throw new Error(\"must be lowCut > lowPass > highPass > highCut: \"+lowCut +\" \"+ lowPass +\" \"+ highPass +\" \"+ highCut);\n    }\n    if(freq <= lowCut || freq >= highCut) {\n        return 0;\n    }\n    if(freq >= lowPass && freq <= highPass) {\n        return 1;\n    }\n    if(freq > lowCut && freq < lowPass) {\n        return 0.5 * (1.0 + Math.cos(Math.PI * (freq - lowPass)\n                / (lowCut - lowPass)));\n    }\n    // freq > highPass && freq < highCut\n    return 0.5 * (1.0 - Math.cos(Math.PI * (freq - highCut)\n            / (highPass - highCut)));\n}\n\n/**\n * Applies the frequency taper to the fft of the time series.\n *\n * @param   fftResult  fft of time series\n * @param   sampleRate sample rate\n * @param   lowCut     low cut\n * @param   lowPass    low pass\n * @param   highPass   high pass\n * @param   highCut    high cut\n * @returns            fft with taper applied\n */\nexport function applyFreqTaper(fftResult: FFTResult,\n                          sampleRate: number,\n                          lowCut: number,\n                          lowPass: number,\n                          highPass: number,\n                          highCut: number): FFTResult {\n\n  const deltaF = sampleRate / fftResult.amp.length / 2;\n  return FFTResult.createFromAmpPhase(fftResult.amp.map( (v,i) => i === 0 ? 0 : v*calcFreqTaper(i*deltaF, lowCut, lowPass, highPass, highCut)),\n                                      fftResult.phase, fftResult.origLength, fftResult.sampleRate);\n}\n\n/**\n * commonly used units as Qty\n */\nexport const UNITS = {\n  COUNT: new Qty('count'),\n  METER: new Qty('m'),\n  METER_PER_SECOND: new Qty('m/s'),\n  METER_PER_SECOND_PER_SECOND: new Qty('m/s2'),\n};\n\n /**\n  * Converts a StationXML response to SAC PoleZero style. This\n  * converts the analog to digital stage (usually 0) along\n  * with the overall gain, but does not include later FIR stages.\n  * To maintain compatibility with SAC, this includes extra zeros\n  * if needed to convert to displacement. The number of extra zeros\n  * added is kept as gamma in the result.\n  *\n  * @param response stationxml Response to convert\n  * @returns SAC PoleZero style version of the response\n  */\nexport function convertToSacPoleZero( response: Response) {\n    let polesZeros: PolesZeros;\n    if (response.stages[0].filter instanceof PolesZeros) {\n      polesZeros = response.stages[0].filter;\n    } else {\n      throw new Error(\"can't find PolesZeros\");\n    }\n    let unit = response.instrumentSensitivity.inputUnits;\n    if (unit === \"M/S\" || unit === \"M/SEC\") {\n      unit = \"m/s\";\n    }\n    const unitQty = new Qty(unit);\n    let scaleUnit = new Qty(1, unit);\n    let gamma = 0;\n    if (unitQty.isCompatible(UNITS.METER)) {\n        gamma = 0;\n        scaleUnit = scaleUnit.to(UNITS.METER);\n    } else if (unitQty.isCompatible(UNITS.METER_PER_SECOND)) {\n        gamma = 1;\n        scaleUnit = scaleUnit.to(UNITS.METER_PER_SECOND);\n    } else if (unitQty.isCompatible(UNITS.METER_PER_SECOND_PER_SECOND)) {\n        gamma = 2;\n        scaleUnit = scaleUnit.to(UNITS.METER_PER_SECOND_PER_SECOND);\n    } else {\n        throw new Error(\"response unit is not displacement, velocity or acceleration: \"+unit);\n    }\n\n    let mulFactor = 1;\n    if (polesZeros.pzTransferFunctionType === \"LAPLACE (HERTZ)\") {\n        mulFactor = 2 * Math.PI;\n    }\n    let zeros = [];\n    // extra gamma zeros are (0,0)\n    for (let i = 0; i < polesZeros.zeros.length; i++) {\n        zeros[i] = createComplex(polesZeros.zeros[i].real() * mulFactor,\n                               polesZeros.zeros[i].imag() * mulFactor);\n    }\n    for (let i=0; i<gamma; i++) {\n      zeros.push(createComplex(0,0));\n    }\n    let poles = [];\n    for (let i = 0; i < polesZeros.poles.length; i++) {\n        poles[i] = createComplex(polesZeros.poles[i].real() * mulFactor,\n                               polesZeros.poles[i].imag() * mulFactor);\n    }\n    let constant = polesZeros.normalizationFactor;\n    let sd = response.instrumentSensitivity.sensitivity;\n    let fs = response.instrumentSensitivity.frequency;\n    sd *= Math.pow(2 * Math.PI * fs, gamma);\n    let A0 = polesZeros.normalizationFactor;\n    let fn = polesZeros.normalizationFrequency;\n    A0 = A0 / Math.pow(2 * Math.PI * fn, gamma);\n    if (polesZeros.pzTransferFunctionType === \"LAPLACE (HERTZ)\") {\n        A0 *= Math.pow(2 * Math.PI, polesZeros.poles.length - polesZeros.zeros.length);\n    }\n    if (poles.length === 0 && zeros.length === 0) {\n        constant = (sd * A0);\n    } else {\n        constant = (sd * calc_A0(poles, zeros, fs));\n    }\n    constant *= scaleUnit.scalar;\n    let sacPZ = new SacPoleZero(poles, zeros, constant);\n    sacPZ.gamma= gamma;\n    sacPZ.mulFactor= mulFactor;\n    sacPZ.sd= sd;\n    sacPZ.A0= A0;\n    return sacPZ;\n}\n\nexport function calc_A0(poles: Array<Complex>,\n                        zeros: Array<Complex>,\n                        ref_freq: number) {\n    let numer = createComplex(1, 0);\n    let denom = createComplex(1, 0);\n    let f0;\n    let a0;\n    f0 = createComplex(0, 2 * Math.PI * ref_freq);\n    for (let i = 0; i < zeros.length; i++) {\n        denom = denom.timesComplex( f0.minusComplex(zeros[i]));\n    }\n    for (let i = 0; i < poles.length; i++) {\n        numer = numer.timesComplex( f0.minusComplex(poles[i]));\n    }\n    a0 = numer.overComplex(denom).abs();\n    return a0;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {checkProtocol, hasArgs, stringify, isDef, isNonEmptyStringArg } from './util';\nimport {Station} from './stationxml.js';\nimport {Quake} from './quakeml.js';\n\nexport let IRIS_HOST = \"service.iris.edu\";\n\nexport const TEXT_FORMAT = \"text\";\nexport const JSON_FORMAT = \"json\";\nexport const SVG_FORMAT = \"svg\";\n\n/**\n * Query to the IRIS traveltime webservice, based on the TauP Toolkit. See\n * http://service.iris.edu/irisws/traveltime/1/ and\n * https://www.seis.sc.edu/TauP/\n *\n * @param host optional host to connect to, defaults to IRIS\n */\nexport class TraveltimeQuery {\n  /** @private */\n  _specVersion: string;\n  /** @private */\n  _protocol: string;\n  /** @private */\n  _host: string;\n  /** @private */\n  _nodata: number;\n  /** @private */\n  _evdepth: number;\n  /** @private */\n  _distdeg: number;\n  /** @private */\n  _model: string;\n  /** @private */\n  _phases: string;\n  /** @private */\n  _stalat: number;\n  /** @private */\n  _stalon: number;\n  /** @private */\n  _evlat: number;\n  /** @private */\n  _evlon: number;\n  /** @private */\n  _format: string;\n  /** @private */\n  _noheader: boolean;\n  constructor(host: ?string) {\n    this._specVersion = \"1\";\n    this._protocol = checkProtocol();\n    if (! isNonEmptyStringArg(host)) {\n      this._host = IRIS_HOST;\n    } else {\n      this._host = host;\n    }\n    this._format = JSON_FORMAT;\n    this._noheader = false; // only for text format\n  }\n  protocol(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._protocol = value, this) : this._protocol;\n  }\n  host(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._host = value, this) : this._host;\n  }\n  specVersion(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._specVersion = value, this) : this._specVersion;\n  }\n  evdepth(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evdepth = value, this) : this._evdepth;\n  }\n  distdeg(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._distdeg = value, this) : this._distdeg;\n  }\n  model(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._model = value, this) : this._model;\n  }\n  phases(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._phases = value, this) : this._phases;\n  }\n  stalat(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._stalat = value, this) : this._stalat;\n  }\n  stalon(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._stalon = value, this) : this._stalon;\n  }\n  latLonFromStation(station: Station): TraveltimeQuery {\n    this.stalat(station.latitude);\n    this.stalon(station.longitude);\n    return this;\n  }\n  evlat(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evlat = value, this) : this._evlat;\n  }\n  evlon(value?: number): number | TraveltimeQuery {\n    return hasArgs(value) ? (this._evlon = value, this) : this._evlon;\n  }\n  latLonFromQuake(quake: Quake): TraveltimeQuery {\n    this.evlat(quake.latitude);\n    this.evlon(quake.longitude);\n    this.evdepth(quake.depth/1000);\n    return this;\n  }\n  format(value?: string): string | TraveltimeQuery {\n    return hasArgs(value) ? (this._format = value, this) : this._format;\n  }\n  noheader(value?: boolean): boolean | TraveltimeQuery {\n    return hasArgs(value) ? (this._noheader = value, this) : this._noheader;\n  }\n  convertToArrival(ttimeline: string) {\n    let items = ttimeline.trim().split(/\\s+/);\n    return {\n      distdeg: parseFloat(items[0]),\n      phase: items[2],\n      time: parseFloat(items[3]),\n      rayparam: parseFloat(items[4]),\n      takeoff: parseFloat(items[5]),\n      incident: parseFloat(items[6]),\n      puristdist: parseFloat(items[7]),\n      puristname: items[9]\n    };\n  }\n\n  queryText(): Promise<string> {\n    this.format(TEXT_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  queryJson(): Promise<any> {\n    this.format(JSON_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.json();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  querySvg(): Promise<Element> {\n    this.format(SVG_FORMAT);\n    return fetch(this.formURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text()\n            .then(textResponse => (new window.DOMParser()).parseFromString(textResponse, \"text/xml\"))\n            .then(xml => {\n              let elArray = xml.getElementsByTagName(\"svg\");\n              if (elArray.length > 0) {\n                return elArray[0];\n              } else {\n                throw new Error(\"Can't find svg element in response\");\n              }\n            });\n\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  queryWadl(): Promise<Element> {\n    return fetch(this.formWadlURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text()\n            .then(textResponse => (new window.DOMParser()).parseFromString(textResponse, \"text/xml\"));\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n  query(): Promise<any> {\n    if (this._format === JSON_FORMAT) {\n      return this.queryJson();\n    } else if (this._format === SVG_FORMAT) {\n      return this.querySvg();\n    } else if (this._format === TEXT_FORMAT) {\n      return this.queryText();\n    } else {\n      throw new Error(\"Unknown format: \"+this._format);\n    }\n  }\n\n  makeParam(name: string, val: mixed): string {\n    return name+\"=\"+encodeURIComponent(stringify(val))+\"&\";\n  }\n\n  formBaseURL(): string {\n    let colon = \":\";\n    if (this._protocol.endsWith(colon)) {\n      colon = \"\";\n    }\n    let url = this._protocol+colon+\"//\"+this._host+\"/irisws/traveltime/\"+this._specVersion+\"/\";\n    return url;\n  }\n\n  formURL(): string {\n    let url = this.formBaseURL()+'query?';\n    if (isDef(this._noheader) && this._noheader) {\n      url = url +\"noheader=true&\";\n    }\n    if (isDef(this._evdepth)) { url = url+this.makeParam(\"evdepth\", this.evdepth()); }\n    if (isDef(this._stalat) && isDef(this._stalon)) {\n      url = url+this.makeParam(\"staloc\", \"[\"+stringify(this.stalat())+\",\"+stringify(this.stalon())+\"]\");\n    }\n    if (isDef(this._evlat) && isDef(this._evlon)) {\n      url = url+this.makeParam(\"evloc\", \"[\"+stringify(this.evlat())+\",\"+stringify(this.evlon())+\"]\");\n    }\n    if (isDef(this._distdeg)) { url = url+this.makeParam(\"distdeg\", this.distdeg());}\n    if (isDef(this._model)) { url = url+this.makeParam(\"model\", this.model());}\n    if (isDef(this._phases)) { url = url+this.makeParam(\"phases\", this.phases());}\n    if (isDef(this._format)) { url = url+this.makeParam(\"format\", this.format());}\n    if (url.endsWith('&') || url.endsWith('?')) {\n      url = url.substr(0, url.length-1); // zap last & or ?\n    }\n    return url;\n  }\n\n\n  queryTauPVersion(): Promise<string> {\n    return fetch(this.formTauPVersionURL())\n      .then(response => {\n        if (response.ok) {\n          return response.text();\n        } else {\n          throw new Error(\"Fetching over network was not ok: \"+response.status+\" \"+response.statusText);\n        }\n      });\n  }\n\n  formTauPVersionURL(): string {\n    return this.formBaseURL()+'taupversion';\n  }\n\n\n  formWadlURL(): string {\n    return this.formBaseURL()+'application.wadl';\n  }\n}\n","//@flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport {SeismogramSegment, Seismogram } from './seismogram.js';\n\n/**\n * const for degrees to radians, pi/180\n */\nexport const DtoR = Math.PI / 180;\n\n/**\n * Result of rotation for 2 seismograms.\n */\nexport class RotatedSeismograms {\n  radial: Seismogram;\n  transverse: Seismogram;\n  azimuthRadial: number;\n  azimuthTransverse: number;\n  rotation: number;\n  constructor(radial: Seismogram,\n              azimuthRadial: number,\n              transverse: Seismogram,\n              azimuthTransverse: number,\n              rotation: number) {\n    this.radial = radial;\n    this.azimuthRadial = azimuthRadial;\n    this.transverse = transverse;\n    this.azimuthTransverse = azimuthTransverse;\n    this.rotation = rotation;\n  }\n}\n\n/**\n * Rotates the given seismograms from their given azimuths so the output radial\n * is along the new azimuth and the output transverse is perpendicular to it.\n *\n * @param   seisA    first seismogram\n * @param   azimuthA azimuth of first seismogram\n * @param   seisB    second seismogram\n * @param   azimuthB azimuth of second seismogram\n * @param   azimuth  output radial azimuth to rotate to\n * @returns radial and transverse seismograms\n */\nexport function rotate(seisA: Seismogram, azimuthA: number, seisB: Seismogram, azimuthB: number, azimuth: number): RotatedSeismograms {\n  if (seisA.segments.length !== seisB.segments.length) {\n    throw new Error(\"Seismograms do not have same number of segments: \"+seisA.segments.length+\" !== \"+seisB.segments.length);\n  }\n  let rotOutRad = [];\n  let rotOutTrans = [];\n  for( let i=0; i< seisA.segments.length; i++) {\n    let result = rotateSeismogramSegment(seisA.segments[i], azimuthA,\n                                         seisB.segments[i], azimuthB, azimuth);\n    rotOutRad.push(result.radial);\n    rotOutTrans.push(result.transverse);\n  }\n  let out = new RotatedSeismograms(new Seismogram(rotOutRad),\n                                   azimuth % 360,\n                                   new Seismogram(rotOutTrans),\n                                   (azimuth + 90) % 360,\n                                   azimuth - azimuthA);\n  return out;\n}\n\n/**\n * Rotates two seismogram segments, checking for same length and time alignment.\n *\n * @param   seisA    first seismogram\n * @param   azimuthA azimuth of first\n * @param   seisB    second seismogram\n * @param   azimuthB azimuth of second\n * @param   azimuth  azimuth to rotate to as radial, transverse will be +90 deg\n * @returns           rotated seismogram segments along with their aziumths\n */\nfunction rotateSeismogramSegment(seisA: SeismogramSegment, azimuthA: number, seisB: SeismogramSegment, azimuthB: number, azimuth: number) {\n  if (seisA.y.length !== seisB.y.length) {\n    throw new Error(\"seisA and seisB should be of same lenght but was \"\n    +seisA.y.length+\" \"+seisB.y.length);\n  }\n  if ( ! seisA.startTime.isSame(seisB.startTime)) {\n    throw new Error(\"Expect startTime to be same, but was \"+seisA.startTime.toISOString()+\" \"+seisB.startTime.toISOString());\n  }\n  if (seisA.sampleRate !== seisB.sampleRate) {\n    throw new Error(\"Expect sampleRate to be same, but was \"+seisA.sampleRate+\" \"+seisB.sampleRate);\n  }\n  if ((azimuthA + 90) % 360 !== azimuthB % 360) {\n    throw new Error(\"Expect azimuthB to be azimuthA + 90, but was \"+azimuthA+\" \"+azimuthB);\n  }\n//  [   cos(theta)    -sin(theta)    0   ]\n//  [   sin(theta)     cos(theta)    0   ]\n//  [       0              0         1   ]\n// seisB => x\n// seisA => y\n// sense of rotation is opposite for aziumth vs math\n  const rotRadian = 1 * DtoR * (azimuth - azimuthA);\n  const cosTheta = Math.cos(rotRadian);\n  const sinTheta = Math.sin(rotRadian);\n  let x = new Float32Array(seisA.y.length);\n  let y = new Float32Array(seisA.y.length);\n  for (let i = 0; i < seisA.y.length; i++) {\n    x[i] = cosTheta * seisB.yAtIndex(i) - sinTheta * seisA.yAtIndex(i);\n    y[i] = sinTheta * seisB.yAtIndex(i) + cosTheta * seisA.yAtIndex(i);\n  }\n  let outSeisRad = seisA.cloneWithNewData(y);\n  outSeisRad.channelCode = seisA.chanCode.slice(0,2)+\"R\";\n  let outSeisTan = seisA.cloneWithNewData(x);\n  outSeisTan.channelCode = seisA.chanCode.slice(0,2)+\"T\";\n  let out = {\n    \"radial\": outSeisRad,\n    \"transverse\": outSeisTan,\n    \"azimuthRadial\": azimuth % 360,\n    \"azimuthTransverse\": (azimuth + 90) % 360\n  };\n  return out;\n}\n\n/**\n * creates a new Seismogram where the value at each sample is the\n * vector magnitude of the 3 corresponding data points from each seismogram.\n * Each of the 3 seismograms are assumed to be mutually perpendicular so\n * that each set of samples gives a vector in 3-dimensional space. In particular\n * all three seismograms must have the same number of samples and sample rate.\n * It is assumed, but not checked, that they will be the three components of\n * motion at a station (ie matching network, station and location codes)\n * and have the same start time.\n *\n * @param   seisA first seismogram\n * @param   seisB second seismogram\n * @param   seisC third seismogram\n * @returns Seismogram of vector magnitudes\n */\nexport function vectorMagnitude(seisA: Seismogram, seisB: Seismogram, seisC: Seismogram) {\n  if (seisA.segments.length !== seisB.segments.length) {\n    throw new Error(\"Seismograms do not have same number of segments: \"+seisA.segments.length+\" !== \"+seisB.segments.length+\" !== \"+seisC.segments.length);\n  }\n  if (seisA.segments.length !== seisC.segments.length) {\n    throw new Error(\"Seismograms do not have same number of segments: \"+seisA.segments.length+\" !== \"+seisB.segments.length+\" !== \"+seisC.segments.length);\n  }\n  let outSeis = [];\n  for( let i=0; i< seisA.segments.length; i++) {\n    let result = vectorMagnitudeSegment(seisA.segments[i],\n                                        seisB.segments[i],\n                                        seisC.segments[i]);\n    outSeis.push(result);\n  }\n  return new Seismogram(outSeis);\n}\n\n/**\n * Calculates the vector magnitude of three components of motion. Each of the three\n * should be mutually perpendicular.\n *\n * @param   seisA first seismogram\n * @param   seisB second perpendicular seismogram\n * @param   seisC thrid perpendicular seismogram\n * @returns         seismogram representing the vector magnitude, sqrt(x*x+y*y+z*z)\n */\nfunction vectorMagnitudeSegment(seisA: SeismogramSegment, seisB: SeismogramSegment, seisC: SeismogramSegment) {\n  if (seisA.y.length !== seisB.y.length) {\n    throw new Error(\"seisA and seisB should be of same lenght but was \"\n    +seisA.y.length+\" \"+seisB.y.length);\n  }\n  if (seisA.sampleRate !== seisB.sampleRate) {\n    throw new Error(\"Expect sampleRate to be same, but was \"+seisA.sampleRate+\" \"+seisB.sampleRate);\n  }\n  if (seisA.y.length !== seisC.y.length) {\n    throw new Error(\"seisA and seisC should be of same lenght but was \"\n    +seisA.y.length+\" \"+seisC.y.length);\n  }\n  if (seisA.sampleRate !== seisC.sampleRate) {\n    throw new Error(\"Expect sampleRate to be same, but was \"+seisA.sampleRate+\" \"+seisC.sampleRate);\n  }\n  let y;\n  if (seisA.y instanceof Float64Array) {\n    y = new Float64Array(seisA.y.length);\n  } else {\n    y = new Float32Array(seisA.y.length);\n  }\n  for (let i = 0; i < seisA.y.length; i++) {\n    y[i] = Math.sqrt(seisA.y[i] * seisA.y[i]\n      + seisB.y[i] * seisB.y[i]\n      + seisC.y[i] * seisC.y[i]);\n  }\n  let outSeis = seisA.cloneWithNewData(y);\n  outSeis.channelCode = seisA.chanCode.slice(0,2)+\"M\";\n  return outSeis;\n}\n","// @flow\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as seedcodec from './seedcodec';\nimport {SeismogramSegment, Seismogram} from './seismogram';\nimport {DataRecord} from './miniseed';\nimport moment from 'moment';\n\n/** const for unknown data version, 0 */\nexport const UNKNOWN_DATA_VERSION = 0;\n/** const for offset to crc in record, 28 */\nexport const CRC_OFFSET = 28;\n/** const for size of fixed header part of record, 40 */\nexport const FIXED_HEADER_SIZE=40;\n/** const for fdsn prefix for extra headers, FDSN */\nexport const FDSN_PREFIX = 'FDSN';\n/** const for little endian, true */\nexport const LITTLE_ENDIAN = true;\n\n/**\n * parse arrayBuffer into an array of XSeedRecords.\n *\n * @param arrayBuffer bytes to extract xseed records from\n * @returns array of all xseed records contained in the buffer\n */\nexport function parseXSeedRecords(arrayBuffer: ArrayBuffer): Array<XSeedRecord> {\n  let dataRecords = [];\n  let offset = 0;\n  while (offset < arrayBuffer.byteLength) {\n    let dataView = new DataView(arrayBuffer, offset);\n    if (! (dataView.getUint8(0) === 77 && dataView.getUint8(1) === 83)) {\n      throw new Error(`First byte must be M=77 S=83 at offset=${offset}, but was ${dataView.getUint8(0)} ${dataView.getUint8(1)}`);\n    }\n    let dr = XSeedRecord.createFromDataView(dataView);\n    dataRecords.push(dr);\n    offset += dr.getSize();\n  }\n  return dataRecords;\n}\n\n/**\n * Represents a xSEED Data Record, with header, extras and data.\n *\n * @param header xseed fixed record header\n * @param extraHeaders json compatible object with extra headers\n * @param rawData waveform data, in correct compression for value in header\n */\nexport class XSeedRecord {\n  header: XSeedHeader;\n  extraHeaders: any;\n  rawData: DataView;\n  constructor(header: XSeedHeader, extraHeaders: any, rawData: DataView) {\n    this.header = header;\n    this.rawData = rawData;\n    this.extraHeaders = extraHeaders;\n  }\n  /**\n   * Parses an xseed data record from a DataView.\n   *\n   * @param   dataView bytes to parse\n   * @returns parsed record\n   */\n  static createFromDataView(dataView: DataView): XSeedRecord {\n    const header = XSeedHeader.createFromDataView(dataView);\n    let extraDataView = new DataView(dataView.buffer,\n                             dataView.byteOffset+header.getSize(),\n                             header.extraHeadersLength);\n    const extraHeaders = parseExtraHeaders(extraDataView);\n    let sliceStart = dataView.byteOffset+header.getSize()+header.extraHeadersLength;\n    const rawData = new DataView(dataView.buffer.slice(sliceStart, sliceStart+ header.dataLength));\n\n    const xr = new XSeedRecord(header, extraHeaders, rawData);\n    return xr;\n  }\n  /**\n   * Calculates the byte size of the xseed record to hold this data.\n   *\n   * @returns size in bytes\n   */\n  getSize() {\n    let json = JSON.stringify(this.extraHeaders);\n    if (json.length > 2) {\n      this.header.extraHeadersLength = json.length;\n    } else {\n      this.header.extraHeadersLength = 0;\n    }\n    return this.header.getSize()+this.header.extraHeadersLength+this.header.dataLength;\n  }\n    /** Decompresses the data , if the compression\n     *  type is known\n     *\n     * @returns decompressed data as a typed array, usually Int32Array or Float32Array\n     */\n  decompress() {\n    return this.asEncodedDataSegment().decode();\n  }\n  /**\n   * Wraps data in an EncodedDataSegment for future decompression.\n   *\n   * @returns waveform data\n   */\n  asEncodedDataSegment() {\n    return new seedcodec.EncodedDataSegment(this.header.encoding,\n                                  this.rawData,\n                                  this.header.numSamples,\n                                  LITTLE_ENDIAN);\n  }\n  /**\n   * Just the header.identifier, included as codes() for compatiblility\n   * with parsed miniseed2 data records.\n   *\n   * @returns string identifier\n   */\n  codes() {\n      return this.header.identifier;\n  }\n\n  /**\n   * Saves xseed record into a DataView, recalculating crc.\n   *\n   * @param   dataView DataView to save into, must be large enough to hold the record.\n   * @returns the number of bytes written to the DataView, can be used as offset\n   * for writting the next record.\n   */\n  save(dataView: DataView): number {\n    let json = JSON.stringify(this.extraHeaders);\n    if (json.length > 2) {\n      this.header.extraHeadersLength = json.length;\n    } else {\n      this.header.extraHeadersLength = 0;\n    }\n    // don't write crc as we need to recalculate\n    let offset = this.header.save(dataView, 0, true);\n    if (json.length > 2) {\n      for (let i=0; i<json.length; i++) {\n        // not ok for unicode?\n        dataView.setInt8(offset, json.charCodeAt(i));\n        offset++;\n      }\n    }\n    if (this.rawData !== null ) {\n      for (let i=0; i< this.rawData.byteLength; i++) {\n        dataView.setUint8(offset+i, this.rawData.getUint8(i));\n      }\n      offset += this.rawData.byteLength;\n    } else {\n      throw new Error(\"rawData is null\");\n    }\n\n    let dvcrc = dataView.getUint32(CRC_OFFSET, true);\n    if (dvcrc !== 0) {\n      throw new Error(`CRC is not zero before calculate! ${dvcrc}`);\n    }\n    let crc = calculateCRC32C(dataView.buffer);\n    dataView.setUint32(CRC_OFFSET, crc, true);\n    return offset;\n  }\n\n  /**\n   * Calculates crc by saving to a DataView, which sets the crc header to zero\n   * and then calculates it based on the rest of the record.\n   *\n   * @returns         crc pulled from saved xseed record\n   */\n  calcCrc(): number {\n    let size = this.getSize();\n    let buff = new ArrayBuffer(this.getSize());\n    let dataView = new DataView(buff);\n    let offset = this.save(dataView);\n    if (offset !== size) {\n      throw new Error(`expect to write ${size} bytes but only ${offset}`);\n    }\n    let crc = dataView.getUint32(CRC_OFFSET, true);\n    return crc;\n  }\n}\n\n/**\n * Fixed header of an XSeed data record.\n */\nexport class XSeedHeader {\n  recordIndicator: string;\n  formatVersion: number;\n  flags: number;\n  nanosecond: number;\n  year: number;\n  dayOfYear: number;\n  hour: number;\n  minute: number;\n  second: number;\n  encoding: number;\n  sampleRatePeriod: number;\n  sampleRate: number;\n  numSamples: number;\n  crc: number;\n  publicationVersion: number;\n  identifierLength: number;\n  extraHeadersLength: number;\n  identifier: string;\n  extraHeaders: any;\n  dataLength: number;\n  start: moment;\n  end: moment;\n  constructor() {\n    // empty construction\n    this.recordIndicator = 'MS';\n    this.formatVersion = 3;\n    this.flags = 0;\n    this.nanosecond=0;\n    this.year = 1970;\n    this.dayOfYear=1;\n    this.hour=0;\n    this.minute=0;\n    this.second=0;\n    this.encoding = 3; // 32 bit ints\n    this.sampleRatePeriod = 1;\n    this.numSamples = 0;\n    this.crc = 0;\n    this.publicationVersion = UNKNOWN_DATA_VERSION;\n    this.identifierLength = 0;\n    this.extraHeadersLength = 2;\n    this.identifier = \"\";\n    this.extraHeaders = {};\n    this.dataLength = 0;\n  }\n  /**\n   * Parses an xseed fixed header from a DataView.\n   *\n   * @param   dataView bytes to parse\n   * @returns parsed header object\n   */\n  static createFromDataView(dataView: DataView): XSeedHeader {\n    const header = new XSeedHeader();\n    header.recordIndicator = makeString(dataView, 0,2);\n    if ( ! header.recordIndicator === 'MS') {\n      throw new Error(\"First 2 bytes of record should be MS but found \"+header.recordIndicator);\n    }\n    header.formatVersion = dataView.getUint8(2);\n    if (header.formatVersion !== 3) {\n      throw new Error(\"Format Version should be 3, \"+header.formatVersion);\n    }\n    header.flags = dataView.getUint8(3);\n    const headerLittleEndian = true;\n    header.nanosecond = dataView.getInt32(4, headerLittleEndian);\n    header.year = dataView.getInt16(8, headerLittleEndian);\n    if (checkByteSwap(header.year)) {\n      throw new Error(\"Looks like wrong byte order, year=\"+header.year);\n    }\n    header.dayOfYear = dataView.getInt16(10, headerLittleEndian);\n    header.hour = dataView.getUint8(12);\n    header.minute = dataView.getUint8(13);\n    header.second = dataView.getUint8(14);\n    header.encoding = dataView.getUint8(15);\n    header.sampleRatePeriod = dataView.getFloat64(16, headerLittleEndian);\n    if (header.sampleRatePeriod < 0) {\n      header.sampleRate = 1 / header.sampleRatePeriod;\n    } else {\n      header.sampleRate = header.sampleRatePeriod;\n    }\n    header.numSamples = dataView.getUint32(24, headerLittleEndian);\n    header.crc = dataView.getUint32(28, headerLittleEndian);\n    header.publicationVersion = dataView.getUint8(32);\n    header.identifierLength = dataView.getUint8(33);\n    header.extraHeadersLength = dataView.getUint16(34, headerLittleEndian);\n    header.dataLength = dataView.getUint32(36, headerLittleEndian);\n    header.identifier = makeString(dataView, 40, header.identifierLength);\n    // lazily extract json and data\n\n    header.start = header._startToMoment();\n    header.end = header.timeOfSample(header.numSamples-1);\n    return header;\n  }\n  /**\n   * Calculates size of the fixed header including the identifier, but without\n   * the extra headers.\n   *\n   * @returns size in bytes of fixed header\n   */\n  getSize() {\n    return FIXED_HEADER_SIZE+this.identifier.length;\n  }\n  toString() {\n    return this.identifier+\" \"+this.start.toISOString()+\" \"+this.encoding;\n  }\n  /**\n   * Converts start time header fields to ISO8641 time string.\n   *\n   * @returns iso start time\n   */\n  getStartFieldsAsISO() {\n    return ''+this.year+'-'+padZeros(this.dayOfYear, 3)\n      +'T'+padZeros(this.hour, 2)+':'+padZeros(this.minute, 2)+\":\"\n      +padZeros(this.second, 2)+\".\"+padZeros(this.nanosecond, 9)+\"Z\";\n  }\n  /**\n   * Calculates time of the ith sample.\n   *\n   * @param   i sample number\n   * @returns the time\n   */\n  timeOfSample(i: number) {\n    return moment.utc(this.start).add(1000*i/this.sampleRate, 'milliseconds');\n  }\n  /**\n   * Writes to the given dataview.\n   *\n   * @param   dataView write buffer\n   * @param   offset   offset within the buffer\n   * @param   zeroCrc  optionally zero out the crc field in order to recalculate\n   * @returns          new offset after this record\n   */\n  save(dataView: DataView, offset: number =0, zeroCrc: boolean =false) {\n    dataView.setInt8(offset, this.recordIndicator.charCodeAt(0));\n    offset++;\n    dataView.setInt8(offset, this.recordIndicator.charCodeAt(1));\n    offset++;\n    dataView.setInt8(offset, this.formatVersion);\n    offset++;\n    dataView.setInt8(offset, this.flags);\n    offset++;\n    dataView.setUint32(offset, this.nanosecond, true);\n    offset+=4;\n    dataView.setUint16(offset, this.year, true);\n    offset+=2;\n    dataView.setUint16(offset, this.dayOfYear, true);\n    offset+=2;\n    dataView.setInt8(offset, this.hour);\n    offset++;\n    dataView.setInt8(offset, this.minute);\n    offset++;\n    dataView.setInt8(offset, this.second);\n    offset++;\n    dataView.setInt8(offset, this.encoding);\n    offset++;\n    dataView.setFloat64(offset, this.sampleRatePeriod, true);\n    offset+=8;\n    dataView.setUint32(offset, this.numSamples, true);\n    offset += 4;\n    if (zeroCrc) {\n      dataView.setUint32(offset, 0, true);\n    } else {\n      dataView.setUint32(offset, this.crc, true);\n    }\n    offset += 4;\n    dataView.setInt8(offset, this.publicationVersion);\n    offset++;\n    dataView.setInt8(offset, this.identifier.length);\n    offset++;\n    dataView.setUint16(offset, this.extraHeadersLength, true);\n    offset += 2;\n    dataView.setUint32(offset, this.dataLength, true);\n    offset+=4;\n    for (let i=0; i<this.identifier.length; i++) {\n// not ok for unicode?\n      dataView.setInt8(offset, this.identifier.charCodeAt(i));\n      offset++;\n    }\n\n    return offset;\n  }\n  /**\n   * Converts header start time to moment\n   *\n   * @returns         start time as moment\n   */\n  _startToMoment(): moment {\n    let m = new moment.utc([this.year, 0, 1, this.hour, this.minute, this.second, 0]);\n    m.add(Math.round(this.nanosecond / 1000000), 'ms');\n    m.dayOfYear(this.dayOfYear);\n    if (m.isValid()) {\n      return m;\n    } else {\n      throw new Error(`Header start is invalid moment: ${this.year} ${this.dayOfYear} ${this.hour} ${this.minute} ${this.second} ${this.nanosecond}`);\n    }\n  }\n}\n\n/**\n * Parses extra headers as json.\n *\n * @param   dataView json bytes as DataView\n * @returns           json object\n */\nexport function parseExtraHeaders(dataView: DataView) {\n  if (dataView.byteLength === 0) {\n    return {};\n  }\n  let firstChar = dataView.getUint8(0);\n  if (firstChar === 123) {\n    // looks like json, '{' is ascii 123\n    return JSON.parse(makeString(dataView, 0, dataView.byteLength));\n  } else {\n    // $FlowFixMe\n    throw new Error(\"do not understand extras with first char val: \"+firstChar+\" \"+(firstChar===123));\n  }\n}\n\n/**\n * Creates a string version of a number with zero prefix padding. For example\n * padZeros(5, 3) is 005.\n *\n * @param   val number to stringify\n * @param   len total length of string\n * @returns      zero padded string\n */\nexport function padZeros(val: number, len: number) {\n  let out = \"\"+val;\n  while (out.length < len) {\n    out = \"0\"+out;\n  }\n  return out;\n}\n\n/**\n * creates a string from bytes in a DataView.\n *\n * @param   dataView data bytes\n * @param   offset   offset to first byte to use\n * @param   length   number of bytes to convert\n * @returns           string resulting from utf-8 conversion\n */\nexport function makeString(dataView: DataView, offset: number, length: number): string {\n  const utf8decoder = new TextDecoder('utf-8');\n  let u8arr = new Uint8Array(dataView.buffer, dataView.byteOffset+offset, length);\n  return utf8decoder.decode(u8arr).trim();\n}\n\n\n\n/**\n * Sanity checks on year to see if a record might be in the wrong byte order.\n * Checks year betwee 1960 and 2055.\n *\n * @param   year year as number to test\n * @returns        true is byte order appears to be wrong, false if it seems ok\n */\nfunction checkByteSwap(year: number) {\n  return year < 1960 || year > 2055;\n}\n\n/**\n * Checks if two xseed records are (nearly) contiguous.\n *\n * @param   dr1 first record\n * @param   dr2 second record\n * @param   sampRatio tolerence expressed as ratio of sample period, default 1.5\n * @returns      true if contiguous\n */\nexport function areContiguous(dr1: XSeedRecord, dr2: XSeedRecord, sampRatio: number =1.5): boolean {\n    let h1 = dr1.header;\n    let h2 = dr2.header;\n    return h1.end.isBefore( h2.start )\n        && moment.utc(h1.end).add(sampRatio/h1.sampleRate, 'seconds').isSameOrAfter(h2.start);\n}\n\n /** concatentates a sequence of XSeedRecords into a single seismogram object.\n  * Assumes that they are all contiguous (no gaps or overlaps) and in order.\n  * Header values from the first XSeedRecord are used.\n  *\n  * @param contig array of xseed records\n  * @returns seismogram segment for the records\n  */\nexport function createSeismogramSegment(contig: Array<XSeedRecord>): SeismogramSegment {\n  let contigData = contig.map(dr => dr.asEncodedDataSegment());\n  let out = new SeismogramSegment(contigData,\n                                 contig[0].header.sampleRate,\n                                 contig[0].header.start);\n  let codes = contig[0].header.identifier.slice(5).split('_');\n  out.networkCode = codes[0];\n  out.stationCode = codes[1];\n  out.locationCode = codes[2];\n  out.channelCode = codes[3]+codes[4]+codes[5];\n\n  return out;\n}\n\n\n /**\n  * Merges xseed records into a Seismogram object, each of\n  * which consists of SeismogramSegment objects\n  * containing the data as EncodedDataSegment objects. DataRecords are\n  * sorted by startTime.\n  * This assumes all data records are from the same channel, byChannel\n  * can be used first if multiple channels may be present. Gaps may be present.\n  *\n  * @param drList list of xseed records to convert\n  * @returns the seismogram\n  */\nexport function merge(drList: Array<XSeedRecord>): Seismogram {\n  let out = [];\n  let currDR;\n  drList.sort(function(a,b) {\n      return a.header.start.getTime() - b.header.start.getTime();\n  });\n  let contig = [];\n  for (let i=0; i<drList.length; i++) {\n    currDR = drList[i];\n    if ( contig.length === 0 ) {\n      contig.push(currDR);\n    } else if (areContiguous(contig[contig.length-1], currDR)) {\n      contig.push(currDR);\n    } else {\n      //found a gap\n      out.push(createSeismogramSegment(contig));\n      contig = [ currDR ];\n    }\n  }\n  if (contig.length > 0) {\n      // last segment\n      out.push(createSeismogramSegment(contig));\n      contig = [];\n  }\n  return new Seismogram(out);\n}\n\n/**\n * splits a list of data records by channel identifier, returning an object\n * with each NSLC mapped to an array of data records.\n *\n * @param drList array of xseed records\n * @returns map of channel id to array of xseed records, possibly not contiguous\n */\nexport function byChannel(drList: Array<XSeedRecord>): Map<string, Array<XSeedRecord>> {\n  let out: Map<string, Array<XSeedRecord>> = new Map();\n  let key;\n  for (let i=0; i<drList.length; i++) {\n    let currDR = drList[i];\n    key = currDR.codes();\n    let drArray = out.get(key);\n    if ( ! drArray) {\n      drArray = [currDR];\n      out.set(key, drArray);\n    } else {\n      drArray.push(currDR);\n    }\n  }\n  return out;\n}\n\n/**\n * splits the XSeedRecords by channel and creates a single\n * Seismogram for each channel.\n *\n * @param   drList XSeedRecords array\n * @returns         Map of code to Seismogram\n */\nexport function seismogramPerChannel(drList: Array<XSeedRecord> ): Array<Seismogram> {\n  let out = [];\n  let byChannelMap = byChannel(drList);\n  byChannelMap.forEach(segments => out.push(merge(segments)));\n  return out;\n}\n\n\n/* MSeed2 to xSeed converstion */\n\n/**\n * Convert array of Miniseed2 DataRecords into an array of XSeedRecords.\n *\n * @param   mseed2 array of DataRecords\n * @returns         array of XSeedRecords\n */\nexport function convertMS2toXSeed(mseed2: Array<DataRecord>): Array<XSeedRecord> {\n  let out = [];\n  for (let i=0; i< mseed2.length; i++) {\n    out.push(convertMS2Record(mseed2[i]));\n  }\n  return out;\n}\n\n/**\n * Converts a single miniseed2 DataRecord into a single XSeedRecord.\n *\n * @param   ms2record Miniseed2 DataRecord to convert\n * @returns            XSeedRecord\n */\nexport function convertMS2Record(ms2record: DataRecord): XSeedRecord {\n  let xHeader = new XSeedHeader();\n  let xExtras = {};\n  let ms2H = ms2record.header;\n  xHeader.flags = (ms2H.activityFlags & 1) *2\n     + (ms2H.ioClockFlags & 64 ) * 4\n     + (ms2H.dataQualityFlags & 16) * 8;\n  xHeader.year = ms2H.startBTime.year;\n  xHeader.dayOfYear = ms2H.startBTime.jday;\n  xHeader.hour = ms2H.startBTime.hour;\n  xHeader.minute = ms2H.startBTime.min;\n  xHeader.second = ms2H.startBTime.sec;\n  xHeader.nanosecond = ms2H.startBTime.tenthMilli*100000+ms2H.startBTime.microsecond*1000;\n  xHeader.sampleRatePeriod = ms2H.sampleRate >= 1 ? ms2H.sampleRate : (-1.0 / ms2H.sampleRate);\n  xHeader.encoding = ms2record.header.encoding;\n  xHeader.publicationVersion = UNKNOWN_DATA_VERSION;\n  xHeader.dataLength = ms2record.data.byteLength;\n  xHeader.identifier = FDSN_PREFIX + ':' +ms2H.netCode + SEP + ms2H.staCode + SEP + ( ms2H.locCode ? ms2H.locCode : \"\" ) + SEP + ms2H.chanCode;\n  xHeader.identifierLength = xHeader.identifier.length;\n\n  xHeader.numSamples = ms2H.numSamples;\n  xHeader.crc = 0;\n  if (ms2H.typeCode) {\n    if (ms2H.typeCode === 'R') {\n      xHeader.publicationVersion = 1;\n    } else if (ms2H.typeCode === 'D') {\n      xHeader.publicationVersion = 2;\n    } else if (ms2H.typeCode === 'Q') {\n      xHeader.publicationVersion = 3;\n    } else if (ms2H.typeCode === 'M') {\n      xHeader.publicationVersion = 4;\n    }\n    if (ms2H.typeCode !== 'D') {\n      xExtras.DataQuality = ms2H.typeCode;\n    }\n  }\n  if (xHeader.nanosecond < 0) {\n    xHeader.second -= 1;\n    xHeader.nanosecond += 1000000000;\n    if (xHeader.second < 0) {\n// might be wrong for leap seconds\n      xHeader.second += 60;\n      xHeader.minute -= 1;\n      if (xHeader.minute < 0) {\n        xHeader.minute += 60;\n        xHeader.hour -= 1;\n        if (xHeader.hour < 0) {\n          xHeader.hour += 24;\n          xHeader.dayOfYear =- 1;\n          if (xHeader.dayOfYear < 0) {\n// wrong for leap years\n            xHeader.dayOfYear += 365;\n            xHeader.year -= 1;\n          }\n        }\n      }\n    }\n  }\n  xHeader.extraHeadersLength = JSON.stringify(xExtras).length;\n  // need to convert if not steim1 or 2\n  let out = new XSeedRecord(xHeader, xExtras, ms2record.data);\n  return out;\n}\n\n/**\n * Default separator for channel id.\n */\nconst SEP = '_';\n\n/**\n * Copy from https://github.com/ashi009/node-fast-crc32c/blob/master/impls/js_crc32c.js\n * and modify to use ArrayBuffer.\n *\n * This code is a manual javascript translation of c code generated by\n * pycrc 0.7.1 (http://www.tty1.net/pycrc/). Command line used:\n * './pycrc.py --model=crc-32c --generate c --algorithm=table-driven'\n */\nconst kCRCTable = new Int32Array([\n  0x00000000, 0xf26b8303, 0xe13b70f7, 0x1350f3f4,\n  0xc79a971f, 0x35f1141c, 0x26a1e7e8, 0xd4ca64eb,\n  0x8ad958cf, 0x78b2dbcc, 0x6be22838, 0x9989ab3b,\n  0x4d43cfd0, 0xbf284cd3, 0xac78bf27, 0x5e133c24,\n  0x105ec76f, 0xe235446c, 0xf165b798, 0x030e349b,\n  0xd7c45070, 0x25afd373, 0x36ff2087, 0xc494a384,\n  0x9a879fa0, 0x68ec1ca3, 0x7bbcef57, 0x89d76c54,\n  0x5d1d08bf, 0xaf768bbc, 0xbc267848, 0x4e4dfb4b,\n  0x20bd8ede, 0xd2d60ddd, 0xc186fe29, 0x33ed7d2a,\n  0xe72719c1, 0x154c9ac2, 0x061c6936, 0xf477ea35,\n  0xaa64d611, 0x580f5512, 0x4b5fa6e6, 0xb93425e5,\n  0x6dfe410e, 0x9f95c20d, 0x8cc531f9, 0x7eaeb2fa,\n  0x30e349b1, 0xc288cab2, 0xd1d83946, 0x23b3ba45,\n  0xf779deae, 0x05125dad, 0x1642ae59, 0xe4292d5a,\n  0xba3a117e, 0x4851927d, 0x5b016189, 0xa96ae28a,\n  0x7da08661, 0x8fcb0562, 0x9c9bf696, 0x6ef07595,\n  0x417b1dbc, 0xb3109ebf, 0xa0406d4b, 0x522bee48,\n  0x86e18aa3, 0x748a09a0, 0x67dafa54, 0x95b17957,\n  0xcba24573, 0x39c9c670, 0x2a993584, 0xd8f2b687,\n  0x0c38d26c, 0xfe53516f, 0xed03a29b, 0x1f682198,\n  0x5125dad3, 0xa34e59d0, 0xb01eaa24, 0x42752927,\n  0x96bf4dcc, 0x64d4cecf, 0x77843d3b, 0x85efbe38,\n  0xdbfc821c, 0x2997011f, 0x3ac7f2eb, 0xc8ac71e8,\n  0x1c661503, 0xee0d9600, 0xfd5d65f4, 0x0f36e6f7,\n  0x61c69362, 0x93ad1061, 0x80fde395, 0x72966096,\n  0xa65c047d, 0x5437877e, 0x4767748a, 0xb50cf789,\n  0xeb1fcbad, 0x197448ae, 0x0a24bb5a, 0xf84f3859,\n  0x2c855cb2, 0xdeeedfb1, 0xcdbe2c45, 0x3fd5af46,\n  0x7198540d, 0x83f3d70e, 0x90a324fa, 0x62c8a7f9,\n  0xb602c312, 0x44694011, 0x5739b3e5, 0xa55230e6,\n  0xfb410cc2, 0x092a8fc1, 0x1a7a7c35, 0xe811ff36,\n  0x3cdb9bdd, 0xceb018de, 0xdde0eb2a, 0x2f8b6829,\n  0x82f63b78, 0x709db87b, 0x63cd4b8f, 0x91a6c88c,\n  0x456cac67, 0xb7072f64, 0xa457dc90, 0x563c5f93,\n  0x082f63b7, 0xfa44e0b4, 0xe9141340, 0x1b7f9043,\n  0xcfb5f4a8, 0x3dde77ab, 0x2e8e845f, 0xdce5075c,\n  0x92a8fc17, 0x60c37f14, 0x73938ce0, 0x81f80fe3,\n  0x55326b08, 0xa759e80b, 0xb4091bff, 0x466298fc,\n  0x1871a4d8, 0xea1a27db, 0xf94ad42f, 0x0b21572c,\n  0xdfeb33c7, 0x2d80b0c4, 0x3ed04330, 0xccbbc033,\n  0xa24bb5a6, 0x502036a5, 0x4370c551, 0xb11b4652,\n  0x65d122b9, 0x97baa1ba, 0x84ea524e, 0x7681d14d,\n  0x2892ed69, 0xdaf96e6a, 0xc9a99d9e, 0x3bc21e9d,\n  0xef087a76, 0x1d63f975, 0x0e330a81, 0xfc588982,\n  0xb21572c9, 0x407ef1ca, 0x532e023e, 0xa145813d,\n  0x758fe5d6, 0x87e466d5, 0x94b49521, 0x66df1622,\n  0x38cc2a06, 0xcaa7a905, 0xd9f75af1, 0x2b9cd9f2,\n  0xff56bd19, 0x0d3d3e1a, 0x1e6dcdee, 0xec064eed,\n  0xc38d26c4, 0x31e6a5c7, 0x22b65633, 0xd0ddd530,\n  0x0417b1db, 0xf67c32d8, 0xe52cc12c, 0x1747422f,\n  0x49547e0b, 0xbb3ffd08, 0xa86f0efc, 0x5a048dff,\n  0x8ecee914, 0x7ca56a17, 0x6ff599e3, 0x9d9e1ae0,\n  0xd3d3e1ab, 0x21b862a8, 0x32e8915c, 0xc083125f,\n  0x144976b4, 0xe622f5b7, 0xf5720643, 0x07198540,\n  0x590ab964, 0xab613a67, 0xb831c993, 0x4a5a4a90,\n  0x9e902e7b, 0x6cfbad78, 0x7fab5e8c, 0x8dc0dd8f,\n  0xe330a81a, 0x115b2b19, 0x020bd8ed, 0xf0605bee,\n  0x24aa3f05, 0xd6c1bc06, 0xc5914ff2, 0x37faccf1,\n  0x69e9f0d5, 0x9b8273d6, 0x88d28022, 0x7ab90321,\n  0xae7367ca, 0x5c18e4c9, 0x4f48173d, 0xbd23943e,\n  0xf36e6f75, 0x0105ec76, 0x12551f82, 0xe03e9c81,\n  0x34f4f86a, 0xc69f7b69, 0xd5cf889d, 0x27a40b9e,\n  0x79b737ba, 0x8bdcb4b9, 0x988c474d, 0x6ae7c44e,\n  0xbe2da0a5, 0x4c4623a6, 0x5f16d052, 0xad7d5351\n]);\n\n/**\n * Copy from https://github.com/ashi009/node-fast-crc32c/blob/master/impls/js_crc32c.js\n * and modify to use ArrayBuffer. Rename calculateCRC32C\n *\n * This code is a manual javascript translation of c code generated by\n * pycrc 0.7.1 (http://www.tty1.net/pycrc/). Command line used:\n * './pycrc.py --model=crc-32c --generate c --algorithm=table-driven'\n *\n * @param buf input data\n * @param initial starting value, from earlier data\n *\n * @returns calculated crc32c value\n */\nexport function calculateCRC32C(buf: ArrayBuffer | Uint8Array, initial: number =0 ) {\n  if ( buf instanceof ArrayBuffer){\n    buf = new Uint8Array(buf);\n  } else if ( buf instanceof Uint8Array) {\n    // ok\n  } else {\n    throw new Error(\"arg must be ArrayBuffer or Uint8Array\");\n  }\n  let crc = (initial | 0) ^ -1;\n  for (let i = 0; i < buf.length; i++){\n    crc = kCRCTable[(crc ^ buf[i]) & 0xff] ^ (crc >>> 8);\n    let tmp = crc;\n    tmp = (tmp ^ -1) >>> 0;\n    if (tmp < 0) {\n      tmp = 0xFFFFFFFF + tmp + 1;\n    }\n  }\n  return (crc ^ -1) >>> 0;\n}\n\n/**\n * Convert crc as a number into a hex string.\n *\n * @param   crc crc as a number\n * @returns      hex representation\n */\nexport function crcToHexString(crc: number): string {\n  if (crc < 0) {\n    crc = 0xFFFFFFFF + crc + 1;\n  }\n  let s = crc.toString(16).toUpperCase();\n  return \"0x\"+s;\n}\n","// @flow\n//\n\n/*\n * Philip Crotwell\n * University of South Carolina, 2019\n * http://www.seis.sc.edu\n */\n\nimport * as cssutil        from './cssutil.js';\nimport * as datalink         from './datalink.js';\nimport * as datechooser      from './datechooser.js';\nimport * as distaz         from './distaz.js';\nimport * as fdsnavailability  from './fdsnavailability.js';\nimport * as fdsndatacenters      from './fdsndatacenters.js';\nimport * as fdsnevent      from './fdsnevent.js';\nimport * as fdsnstation    from './fdsnstation.js';\nimport * as fdsndataselect from './fdsndataselect.js';\nimport * as filter         from './filter.js';\nimport * as fft         from './fft.js';\nimport * as fftplot         from './fftplot.js';\nimport * as helicorder from './helicorder.js';\nimport * as knownDataCenters from './knowndatacenters.js';\nimport * as miniseed       from './miniseed.js';\nimport * as mseedarchive   from './mseedarchive.js';\nimport * as oregondsputil   from './oregondsputil.js';\nimport * as particlemotion        from './particlemotion.js';\nimport * as plotutil        from './plotutil.js';\nimport * as quakeml        from './quakeml.js';\nimport * as ringserverweb  from './ringserverweb.js';\nimport * as sacPoleZero    from './sacpolezero.js';\nimport * as seedcodec      from './seedcodec.js';\nimport * as seedlink       from './seedlink.js';\nimport * as seismogram     from './seismogram.js';\nimport * as seismograph     from './seismograph.js';\nimport * as seismographconfig     from './seismographconfig.js';\nimport * as stationxml     from './stationxml.js';\nimport * as taper     from './taper.js';\nimport * as transfer     from './transfer.js';\nimport * as traveltime     from './traveltime.js';\nimport * as util      from './util.js';\nimport * as vector      from './vector.js';\nimport * as xseed      from './xseed.js';\n\nimport * as OregonDSPTop from 'oregondsp';\nconst OregonDSP = OregonDSPTop.com.oregondsp.signalProcessing;\n\nimport moment from 'moment';\nimport RSVP from 'rsvp';\nimport * as d3 from 'd3';\n\n/**\n * Current version of seisplotjs\n */\nconst version = '2.0.1';\n\n/* reexport */\nexport { cssutil,\n         datalink,\n         datechooser,\n         distaz,\n         fdsnavailability,\n         fdsndatacenters,\n         fdsnevent,\n         fdsnstation,\n         fdsndataselect,\n         fft,\n         fftplot,\n         helicorder,\n         filter,\n         knownDataCenters,\n         miniseed,\n         mseedarchive,\n         oregondsputil,\n         particlemotion,\n         plotutil,\n         quakeml,\n         ringserverweb,\n         sacPoleZero,\n         seedcodec,\n         seedlink,\n         seismogram,\n         seismograph,\n         seismographconfig,\n         stationxml,\n         taper,\n         transfer,\n         traveltime,\n         util,\n         vector,\n         version,\n         xseed,\n         OregonDSP,\n         d3,\n         moment,\n         RSVP };\n"],"names":["insertCSS","cssText","head","document","Error","styleElement","createElement","type","appendChild","createTextNode","insertBefore","firstChild","RSVP","on","reason","console","assert","XML_MIME","JSON_MIME","JSONAPI_MIME","TEXT_MIME","hasArgs","value","arguments","length","hasNoArgs","isStringArg","isNumArg","isNonEmptyStringArg","isObject","obj","isDef","v","dataViewToString","dataView","out","i","byteLength","String","fromCharCode","getUint8","log","msg","stringify","d3","append","text","toString","name","moment","toISOString","constructor","calcClockOffset","serverTimeUTC","utc","diff","StartEndDuration","startTime","endTime","duration","clockOffset","charAt","_duration","Number","parseFloat","isDuration","JSON","_startTime","checkStringOrDate","_endTime","add","subtract","undefined","_clockOffset","start","end","contains","other","isAfter","isBefore","overlaps","intersect","tb","te","union","toIsoWoZ","d","isMoment","Date","lc","toLowerCase","makeParam","val","encodeURIComponent","date","substring","checkProtocol","_protocol","location","protocol","defaultFetchInitObj","mimeType","headers","Accept","cache","redirect","mode","referrer","doFetchWithTimeout","url","fetchInit","timeoutSec","controller","AbortController","signal","setTimeout","abort","absoluteUrl","URL","fetch","catch","err","then","response","ok","status","meanOfSlice","dataSlice","totalPts","reduce","acc","byTwo","Math","floor","slice","ASCII","SHORT","INT24","INTEGER","FLOAT","DOUBLE","STEIM1","STEIM2","CDSN","SRO","DWWSSN","CodecException","message","UnsupportedCompressionType","isFloatCompression","compressionType","EncodedDataSegment","numSamples","littleEndian","decode","decompress","Int32Array","offset","getInt16","getInt32","Float32Array","getFloat32","Float64Array","getFloat64","decodeSteim1","decodeSteim2","bias","buf","ArrayBuffer","samples","tempSamples","numFrames","current","firstData","lastValue","j","extractSteim1Samples","nibbles","currNibble","temp","currNum","n","getInt8","swapBytes","extractSteim2Samples","getUint32","dnib","tempInt","diffCount","bitSize","headerSize","OregonDSP","OregonDSPTop","oregondsp","signalProcessing","Complex","filter","iir","createComplex","real","imag","Complex_init","STAML_NS","Network","networkCode","stations","startDate","_startDate","endDate","_endDate","timeRange","codes","isTempNet","first","Station","network","stationCode","channels","Channel","station","channelCode","locationCode","_locationCode","hasInstrumentSensitivity","instrumentSensitivity","Response","InstrumentSensitivity","sensitivity","frequency","inputUnits","outputUnits","stages","Stage","decimation","gain","AbstractFilterType","PolesZeros","FIR","CoefficientsFilter","Decimation","Gain","parseStationXml","rawXml","top","documentElement","netArray","getElementsByTagNameNS","push","convertToNetwork","xml","netCode","_grabAttribute","rs","restrictedStatus","desc","_grabFirstElText","description","totSta","totalNumberStations","parseInt","staArray","s","convertToStation","staCode","lat","_grabFirstElFloat","latitude","lon","longitude","elev","elevation","_grabFirstEl","chanArray","c","convertToChannel","locCode","chanCode","depth","azimuth","dip","sampleRate","responseXml","r","item","convertToResponse","inst","convertToInstrumentSensitivity","xmlStages","jsStages","Array","from","map","stageXml","convertToStage","subEl","firstElementChild","childElementCount","localName","pzt","pzTransferFunctionType","nfa","normalizationFactor","nfr","normalizationFrequency","zeros","zeroEl","extractComplex","poles","poleEl","coeffXml","cft","cfTransferFunction","numerator","numerEl","textContent","denominator","denomEl","firXml","symmetry","hasAttribute","decimationXml","convertToDecimation","gainXml","convertToGain","decXml","insr","inputSampleRate","fac","_grabFirstElInt","factor","delay","correction","f","el","re","im","allStations","networks","allChannels","findChannels","tagName","getElementsByTagName","e","elText","a","getAttribute","_grabAttributeNS","namespace","getAttributeNS","parseUtil","QML_NS","BED_NS","IRIS_NS","ANSS_NS","ANSS_CATALOG_NS","USGS_HOST","UNKNOWN_MAG_TYPE","Quake","createFromXml","qml","host","publicId","otimeStr","time","allPickEls","allPicks","pickEl","Pick","allOriginEls","allOrigins","originEl","Origin","allMagEls","allMags","magEl","Magnitude","originList","magnitudeList","pickList","eventId","extractEventId","preferredOriginId","preferredMagnitudeId","o","preferredOrigin","util","magnitude","m","preferredMagnitude","catalogEventSource","publicid","parsed","exec","_time","arrivals","arrivalList","picks","pid","allArrivalEls","allArrivals","arrivalEl","Arrival","mag","_grabFirstElNS","phase","pick","arrivalQML","pickId","myPick","find","p","pickQML","waveformIdEl","parseQuakeML","eventArray","eventEl","elList","COUNT_UNIT","SeismogramSegment","yArray","_y","_compressed","isArray","every","ee","seedcodec","_sampleRate","yUnit","_endTime_cache","_endTime_cache_numPoints","y","isEncoded","outLen","numPoints","currIdx","cData","_invalidate_endTime_cache","timeOfSample","timeWindow","locId","getEncoded","yAtIndex","findMinMax","minMaxAccumulator","minAmp","MAX_SAFE_INTEGER","maxAmp","yData","indexOfTime","t","round","hasCodes","sep","seisId","replace","clone","clonedData","cloneWithNewData","clonedStartTime","cut","sIndex","milliDiff","eIndex","cutY","Seismogram","segmentArray","_segmentArray","checkAllSimilar","findStartEnd","forEach","checkSimilar","allStart","seis","min","allEnd","max","mean","meanVal","npts","segments","accumulator","seismogram","trim","cutSeisArray","seg","Boolean","trimSeisArray","isSameOrAfter","isSameOrBefore","break","breakStart","breakWindow","concat","isContiguous","prev","merge","outArray","cloned","newY","createFromContiguousData","NonContiguousData","ensureIsSeismogram","seisSeismogram","prototype","SeismogramDisplayData","_id","_seismogram","label","markerList","channel","_instrumentSensitivity","quakeList","alignmentTime","doShow","_statsCache","fromSeismogram","fromChannelAndTimeWindow","fromChannelAndTimes","addQuake","quake","q","addMarkers","markers","hasQuake","hasSeismogram","hasChannel","hasSensitivity","id","calcStats","stats","SeismogramDisplayStats","minMax","cloneWithNewSeismogram","Object","getOwnPropertyNames","cutSeis","trendSlope","sddList","sdd","initial_minAmp","initial_maxAmp","findMinMaxOverTimeRange","minMaxArr","mm","findStartEndOfSeismograms","data","findMinMaxOfSeismograms","MINISEED_MIME","parseDataRecords","arrayBuffer","dataRecords","DataView","dr","parseSingleDataRecord","header","recordSize","parseSingleDataRecordHeader","buffer","byteOffset","dataOffset","DataRecord","DataHeader","seq","makeString","typeCode","continuationCode","startBTime","parseBTime","headerByteSwap","checkByteSwap","sampRateFac","sampRateMul","activityFlags","ioClockFlags","dataQualityFlags","numBlockettes","timeCorrection","getUint16","blocketteOffset","blocketteList","calcSampleRate","toMoment","nextOffset","blockette","parseBlockette","Blockette1000","dataRecordLengthByte","encoding","wordOrder","Blockette1001","microsecond","Blockette100","body","timeQual","frameCount","flags","Blockette","asEncodedDataSegment","BTime","multiplier","pow","abs","charCode","byteSwap","year","jday","hour","sec","tenthMilli","toFixed","padStart","dayOfYear","isValid","bTime","areContiguous","dr1","dr2","h1","h2","valueOf","createSeismogramSegment","contig","contigData","drList","currDR","sort","b","byChannel","Map","key","drArray","get","set","seismogramPerChannel","byChannelMap","DATALINK_PROTOCOL","QUERY_MODE","STREAM_MODE","MAX_PROC_NUM","USER_BROWSER","DEFAULT_PROGRAM","DEFAULT_ARCH","ERROR","PACKET","STREAM","ENDSTREAM","MSEED_TYPE","IRIS_RINGSERVER_URL","defaultHandleResponse","DataLinkConnection","packetHandler","errorHandler","_mode","closeHandler","serverId","clientIdNum","random","programname","username","architecture","_responseResolve","_responseReject","setOnClose","connect","that","resolve","reject","webSocket","WebSocket","binaryType","onmessage","event","handle","onerror","handleError","onclose","closeEvent","onopen","datalink","sendId","idmsg","isConnected","stream","sendDLCommand","endStream","close","ensureDataLinkResponse","dlResponse","encodeDL","cmdLen","len","lenStr","rawPacket","binaryPacket","Uint8Array","packet","setUint8","charCodeAt","SPACE","sendDLBinary","send","command","dataString","stringToUint8Array","awaitDLBinary","promise","error","awaitDLCommand","writeAck","streamid","hpdatastart","hpdataend","momentToHPTime","dl","DataLinkResponse","ensureDataLinkPacket","DataLinkPacket","processid","info","infoType","positionAfter","positionAfterHPTime","hpTime","match","pattern","read","packetId","wsEvent","rawData","dlPreHeader","headerLen","startsWith","dv","parse","split","dataview","_miniseed","streamId","pktid","hppackettime","hppacketstart","hppacketend","dataSize","packetStart","hpTimeToMoment","packetEnd","packetTime","isMiniseed","endsWith","miniseed","hptime","binaryData","HourMinChooser","div","initialTime","updateCallback","mythis","dummyCallback","hourMinRegEx","myOnClick","target","hourMinField","popupDiv","hide","classed","attr","format","showHide","stopPropagation","property","style","h","hours","minutes","timeModified","hourDiv","hourSlider","nHour","minuteDiv","minuteSlider","nMinute","minute","updateTime","newTime","_adjustPopupPosition","window","addEventListener","removeEventListener","field","node","width","offsetWidth","height","offsetHeight","viewportWidth","innerWidth","viewportHeight","innerHeight","scrollTop","pageYOffset","left","offsetLeft","offsetTop","offsetParent","DateTimeChooser","second","millisecond","dateField","picker","isVisible","Pikaday","onSelect","pikaValue","getMoment","origTime","_internalSetTime","hourMin","getTime","setMoment","month","TimeRangeChooser","_mostRecentChanged","startDiv","startChooser","endChooser","getTimeRange","durationDiv","nDur","endDiv","chooser_css","pikaday_css","kmPerDeg","degtokm","deg","kmtodeg","km","distaz","lat1","lon1","lat2","lon2","result","stalat","stalon","evtlat","evtlon","delta","az","baz","scolat","slon","ecolat","elon","aa","bb","cc","dd","g","gg","hh","k","kk","rhs1","rhs2","sph","rad","del","daz","dbaz","PI","atan","tan","sin","cos","acos","atan2","FORMAT_JSON","FORMAT_TEXT","FORMAT_GEOCSV","FORMAT_REQUEST","EMPTY_JSON","SERVICE_VERSION","SERVICE_NAME","IRIS_HOST","AvailabilityQuery","_specVersion","_host","_port","_timeoutSec","specVersion","nodata","_nodata","port","_networkCode","_stationCode","_channelCode","se","quality","_quality","_merge","mergeGaps","_mergeGaps","show","_show","limit","_limit","orderby","_orderby","includeRestricted","_includerestricted","_format","timeout","query","queryJson","json","extractFromJson","formURL","contentType","includes","TypeError","extent","extentJson","postQuery","channelTimeList","postQueryJson","postExtent","postExtentJson","postJson","method","postRaw","hash","createPostBody","formBaseURL","jsonChanTimes","knownNets","datasources","ds","ss","earliest","latest","timespans","ts","makePostParm","ct","sta","net","colon","formVersionURL","queryVersion","substr","FORMAT_MINISEED","DataSelectQuery","minimumLength","_minimumLength","longestOnly","_longestOnly","repository","_repository","queryDataRecords","rawBuffer","querySeismograms","postQueryDataRecords","postQueryRaw","fetchResponse","ab","postQuerySeismograms","seisArray","createDataSelectQuery","params","loc","chan","starttime","endtime","minimumlength","longestonly","FAKE_EMPTY_XML","EventQuery","_eventId","updatedAfter","_updatedAfter","minMag","_minMag","maxMag","_maxMag","magnitudeType","_magnitudeType","minDepth","_minDepth","maxDepth","_maxDepth","minLat","_minLat","maxLat","_maxLat","minLon","_minLon","maxLon","_maxLon","_latitude","_longitude","minRadius","_minRadius","maxRadius","_maxRadius","includeArrivals","_includeArrivals","includeAllOrigins","_includeAllOrigins","includeAllMagnitudes","_includeAllMagnitudes","_offset","orderBy","_orderBy","catalog","_catalog","contributor","_contributor","isSomeParameterSet","queryRawXml","rawXmlText","DOMParser","parseFromString","formCatalogsURL","queryCatalogs","catalogArray","formContributorsURL","queryContributors","contributorArray","LEVEL_NETWORK","LEVEL_STATION","LEVEL_CHANNEL","LEVEL_RESPONSE","LEVELS","StationQuery","startBefore","_startBefore","endBefore","_endBefore","startAfter","_startAfter","endAfter","_endAfter","_includeRestricted","includeAvailability","_includeAvailability","matchTimeseries","_matchTimeseries","queryNetworks","queryStations","queryChannels","queryResponses","level","FDSN_HOST","DataCentersQuery","_name","services","_services","includeDataSets","_includedatasets","findFdsnAvailability","repoName","fdsnavailability","extractCompatibleServices","service","hostname","findFdsnDataSelect","fdsndataselect","findFdsnEvent","dcname","fdsnevent","findFdsnStation","fdsnstation","compatibleName","datacenters","dc","repositories","repo","compatibleWith","CenteredHilbertTransform","fir","equiripple","BAND_PASS","PassbandType","BANDPASS","LOW_PASS","LOWPASS","HIGH_PASS","HIGHPASS","amplitude","hypot","rMean","rmeanSeismogram","demeanY","gainCorrect","gainSeismogram","gainY","outS","createButterworth","numPoles","passband","lowFreqCorner","highFreqCorner","Butterworth","createChebyshevI","epsilon","ChebyshevI","createChebyshevII","ChebyshevII","applyFilter","iirFilter","filteredSegments","outData","filterInPlace","envelope","seisY","hilbert","hilbertY","outY","sqrt","lowEdge","highEdge","coeff","getCoefficients","isNaN","join","fftForward","FFTResult","createFromPackedFreq","calcDFT","timeseries","log2N","N","dft","fft","RDFT","inArray","fill","evaluate","inverseDFT","packedFreq","evaluateInverse","origLength","fftResult","recalcFromPackedFreq","createFromComplex","complexArray","complex","recalcFromComplex","createFromAmpPhase","amp","recalcFromAmpPhase","fundamentalFrequency","angle","L","modFreq","modComplex","Companion","ComplexFromPolar","fftInverse","DRAW_SVG","DRAW_CANVAS","DRAW_BOTH","DRAW_BOTH_ALIGN","SeismographConfig","drawingType","isXAxis","isXAxisTop","isYAxisNice","isYAxis","isYAxisRight","xScaleFormat","multiFormatHour","yScaleFormat","formatCountOrAmp","_title","xLabel","xLabelOrientation","xSublabel","yLabel","yLabelRight","yLabelOrientation","ySublabel","ySublabelTrans","ySublabelIsUnits","doRMean","doGain","windowAmp","fixedYScale","fixedTimeScale","doMarkers","markerTextOffset","markerTextAngle","markerFlagpoleBase","minHeight","margin","right","bottom","segmentDrawCompressedCutoff","maxZoomPixelPerSample","wheelZoom","connectSegments","lineColors","lineWidth","title","createAlignmentData","mid","fakeData","fakeSampleRate","asSeconds","fakeSeis","fakeSDD","getColorForIndex","formatCount","formatExp","formatMillisecond","formatSecond","formatMinute","formatHour","formatDay","formatMonth","formatYear","createSimpleFFTPlot","cssSelector","config","loglog","fftplot","FFTPlot","draw","createOverlayFFTPlot","fftResults","seismographConfig","svgParent","xScale","yScale","svg","ampPhaseList","ampSliceMap","maxFFTAmpLen","extentFFTData","freqMinMax","fftA","ap","ampSlice","currExtent","curr","rect","getBoundingClientRect","rangeRound","domain","xAxis","call","yAxis","pathg","minFreq","line","x","range","datum","fftplot_css","CLIP_PREFIX","Seismograph","inSvgParent","seisData","plotId","_lastID","beforeFirstDraw","seisDataList","_internalAppend","alignmentSeisData","canvas","maxHeight","calcTimeScaleDomain","yScaleData","yScaleRmean","linkedAmpScale","LinkedAmpScale","xScaleChangeListeners","currZoomXScale","tickFormat","xAxisTop","yAxisRight","z","zoomed","calcAmpScaleDomain","checkResize","fromSeismograms","seismogramList","outerWidth","outerHeight","calcWidthHeight","canvasHolder","insert","getComputedStyle","padTop","getPropertyValue","borderTop","drawSeismograms","drawAxis","drawAxisLabels","drawMarkers","printSizes","grect","crect","startenddur","drawSeismogramsCanvas","drawSeismogramsSvg","drawCanvasAlignment","elem","getClientRects","canvasNode","context","getContext","save","clearRect","plotStart","plotEnd","plotDuration","secondsPerPixel","ti","color","firstTime","samplesPerPixel","pixelsPerSample","startPixel","toDate","endPixel","leftVisibleSample","rightVisibleSample","leftVisiblePixel","ceil","beginPath","strokeStyle","moveTo","lineTo","stroke","restore","radius","minX","maxX","minY","maxY","selectAll","remove","circles","exit","enter","textcolor","textcolorArr","strokeText","fillStyle","arc","calcScaleAndZoom","rescaleYAxis","container","select","empty","clip","allSegG","traceJoin","subtraceJoin","segmentDrawLine","calcSecondsPerPixel","lineFunc","curve","_highlow","xScaleDomain","highlow","numHL","snippet","xScaleRange","highlowArray","svgG","scale","ticks","myThis","throttleRescale","clearTimeout","transition","drawTitle","drawXLabel","drawXSublabel","drawYLabel","drawYSublabel","cloneXScale","outxScale","resetZoom","redrawWithXScale","origXScale","transform","xt","rescaleX","prevZoomXScale","marker","textx","deltaY","texty","startEnd","undrawnMarkers","l","notifyScaleChange","allMarkers","markerG","labelSelection","radianTextAngle","each","drawG","innerTextG","textSel","link","selection","bbox","getBBox","warn","bboxH","bboxW","nOuterWidth","nOuterHeight","resizeXScale","throttle","func","throttleResize","resizeNeeded","setMargin","titleSVGText","side","hTranslate","svgText","oldMinMax","recalculate","nice","redoDisplayYScale","niceMinMax","firstSensitivity","allUnits","u","getSeismogramData","getDisplayDataForSeismogram","sd","linkXScaleTo","seismograph","destinationKey","unlinkXScaleTo","graphList","glist","_graphSet","Set","graph","unlink","delete","values","maxRange","cur","graphMaxRange","graphMin","graphMax","createMarkersForTravelTimes","ttime","seismograph_css","Helicorder","heliConfig","seismographArray","lineSeisConfig","maxVariation","posOffset","negOffset","secondsPerLine","numLines","lineTimes","calcTimesForLines","nl","baseHeight","overlap","lineTime","marginTop","lineNumber","seisDiv","lineCutSeis","lineSeisData","lineMean","numberOfLines","lineNum","HeliTimeRange","HelicorderConfig","helicorder_css","DS","EV","ST","RS","BestDCIdMap","initBestDCIdMap","knownDataCenters","knownDCs","knownDataCentersJsonURL","allDCTypes","getDefaultDC","getDataCenter","getKnownDataCenters","accesstime","updateKnownDataCenters","kdcs","doesSupport","supports","serviceHost","does","servicePort","Allowed_Flags","MSeedArchive","rootUrl","_rootUrl","_pattern","_recordSize","checkPattern","regexp","allFlags","indexOf","loadSeismograms","promiseArray","loadDataForChannel","pArray","request","loadData","basePattern","fillBasePattern","minSampleRate","recordTime","maxTimeForRecord","urlList","fillTimePattern","loadDataRecords","maxSampleRate","createPlotsBySelectorPromise","selector","startAttr","endAttr","statusText","seismograms","dataselect","all","createPlotsBySelector","resultArray","svgDiv","seisConfig","alphabeticalSort","traceA","traceB","createParticleMotionBySelector","addDivForParticleMotion","xSeisData","ySeisData","xSeis","ySeis","addParticleMotion","pmp","ParticleMotion","calcTimeWindow","xScaleRmean","calcScaleDomain","drawParticleMotion","lineG","xSegments","ySegments","segX","segY","drawParticleMotionForSegment","segA","segB","idxA","lastIdxA","idxB","lastIdxB","numPts","segmentG","path","rescaleAxis","halfDomainDelta","xMinMax","yMinMax","xMid","yMid","xNiceMinMax","xHalfNice","yNiceMinMax","yHalfNice","tw","particleMotion_css","ORG","RingserverConnection","pullId","pullRaw","formIdURL","raw","lines","organization","pullStreamIds","matchPattern","queryParams","formStreamIdsURL","pullStreams","formStreamsURL","accessTime","streams","vals","StreamStat","stationsFromStreams","nslc","nslcSplit","staKey","stat","startRaw","endRaw","calcLatency","SacPoleZero","constant","gamma","mulFactor","A0","toText","pz","numZeros","items","SEEDLINK_PROTOCOL","SeedlinkConnection","requestConfig","receiveMiniseedFn","errorFn","closeFn","setTimeCommand","setOnError","sendHello","sendCmdArray","handleMiniseed","slHeader","seqStr","rawsequence","sequence","replyMsg","cmd","accum","next","createCmdPromise","mycmd","taper","taperType","HANNING","w","omega","f0","f1","taperFactor","HAMMING","COSINE","transfer","lowCut","lowPass","highPass","highCut","sacPoleZero","convertToSacPoleZero","transferSacPZ","outSeis","transferSacPZSegment","sampFreq","freqValues","combine","calcResponse","unit","unitQty","Qty","isCompatible","UNITS","METER","METER_PER_SECOND","METER_PER_SECOND_PER_SECOND","trimmedZeros","reverse","idx","findIndex","splice","calcResponseFromSacPoleZero","deltaF","freq","respAtS","evalPoleZeroInverse","overComplex","timesReal","calcFreqTaper","freqComplex","timesComplex","zeroOut","poleOut","minusComplex","overReal","applyFreqTaper","COUNT","polesZeros","scaleUnit","to","fs","fn","calc_A0","scalar","sacPZ","ref_freq","numer","denom","a0","TEXT_FORMAT","JSON_FORMAT","SVG_FORMAT","TraveltimeQuery","_noheader","evdepth","_evdepth","distdeg","_distdeg","model","_model","phases","_phases","_stalat","_stalon","latLonFromStation","evlat","_evlat","evlon","_evlon","latLonFromQuake","noheader","convertToArrival","ttimeline","rayparam","takeoff","incident","puristdist","puristname","queryText","querySvg","textResponse","elArray","queryWadl","formWadlURL","queryTauPVersion","formTauPVersionURL","DtoR","RotatedSeismograms","radial","azimuthRadial","transverse","azimuthTransverse","rotation","rotate","seisA","azimuthA","seisB","azimuthB","rotOutRad","rotOutTrans","rotateSeismogramSegment","isSame","rotRadian","cosTheta","sinTheta","outSeisRad","outSeisTan","vectorMagnitude","seisC","vectorMagnitudeSegment","UNKNOWN_DATA_VERSION","CRC_OFFSET","FIXED_HEADER_SIZE","FDSN_PREFIX","LITTLE_ENDIAN","parseXSeedRecords","XSeedRecord","createFromDataView","getSize","extraHeaders","XSeedHeader","extraDataView","extraHeadersLength","parseExtraHeaders","sliceStart","dataLength","xr","identifier","setInt8","dvcrc","crc","calculateCRC32C","setUint32","calcCrc","size","buff","recordIndicator","formatVersion","nanosecond","sampleRatePeriod","publicationVersion","identifierLength","headerLittleEndian","_startToMoment","getStartFieldsAsISO","padZeros","zeroCrc","setUint16","setFloat64","firstChar","utf8decoder","TextDecoder","u8arr","sampRatio","convertMS2toXSeed","mseed2","convertMS2Record","ms2record","xHeader","xExtras","ms2H","SEP","DataQuality","kCRCTable","initial","crcToHexString","toUpperCase","version"],"mappings":"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"}